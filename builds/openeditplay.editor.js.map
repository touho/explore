{"version":3,"file":"openeditplay.editor.js","sources":["../src/util/assert.ts","../src/util/circularDependencyDetector.ts","../src/core/eventDispatcher.ts","../src/core/change.ts","../src/util/environment.ts","../src/core/serializable.ts","../src/core/property.ts","../src/core/propertyType.ts","../src/util/vector.ts","../src/util/color.ts","../src/core/dataTypes.ts","../src/core/propertyOwner.ts","../node_modules/redom/dist/redom.es.js","../src/util/popup.ts","../src/features/graphics.ts","../src/modules/backgroundGradient.ts","../src/core/game.ts","../src/features/physics.ts","../src/util/input.ts","../src/editor/editorEventDispatcher.ts","../src/util/performance.ts","../src/core/scene.ts","../src/core/component.ts","../src/core/componentData.ts","../src/core/serializableManager.ts","../src/core/entity.ts","../src/core/prototype.ts","../src/core/entityPrototype.ts","../src/core/prefab.ts","../src/core/level.ts","../src/components/Transform.ts","../src/components/TransformVariance.ts","../src/components/Shape.ts","../src/components/Sprite.ts","../src/components/Spawner.ts","../src/components/Trigger.ts","../src/components/Physics.ts","../src/components/Lifetime.ts","../src/components/Particles.ts","../src/util/algorithm.ts","../src/components/CharacterController.ts","../src/features/animation/animation.ts","../src/components/Animation.ts","../src/util/callLimiter.ts","../src/core/net.ts","../src/util/redomEvents.ts","../src/editor/util/options.ts","../src/editor/layout/moduleContainer.ts","../src/editor/layout/layout.ts","../src/editor/module/module.ts","../src/editor/editorSelection.ts","../src/editor/editorGlobals.ts","../src/editor/module/topBarModule.ts","../src/editor/util/sceneEditUtil.ts","../src/editor/components/EditorSelection.ts","../src/editor/views/popup/Popup.ts","../src/editor/views/popup/Confirmation.ts","../src/editor/views/popup/componentAdder.ts","../src/editor/views/popup/createObject.ts","../src/editor/widget/widgetManager.ts","../src/editor/module/sceneModule.ts","../src/editor/util/dragAndDrop.ts","../src/editor/views/treeView.ts","../src/editor/util/positionAngleScaleUtil.ts","../src/editor/module/objectsModule.ts","../src/editor/views/popup/PrototypeDeleteConfirmation.ts","../src/editor/module/prefabsModule.ts","../src/editor/module/levelsModule.ts","../src/editor/views/propertyEditor/propertyEditorTypes.ts","../src/editor/views/popup/objectMoreButtonContextMenu.ts","../src/editor/views/propertyEditor/util.ts","../src/editor/views/propertyEditor/propertyEditor.ts","../src/editor/module/prefabModule.ts","../src/editor/module/objectModule.ts","../src/editor/module/levelModule.ts","../src/editor/module/gameModule.ts","../src/editor/module/animationModule.ts","../src/editor/module/performanceModule.ts","../src/editor/module/perSecondModule.ts","../src/editor/views/animation/animationView.ts","../src/editor/help.ts","../src/editor/test/index.ts","../src/editor/views/popup/OKPopup.ts","../src/editor/editor.ts"],"sourcesContent":["// @ifndef OPTIMIZE\nexport const changeGetter = {\n\tget: () => null // override this\n};\n// @endif\n\nexport default function assert(condition, ...messages) {\n\t// @ifndef OPTIMIZE\n\tif (!condition) {\n\t\tconsole.warn('Assert', ...messages, '\\norigin', changeGetter.get());\n\t\tconsole.log(new Error().stack); // In own log call so that browser console can map from from bundle files to .ts files.\n\n\t\tdebugger; // Check console for error messages\n\n\t\tif (!window['force'])\n\t\t\tthrow new Error(messages.join('; '));\n\t}\n\t// @endif\n}\n","import assert from \"./assert\";\n\nconst SAVE_STACK_TRACE = false;\n\nexport class CircularDependencyDetector {\n    currentType: string = null;\n    chain: any[] = [];\n    timeout: any = null;\n\n    enter(type, data = null) {\n        this.chain.push({\n            type,\n            data,\n            stack: SAVE_STACK_TRACE ? (new Error()).stack : null\n        });\n        if (type !== this.currentType) {\n            if (this.chain.find((link, i) => link.type === type && i !== this.chain.length - 1)) {\n                console.warn('Change event circular dependency');\n                console.log('################################');\n                for (const part of this.chain) {\n                    console.warn(`%c${part.type}`, 'font-weight: bold; font-size: 16px');\n                    if (part.data && typeof part.data === 'object') {\n                        for (const key in part.data) {\n                            if (part.data[key] != null)\n                                console.warn(key + ':', part.data[key]);\n                        }\n                    } else {\n                        console.warn(part.data);\n                    }\n                    console.warn(part.stack || 'Turn SAVE_STACK_TRACE on to see stack traces. It will slow down the engine.');\n                    console.log('--------------------------------------');\n                }\n                assert(false, 'Change event circular dependency');\n            }\n            this.currentType = type;\n            if (!this.timeout) {\n                this.timeout = setTimeout(() => this.reset(), 0);\n            }\n        }\n    }\n    leave(type) {\n        if (this.chain.length > 0 && this.chain[this.chain.length - 1].type === type) {\n            this.chain.pop();\n            this.currentType = this.chain.length > 0 ? this.chain[this.chain.length - 1].type : null;\n        }\n    }\n    reset() {\n        this.currentType = null;\n        this.chain.length = 0;\n        this.timeout = null;\n    }\n}\n\nfunction test() {\n    let c = new CircularDependencyDetector();\n    c.enter('a');\n    c.enter('a');\n    c.enter('b');\n    c.enter('b');\n    c.leave('b');\n    c.leave('b');\n    c.enter('a');\n}\n\ntest();\n","import { CircularDependencyDetector } from \"../util/circularDependencyDetector\";\n\nexport enum GameEvent {\n    SCENE_START = 'scene start',\n    SCENE_PLAY = 'scene play',\n    SCENE_PAUSE = 'scene pause',\n    SCENE_RESET = 'scene reset',\n    SCENE_DRAW = 'scene draw', // parameters(scene: Scene)\n    SCENE_ZOOM_CHANGED = 'zoom changed',\n    GAME_LEVEL_COMPLETED = 'game level completed',\n    PROPERTY_VALUE_CHANGE = 'property change',\n    GLOBAL_CHANGE_OCCURED = 'change',\n    GLOBAL_SCENE_CREATED = 'scene created',\n    GLOBAL_GAME_CREATED = 'game created',\n    GLOBAL_ENTITY_CLICKED = 'global entity clicked', // parameters(entity, component)\n    ENTITY_CLICKED = 'entity clicked', // parameters(component)\n}\n\nexport type ListenerFunction = Function & { priority?: number };\n\nexport let eventDispatcherCallbacks = {\n    eventDispatchedCallback: null // (eventName, listenerCount) => void\n};\n\nconst globalCircularDependencyDetector = new CircularDependencyDetector();\n\nexport default class EventDispatcher {\n    _listeners: { [event in GameEvent]?: Array<ListenerFunction> } = {};\n\n    // priority should be a whole number between -100000 and 100000. a smaller priority number means that it will be executed first.\n    listen(event: GameEvent, callback: ListenerFunction, priority = 0) {\n        (callback as any).priority = priority + (listenerCounter++ / NUMBER_BIGGER_THAN_LISTENER_COUNT);\n        if (!this._listeners.hasOwnProperty(event)) {\n            this._listeners[event] = [];\n        }\n        let index = decideIndexOfListener(this._listeners[event], callback);\n        this._listeners[event].splice(index, 0, callback);\n        return () => {\n            let eventListeners = this._listeners[event];\n            if (!eventListeners) return; // listeners probably already deleted\n\n            let index = eventListeners.indexOf(callback);\n            if (index >= 0)\n                eventListeners.splice(index, 1);\n        };\n    }\n    dispatch(event: GameEvent, a?, b?, c?) {\n        let listeners = this._listeners[event];\n        if (!listeners)\n            return;\n\n        let circularDependencyEvent = (a && a.reference) ? (event + a.reference.id) : event;\n        globalCircularDependencyDetector.enter(circularDependencyEvent, {\n            this: this, a, b, c\n        });\n\n        if (eventDispatcherCallbacks.eventDispatchedCallback)\n            eventDispatcherCallbacks.eventDispatchedCallback(event, listeners.length);\n\n        for (let i = 0; i < listeners.length; i++) {\n            // @ifndef OPTIMIZE\n            try {\n                // @endif\n\n                listeners[i](a, b, c);\n\n                // @ifndef OPTIMIZE\n            } catch (e) {\n                console.error(`Event ${event} listener crashed.`, this._listeners[event][i], e);\n            }\n            // @endif\n        }\n\n        globalCircularDependencyDetector.leave(circularDependencyEvent);\n    }\n\n    /**\n     * This is separate function for optimization.\n     * Returns promise that has value array, containing all results from listeners.\n     * Promise can reject.\n     *\n     * Handler of this kind of events should return either a value or a Promise.\n     */\n    dispatchWithResults(event: GameEvent, a?, b?, c?) {\n        let listeners = this._listeners[event];\n        if (!listeners)\n            return Promise.all([]);\n\n        let results = [];\n\n        if (eventDispatcherCallbacks.eventDispatchedCallback)\n            eventDispatcherCallbacks.eventDispatchedCallback(event, listeners.length);\n\n        for (let i = 0; i < listeners.length; i++) {\n            // @ifndef OPTIMIZE\n            try {\n                // @endif\n\n                results.push(listeners[i](a, b, c));\n\n                // @ifndef OPTIMIZE\n            } catch (e) {\n                console.error(`Event ${event} listener crashed.`, this._listeners[event][i], e);\n            }\n            // @endif\n        }\n\n        let promises = results.map(res => res instanceof Promise ? res : Promise.resolve(res));\n        return Promise.all(promises);\n    }\n\n    delete() {\n        this._listeners = {};\n    }\n}\n\nexport let globalEventDispatcher = new EventDispatcher();\nglobalEventDispatcher['globalEventDispatcher'] = true; // for debugging\n\nlet listenerCounter = 0;\nconst NUMBER_BIGGER_THAN_LISTENER_COUNT = 10000000000;\n\nfunction decideIndexOfListener(array, callback) {\n    let low = 0,\n        high = array.length,\n        priority = callback.priority;\n\n    while (low < high) {\n        let mid = low + high >>> 1;\n        if (array[mid].priority < priority) low = mid + 1;\n        else high = mid;\n    }\n    return low;\n}\n","import assert, { changeGetter as assertChangeGetter } from '../util/assert';\nimport Serializable, { serializableCallbacks } from './serializable';\nimport Property from './property';\nimport EventDispatcher, { GameEvent, globalEventDispatcher } from './eventDispatcher';\nimport { CircularDependencyDetector } from '../util/circularDependencyDetector';\n\nlet DEBUG_CHANGES = 0;\nlet CHECK_FOR_INVALID_ORIGINS = 1; // TODO: Do stuff in editor with this set to true to find nasty bugs.\n\nexport type Change = {\n\ttype: string;\n\treference: Serializable;\n\tid: string;\n\texternal: boolean; // caused by network\n\torigin?: any; // exists in editor, but not in optimized release\n\tvalue?: any;\n\tparent?: Serializable;\n}\n\n// reference parameters are not sent over net. they are helpers in local game instance\nexport let changeType = {\n\taddSerializableToTree: 'a', // parentId, reference\n\tsetPropertyValue: 's', // id, value\n\tdeleteSerializable: 'd', // id\n\tmove: 'm', // id, parentId\n\tdeleteAllChildren: 'c', // id\n};\n\nlet circularDependencyDetector = new CircularDependencyDetector();\nlet origin;\n\n// @ifndef OPTIMIZE\nlet previousVisualOrigin;\nfunction resetOrigin() {\n\torigin = null;\n}\nexport function getChangeOrigin() {\n\treturn origin;\n}\nassertChangeGetter.get = getChangeOrigin;\n// @endif\nexport function setChangeOrigin(_origin) {\n\t// @ifndef OPTIMIZE\n\tif (_origin !== origin) {\n\t\torigin = _origin;\n\t\tif (DEBUG_CHANGES && _origin && _origin !== previousVisualOrigin) {\n\t\t\tconsole.log('origin', previousVisualOrigin);\n\t\t\tpreviousVisualOrigin = _origin;\n\t\t}\n\n\t\tif (CHECK_FOR_INVALID_ORIGINS)\n\t\t\tsetTimeout(resetOrigin, 0);\n\t}\n\t// @endif\n}\n\nlet externalChange = false;\n\n// addChange needs to be called if editor, server or net game needs to share changes\nexport function addChange(type: string, reference: Serializable) {\n\t// @ifndef OPTIMIZE\n\tassert(origin, 'Change without origin!');\n\tconst circularEventId = type + (reference && reference.threeLetterType)\n\tcircularDependencyDetector.enter(circularEventId)\n\t// @endif\n\n\tif (!reference.id) return circularDependencyDetector.leave(circularEventId);\n\n\tlet change: Change = {\n\t\ttype,\n\t\treference,\n\t\tid: reference.id,\n\t\texternal: externalChange,\n\t\torigin // exists in editor, but not in optimized release\n\t};\n\tif (type === changeType.setPropertyValue) {\n\t\tchange.value = (reference as Property)._value;\n\t} else if (type === changeType.move) {\n\t\tchange.parent = reference._parent;\n\t} else if (type === changeType.addSerializableToTree) {\n\t\tchange.parent = reference._parent;\n\t\tdelete change.id;\n\t}\n\n\t// @ifndef OPTIMIZE\n\tif (DEBUG_CHANGES)\n\t\tconsole.log('change', change);\n\n\tlet previousOrigin = origin;\n\t// @endif\n\n\tglobalEventDispatcher.dispatch(GameEvent.GLOBAL_CHANGE_OCCURED, change);\n\n\t// @ifndef OPTIMIZE\n\tif (origin !== previousOrigin) {\n\t\tif (DEBUG_CHANGES)\n\t\t\tconsole.log('origin changed from', previousOrigin, 'to', origin && origin.constructor || origin);\n\t\torigin = previousOrigin;\n\t}\n\t// @endif\n\n\tcircularDependencyDetector.leave(circularEventId)\n}\n\nexport function executeExternal(callback) {\n\texecuteWithOrigin('external', () => {\n\t\tif (externalChange) return callback();\n\t\texternalChange = true;\n\t\tcallback();\n\t\texternalChange = false;\n\t});\n}\n\nexport function executeWithOrigin(origin, task) {\n\tconst oldOrigin = origin;\n\tsetChangeOrigin(origin);\n\ttask();\n\tsetChangeOrigin(oldOrigin);\n}\n","let isClient = typeof window !== 'undefined';\nlet isServer = typeof module !== 'undefined';\n\n// In Electron app, both are true\n// if (isClient && isServer)\n// \tthrow new Error('Can not be client and server at the same time.');\n\nexport { isClient, isServer };\n","import assert from '../util/assert';\nimport { changeType, addChange } from './change';\nimport { isClient } from '../util/environment';\nimport EventDispatcher, { globalEventDispatcher, GameEvent } from './eventDispatcher';\n\nexport const serializableCallbacks = {\n\taddSerializable: (serializable: Serializable) => { },\n\tremoveSerializable: (serializableId: string) => { },\n};\n\nconst CHARACTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; // 62 chars\nconst CHAR_COUNT = CHARACTERS.length;\n\nconst random = Math.random;\nexport function createStringId(threeLetterPrefix = '???', characters = 16) {\n\tlet id = threeLetterPrefix;\n\tfor (let i = characters - 1; i >= 0; --i)\n\t\tid += CHARACTERS[random() * CHAR_COUNT | 0];\n\treturn id;\n}\n\nlet serializableClasses = new Map();\n\nexport default class Serializable extends EventDispatcher {\n\tid: string;\n\tthreeLetterType: string;\n\tisRoot: boolean;\n\t_children: Map<string, Array<Serializable>> = new Map();\n\t_rootType: string;\n\t_parent: Serializable;\n\t_alive: boolean;\n\t_state: number;\n\n\tconstructor(predefinedId: string = '', skipSerializableRegistering = false) {\n\t\tsuper();\n\t\t// @ifndef OPTIMIZE\n\t\tassert(this.threeLetterType, 'Forgot to Serializable.registerSerializable your class?');\n\t\t// @endif\n\t\tthis._rootType = this.isRoot ? this.threeLetterType : null;\n\t\tif (skipSerializableRegistering)\n\t\t\treturn;\n\t\tif (predefinedId) {\n\t\t\tthis.id = predefinedId;\n\t\t} else {\n\t\t\tthis.id = createStringId(this.threeLetterType);\n\t\t}\n\t\t/*\n\t\tif (this.id.startsWith('?'))\n\t\t\tthrow new Error('?');\n\t\t\t*/\n\t\tserializableCallbacks.addSerializable(this);\n\t}\n\tmakeUpAName() {\n\t\treturn 'Serializable';\n\t}\n\tdelete() {\n\t\tsuper.delete();\n\t\tif (this._parent) {\n\t\t\tthis._parent.deleteChild(this);\n\t\t\treturn false;\n\t\t}\n\t\tthis.deleteChildren();\n\t\tthis._alive = false;\n\t\tthis._rootType = null;\n\t\tserializableCallbacks.removeSerializable(this.id);\n\t\tthis._state |= Serializable.STATE_DESTROY;\n\t\treturn true;\n\t}\n\tdeleteChildren() {\n\t\tif (this._children.size) {\n\t\t\tthis._children.forEach(array => {\n\t\t\t\tarray.forEach(child => {\n\t\t\t\t\tchild._parent = null;\n\t\t\t\t\tchild.delete();\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis._children.clear();\n\n\t\t\tif (this._parent) {\n\t\t\t\taddChange(changeType.deleteAllChildren, this);\n\t\t\t}\n\t\t}\n\t}\n\t// this is called right after constructor\n\tinitWithChildren(children: Array<Serializable> = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\t\tif (children.length > 0)\n\t\t\tthis.addChildren(children);\n\t\treturn this;\n\t}\n\taddChildren(children) {\n\t\tfor (let i = 0; i < children.length; i++)\n\t\t\tthis.addChild(children[i]);\n\t\treturn this;\n\t}\n\taddChild(child: Serializable): Serializable {\n\t\tthis._addChild(child);\n\n\t\tthis._state |= Serializable.STATE_ADDCHILD;\n\n\t\tif (this._rootType)\n\t\t\taddChange(changeType.addSerializableToTree, child);\n\t\treturn this;\n\t}\n\t_addChild(child: Serializable) {\n\t\tassert(child._parent === null);\n\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tif (array === undefined) {\n\t\t\tarray = [];\n\t\t\tthis._children.set(child.threeLetterType, array);\n\t\t}\n\t\tarray.push(child);\n\t\tchild._parent = this;\n\t\tchild._state |= Serializable.STATE_ADDPARENT;\n\n\t\tif (child._rootType !== this._rootType) // tiny optimization\n\t\t\tchild.setRootType(this._rootType);\n\n\t\treturn this;\n\t}\n\tfindChild(threeLetterType: string, filterFunction: (s: Serializable) => boolean, deep: boolean = false) {\n\t\tlet array = this._children.get(threeLetterType);\n\t\tif (!array) return null;\n\t\tif (filterFunction) {\n\t\t\tlet foundChild = array.find(filterFunction);\n\t\t\tif (foundChild) {\n\t\t\t\treturn foundChild;\n\t\t\t} else if (deep) {\n\t\t\t\tfor (let i = 0; i < array.length; ++i) {\n\t\t\t\t\tlet child = array[i];\n\t\t\t\t\tlet foundChild = child.findChild(threeLetterType, filterFunction, true);\n\t\t\t\t\tif (foundChild)\n\t\t\t\t\t\treturn foundChild;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn array[0];\n\t\t}\n\t}\n\tfindParent(threeLetterType: string, filterFunction: (Serializable) => boolean = null) {\n\t\tlet serializable: Serializable = this;\n\t\twhile (serializable) {\n\t\t\tif (serializable.threeLetterType === threeLetterType && (!filterFunction || filterFunction(serializable)))\n\t\t\t\treturn serializable;\n\t\t\tserializable = serializable._parent;\n\t\t}\n\t\treturn null;\n\t}\n\tgetRoot() {\n\t\tlet serializable: Serializable = this;\n\t\twhile (serializable._parent) {\n\t\t\tserializable = serializable._parent;\n\t\t}\n\t\treturn serializable;\n\t}\n\t// idx is optional\n\tdeleteChild(child: Serializable, idx?: number) {\n\t\taddChange(changeType.deleteSerializable, child);\n\t\tthis._detachChild(child, idx);\n\t\tchild.delete();\n\t\treturn this;\n\t}\n\t// idx is optional\n\t_detachChild(child: Serializable, idx: number = 0) {\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tassert(array, 'child not found');\n\t\tif (array[idx] !== child)\n\t\t\tidx = array.indexOf(child);\n\t\tassert(idx >= 0, 'child not found');\n\t\tarray.splice(idx, 1);\n\t\tif (array.length === 0)\n\t\t\tthis._children.delete(child.threeLetterType);\n\t\tchild._parent = null;\n\t\tchild.setRootType(null);\n\n\t\treturn this;\n\t}\n\tforEachChild(threeLetterType: string = null, callback: (s: Serializable) => void, deep: boolean = false) {\n\t\tfunction processArray(array) {\n\t\t\tarray.forEach(child => {\n\t\t\t\tcallback(child);\n\t\t\t\tdeep && child.forEachChild(threeLetterType, callback, true);\n\t\t\t});\n\t\t}\n\t\tif (threeLetterType) {\n\t\t\tprocessArray(this._children.get(threeLetterType) || []);\n\t\t} else {\n\t\t\tthis._children.forEach(processArray);\n\t\t}\n\t\treturn this;\n\t}\n\tmove(newParent: Serializable) {\n\n\t\tnewParent._addChild(this._detach());\n\t\taddChange(changeType.move, this);\n\n\t\treturn this;\n\t}\n\t_detach() {\n\t\tthis._parent && this._parent._detachChild(this);\n\t\treturn this;\n\t}\n\tgetParent() {\n\t\treturn this._parent || null;\n\t}\n\tgetChildren(threeLetterType: string) {\n\t\treturn this._children.get(threeLetterType) || [];\n\t}\n\ttoJSON() {\n\t\tlet json: any = {\n\t\t\tid: this.id\n\t\t};\n\t\tif (this._children.size > 0) {\n\t\t\tlet arrays = [];\n\t\t\t// prototypes must come before a level\n\t\t\tArray.from(this._children.keys()).sort((a, b) => a === 'prt' ? -1 : 1)\n\t\t\t\t.forEach(key => arrays.push(this._children.get(key)));\n\t\t\tjson.c = [].concat(...arrays).map(child => child.toJSON());\n\t\t}\n\t\treturn json;\n\t}\n\ttoString() {\n\t\treturn JSON.stringify(this.toJSON(), null, 4);\n\t}\n\tclone() {\n\t\tlet obj: Serializable = new (this.constructor as any)();\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\thasDescendant(child: Serializable) {\n\t\tif (!child) return false;\n\t\tlet parent = child._parent;\n\t\twhile (parent) {\n\t\t\tif (parent === this) return true;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn false;\n\t}\n\tsetRootType(rootType: string) {\n\t\tif (this._rootType === rootType)\n\t\t\treturn;\n\t\tthis._rootType = rootType;\n\n\t\t// Optimized\n\t\tlet i;\n\t\tthis._children.forEach(childArray => {\n\t\t\tfor (i = 0; i < childArray.length; ++i) {\n\t\t\t\tchildArray[i].setRootType(rootType);\n\t\t\t}\n\t\t});\n\t}\n\tisInTree() {\n\t\treturn !!this._rootType;\n\t}\n\tstatic fromJSON(json: any) {\n\t\tassert(typeof json.id === 'string' && json.id.length > 5, 'Invalid id.');\n\t\tlet fromJSON = serializableClasses.get(json.id.substring(0, 3));\n\t\tassert(fromJSON);\n\t\tlet obj;\n\t\ttry {\n\t\t\tobj = fromJSON(json);\n\t\t} catch (e) {\n\t\t\tif (isClient) {\n\t\t\t\tconsole.error(e);\n\t\t\t\tif (!window['force'])\n\t\t\t\t\tdebugger; // Type 'force = true' in console to ignore failed imports.\n\n\t\t\t\tif (!window['force'])\n\t\t\t\t\tthrow new Error();\n\t\t\t} else {\n\t\t\t\tconsole.log('Error fromJSON', e);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\tlet children = json.c ? json.c.map(child => Serializable.fromJSON(child)).filter(Boolean) : [];\n\t\tif (obj._state & Serializable.STATE_INIT)\n\t\t\tobj.addChildren(children);\n\t\telse\n\t\t\tobj.initWithChildren(children);\n\t\tobj._state |= Serializable.STATE_FROMJSON;\n\t\treturn obj;\n\t}\n\tstatic registerSerializable(Class: { new(...args): Serializable }, threeLetterType: string, fromJSON: (json: any) => Serializable = null) {\n\t\tClass.prototype.threeLetterType = threeLetterType;\n\t\tassert(typeof threeLetterType === 'string' && threeLetterType.length === 3);\n\t\tif (!fromJSON)\n\t\t\tfromJSON = json => new Class(json.id);\n\t\tserializableClasses.set(threeLetterType, fromJSON);\n\t}\n\n\tstatic STATE_INIT: number = 2;\n\tstatic STATE_ADDCHILD: number = 4;\n\tstatic STATE_ADDPARENT: number = 8;\n\tstatic STATE_CLONE: number = 16;\n\tstatic STATE_DESTROY: number = 32;\n\tstatic STATE_FROMJSON: number = 64;\n}\n\nSerializable.prototype._parent = null;\nSerializable.prototype._alive = true;\nSerializable.prototype._state = 0;\nSerializable.prototype._rootType = null;\n\nSerializable.prototype.isRoot = false; // If this should be a root node\nObject.defineProperty(Serializable.prototype, 'debug', {\n\tget() {\n\t\tlet info = this.threeLetterType;\n\n\t\tif (this.threeLetterType === 'cda')\n\t\t\tinfo += '|' + this.name;\n\n\t\tthis._children.forEach((value, key) => {\n\t\t\tinfo += '|';\n\t\t\tif (key === 'prp')\n\t\t\t\tinfo += this.getChildren('prp').map(p => `${p.name}=${p._value}`).join(', ');\n\t\t\telse\n\t\t\t\tinfo += `${key}(${value.length})`;\n\t\t});\n\n\t\tinfo += '|state: ';\n\n\t\tlet states = [];\n\t\tlet logState = (state, stateString) => {\n\t\t\tif (this._state & state)\n\t\t\t\tstates.push(stateString);\n\t\t};\n\n\t\tlogState(Serializable.STATE_INIT, 'init');\n\t\tlogState(Serializable.STATE_ADDCHILD, 'add child');\n\t\tlogState(Serializable.STATE_ADDPARENT, 'add parent');\n\t\tlogState(Serializable.STATE_CLONE, 'clone');\n\t\tlogState(Serializable.STATE_DESTROY, 'destroy');\n\t\tlogState(Serializable.STATE_FROMJSON, 'from json');\n\n\t\tinfo += states.join(', ');\n\n\t\treturn info;\n\t}\n});\nObject.defineProperty(Serializable.prototype, 'debugChildren', {\n\tget() {\n\t\tlet c = [];\n\t\tthis._children.forEach((value, key) => {\n\t\t\tc = c.concat(value);\n\t\t});\n\n\t\tlet children = [];\n\n\t\tfunction createDebugObject(type) {\n\t\t\tif (type === 'gam') return new function Game() { };\n\t\t\tif (type === 'sce') return new function Scene() { };\n\t\t\tif (type === 'prt') return new function Prototype() { };\n\t\t\tif (type === 'prp') return new function Property() { };\n\t\t\tif (type === 'cda') return new function ComponentData() { };\n\t\t\tif (type === 'com') return new function Component() { };\n\t\t\tif (type === 'epr') return new function EntityPrototype() { };\n\t\t\tif (type === 'ent') return new function Entity() { };\n\t\t\tif (type === 'lvl') return new function Level() { };\n\t\t\tif (type === 'pfa') return new function Prefab() { };\n\t\t\treturn new function Other() { };\n\t\t}\n\n\t\tc.forEach(child => {\n\t\t\tlet obj = createDebugObject(child.threeLetterType);\n\n\t\t\tobj.debug = child.debug;\n\t\t\tobj.ref = child;\n\t\t\tobj.debugChildren = child.debugChildren;\n\t\t\tlet c = child.debugChildArray;\n\t\t\tif (c && c.length > 0)\n\t\t\t\tobj.children = c;\n\t\t\tchildren.push(obj);\n\t\t});\n\n\t\treturn children;\n\t}\n});\n\n/**\n * If a serializable is a ancestor of another serializable, it is filtered out from the list\n */\nexport function filterChildren(serializables: Array<Serializable>) {\n\tlet idSet = new Set(serializables.map(s => s.id));\n\treturn serializables.filter(serializable => {\n\t\tlet parent = serializable.getParent();\n\t\twhile (parent) {\n\t\t\tif (idSet.has(parent.id))\n\t\t\t\treturn false;\n\t\t\tparent = parent.getParent();\n\t\t}\n\t\treturn true;\n\t});\n}\n","import Serializable from './serializable';\nimport { addChange, changeType, setChangeOrigin } from './change';\nimport assert from '../util/assert';\nimport * as performanceTool from '../util/performance';\nimport { PropertyType } from './propertyType';\nimport { GameEvent, globalEventDispatcher } from './eventDispatcher';\n\nlet gameChangesEnabled = true;\nlet sceneChangesEnabled = false;\nlet sceneChangeFilter: (prp: Property) => boolean = null;\n\nlet changesEnabled = false;\nlet scenePropertyFilter = null;\n// true / false to enable / disable property value change sharing.\n// if object is passed, changes are only sent\nexport function filterSceneChanges(_scenePropertyFilter) {\n\tscenePropertyFilter = _scenePropertyFilter;\n\tchangesEnabled = true;\n}\n\nexport function disableAllChanges() {\n\tchangesEnabled = false;\n}\n\nexport function enableAllChanges() {\n\tchangesEnabled = true;\n}\n\nexport function setPropertyChangeSettings(enableGameChanges: boolean, enableSceneChanges: boolean | ((prp: Property) => boolean)) {\n\tgameChangesEnabled = enableGameChanges\n\tsceneChangesEnabled = !!enableSceneChanges\n\tsceneChangeFilter = typeof enableSceneChanges === 'function' ? enableSceneChanges : null\n}\n\nexport function executeWithoutEntityPropertyChangeCreation(task) {\n\tlet oldChangesEnabled = changesEnabled;\n\tchangesEnabled = false;\n\ttask();\n\tchangesEnabled = oldChangesEnabled;\n}\n\n// Object of a property\nexport default class Property extends Serializable {\n\t_value: any;\n\t_initialValue: any;\n\tname: any;\n\tpropertyType: PropertyType;\n\t_initialValueIsJSON: boolean = false;\n\n\t// set skipSerializableRegistering=true if you are not planning to add this property to the hierarchy\n\t// if you give propertyType, value in real value form\n\t// if you don't give propertyType (give it later), value as JSON form\n\tconstructor({ value, predefinedId = '', name, propertyType = null, skipSerializableRegistering = false }) {\n\t\tsuper(predefinedId, skipSerializableRegistering);\n\t\tassert(name, 'Property without a name can not exist');\n\t\tthis._initialValue = value;\n\t\tif (propertyType)\n\t\t\tthis.setPropertyType(propertyType);\n\t\telse {\n\t\t\tthis.name = name;\n\t\t\tthis._initialValueIsJSON = true;\n\t\t}\n\t}\n\tmakeUpAName() {\n\t\treturn this.name;\n\t}\n\tsetPropertyType(propertyType) {\n\t\tthis.propertyType = propertyType;\n\t\ttry {\n\t\t\tif (this._initialValue !== undefined)\n\t\t\t\tthis.value = this._initialValueIsJSON ? propertyType.type.fromJSON(this._initialValue) : this._initialValue;\n\t\t\telse\n\t\t\t\tthis.value = propertyType.initialValue;\n\t\t} catch (e) {\n\t\t\tconsole.log('Invalid value', e, propertyType, this);\n\t\t\tthis.value = propertyType.initialValue;\n\t\t}\n\t\tthis.name = propertyType.name;\n\t}\n\tclone(skipSerializableRegistering = false) {\n\t\treturn new Property({\n\t\t\tvalue: this.propertyType.type.clone(this.value),\n\t\t\tname: this.name,\n\t\t\tpropertyType: this.propertyType,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tv: this.type.toJSON(this.value),\n\t\t\tn: this.propertyType.name\n\t\t});\n\t}\n\n\tvalueEquals(otherValue) {\n\t\treturn this.propertyType.type.equal(this._value, otherValue);\n\t}\n\n\tget type() {\n\t\treturn this.propertyType.type;\n\t}\n\n\tset value(newValue) {\n\t\tlet oldValue = this._value;\n\t\tthis._value = this.propertyType.validator.validate(newValue);\n\n\t\tthis.dispatch(GameEvent.PROPERTY_VALUE_CHANGE, this._value, oldValue);\n\t\tif (this._rootType === 'gam') {\n\t\t\tif (gameChangesEnabled) {\n\t\t\t\taddChange(changeType.setPropertyValue, this);\n\t\t\t}\n\t\t} else if (sceneChangesEnabled && (!sceneChangeFilter || sceneChangeFilter(this))) {\n\t\t\taddChange(changeType.setPropertyValue, this);\n\t\t}\n\t}\n\tget value() {\n\t\treturn this._value;\n\t}\n}\nProperty.prototype.propertyType = null;\n\nSerializable.registerSerializable(Property, 'prp', json => {\n\treturn new Property({\n\t\tvalue: json.v,\n\t\tpredefinedId: json.id,\n\t\tname: json.n\n\t});\n});\n\nObject.defineProperty(Property.prototype, 'debug', {\n\tget() {\n\t\treturn `prp ${this.name}=${this.value}`;\n\t}\n});\n","import assert from '../util/assert';\nimport Property from './property';\nimport { DataTypeContainer } from './dataTypes';\n// info about type, validator, validatorParameters, initialValue\n\nexport class PropertyType {\n\tflags: any;\n\tconstructor(\n\t\tpublic name: string,\n\t\tpublic type: DataType,\n\t\tpublic validator,\n\t\tpublic initialValue,\n\t\tpublic description: string,\n\t\tflags: Array<any> = [],\n\t\tpublic visibleIf\n\t) {\n\t\tassert(name[0] >= 'a' && name[0] <= 'z', 'Name of a property must start with lower case letter.');\n\t\tassert(type && typeof type.name === 'string');\n\t\tassert(validator && typeof validator.validate === 'function');\n\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.validator = validator;\n\t\tthis.initialValue = initialValue;\n\t\tthis.description = description;\n\t\tthis.visibleIf = visibleIf;\n\t\tthis.flags = {};\n\t\tflags.forEach(f => this.flags[f.type] = f);\n\t}\n\tgetFlag(flag: Flag) {\n\t\treturn this.flags[flag.type];\n\t}\n\tcreateProperty({\n\t\tvalue,\n\t\tpredefinedId,\n\t\tskipSerializableRegistering = false\n\t}: CreatePropertyParameters = {}) {\n\t\treturn new Property({\n\t\t\tpropertyType: this,\n\t\t\tvalue,\n\t\t\tpredefinedId,\n\t\t\tname: this.name,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n}\n\ntype CreatePropertyParameters = {\n\tvalue?: any;\n\tpredefinedId?: string;\n\tskipSerializableRegistering?: boolean;\n}\n\nexport interface PropType extends Function, DataTypeContainer {\n\tvisibleIf?: (propertyName: string, value: any) => any;\n}\n\n/*\n\tBeautiful way of creating property types\n\n\toptionalParameters:\n\t\tdescription: 'Example',\n\t\tvalidator: PropertyType.\n */\n/**\n *\n * @param propertyName - name of property. name will be converted propertyName -> Property Name in editor.\n * @param defaultValue - initial value of property\n * @param type - Prop.<type>, for example Prop.int, Prop.bool, prop.float\n * @param optionalParameters - \"description\", validator Prop.float.range(0, 1)\n */\nconst Prop: PropType = function Prop(propertyName: string, defaultValue: any, type: DataTypeDefinition, ...optionalParameters) {\n\tlet dataType = type();\n\tlet validator = dataType.validators.default();\n\tlet description = '';\n\tlet flags = [];\n\tlet visibleIf = null;\n\toptionalParameters.forEach((p, idx) => {\n\t\tif (typeof p === 'string')\n\t\t\tdescription = p;\n\t\telse if (p && p.validate)\n\t\t\tvalidator = p;\n\t\telse if (p && p.isFlag)\n\t\t\tflags.push(p);\n\t\telse if (p && p.visibleIf)\n\t\t\tvisibleIf = p;\n\t\telse\n\t\t\tassert(false, 'invalid parameter ' + p + ' idx ' + idx);\n\t});\n\treturn new PropertyType(propertyName, dataType, validator, defaultValue, description, flags, visibleIf);\n};\n\nexport default Prop;\n\n// if value is string, property must be value\n// if value is an array, property must be one of the values\nProp.visibleIf = function (propertyName: string, value: any) {\n\tassert(typeof propertyName === 'string' && propertyName.length);\n\tassert(typeof value !== 'undefined');\n\treturn {\n\t\tvisibleIf: true,\n\t\tpropertyName,\n\t\tvalues: Array.isArray(value) ? value : [value]\n\t};\n};\n\ntype Flag = {\n\ttype: string;\n\tisFlag: boolean;\n};\nfunction createFlag(type: string, func: any = {}): Flag {\n\tfunc.isFlag = true;\n\tfunc.type = type;\n\treturn func;\n}\n\nexport interface PropType {\n\tflagDegreesInEditor?: Flag;\n}\nProp.flagDegreesInEditor = createFlag('degreesInEditor');\n\ntype DataType = {\n\tname: string;\n\tvalidators?: { [s: string]: Function };\n\ttoJSON?: Function;\n\tfromJSON?: Function;\n\tclone?: Function;\n\tequal?: (a, b) => boolean\n};\nexport type DataTypeDefinition = Function;\n\nexport function createDataType({\n\tname = '',\n\tvalidators = { default: x => x }, // default must exist. if value is a reference(object), validator should copy the value.\n\ttoJSON = x => x,\n\tfromJSON = x => x,\n\tclone = x => x,\n\tequal = (a, b) => a === b\n}: DataType): DataTypeDefinition {\n\tassert(name, 'name missing from property type');\n\tassert(typeof validators.default === 'function', 'default validator missing from property type: ' + name);\n\tassert(typeof toJSON === 'function', 'invalid toJSON for property type: ' + name);\n\tassert(typeof fromJSON === 'function', 'invalid fromJSON for property type: ' + name);\n\n\tlet type: DataType = {\n\t\tname,\n\t\tvalidators,\n\t\ttoJSON,\n\t\tfromJSON,\n\t\tclone,\n\t\tequal\n\t};\n\tlet createType = () => type;\n\n\tObject.keys(validators).forEach(validatorName => {\n\t\tcreateType[validatorName] = createValidator(validatorName, validators[validatorName]);\n\t\tvalidators[validatorName] = createType[validatorName];\n\t});\n\treturn createType;\n}\n\ntype Validator = {\n\tvalidate?: Function,\n\tvalidatorName?: string,\n\tparameters?: Array<any>\n};\n\nfunction createValidator(name: string, validatorFunction: Function): Validator {\n\tlet validator: any = function (...args): Validator {\n\t\tlet parameters = args;\n\t\tlet validatorArgs = [null, ...args];\n\t\treturn {\n\t\t\tvalidatorName: name,\n\t\t\tvalidate: function (x) {\n\t\t\t\tvalidatorArgs[0] = x;\n\t\t\t\treturn validatorFunction.apply(null, validatorArgs);\n\t\t\t},\n\t\t\tparameters\n\t\t};\n\t};\n\tvalidator.validatorName = name;\n\tvalidator.validate = validatorFunction;\n\treturn validator;\n}\n","export default class Vector {\n\tx: number;\n\ty: number;\n\tconstructor(x: number, y: number) {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t}\n\tadd(vec: Vector) {\n\t\tthis.x += vec.x;\n\t\tthis.y += vec.y;\n\t\treturn this;\n\t}\n\taddScalars(x: number, y: number) {\n\t\tthis.x += x;\n\t\tthis.y += y;\n\t\treturn this;\n\t}\n\tsubtract(vec: Vector) {\n\t\tthis.x -= vec.x;\n\t\tthis.y -= vec.y;\n\t\treturn this;\n\t}\n\tsubtractScalars(x: number, y: number) {\n\t\tthis.x -= x;\n\t\tthis.y -= y;\n\t\treturn this;\n\t}\n\tmultiply(vec: Vector) {\n\t\tthis.x *= vec.x;\n\t\tthis.y *= vec.y;\n\t\treturn this;\n\t}\n\tmultiplyScalar(scalar: number) {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\treturn this;\n\t}\n\tdivide(vec: Vector) {\n\t\tthis.x /= vec.x;\n\t\tthis.y /= vec.y;\n\t\treturn this;\n\t}\n\tdivideScalar(scalar: number) {\n\t\tthis.x /= scalar;\n\t\tthis.y /= scalar;\n\t\treturn this;\n\t}\n\tdot(vec: Vector) {\n\t\treturn this.x * vec.x + this.y * vec.y;\n\t}\n\tlength(): number {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n\tlengthSq(): number {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n\tsetLength(newLength: number) {\n\t\tlet oldLength = this.length();\n\n\t\tif (oldLength === 0) {\n\t\t\tthis.x = newLength;\n\t\t\tthis.y = 0;\n\t\t} else {\n\t\t\tthis.multiplyScalar(newLength / oldLength);\n\t\t}\n\t\treturn this;\n\t}\n\tgetProjectionOn(vec: Vector) {\n\t\tlet length = vec.length();\n\t\tif (length === 0)\n\t\t\treturn this.clone();\n\t\telse\n\t\t\treturn vec.clone().multiplyScalar(this.dot(vec) / (length * length));\n\t}\n\tdistance(vec: Vector) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t}\n\tdistanceSq(vec: Vector) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn dx * dx + dy * dy;\n\t}\n\t// returns 0 .. pi\n\tangleTo(vec: Vector) {\n\t\tlet lengthPart = this.length() * vec.length();\n\t\tif (lengthPart > 0) {\n\t\t\treturn Math.acos(this.dot(vec) / lengthPart);\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\t// returns 0 .. pi / 2\n\tclosestAngleTo(vec: Vector) {\n\t\tlet angle = Math.abs(this.angleTo(vec));\n\t\tif (angle > Math.PI * 0.5) {\n\t\t\treturn Math.abs(Math.PI - angle);\n\t\t} else {\n\t\t\treturn angle;\n\t\t}\n\t}\n\tnormalize() {\n\t\treturn this.setLength(1);\n\t}\n\thorizontalAngle() {\n\t\treturn Math.atan2(this.y, this.x);\n\t}\n\tverticalAngle() {\n\t\treturn Math.atan2(this.x, this.y);\n\t}\n\trotate(angle: number) {\n\t\tlet x = this.x * Math.cos(angle) - this.y * Math.sin(angle);\n\t\tthis.y = this.x * Math.sin(angle) + this.y * Math.cos(angle);\n\t\tthis.x = x;\n\n\t\treturn this;\n\t}\n\trotateTo(angle: number) {\n\t\treturn this.rotate(angle - this.verticalAngle());\n\t}\n\tisEqualTo(vec: Vector) {\n\t\treturn this.x === vec.x && this.y === vec.y;\n\t}\n\tisZero(): boolean {\n\t\treturn !this.x && !this.y;\n\t}\n\tclone(): Vector {\n\t\treturn new Vector(this.x, this.y);\n\t}\n\tset(vec: Vector) {\n\t\tthis.x = vec.x;\n\t\tthis.y = vec.y;\n\t\treturn this;\n\t}\n\tsetScalars(x: number, y: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\treturn this;\n\t}\n\ttoString(): string {\n\t\treturn `[${this.x}, ${this.y}]`;\n\t}\n\ttoArray(): Array<number> {\n\t\treturn [this.x, this.y];\n\t}\n\tinterpolateLinear(other: Vector, t: number): Vector {\n\t\treturn new Vector(this.x + (other.x - this.x) * t, this.y + (other.y - this.y) * t);\n\t}\n\tinterpolateCubic(other: Vector, control1: Vector, control2: Vector, t: number): Vector {\n\t\tlet t2 = 1 - t;\n\t\treturn new Vector(\n\t\t\tt2 ** 3 * this.x +\n\t\t\t3 * t2 * t2 * t * control1.x +\n\t\t\t3 * t2 * t * t * control2.x +\n\t\t\tt ** 3 * other.x,\n\t\t\tt2 ** 3 * this.y +\n\t\t\t3 * t2 * t2 * t * control1.y +\n\t\t\t3 * t2 * t * t * control2.y +\n\t\t\tt ** 3 * other.y);\n\t}\n\n\tstatic fromObject(obj: { x: number, y: number }) {\n\t\treturn new Vector(obj.x, obj.y);\n\t};\n\tstatic fromArray(obj) {\n\t\treturn new Vector(obj[0], obj[1]);\n\t};\n}\n","import assert from './assert'\n\nfunction isColor(color) {\n\n}\n\nexport class Color {\n\tr: number;\n\tg: number;\n\tb: number;\n\tconstructor(r: number | Color | string, g?: number, b?: number) {\n\t\tif (r instanceof Color) {\n\t\t\tthis.r = r.r;\n\t\t\tthis.g = r.g;\n\t\t\tthis.b = r.b;\n\t\t} else if (typeof r === 'number') {\n\t\t\tthis.r = Math.round(r);\n\t\t\tthis.g = Math.round(g);\n\t\t\tthis.b = Math.round(b);\n\t\t} else if (typeof r === 'string') {\n\t\t\tlet rgb = hexToRgb(r);\n\t\t\tthis.r = rgb.r;\n\t\t\tthis.g = rgb.g;\n\t\t\tthis.b = rgb.b;\n\t\t} else {\n\t\t\tassert(false, 'Invalid Color parameters');\n\t\t}\n\t}\n\ttoHexString() {\n\t\treturn rgbToHex(this.r, this.g, this.b);\n\t}\n\ttoHexNumber() {\n\t\treturn this.r * 256 * 256 + this.g * 256 + this.b;\n\t}\n\ttoString() {\n\t\treturn `[${this.r},${this.g},${this.b}]`;\n\t}\n\t/**\n\t *\n\t * @param color Color to interpolate to\n\t * @param t 0 .. 1\n\t */\n\tinterpolateLinear(color: Color, t: number) {\n\t\treturn new Color(\n\t\t\tthis.r + (color.r - this.r) * t,\n\t\t\tthis.g + (color.g - this.g) * t,\n\t\t\tthis.b + (color.b - this.b) * t\n\t\t);\n\t}\n\tinterpolateCubic(color: Color, control1: Color, control2: Color, t: number) {\n\t\tlet t2 = 1 - t;\n\t\treturn new Color(\n\t\t\tt2 ** 3 * this.r +\n\t\t\t\t3 * t2 * t2 * t * control1.r +\n\t\t\t\t3 * t2 * t * t * control2.r +\n\t\t\t\tt ** 3 * color.r,\n\t\t\tt2 ** 3 * this.g +\n\t\t\t\t3 * t2 * t2 * t * control1.g +\n\t\t\t\t3 * t2 * t * t * control2.g +\n\t\t\t\tt ** 3 * color.g,\n\t\t\tt2 ** 3 * this.b +\n\t\t\t\t3 * t2 * t2 * t * control1.b +\n\t\t\t\t3 * t2 * t * t * control2.b +\n\t\t\t\tt ** 3 * color.b\n\t\t);\n\t}\n\tisEqualTo(other: Color) {\n\t\treturn this.r === other.r && this.g === other.g && this.b === other.b;\n\t}\n\tstatic fromHexString(hexString: string) {\n\t\tlet rgb = hexToRgb(hexString);\n\t\treturn new Color(rgb.r, rgb.g, rgb.b);\n\t}\n}\n\nexport function hexToRgb(hex) {\n\tvar result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\treturn result ? {\n\t\tr: parseInt(result[1], 16),\n\t\tg: parseInt(result[2], 16),\n\t\tb: parseInt(result[3], 16)\n\t} : null;\n}\n\nexport function componentToHex(c: number) {\n\tvar hex = c.toString(16);\n\treturn hex.length == 1 ? \"0\" + hex : hex;\n}\n\nexport function rgbToHex(r: number, g: number, b: number) {\n\treturn \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n}\n\nexport function isHexString(hex: string) {\n\treturn hex && hex.match(/^#[0-9a-f]{6}$/i) ? true : false;\n}\n","import assert from '../util/assert';\nimport Prop, { createDataType, PropType, DataTypeDefinition } from './propertyType';\nimport Vector from '../util/vector';\nimport { isHexString, Color } from '../util/color';\n\nfunction validateFloat(val) {\n\tif (isNaN(val) || val === Infinity || val === -Infinity)\n\t\tthrow new Error('Invalid float: ' + val);\n}\n\nconst FLOAT_JSON_PRECISION = 4;\nconst FLOAT_JSON_PRECISION_MULTIPLIER = Math.pow(10, FLOAT_JSON_PRECISION);\nconst FLOAT_DELTA = 0.0000001;\n\nexport interface DataTypeContainer {\n\tfloat?: Function & {\n\t\trange?: (min: number, max: number) => number,\n\t\tmodulo?: (min: number, max: number) => number\n\t};\n}\nProp.float = createDataType({\n\tname: 'float',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseFloat(x);\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tvalidateFloat(x);\n\t\t\t// @endif\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x: number, min: number, max: number): number {\n\t\t\tx = Number(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t},\n\t\tmodulo(x, min, max) {\n\t\t\tx = Number(x);\n\t\t\tvalidateFloat(x);\n\n\t\t\tlet range = max - min;\n\n\t\t\tif (x < min) {\n\t\t\t\tx += (((min - x) / range | 0) + 1) * range;\n\t\t\t} else if (x > max - FLOAT_DELTA) {\n\t\t\t\tx -= (((x - max) / range | 0) + 1) * range;\n\t\t\t}\n\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => Math.round(x * FLOAT_JSON_PRECISION_MULTIPLIER) / FLOAT_JSON_PRECISION_MULTIPLIER,\n\tfromJSON: x => x\n});\n\nexport interface DataTypeContainer {\n\tint?: Function & {\n\t\trange?: (min: number, max: number) => number\n\t};\n}\nProp.int = createDataType({\n\tname: 'int',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseInt(x);\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tvalidateFloat(x);\n\t\t\t// @endif\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseInt(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\nexport interface DataTypeContainer { vector?: DataTypeDefinition; }\nProp.vector = createDataType({\n\tname: 'vector',\n\tvalidators: {\n\t\tdefault(vec) {\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tif (!(vec instanceof Vector))\n\t\t\t\tthrow new Error();\n\t\t\t// @endif\n\t\t\tvec = vec.clone();\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tvec.x = parseFloat(vec.x);\n\t\t\tvec.y = parseFloat(vec.y);\n\t\t\tvalidateFloat(vec.x);\n\t\t\tvalidateFloat(vec.y);\n\t\t\t// @endif\n\t\t\treturn vec;\n\t\t}\n\t},\n\ttoJSON: vec => ({\n\t\tx: Math.round(vec.x * FLOAT_JSON_PRECISION_MULTIPLIER) / FLOAT_JSON_PRECISION_MULTIPLIER,\n\t\ty: Math.round(vec.y * FLOAT_JSON_PRECISION_MULTIPLIER) / FLOAT_JSON_PRECISION_MULTIPLIER\n\t}),\n\tfromJSON: vec => Vector.fromObject(vec),\n\tclone: vec => vec.clone(),\n\tequal: (a: Vector, b: Vector) => a.isEqualTo(b)\n});\n\nexport interface DataTypeContainer { string?: DataTypeDefinition; }\nProp.string = createDataType({\n\tname: 'string',\n\tvalidators: {\n\t\tdefault: x => x ? String(x) : ''\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\n// longString can have longer length in editor input\nexport interface DataTypeContainer { longString?: DataTypeDefinition; }\nProp.longString = createDataType({\n\tname: 'longString',\n\tvalidators: {\n\t\tdefault: x => x ? String(x) : ''\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\nexport interface DataTypeContainer { bool?: DataTypeDefinition; }\nProp.bool = createDataType({\n\tname: 'bool',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tif (typeof x !== 'boolean')\n\t\t\t\tthrow new Error();\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x ? 1 : 0,\n\tfromJSON: x => !!x\n});\n\nexport interface DataTypeContainer {\n\tenum?: Function & {\n\t\tvalues?: (...values: Array<string>) => string\n\t};\n}\nProp.enum = createDataType({\n\tname: 'enum',\n\tvalidators: {\n\t\tdefault() {\n\t\t\tassert(false, `also specify enum values with Prop.enum.values('value1', 'value2', ...)`);\n\t\t},\n\t\tvalues(x, ...values) {\n\t\t\tif (!Array.isArray(values))\n\t\t\t\tthrow new Error();\n\t\t\tif (typeof x !== 'string')\n\t\t\t\tthrow new Error('val should be string');\n\t\t\tif (values.indexOf(x) < 0)\n\t\t\t\tthrow new Error(`value ${x} not in enum: [${values}]`);\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\nexport interface DataTypeContainer { color?: DataTypeDefinition; }\nProp.color = createDataType({\n\tname: 'color',\n\tvalidators: {\n\t\tdefault(color) {\n\t\t\tlet newColor = new Color(color);\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tassert(newColor.r >= 0 && newColor.r < 256);\n\t\t\tassert(newColor.g >= 0 && newColor.g < 256);\n\t\t\tassert(newColor.b >= 0 && newColor.b < 256);\n\t\t\t// @endif\n\t\t\treturn newColor;\n\t\t}\n\t},\n\ttoJSON: x => x.toHexString(),\n\tfromJSON: x => new Color(x),\n\tequal: (a: Color, b: Color) => a.isEqualTo(b)\n});\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nimport { PropertyType } from './propertyType';\nexport { default as Prop } from './propertyType';\nimport Property from './property';\n\nexport interface PropertyOwnerClass {\n\t_propertyTypes: Array<PropertyType>;\n\t_propertyTypesByName: { [s: string]: PropertyType };\n}\n\nexport default class PropertyOwner extends Serializable {\n\t_properties: { [name: string]: Property } = {};\n\t_propertyOwnerClass: PropertyOwnerClass; // use prototype's value\n\n\tconstructor(predefinedId?: string) {\n\t\tsuper(predefinedId);\n\t\tassert(Array.isArray(this._propertyOwnerClass._propertyTypes), 'call PropertyOwner.defineProperties after class definition');\n\t}\n\tmakeUpAName() {\n\t\treturn (this as any).name || 'PropertyOwner';\n\t}\n\t// Just a helper\n\tinitWithPropertyValues(values: { [key: string]: any } = {}) {\n\t\tlet children = [];\n\n\t\tObject.keys(values).forEach(propName => {\n\t\t\tlet propertyType = this._propertyOwnerClass._propertyTypesByName[propName];\n\t\t\tassert(propertyType, 'Invalid property ' + propName);\n\t\t\tchildren.push(propertyType.createProperty({\n\t\t\t\tvalue: values[propName]\n\t\t\t}));\n\t\t});\n\t\tthis.initWithChildren(children);\n\t\treturn this;\n\t}\n\tinitWithChildren(children: Array<Serializable> = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\n\t\tlet propChildren: Array<Property> = [];\n\t\tlet otherChildren: Array<Serializable> = [];\n\t\t// Separate Property children and other children\n\t\tchildren.forEach(child => {\n\t\t\tif (child.threeLetterType === 'prp') {\n\t\t\t\tpropChildren.push(child as Property);\n\t\t\t} else {\n\t\t\t\totherChildren.push(child);\n\t\t\t}\n\t\t});\n\t\tsuper.addChildren(otherChildren);\n\n\t\tlet invalidPropertiesCount = 0;\n\n\t\tlet propertyIdToInvalid = {};\n\n\t\t// Make sure Properties have a PropertyType. They don't work without it.\n\t\tpropChildren.filter(prop => !prop.propertyType).forEach(prop => {\n\t\t\tlet propertyType = (this.constructor as any as PropertyOwnerClass)._propertyTypesByName[prop.name];\n\t\t\tif (!propertyType) {\n\t\t\t\tconsole.log('Property of that name not defined', this.id, prop.name, this);\n\t\t\t\tinvalidPropertiesCount++;\n\t\t\t\tpropertyIdToInvalid[prop.id] = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprop.setPropertyType(propertyType);\n\t\t});\n\t\tif (invalidPropertiesCount)\n\t\t\tpropChildren = propChildren.filter(p => !propertyIdToInvalid[p.id]);\n\n\t\t// Make sure all PropertyTypes have a matching Property\n\t\tlet nameToProp = {};\n\t\tpropChildren.forEach(c => nameToProp[c.name] = c);\n\t\tthis._propertyOwnerClass._propertyTypes.forEach(propertyType => {\n\t\t\tif (!nameToProp[propertyType.name])\n\t\t\t\tpropChildren.push(propertyType.createProperty());\n\t\t});\n\n\t\tsuper.addChildren(propChildren);\n\t\treturn this;\n\t}\n\taddChild(child: Serializable): PropertyOwner {\n\t\tassert(this._state & Serializable.STATE_INIT, this.constructor + ' requires that initWithChildren will be called before addChild');\n\t\tsuper.addChild(child);\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!(child as Property).propertyType) {\n\t\t\t\tif (!this._propertyOwnerClass._propertyTypesByName[(child as Property).name]) {\n\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t(child as Property).setPropertyType(this._propertyOwnerClass._propertyTypesByName[(child as Property).name]);\n\t\t\t}\n\t\t\tassert(this._properties[(child as Property).propertyType.name] === undefined, 'Property already added');\n\t\t\tthis._properties[(child as Property).propertyType.name] = (child as Property);\n\t\t}\n\t\treturn this;\n\t}\n\tcreatePropertyHash() {\n\t\treturn this.getChildren('prp').map(property => '' + (property as Property)._value).join(',');\n\t}\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\t\tthis._properties = {};\n\t\treturn true;\n\t}\n\t// idx is optional\n\tdeleteChild(child: Serializable, idx?: number) {\n\t\tassert(child.threeLetterType !== 'prp', 'Can not delete just one Property child.');\n\t\tsuper.deleteChild(child, idx);\n\t\treturn this;\n\t}\n\n\tstatic defineProperties(Class: { new(...args): Serializable }, propertyTypes: Array<PropertyType>) {\n\t\tClass.prototype._propertyOwnerClass = Class;\n\t\tlet ClassAsTypeHolder = Class as any as PropertyOwnerClass;\n\t\t// debugger;\n\t\tif (!ClassAsTypeHolder._propertyTypes) {\n\t\t\tClassAsTypeHolder._propertyTypes = [];\n\t\t}\n\t\tClassAsTypeHolder._propertyTypes.push(...propertyTypes);\n\t\tClassAsTypeHolder._propertyTypesByName = {};\n\n\t\tClassAsTypeHolder._propertyTypes.forEach(propertyType => {\n\t\t\tconst propertyTypeName = propertyType.name;\n\t\t\tassert(!Class.prototype.hasOwnProperty(propertyTypeName), 'Property name ' + propertyTypeName + ' clashes');\n\t\t\tClassAsTypeHolder._propertyTypesByName[propertyTypeName] = propertyType;\n\t\t\tObject.defineProperty(Class.prototype, propertyTypeName, {\n\t\t\t\tget() {\n\t\t\t\t\tif (!this._properties[propertyTypeName])\n\t\t\t\t\t\tdebugger;\n\t\t\t\t\treturn this._properties[propertyTypeName].value;\n\t\t\t\t},\n\t\t\t\tset(value) {\n\t\t\t\t\tthis._properties[propertyTypeName].value = value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n}\n","function parseQuery (query) {\n  var chunks = query.split(/([#.])/);\n  var tagName = '';\n  var id = '';\n  var classNames = [];\n\n  for (var i = 0; i < chunks.length; i++) {\n    var chunk = chunks[i];\n    if (chunk === '#') {\n      id = chunks[++i];\n    } else if (chunk === '.') {\n      classNames.push(chunks[++i]);\n    } else if (chunk.length) {\n      tagName = chunk;\n    }\n  }\n\n  return {\n    tag: tagName || 'div',\n    id: id,\n    className: classNames.join(' ')\n  };\n}\n\nfunction createElement (query, ns) {\n  var ref = parseQuery(query);\n  var tag = ref.tag;\n  var id = ref.id;\n  var className = ref.className;\n  var element = ns ? document.createElementNS(ns, tag) : document.createElement(tag);\n\n  if (id) {\n    element.id = id;\n  }\n\n  if (className) {\n    if (ns) {\n      element.setAttribute('class', className);\n    } else {\n      element.className = className;\n    }\n  }\n\n  return element;\n}\n\nfunction unmount (parent, child) {\n  var parentEl = getEl(parent);\n  var childEl = getEl(child);\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (childEl.parentNode) {\n    doUnmount(child, childEl, parentEl);\n\n    parentEl.removeChild(childEl);\n  }\n\n  return child;\n}\n\nfunction doUnmount (child, childEl, parentEl) {\n  var hooks = childEl.__redom_lifecycle;\n\n  if (hooksAreEmpty(hooks)) {\n    childEl.__redom_lifecycle = {};\n    return;\n  }\n\n  var traverse = parentEl;\n\n  if (childEl.__redom_mounted) {\n    trigger(childEl, 'onunmount');\n  }\n\n  while (traverse) {\n    var parentHooks = traverse.__redom_lifecycle || {};\n\n    for (var hook in hooks) {\n      if (parentHooks[hook]) {\n        parentHooks[hook] -= hooks[hook];\n      }\n    }\n\n    if (hooksAreEmpty(parentHooks)) {\n      traverse.__redom_lifecycle = null;\n    }\n\n    traverse = traverse.parentNode;\n  }\n}\n\nfunction hooksAreEmpty (hooks) {\n  if (hooks == null) {\n    return true;\n  }\n  for (var key in hooks) {\n    if (hooks[key]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/* global Node, ShadowRoot */\n\nvar hookNames = ['onmount', 'onremount', 'onunmount'];\nvar shadowRootAvailable = typeof window !== 'undefined' && 'ShadowRoot' in window;\n\nfunction mount (parent, child, before, replace) {\n  var parentEl = getEl(parent);\n  var childEl = getEl(child);\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (child !== childEl) {\n    childEl.__redom_view = child;\n  }\n\n  var wasMounted = childEl.__redom_mounted;\n  var oldParent = childEl.parentNode;\n\n  if (wasMounted && (oldParent !== parentEl)) {\n    doUnmount(child, childEl, oldParent);\n  }\n\n  if (before != null) {\n    if (replace) {\n      parentEl.replaceChild(childEl, getEl(before));\n    } else {\n      parentEl.insertBefore(childEl, getEl(before));\n    }\n  } else {\n    parentEl.appendChild(childEl);\n  }\n\n  doMount(child, childEl, parentEl, oldParent);\n\n  return child;\n}\n\nfunction trigger (el, eventName) {\n  if (eventName === 'onmount' || eventName === 'onremount') {\n    el.__redom_mounted = true;\n  } else if (eventName === 'onunmount') {\n    el.__redom_mounted = false;\n  }\n\n  var hooks = el.__redom_lifecycle;\n\n  if (!hooks) {\n    return;\n  }\n\n  var view = el.__redom_view;\n  var hookCount = 0;\n\n  view && view[eventName] && view[eventName]();\n\n  for (var hook in hooks) {\n    if (hook) {\n      hookCount++;\n    }\n  }\n\n  if (hookCount) {\n    var traverse = el.firstChild;\n\n    while (traverse) {\n      var next = traverse.nextSibling;\n\n      trigger(traverse, eventName);\n\n      traverse = next;\n    }\n  }\n}\n\nfunction doMount (child, childEl, parentEl, oldParent) {\n  var hooks = childEl.__redom_lifecycle || (childEl.__redom_lifecycle = {});\n  var remount = (parentEl === oldParent);\n  var hooksFound = false;\n\n  for (var i = 0, list = hookNames; i < list.length; i += 1) {\n    var hookName = list[i];\n\n    if (!remount) { // if already mounted, skip this phase\n      if (child !== childEl) { // only Views can have lifecycle events\n        if (hookName in child) {\n          hooks[hookName] = (hooks[hookName] || 0) + 1;\n        }\n      }\n    }\n    if (hooks[hookName]) {\n      hooksFound = true;\n    }\n  }\n\n  if (!hooksFound) {\n    childEl.__redom_lifecycle = {};\n    return;\n  }\n\n  var traverse = parentEl;\n  var triggered = false;\n\n  if (remount || (traverse && traverse.__redom_mounted)) {\n    trigger(childEl, remount ? 'onremount' : 'onmount');\n    triggered = true;\n  }\n\n  while (traverse) {\n    var parent = traverse.parentNode;\n    var parentHooks = traverse.__redom_lifecycle || (traverse.__redom_lifecycle = {});\n\n    for (var hook in hooks) {\n      parentHooks[hook] = (parentHooks[hook] || 0) + hooks[hook];\n    }\n\n    if (triggered) {\n      break;\n    } else {\n      if (traverse.nodeType === Node.DOCUMENT_NODE ||\n        (shadowRootAvailable && (traverse instanceof ShadowRoot)) ||\n        (parent && parent.__redom_mounted)\n      ) {\n        trigger(traverse, remount ? 'onremount' : 'onmount');\n        triggered = true;\n      }\n      traverse = parent;\n    }\n  }\n}\n\nfunction setStyle (view, arg1, arg2) {\n  var el = getEl(view);\n\n  if (typeof arg1 === 'object') {\n    for (var key in arg1) {\n      setStyleValue(el, key, arg1[key]);\n    }\n  } else {\n    setStyleValue(el, arg1, arg2);\n  }\n}\n\nfunction setStyleValue (el, key, value) {\n  if (value == null) {\n    el.style[key] = '';\n  } else {\n    el.style[key] = value;\n  }\n}\n\n/* global SVGElement */\n\nvar xlinkns = 'http://www.w3.org/1999/xlink';\n\nfunction setAttr (view, arg1, arg2) {\n  setAttrInternal(view, arg1, arg2);\n}\n\nfunction setAttrInternal (view, arg1, arg2, initial) {\n  var el = getEl(view);\n\n  var isObj = typeof arg1 === 'object';\n\n  if (isObj) {\n    for (var key in arg1) {\n      setAttrInternal(el, key, arg1[key], initial);\n    }\n  } else {\n    var isSVG = el instanceof SVGElement;\n    var isFunc = typeof arg2 === 'function';\n\n    if (arg1 === 'style' && typeof arg2 === 'object') {\n      setStyle(el, arg2);\n    } else if (isSVG && isFunc) {\n      el[arg1] = arg2;\n    } else if (arg1 === 'dataset') {\n      setData(el, arg2);\n    } else if (!isSVG && (arg1 in el || isFunc) && (arg1 !== 'list')) {\n      el[arg1] = arg2;\n    } else {\n      if (isSVG && (arg1 === 'xlink')) {\n        setXlink(el, arg2);\n        return;\n      }\n      if (initial && arg1 === 'class') {\n        arg2 = el.className + ' ' + arg2;\n      }\n      if (arg2 == null) {\n        el.removeAttribute(arg1);\n      } else {\n        el.setAttribute(arg1, arg2);\n      }\n    }\n  }\n}\n\nfunction setXlink (el, arg1, arg2) {\n  if (typeof arg1 === 'object') {\n    for (var key in arg1) {\n      setXlink(el, key, arg1[key]);\n    }\n  } else {\n    if (arg2 != null) {\n      el.setAttributeNS(xlinkns, arg1, arg2);\n    } else {\n      el.removeAttributeNS(xlinkns, arg1, arg2);\n    }\n  }\n}\n\nfunction setData (el, arg1, arg2) {\n  if (typeof arg1 === 'object') {\n    for (var key in arg1) {\n      setData(el, key, arg1[key]);\n    }\n  } else {\n    if (arg2 != null) {\n      el.dataset[arg1] = arg2;\n    } else {\n      delete el.dataset[arg1];\n    }\n  }\n}\n\nfunction text (str) {\n  return document.createTextNode((str != null) ? str : '');\n}\n\nfunction parseArgumentsInternal (element, args, initial) {\n  for (var i = 0, list = args; i < list.length; i += 1) {\n    var arg = list[i];\n\n    if (arg !== 0 && !arg) {\n      continue;\n    }\n\n    var type = typeof arg;\n\n    if (type === 'function') {\n      arg(element);\n    } else if (type === 'string' || type === 'number') {\n      element.appendChild(text(arg));\n    } else if (isNode(getEl(arg))) {\n      mount(element, arg);\n    } else if (arg.length) {\n      parseArgumentsInternal(element, arg, initial);\n    } else if (type === 'object') {\n      setAttrInternal(element, arg, null, initial);\n    }\n  }\n}\n\nfunction ensureEl (parent) {\n  return typeof parent === 'string' ? html(parent) : getEl(parent);\n}\n\nfunction getEl (parent) {\n  return (parent.nodeType && parent) || (!parent.el && parent) || getEl(parent.el);\n}\n\nfunction isNode (arg) {\n  return arg && arg.nodeType;\n}\n\nvar htmlCache = {};\n\nfunction html (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  var type = typeof query;\n\n  if (type === 'string') {\n    element = memoizeHTML(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else if (type === 'function') {\n    var Query = query;\n    element = new (Function.prototype.bind.apply( Query, [ null ].concat( args) ));\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArgumentsInternal(getEl(element), args, true);\n\n  return element;\n}\n\nvar el = html;\nvar h = html;\n\nhtml.extend = function extendHtml (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var clone = memoizeHTML(query);\n\n  return html.bind.apply(html, [ this, clone ].concat( args ));\n};\n\nfunction memoizeHTML (query) {\n  return htmlCache[query] || (htmlCache[query] = createElement(query));\n}\n\nfunction setChildren (parent) {\n  var children = [], len = arguments.length - 1;\n  while ( len-- > 0 ) children[ len ] = arguments[ len + 1 ];\n\n  var parentEl = getEl(parent);\n  var current = traverse(parent, children, parentEl.firstChild);\n\n  while (current) {\n    var next = current.nextSibling;\n\n    unmount(parent, current);\n\n    current = next;\n  }\n}\n\nfunction traverse (parent, children, _current) {\n  var current = _current;\n\n  var childEls = new Array(children.length);\n\n  for (var i = 0; i < children.length; i++) {\n    childEls[i] = children[i] && getEl(children[i]);\n  }\n\n  for (var i$1 = 0; i$1 < children.length; i$1++) {\n    var child = children[i$1];\n\n    if (!child) {\n      continue;\n    }\n\n    var childEl = childEls[i$1];\n\n    if (childEl === current) {\n      current = current.nextSibling;\n      continue;\n    }\n\n    if (isNode(childEl)) {\n      var next = current && current.nextSibling;\n      var exists = child.__redom_index != null;\n      var replace = exists && next === childEls[i$1 + 1];\n\n      mount(parent, child, current, replace);\n\n      if (replace) {\n        current = next;\n      }\n\n      continue;\n    }\n\n    if (child.length != null) {\n      current = traverse(parent, child, current);\n    }\n  }\n\n  return current;\n}\n\nfunction listPool (View, key, initData) {\n  return new ListPool(View, key, initData);\n}\n\nvar ListPool = function ListPool (View, key, initData) {\n  this.View = View;\n  this.initData = initData;\n  this.oldLookup = {};\n  this.lookup = {};\n  this.oldViews = [];\n  this.views = [];\n\n  if (key != null) {\n    this.key = typeof key === 'function' ? key : propKey(key);\n  }\n};\n\nListPool.prototype.update = function update (data, context) {\n  var ref = this;\n    var View = ref.View;\n    var key = ref.key;\n    var initData = ref.initData;\n  var keySet = key != null;\n\n  var oldLookup = this.lookup;\n  var newLookup = {};\n\n  var newViews = new Array(data.length);\n  var oldViews = this.views;\n\n  for (var i = 0; i < data.length; i++) {\n    var item = data[i];\n    var view = (void 0);\n\n    if (keySet) {\n      var id = key(item);\n\n      view = oldLookup[id] || new View(initData, item, i, data);\n      newLookup[id] = view;\n      view.__redom_id = id;\n    } else {\n      view = oldViews[i] || new View(initData, item, i, data);\n    }\n    view.update && view.update(item, i, data, context);\n\n    var el = getEl(view.el);\n\n    el.__redom_view = view;\n    newViews[i] = view;\n  }\n\n  this.oldViews = oldViews;\n  this.views = newViews;\n\n  this.oldLookup = oldLookup;\n  this.lookup = newLookup;\n};\n\nfunction propKey (key) {\n  return function (item) {\n    return item[key];\n  };\n}\n\nfunction list (parent, View, key, initData) {\n  return new List(parent, View, key, initData);\n}\n\nvar List = function List (parent, View, key, initData) {\n  this.View = View;\n  this.initData = initData;\n  this.views = [];\n  this.pool = new ListPool(View, key, initData);\n  this.el = ensureEl(parent);\n  this.keySet = key != null;\n};\n\nList.prototype.update = function update (data, context) {\n    if ( data === void 0 ) data = [];\n\n  var ref = this;\n    var keySet = ref.keySet;\n  var oldViews = this.views;\n\n  this.pool.update(data, context);\n\n  var ref$1 = this.pool;\n    var views = ref$1.views;\n    var lookup = ref$1.lookup;\n\n  if (keySet) {\n    for (var i = 0; i < oldViews.length; i++) {\n      var oldView = oldViews[i];\n      var id = oldView.__redom_id;\n\n      if (lookup[id] == null) {\n        oldView.__redom_index = null;\n        unmount(this, oldView);\n      }\n    }\n  }\n\n  for (var i$1 = 0; i$1 < views.length; i$1++) {\n    var view = views[i$1];\n\n    view.__redom_index = i$1;\n  }\n\n  setChildren(this, views);\n\n  if (keySet) {\n    this.lookup = lookup;\n  }\n  this.views = views;\n};\n\nList.extend = function extendList (parent, View, key, initData) {\n  return List.bind(List, parent, View, key, initData);\n};\n\nlist.extend = List.extend;\n\n/* global Node */\n\nfunction place (View, initData) {\n  return new Place(View, initData);\n}\n\nvar Place = function Place (View, initData) {\n  this.el = text('');\n  this.visible = false;\n  this.view = null;\n  this._placeholder = this.el;\n\n  if (View instanceof Node) {\n    this._el = View;\n  } else if (View.el instanceof Node) {\n    this._el = View;\n    this.view = View;\n  } else {\n    this._View = View;\n  }\n\n  this._initData = initData;\n};\n\nPlace.prototype.update = function update (visible, data) {\n  var placeholder = this._placeholder;\n  var parentNode = this.el.parentNode;\n\n  if (visible) {\n    if (!this.visible) {\n      if (this._el) {\n        mount(parentNode, this._el, placeholder);\n        unmount(parentNode, placeholder);\n\n        this.el = getEl(this._el);\n        this.visible = visible;\n      } else {\n        var View = this._View;\n        var view = new View(this._initData);\n\n        this.el = getEl(view);\n        this.view = view;\n\n        mount(parentNode, view, placeholder);\n        unmount(parentNode, placeholder);\n      }\n    }\n    this.view && this.view.update && this.view.update(data);\n  } else {\n    if (this.visible) {\n      if (this._el) {\n        mount(parentNode, placeholder, this._el);\n        unmount(parentNode, this._el);\n\n        this.el = placeholder;\n        this.visible = visible;\n\n        return;\n      }\n      mount(parentNode, placeholder, this.view);\n      unmount(parentNode, this.view);\n\n      this.el = placeholder;\n      this.view = null;\n    }\n  }\n  this.visible = visible;\n};\n\n/* global Node */\n\nfunction router (parent, Views, initData) {\n  return new Router(parent, Views, initData);\n}\n\nvar Router = function Router (parent, Views, initData) {\n  this.el = ensureEl(parent);\n  this.Views = Views;\n  this.initData = initData;\n};\n\nRouter.prototype.update = function update (route, data) {\n  if (route !== this.route) {\n    var Views = this.Views;\n    var View = Views[route];\n\n    this.route = route;\n\n    if (View && (View instanceof Node || View.el instanceof Node)) {\n      this.view = View;\n    } else {\n      this.view = View && new View(this.initData, data);\n    }\n\n    setChildren(this.el, [this.view]);\n  }\n  this.view && this.view.update && this.view.update(data, route);\n};\n\nvar ns = 'http://www.w3.org/2000/svg';\n\nvar svgCache = {};\n\nfunction svg (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  var type = typeof query;\n\n  if (type === 'string') {\n    element = memoizeSVG(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else if (type === 'function') {\n    var Query = query;\n    element = new (Function.prototype.bind.apply( Query, [ null ].concat( args) ));\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArgumentsInternal(getEl(element), args, true);\n\n  return element;\n}\n\nvar s = svg;\n\nsvg.extend = function extendSvg (query) {\n  var clone = memoizeSVG(query);\n\n  return svg.bind(this, clone);\n};\n\nsvg.ns = ns;\n\nfunction memoizeSVG (query) {\n  return svgCache[query] || (svgCache[query] = createElement(query, ns));\n}\n\nexport { List, ListPool, Place, Router, el, h, html, list, listPool, mount, place, router, s, setAttr, setChildren, setData, setStyle, setXlink, svg, text, unmount };\n","import {el, mount} from 'redom';\n\nexport function stickyNonModalErrorPopup(text) {\n\tdocument.body.style.filter = 'contrast(70%) brightness(130%) saturate(200%) sepia(40%) hue-rotate(300deg)';\n\n\tlet popup = el('div', text, {\n\t\tstyle: {\n\t\t\t'position': 'fixed',\n\t\t\t'display': 'inline-block',\n\t\t\t'max-width': '600%',\n\t\t\t'top': '20%',\n\t\t\t'width': '100%',\n\t\t\t'padding': '40px 10%',\n\t\t\t'font-size': '20px',\n\t\t\t'z-index': '100000',\n\t\t\t'color': 'white',\n\t\t\t'background': '#0c0c0c',\n\t\t\t'text-align': 'center',\n\t\t\t'user-select': 'auto !important',\n\t\t\t'box-sizing': 'border-box'\n\t\t}\n\t});\n\n\tmount(document.body, popup);\n}\n\nwindow.sticky = stickyNonModalErrorPopup;\n","import { isClient } from '../util/environment';\nimport Vector from '../util/vector';\n\nlet PIXI;\n\nif (isClient) {\n\tPIXI = window['PIXI'];\n\tPIXI.ticker.shared.stop();\n}\n\nexport default PIXI;\n\nlet renderer = null; // Only one PIXI renderer supported for now\n\nexport function getRenderer(canvas: HTMLCanvasElement) {\n\t/*\n\treturn {\n\t\trender: () => {},\n\t\tresize: () => {}\n\t};\n\t*/\n\n\tif (!renderer) {\n\t\trenderer = PIXI.autoDetectRenderer({\n\t\t\tview: canvas,\n\t\t\tautoResize: true,\n\t\t\tantialias: true\n\t\t});\n\n\t\t// Interaction plugin uses ticker that runs in the background. Destroy it to save CPU.\n\t\t// if (renderer.plugins.interaction) // if interaction is left out from pixi build, interaction is no defined\n\t\t// renderer.plugins.interaction.destroy();\n\t}\n\n\treturn renderer;\n}\n\nexport function sortDisplayObjects(container) {\n\tcontainer.children.sort(sortFunc);\n}\nfunction sortFunc(a, b) {\n\tif (a.y < b.y)\n\t\treturn -1;\n\telse if (a.y > b.y)\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}\n\nlet texturesAndAnchors: { [hash: string]: { texture: any, anchor: any, graphicsObject, containsPoint: Function } } = {};\nexport function resetTexturesAndAnchors() {\n\tfor (let i in texturesAndAnchors) {\n\t\ttexturesAndAnchors[i].texture.destroy();\n\t\ttexturesAndAnchors[i].graphicsObject.destroy();\n\t}\n\ttexturesAndAnchors = {};\n}\nexport function getHashedTextureAndAnchor(hash) {\n\treturn texturesAndAnchors[hash];\n}\n/**\n *\n * @param graphicsObject You should not destroy this object after generating texture. It is used for collision testing\n * @param hash\n */\nexport function generateTextureAndAnchor(graphicsObject, hash) {\n\tif (!texturesAndAnchors[hash]) {\n\t\tlet bounds = graphicsObject.getLocalBounds();\n\t\tlet anchor = {\n\t\t\tx: -bounds.x / bounds.width,\n\t\t\ty: -bounds.y / bounds.height\n\t\t};\n\t\ttexturesAndAnchors[hash] = {\n\t\t\ttexture: renderer.generateTexture(graphicsObject, PIXI.SCALE_MODES.LINEAR, 2),\n\t\t\tanchor,\n\t\t\tgraphicsObject,\n\t\t\tcontainsPoint: (point) => {\n\t\t\t\t// Code copied from PIXI.js http://pixijs.download/release/docs/core_graphics_Graphics.js.html#line29\n\n\t\t\t\tfor (let i = 0; i < graphicsObject.graphicsData.length; ++i) {\n\t\t\t\t\tconst data = graphicsObject.graphicsData[i];\n\t\t\t\t\tif (!data.fill) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (data.shape) {\n\t\t\t\t\t\tif (data.shape.contains(point.x, point.y)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\t}\n\treturn texturesAndAnchors[hash];\n}\n\nconst hitTestCanvas = document.createElement('canvas');\nhitTestCanvas.width = 1;\nhitTestCanvas.height = 1;\nconst hitTestContext = hitTestCanvas.getContext('2d');\nexport function hitTest(sprite, pixiCoordinates: Vector, stage) {\n\tlet localBounds = sprite.getLocalBounds();\n\tlet textureSource = sprite.texture.baseTexture.source;\n\n\tlet localMousePoint = sprite.toLocal(pixiCoordinates, stage);\n\n\tlet xPart = (localMousePoint.x - localBounds.x) / (localBounds.width);\n\tlet yPart = (localMousePoint.y - localBounds.y) / (localBounds.height);\n\n\tif (xPart < 0 || xPart > 1 || yPart < 0 || yPart > 1) {\n\t\treturn false;\n\t}\n\n\thitTestCanvas.width = hitTestCanvas.width; // A way to reset contents of the canvas\n\thitTestContext.drawImage(textureSource, textureSource.width * xPart | 0, textureSource.height * yPart | 0, 1, 1, 0, 0, 1, 1);\n\tlet imageData = hitTestContext.getImageData(0, 0, 1, 1);\n\n\t/*\n\tPosition debugging\n\tconst c = document.createElement('canvas');\n\tc.setAttribute('style', 'position: fixed;top:0px;left:0px;');\n\tc.width = src.width;\n\tc.height = src.height;\n\tconst co = c.getContext('2d');\n\tco.drawImage(src, 0, 0);\n\tco.fillStyle = `rgb(${imageData.data[0]},${imageData.data[1]},${imageData.data[2]})`; ['red', 'green', 'blue', 'purple', 'white', 'yellow'][Math.random() * 6 | 0];\n\tco.strokeStyle = 'purple';\n\n\tco.fillRect((src.width * xPart | 0) - 10, (src.width * yPart | 0) - 10, 20, 20);\n\tco.strokeRect(xPart * c.width - 10, yPart * c.height - 10, 20, 20);\n\tdocument.body.appendChild(c);\n\t*/\n\n\treturn imageData.data[3] > 30; // Alpha channel is over 30/255\n}\n","import PIXI from '../features/graphics';\nimport Scene from '../core/scene';\nimport { globalEventDispatcher } from '../core/eventDispatcher';\n\nfunction createCanvas() {\n\tconst RESOLUTION = 10;\n\tvar canvas = document.createElement('canvas');\n\tcanvas.width  = 1;\n\tcanvas.height = RESOLUTION;\n\tvar ctx = canvas.getContext('2d');\n\tvar gradient = ctx.createLinearGradient(0, 0, 0, RESOLUTION * 0.8);\n\t// gradient.addColorStop(0, \"#5886c8\");\n\t// gradient.addColorStop(1, \"#9eb6d5\");\n\tgradient.addColorStop(0, \"#5c77ff\");\n\tgradient.addColorStop(1, \"#90c9f6\");\n\tctx.fillStyle = gradient;\n\tctx.fillRect(0, 0, 1, RESOLUTION);\n\treturn canvas;\n}\n\nglobalEventDispatcher.listen('scene load level', (scene: Scene) => {\n\tlet gradientCanvas = createCanvas();\n\tlet sprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(gradientCanvas));\n\tscene['backgroundGradient'] = sprite;\n\tupdateSceneBackgroundGradient(scene);\n\tscene.layers.static.addChild(sprite);\n});\n\nglobalEventDispatcher.listen('scene unload level', (scene: Scene) => {\n\tdelete scene['backgroundGradient'];\n});\n\nglobalEventDispatcher.listen('canvas resize', (scene: Scene) => {\n\tupdateSceneBackgroundGradient(scene);\n});\n\nfunction updateSceneBackgroundGradient(scene: Scene) {\n\tif (!scene.canvas || !scene['backgroundGradient'])\n\t\treturn;\n\n\tscene['backgroundGradient'].width = scene.canvas.width;\n\tscene['backgroundGradient'].height = scene.canvas.height;\n};\n","// @flow\n\nimport Serializable from './serializable'\nimport { addChange, changeType, getChangeOrigin } from './change';\nimport PropertyOwner, { Prop } from './propertyOwner';\nimport {stickyNonModalErrorPopup} from '../util/popup'\nimport '../modules';\nimport { globalEventDispatcher, GameEvent } from './eventDispatcher';\n\nconsole.log('%cOpen Edit Play', 'color: #666; font-size: 16px; text-shadow: 0px 0px 1px #777;');\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nlet game: Game = null; // only one game at the time\nexport { game };\n\nlet isClient = typeof window !== 'undefined';\n\nexport default class Game extends PropertyOwner {\n\tconstructor(predefinedId?: string) {\n\t\tif (game)\n\t\t\tconsole.error('Only one game allowed.');\n\n\t\t/*\n\t\tif (isClient) {\n\t\t\tif (game) {\n\t\t\t\ttry {\n\t\t\t\t\tgame.delete();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Deleting old game failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t*/\n\n\t\tsuper(predefinedId);\n\n\t\tif (isClient) {\n\t\t\tgame = this;\n\t\t}\n\t}\n\tinitWithChildren(children: Array<Serializable> = []) {\n\t\tlet val = super.initWithChildren(children);\n\t\taddChange(changeType.addSerializableToTree, this);\n\t\treturn val;\n\t}\n\tdelete() {\n\t\taddChange(changeType.deleteSerializable, this);\n\t\tif (!super.delete()) return false;\n\n\t\tif (game === this)\n\t\t\tgame = null;\n\n\t\tstickyNonModalErrorPopup('Game deleted');\n\n\t\treturn true;\n\t}\n}\nPropertyOwner.defineProperties(Game, propertyTypes);\n\nGame.prototype.isRoot = true;\n\n/*\n// Export so that other components can have this component as parent\nComponent.register({\n\tname: 'GameProperties',\n\tdescription: 'Contains all game specific settings',\n\tcategory: 'MainProperties',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('gameProperty1', 3, Prop.float, Prop.float.range(0.01, 1000))\n\t]\n});\n*/\n\nSerializable.registerSerializable(Game, 'gam', json => {\n\tif (json.c) {\n\t\tjson.c.sort((a, b) => {\n\t\t\tif (a.id.startsWith('prt') || a.id.startsWith('pfa'))\n\t\t\t\treturn -1;\n\t\t\telse\n\t\t\t\treturn 1;\n\t\t});\n\t}\n\treturn new Game(json.id);\n});\n\nlet gameCreateListeners = [];\nexport function forEachGame(listener: (game: Game) => void) {\n\tglobalEventDispatcher.listen(GameEvent.GLOBAL_GAME_CREATED, listener);\n\n\tif (game)\n\t\tlistener(game);\n}\n","import assert from '../util/assert';\nimport { isClient } from '../util/environment';\n\nlet p2;\nif (isClient)\n\tp2 = window.p2;\nelse\n\tp2 = require('../src/external/p2');\n\nexport default p2;\n\nexport function createWorld(owner, options) {\n\tassert(!owner._p2World);\n\towner._p2World = new p2.World({\n\t\tgravity: [0, 9.81]\n\t\t// gravity: [0, 0]\n\t});\n\n\t// Stress test says that Body sleeping performs better than Island sleeping when idling.\n\towner._p2World.sleepMode = p2.World.BODY_SLEEPING;\n}\n// const MAX_PHYSICS_DT = 0.2;\nconst PHYSICS_DT = 1 / 60;\nexport function updateWorld(owner, dt) {\n\towner._p2World.step(PHYSICS_DT, dt, 5);\n\t// owner._p2World.step(dt, dt, 10);\n}\nexport function deleteWorld(owner) {\n\tif (owner._p2World)\n\t\towner._p2World.clear()\n\tdelete owner._p2World;\n\tdelete owner._p2Materials;\n}\nexport function getWorld(owner) {\n\treturn owner._p2World;\n}\nexport function addBody(owner, body) {\n\towner._p2World.addBody(body);\n}\nexport function deleteBody(owner, body) {\n\towner._p2World.removeBody(body);\n}\n\n// export function addContactMaterial(owner, A, B, options) {\n// \towner._p2World.addContactMaterial(new p2.ContactMaterial(A, B, options));\n// }\n\nconst defaultMaterialOptions = {\n\tfriction: 0.3,\n\trestitution: 0,\n\tstiffness: 1e6, // Hardness of the contact. Less stiffness will make the objects penetrate more, and will make the contact act more like a spring than a contact force.\n\trelaxation: 4, // Original: 3. Small number makes bounce. Big number makes object stay inside another object.\n\tfrictionStiffness: 1e6, // Stiffness of the resulting friction force. For most cases, the value of this property should be a large number. I cannot think of any case where you would want less frictionStiffness.\n\tfrictionRelaxation: 4, // Relaxation of the resulting friction force. The default value should be good for most simulations.\n\tsurfaceVelocity: 0 // Will add surface velocity to this material. If bodyA rests on top if bodyB, and the surface velocity is positive, bodyA will slide to the right.\n};\n\nexport function createMaterial(owner, options) {\n\tif (!owner._p2Materials)\n\t\towner._p2Materials = {};\n\tlet materials = owner._p2Materials;\n\toptions = Object.assign({}, defaultMaterialOptions, options);\n\tlet hash = [\n\t\toptions.friction,\n\t\toptions.restitution,\n\t\toptions.stiffness,\n\t\toptions.relaxation,\n\t\toptions.frictionStiffness,\n\t\toptions.frictionRelaxation,\n\t\toptions.surfaceVelocity\n\t].join(';');\n\n\tif (materials[hash])\n\t\treturn materials[hash];\n\n\tlet material = new p2.Material();\n\tmaterial.options = options;\n\tmaterials[hash] = material;\n\n\t// TODO: When physics entities are edited, new materials are created.\n\t// Should somehow remove old unused materials and contact materials.\n\n\tfor (var h in materials) {\n\t\tlet m = materials[h];\n\t\tlet o1 = material.options;\n\t\tlet o2 = m.options;\n\t\tlet contactMaterial = new p2.ContactMaterial(material, m, {\n\t\t\tfriction:\t\t\t\tMath.min(o1.friction, o2.friction),\n\t\t\trestitution:\t\t\tMath.max(o1.restitution, o2.restitution), // If one is bouncy and other is not, collision is bouncy.\n\t\t\tstiffness:\t\t\t\tMath.min(o1.stiffness, o2.stiffness),\n\t\t\trelaxation:\t\t\t\t(o1.relaxation + o2.relaxation) / 2,\n\t\t\tfrictionStiffness:\t\tMath.min(o1.frictionStiffness, o2.frictionStiffness),\n\t\t\tfrictionRelaxation:\t\t(o1.frictionRelaxation + o2.frictionRelaxation) / 2,\n\t\t\tsurfaceVelocity:\t\tMath.max(o1.surfaceVelocity, o2.surfaceVelocity)\n\t\t});\n\t\towner._p2World.addContactMaterial(contactMaterial);\n\t}\n\n\treturn material;\n}\n","import Vector from './vector';\n\nexport function keyPressed(key) {\n\treturn keys[key] || false;\n}\n\nexport function listenKeyDown(handler) {\n\tkeyDownListeners.push(handler);\n\treturn () => keyDownListeners.splice(keyDownListeners.indexOf(handler), 1);\n}\nexport function listenKeyUp(handler) {\n\tkeyUpListeners.push(handler);\n\treturn () => keyUpListeners.splice(keyUpListeners.indexOf(handler), 1);\n}\n\nexport const key = {\n\tleft: 37,\n\tright: 39,\n\tup: 38,\n\tdown: 40,\n\tctrl: 17,\n\tappleLeft: 91,\n\tappleRight: 93,\n\talt: 18,\n\tshift: 16,\n\tspace: 32,\n\ta: 65,\n\tb: 66,\n\tc: 67,\n\td: 68,\n\te: 69,\n\tf: 70,\n\tg: 71,\n\th: 72,\n\ti: 73,\n\tj: 74,\n\tk: 75,\n\tl: 76,\n\tm: 77,\n\tn: 78,\n\to: 79,\n\tp: 80,\n\tq: 81,\n\tr: 82,\n\ts: 83,\n\tt: 84,\n\tu: 85,\n\tv: 86,\n\tw: 87,\n\tx: 88,\n\ty: 89,\n\tz: 90,\n\t'0': 48,\n\t'1': 49,\n\t'2': 50,\n\t'3': 51,\n\t'4': 52,\n\t'5': 53,\n\t'6': 54,\n\t'7': 55,\n\t'8': 56,\n\t'9': 57,\n\tbackspace: 8,\n\tenter: 13,\n\tesc: 27,\n\tplus: 187,\n\tminus: 189,\n\tquestionMark: 191\n};\n\nlet mouseDown = false;\nexport function isMouseButtonDown() {\n\treturn mouseDown;\n}\n\n\ndocument.addEventListener('mousedown', event => event.button === 0 && (mouseDown = true));\ndocument.addEventListener('mouseup', event => event.button === 0 && (mouseDown = false));\n\nexport function listenMouseMove(element: HTMLElement, handler: (vec: Vector, event?) => void): () => void {\n\tlet domHandler = event => {\n\t\tlet x = event.pageX;\n\t\tlet y = event.pageY;\n\t\tlet el = element;\n\t\twhile (el != null) {\n\t\t\tx -= el.offsetLeft;\n\t\t\ty -= el.offsetTop;\n\t\t\tel = <HTMLElement>el.offsetParent;\n\t\t}\n\n\t\telement['_mx'] = x;\n\t\telement['_my'] = y;\n\n\t\thandler && handler(new Vector(x, y), event);\n\t};\n\telement.addEventListener('mousemove', domHandler);\n\treturn () => element.removeEventListener('mousemove', domHandler);\n}\n// Requires listenMouseMove on the same element to get the mouse position\nexport function listenMouseDown(element: HTMLElement, handler: (vec?: Vector, event?) => void) {\n\tlet domHandler = event => {\n\t\tif (event.button !== 0)\n\t\t\treturn;\n\n\t\tif (typeof element['_mx'] === 'number')\n\t\t\thandler(new Vector(element['_mx'], element['_my']), event);\n\t\telse\n\t\t\thandler(null, event);\n\t};\n\telement.addEventListener('mousedown', domHandler);\n\treturn () => element.removeEventListener('mousedown', domHandler);\n}\n// Requires listenMouseMove on the same element to get the mouse position\nexport function listenMouseUp(element: HTMLElement, handler: (vec?: Vector, event?) => void) {\n\t// listen document body because many times mouse is accidentally dragged outside of element\n\tlet domHandler = event => {\n\t\tif (typeof element['_mx'] === 'number')\n\t\t\thandler(new Vector(element['_mx'], element['_my']), event);\n\t\telse\n\t\t\thandler(null, event);\n\t};\n\tdocument.body.addEventListener('mouseup', domHandler);\n\treturn () => document.body.removeEventListener('mouseup', domHandler);\n}\n\n////////////////////////////////////\n\n\nlet keys = {};\nlet keyDownListeners = [];\nlet keyUpListeners = [];\n\n\nif (typeof window !== 'undefined') {\n\n\twindow.onkeydown = event => {\n\t\tlet keyCode = event.which || event.keyCode;\n\n\t\tif (document.activeElement.nodeName.toLowerCase() == \"input\" && keyCode !== key.esc)\n\t\t\treturn;\n\n\t\tif (!keys[keyCode]) {\n\t\t\tkeys[keyCode] = true;\n\t\t\tkeyDownListeners.forEach(l => l(keyCode));\n\t\t}\n\n\t\t// console.log(keyCode);\n\t};\n\twindow.onkeyup = event => {\n\t\tlet key = event.which || event.keyCode;\n\t\tkeys[key] = false;\n\t\tkeyUpListeners.forEach(l => l(key));\n\t};\n}\n\nexport function simulateKeyEvent(eventName: 'keydown' | 'keyup', keyCode: number) {\n\tif (eventName === 'keydown') {\n\t\twindow.onkeydown({\n\t\t\tkeyCode\n\t\t} as any);\n\t} else if (eventName === 'keyup') {\n\t\twindow.onkeyup({\n\t\t\tkeyCode\n\t\t} as any);\n\t}\n}\n","import EventDispatcher, { GameEvent, ListenerFunction } from \"../core/eventDispatcher\";\n\nexport enum EditorEvent {\n    EDITOR_CHANGE = 'editor change',\n    EDITOR_REGISTER_MODULES = 'registerModules', // parameters(editor)\n    EDITOR_SCENE_TOOL_CHANGED = 'scene tool changed', // parameters(editor)\n    EDITOR_REGISTER_HELP_VARIABLE = 'define help variable', // parameters(name, value)\n    EDITOR_DELETE_CONFIRMATION = 'delete confirmation', // handlerCallback return true|false|Promise wether deletion should succeed.\n    EDITOR_PRE_DELETE_SELECTION = 'pre delete selection',\n    EDITOR_LOADED = 'editor loaded',\n    EDITOR_RESET = 'reset',\n    EDITOR_FORCE_UPDATE = 'editor force update',\n    EDITOR_UNFOCUS = 'editor unfocus',\n    EDITOR_PLAY = 'play',\n    EDITOR_PAUSE = 'pause',\n    EDITOR_CLONE = 'clone',\n    EDITOR_DELETE = 'delete',\n    EDITOR_DRAW_NEEDED = 'draw needed',\n    EDITOR_SCENE_MODE_CHANGED = 'scene mode change' // mode just turned on. get state from editorGlobals.recording\n};\n\n// Wrapper that takes only EditorEvents\nclass EditorEventDispatcher {\n    dispatcher: EventDispatcher = new EventDispatcher();\n\n    // priority should be a whole number between -100000 and 100000. a smaller priority number means that it will be executed first.\n    listen(event: EditorEvent | string, callback: ListenerFunction, priority = 0) {\n        return this.dispatcher.listen(event as any as GameEvent, callback, priority);\n    }\n    dispatch(event: EditorEvent | string, a?, b?, c?) {\n        this.dispatcher.dispatch(event as any as GameEvent, a, b, c);\n    }\n    dispatchWithResults(event: EditorEvent | string, a?, b?, c?) {\n        return this.dispatcher.dispatchWithResults(event as any as GameEvent, a, b, c);\n    }\n    getEventPromise(event: EditorEvent | string) {\n\t\treturn new Promise(function(res) {\n\t\t\teditorEventDispacher.listen(event, res);\n\t\t});\n\t}\n}\n\nexport let editorEventDispacher = new EditorEventDispatcher();\neditorEventDispacher.dispatcher['editorEventDispatcher'] = true; // for debugging\n","import { isClient } from './environment';\nimport { editorEventDispacher } from \"../editor/editorEventDispatcher\";\nimport { eventDispatcherCallbacks } from '../core/eventDispatcher';\n\nconst UPDATE_INTERVAL = 1000; //ms\n\nlet performance;\nperformance = isClient ? window.performance : { now: Date.now };\n\nlet snapshotPerformance = []; // is static data for UPDATE_INTERVAL. then it changes.\nlet cumulativePerformance = {}; // will be reseted every UPDATE_INTERVAL\nlet currentPerformanceMeters = {}; // very short term\n\nlet perSecondSnapshot = [];\nlet currentPerSecondMeters = {};\nexport function eventHappened(name, count = 1) {\n\t// @ifndef OPTIMIZE\n\tif (['Event performance snapshot', 'Event perSecond snapshot'].includes(name)) return;\n\tcurrentPerSecondMeters[name] = (currentPerSecondMeters[name] || 0) + count;\n\t// @endif\n}\neventDispatcherCallbacks.eventDispatchedCallback = (eventName, count) => eventHappened(`Event ${eventName}`, count);\n\nexport function start(name) {\n\t// @ifndef OPTIMIZE\n\tcurrentPerformanceMeters[name] = performance.now();\n\t// @endif\n}\n\nexport function stop(name) {\n\t// @ifndef OPTIMIZE\n\tlet millis = performance.now() - currentPerformanceMeters[name];\n\tif (cumulativePerformance[name])\n\t\tcumulativePerformance[name] += millis;\n\telse\n\t\tcumulativePerformance[name] = millis;\n\t// @endif\n}\n\nlet performanceInterval = null;\nexport function startPerformanceUpdates() {\n\tperformanceInterval = setInterval(() => {\n\t\tprintPrivatePerformance(cumulativePerformance);\n\n\t\tsnapshotPerformance = performanceObjectToPublicArray(cumulativePerformance);\n\t\tcumulativePerformance = {};\n\t\teditorEventDispacher.dispatch('performance snapshot', snapshotPerformance);\n\n\t\tperSecondSnapshot = perSecondObjectToPublicArray(currentPerSecondMeters);\n\t\tcurrentPerSecondMeters = {};\n\t\teditorEventDispacher.dispatch('perSecond snapshot', perSecondSnapshot);\n\t}, UPDATE_INTERVAL);\n}\n\nfunction printPrivatePerformance(object) {\n\tlet msg = '';\n\tObject.keys(object).filter(key => key.startsWith('#')).map(key => ({\n\t\tname: key,\n\t\tvalue: object[key] / UPDATE_INTERVAL\n\t})).sort((a, b) => {\n\t\treturn a.value < b.value ? 1 : -1;\n\t}).forEach(perf => {\n\t\tmsg += `\\n   ${perf.name.substring(1)}: ${perf.value * 100}`;\n\t});\n\tif (msg)\n\t\tconsole.log('#Performance:' + msg);\n}\n\nfunction performanceObjectToPublicArray(object) {\n\treturn Object.keys(object).filter(key => !key.startsWith('#')).map(key => ({\n\t\tname: key,\n\t\tvalue: object[key] / UPDATE_INTERVAL\n\t})).sort((a, b) => {\n\t\treturn a.value < b.value ? 1 : -1;\n\t});\n}\nfunction perSecondObjectToPublicArray(object) {\n\treturn Object.keys(object).map(key => ({\n\t\tname: key,\n\t\tcount: object[key]\n\t})).sort((a, b) => a.name.localeCompare(b.name));\n}\n\nexport let FRAME_MEMORY_LENGTH = 60 * 8;\nlet frameTimes = [];\nfor (let i = 0; i < FRAME_MEMORY_LENGTH; ++i) {\n\tframeTimes.push(0);\n}\nexport function setFrameTime(seconds) {\n\t// @ifndef OPTIMIZE\n\tframeTimes.shift();\n\tframeTimes.push(seconds);\n\t// @endif\n}\nexport function getFrameTimes() {\n\treturn frameTimes;\n}\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { game } from './game';\nimport { addChange, changeType, setChangeOrigin } from './change';\nimport { createWorld, deleteWorld, updateWorld } from '../features/physics';\nimport { listenMouseMove, listenMouseDown, listenMouseUp, listenKeyDown, key, keyPressed } from '../util/input';\nimport { default as PIXI, getRenderer, sortDisplayObjects } from '../features/graphics';\nimport * as performanceTool from '../util/performance';\nimport Vector from '../util/vector';\n\nimport Level from './level';\nimport { Component } from './component';\nimport EntityPrototype from './entityPrototype';\nimport { GameEvent, globalEventDispatcher } from './eventDispatcher';\n\nlet scene: Scene = null;\nexport { scene };\n\nconst physicsOptions = {\n\tenableSleeping: true\n};\n\nexport default class Scene extends Serializable {\n\tcanvas: HTMLCanvasElement;\n\trenderer: any;\n\tmouseListeners: Array<() => void>;\n\tlevel: Level;\n\tstage: PIXI.Container;\n\tcameraPosition: Vector;\n\tcameraZoom: number;\n\tlayers: { [s: string]: PIXI.Container } = {};\n\tcomponents: Map<string, Set<Component>>;\n\tanimationFrameId: any;\n\tplaying: boolean;\n\ttime: number;\n\twon: boolean;\n\t_prevUpdate: number;\n\tresetting: boolean = false;\n\tpixelDensity: Vector = new Vector(1, 1);\n\n\tconstructor(predefinedId?) {\n\t\tsuper(predefinedId);\n\n\t\tif (scene) {\n\t\t\ttry {\n\t\t\t\tscene.delete();\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Deleting old scene failed', e);\n\t\t\t}\n\t\t}\n\t\tscene = this;\n\n\t\tthis.canvas = document.querySelector('canvas.openEditPlayCanvas');\n\t\tthis.renderer = getRenderer(this.canvas);\n\n\t\tthis.mouseListeners = [\n\t\t\tlistenMouseMove(this.canvas, mousePosition => this.dispatch('onMouseMove', mousePosition)),\n\t\t\tlistenMouseDown(this.canvas, mousePosition => this.dispatch('onMouseDown', mousePosition)),\n\t\t\tlistenMouseUp(this.canvas, mousePosition => this.dispatch('onMouseUp', mousePosition))\n\t\t];\n\n\t\taddChange(changeType.addSerializableToTree, this);\n\n\t\tglobalEventDispatcher.dispatch(GameEvent.GLOBAL_SCENE_CREATED, this);\n\t}\n\tmakeUpAName() {\n\t\tif (this.level)\n\t\t\treturn this.level.makeUpAName();\n\t\telse\n\t\t\treturn 'Scene';\n\t}\n\n\tloadLevel(level: Level) {\n\t\tthis.level = level;\n\n\t\tthis.stage = new PIXI.Container();\n\t\tthis.cameraPosition = new Vector(0, 0);\n\t\tthis.cameraZoom = 1;\n\n\t\tlet self = this;\n\t\tfunction createLayer(parent = self.stage): PIXI.Container {\n\t\t\tlet layer = new PIXI.Container();\n\t\t\tparent.addChild(layer);\n\t\t\treturn layer;\n\t\t}\n\t\tthis.layers = {\n\t\t\tstatic: createLayer(), // doesn't move when camera does\n\t\t\tbackground: createLayer(), // moves a little when camera does\n\t\t\tmove: createLayer(), // moves with camera\n\t\t\tui: createLayer() // doesn't move, is on front\n\t\t};\n\t\tthis.layers.behind = createLayer(this.layers.move);\n\t\tthis.layers.main = createLayer(this.layers.move);\n\t\tthis.layers.front = createLayer(this.layers.move);\n\n\t\t// this.bloom = new PIXI.filters.AdvancedBloomFilter();\n\t\t// this.layers.move.filters = [this.bloom];\n\n\t\t// To make component based entity search fast:\n\t\tthis.components = new Map(); // componentName -> Set of components\n\n\t\tthis.animationFrameId = null;\n\t\tthis.playing = false;\n\t\tthis.time = 0;\n\t\tthis.won = false;\n\n\t\tcreateWorld(this, physicsOptions);\n\n\t\tglobalEventDispatcher.dispatch('scene load level before entities', scene, level);\n\n\t\tthis.level.getChildren('epr').map((epr: EntityPrototype) => epr.createEntity(this));\n\n\t\tglobalEventDispatcher.dispatch('scene load level', scene, level);\n\n\t\t// this.draw();\n\t}\n\tunloadLevel() {\n\t\tlet level = this.level;\n\t\tthis.level = null;\n\n\t\tthis.pause();\n\n\t\tthis.deleteChildren();\n\n\t\tif (this.stage)\n\t\t\tthis.stage.destroy();\n\t\tthis.stage = null;\n\n\t\tthis.layers = {};\n\n\t\tthis.components.clear();\n\n\t\tdeleteWorld(this);\n\n\t\tglobalEventDispatcher.dispatch('scene unload level', scene, level);\n\t}\n\n\tsetCameraPositionToPlayer() {\n\t\tlet pos = new Vector(0, 0);\n\t\tlet count = 0;\n\t\tthis.getComponents('CharacterController').forEach(characterController => {\n\t\t\tif (characterController._rootType) {\n\t\t\t\tpos.add(characterController.Transform.getGlobalPosition());\n\t\t\t\tcount++;\n\t\t\t}\n\t\t});\n\t\tif (count > 0) {\n\t\t\tthis.cameraPosition.set(pos.divideScalar(count));\n\t\t}\n\t}\n\n\tupdateCamera() {\n\t\tif (this.playing) {\n\t\t\tthis.setCameraPositionToPlayer();\n\t\t}\n\t\t// pivot is camera top left corner position\n\t\tthis.layers.move.pivot.set(this.cameraPosition.x - this.canvas.width / 2 / this.cameraZoom, this.cameraPosition.y - this.canvas.height / 2 / this.cameraZoom);\n\t\tthis.layers.move.scale.set(this.cameraZoom, this.cameraZoom);\n\t}\n\n\twin() {\n\t\tthis.won = true;\n\t}\n\n\tanimFrame() {\n\t\tthis.animationFrameId = null;\n\t\tif (!this._alive || !this.playing) return;\n\n\t\tlet timeInMilliseconds = performance.now();\n\t\tlet t = 0.001 * timeInMilliseconds;\n\t\tlet dt = t - this._prevUpdate;\n\n\t\tperformanceTool.setFrameTime(dt);\n\n\t\tif (dt > 0.05)\n\t\t\tdt = 0.05;\n\t\tthis._prevUpdate = t;\n\t\tthis.time += dt;\n\n\t\tsetChangeOrigin(this);\n\n\t\t// Update logic\n\t\tperformanceTool.start('Component updates');\n\t\tthis.dispatch('onUpdate', dt, this.time);\n\t\tperformanceTool.stop('Component updates');\n\n\t\t// performanceTool.start('Component up2');\n\t\t// let set = this.getComponents('Spawner');\n\t\t// let sceneTime = this.time;\n\t\t// set.forEach(comp => {\n\t\t// \tif (sceneTime > comp.lastSpawn + comp.interval)\n\t\t// \t\tcomp.spawn();\n\t\t// });\n\t\t// performanceTool.stop('Component up2');\n\n\t\t// Update physics\n\t\tperformanceTool.start('Physics');\n\t\tupdateWorld(this, dt);\n\t\tperformanceTool.stop('Physics');\n\n\t\t// // Update logic\n\t\t// performanceTool.start('Component post updates');\n\t\t// this.dispatch('onPostPhysicsUpdate', dt, this.time);\n\t\t// performanceTool.stop('Component post updates');\n\n\t\t// Update graphics\n\t\tperformanceTool.start('Draw');\n\t\tthis.draw();\n\t\tperformanceTool.stop('Draw');\n\n\t\tif (this.won) {\n\t\t\tthis.pause();\n\t\t\tthis.time = 0;\n\t\t\tgame.dispatch(GameEvent.GAME_LEVEL_COMPLETED);\n\t\t\tthis.reset();\n\t\t}\n\n\t\tthis.requestAnimFrame();\n\t}\n\n\trequestAnimFrame() {\n\t\tlet callback = () => this.animFrame();\n\t\tif (window.requestAnimationFrame)\n\t\t\tthis.animationFrameId = window.requestAnimationFrame(callback);\n\t\telse\n\t\t\tthis.animationFrameId = setTimeout(callback, 16);\n\t}\n\n\tdraw() {\n\t\tthis.updateCamera();\n\n\t\t[this.layers.behind, this.layers.main, this.layers.front].forEach(sortDisplayObjects);\n\n\t\tthis.renderer.render(this.stage, null, false);\n\n\t\tthis.dispatch(GameEvent.SCENE_DRAW, scene);\n\t\tperformanceTool.eventHappened('Draws');\n\t}\n\n\tisInInitialState() {\n\t\treturn !this.playing && this.time === 0;\n\t}\n\n\treset() {\n\t\tif (!this._alive)\n\t\t\treturn; // scene has been replaced by another one\n\n\t\tthis.resetting = true;\n\n\t\tlet level = this.level;\n\t\tthis.unloadLevel();\n\n\t\tif (level)\n\t\t\tthis.loadLevel(level);\n\n\t\t// this.draw(); // we might be doing ok even without draw.\n\t\t// player mode starts mainloop and editor may want to control the drawing more.\n\n\t\tdelete this.resetting;\n\n\t\tthis.dispatch(GameEvent.SCENE_RESET);\n\t}\n\n\tpause() {\n\t\tif (!this.playing) return;\n\n\t\tthis.playing = false;\n\t\tif (this.animationFrameId) {\n\t\t\tif (window.requestAnimationFrame)\n\t\t\t\twindow.cancelAnimationFrame(this.animationFrameId);\n\t\t\telse\n\t\t\t\tclearTimeout(this.animationFrameId);\n\t\t}\n\t\tthis.animationFrameId = null;\n\n\t\tthis.dispatch(GameEvent.SCENE_PAUSE);\n\t}\n\n\tplay() {\n\t\tif (this.playing) return;\n\n\t\tthis._prevUpdate = 0.001 * performance.now();\n\t\tthis.playing = true;\n\n\t\tthis.requestAnimFrame();\n\n\t\tif (this.time === 0)\n\t\t\tthis.dispatch(GameEvent.SCENE_START);\n\n\t\tthis.dispatch(GameEvent.SCENE_PLAY);\n\t}\n\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\n\t\tthis.unloadLevel();\n\n\t\tif (scene === this)\n\t\t\tscene = null;\n\n\t\tif (this.mouseListeners) {\n\t\t\tthis.mouseListeners.forEach(listener => listener());\n\t\t\tthis.mouseListeners = null;\n\t\t}\n\n\t\tthis.renderer = null; // Do not call renderer.destroy(). Same renderer is used by all scenes for now.\n\n\t\treturn true;\n\t}\n\n\t// To make component based entity search fast:\n\taddComponent(component: Component) {\n\t\tlet set = this.components.get(component.componentClass.componentName);\n\t\tif (!set) {\n\t\t\tset = new Set();\n\t\t\tthis.components.set(component.componentClass.componentName, set);\n\t\t}\n\t\tset.add(component);\n\t}\n\n\tremoveComponent(component: Component) {\n\t\tlet set = this.components.get(component.componentClass.componentName);\n\t\tassert(set);\n\t\tassert(set.delete(component));\n\t}\n\n\tgetComponents(componentName) {\n\t\treturn this.components.get(componentName) || new Set;\n\t}\n\n\tmouseToWorld(mousePosition: Vector) {\n\t\treturn new Vector(\n\t\t\tthis.layers.move.pivot.x + mousePosition.x / this.cameraZoom * this.pixelDensity.x,\n\t\t\tthis.layers.move.pivot.y + mousePosition.y / this.cameraZoom * this.pixelDensity.y\n\t\t);\n\t}\n\tworldToMouse(worldPosition: Vector) {\n\t\treturn new Vector(\n\t\t\t(worldPosition.x - this.layers.move.pivot.x) * this.cameraZoom / this.pixelDensity.x,\n\t\t\t(worldPosition.y - this.layers.move.pivot.y) * this.cameraZoom / this.pixelDensity.y\n\t\t);\n\t}\n\tmouseToPIXI(mousePosition: Vector) {\n\t\treturn mousePosition.clone().multiply(this.pixelDensity);\n\t}\n\tscreenPixelsToWorldPixels(screenPixels: number) {\n\t\treturn screenPixels / this.cameraZoom * this.pixelDensity.x;\n\t}\n\tgetEntitiesAtScreenPoint(screenPoint: Vector) {\n\t\tfor (const child of this.stage.children) {\n\n\t\t}\n\t}\n\n\tsetZoom(zoomLevel) {\n\t\tif (zoomLevel)\n\t\t\tthis.cameraZoom = zoomLevel;\n\t\tthis.dispatch(GameEvent.SCENE_ZOOM_CHANGED, this.cameraZoom);\n\t}\n\n\tresizeCanvas(gameResolution: Vector, screenResolution?: Vector) {\n\t\tthis.renderer.resize(gameResolution.x, gameResolution.y);\n\n\t\tif (screenResolution) {\n\t\t\tthis.pixelDensity.setScalars(gameResolution.x / screenResolution.x, gameResolution.y / screenResolution.y);\n\t\t} else {\n\t\t\tthis.pixelDensity.setScalars(1, 1);\n\t\t}\n\t}\n}\nScene.prototype.isRoot = true;\n\nSerializable.registerSerializable(Scene, 'sce');\n\nexport function forEachScene(listener) {\n\tglobalEventDispatcher.listen(GameEvent.GLOBAL_SCENE_CREATED, listener);\n\n\tif (scene)\n\t\tlistener(scene);\n}\n","import Serializable from './serializable';\nimport Entity from './entity';\nimport assert from '../util/assert';\nimport PropertyOwner from './propertyOwner';\nimport Scene, { scene } from './scene';\nimport Game, { game } from './game';\nexport { default as Prop } from './propertyType';\nexport let componentClasses: Map<string, typeof Component> = new Map();\nimport * as performance from '../util/performance';\nimport { PropertyType } from './propertyType';\nimport { GameEvent } from './eventDispatcher';\n\nconst automaticSceneEventListeners = {\n\tonUpdate: 'onUpdate',\n\tonStart: GameEvent.SCENE_START\n};\n\n// Object of a component, see _componentExample.js\nexport class Component extends PropertyOwner {\n\t_componentId: string;\n\tscene: Scene;\n\tgame: Game;\n\t_listenRemoveFunctions: Array<() => void>;\n\tentity: Entity;\n\tcomponentClass: typeof Component;\n\tcomponentName: string;\n\tTransform: Component;\n\t[s: string]: any; // Suppress all errors. Components will have many custom parameters.\n\n\tstatic componentName: string;\n\tstatic category: string;\n\tstatic requirements: Array<string>;\n\tstatic children: Array<any>;\n\tstatic description: string;\n\tstatic allowMultiple: boolean;\n\tstatic icon: string;\n\tstatic color: string;\n\n\tstatic _propertyTypes: Array<PropertyType>;\n\tstatic _propertyTypesByName: { [s: string]: PropertyType };\n\n\tconstructor(predefinedId?: string) {\n\t\tsuper(predefinedId);\n\t\tthis._componentId = null; // Creator will fill this\n\t\tthis.scene = scene;\n\t\tthis.game = game;\n\t\tthis._listenRemoveFunctions = [];\n\t\tthis.entity = null;\n\t}\n\tmakeUpAName() {\n\t\treturn this.componentClass.componentName;\n\t}\n\tclone() {\n\t\tlet component = super.clone() as any as Component;\n\t\tcomponent._componentId = this._componentId;\n\t\treturn component;\n\t}\n\tdelete() {\n\t\t// Component.delete never returns false because entity doesn't have components as children\n\t\tthis._parent = null;\n\t\tthis.entity = null;\n\t\tsuper.delete();\n\t\treturn true;\n\t}\n\t_addEventListener(functionName: string, eventName?: GameEvent) {\n\t\tif (!eventName)\n\t\t\teventName = functionName as GameEvent;\n\n\t\tlet func = this[functionName];\n\t\tlet self = this;\n\t\tlet performanceName = 'Component: ' + this.componentClass.componentName;\n\t\tthis._listenRemoveFunctions.push(this.scene.listen(eventName, function () {\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tperformance.start(performanceName);\n\t\t\t// @endif\n\n\t\t\tfunc.apply(self, arguments);\n\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tperformance.stop(performanceName);\n\t\t\t// @endif\n\t\t}));\n\t}\n\t// In preInit you can init the component with stuff that other components might want to use in init function\n\t// In preInit you can not trust that other components have been inited in any way\n\t_preInit() {\n\t\tthis.componentClass.requirements.forEach(r => {\n\t\t\tthis[r] = this.entity.getComponent(r);\n\t\t\tassert(this[r], this.componentClass.componentName + ` requires component ` + r + ` but it is not found`);\n\t\t});\n\n\t\tthis.forEachChild('com', (c: Component) => c._preInit());\n\n\t\tfor (let key in automaticSceneEventListeners) {\n\t\t\tif (typeof this[key] === 'function') {\n\t\t\t\tthis._addEventListener(key, automaticSceneEventListeners[key]);\n\t\t\t}\n\t\t}\n\t\t/*\n\t\tfor (let i = 0; i < Object.keys(automaticSceneEventListeners).length; ++i) {\n\t\t\tif (typeof this[automaticSceneEventListeners[i]] === 'function') {\n\t\t\t\tthis._addEventListener(automaticSceneEventListeners[i]);\n\t\t\t}\n\t\t}\n\t\t*/\n\n\t\tif (this.componentClass.componentName !== 'Transform' && this.scene)\n\t\t\tthis.scene.addComponent(this);\n\n\t\ttry {\n\t\t\tif (typeof (this as ComponentRegisterPrototype).preInit === 'function')\n\t\t\t\t(this as ComponentRegisterPrototype).preInit();\n\t\t} catch (e) {\n\t\t\tconsole.error(this.entity, this.componentClass.componentName, 'preInit', e);\n\t\t}\n\t}\n\t// In preInit you can access other components and know that their preInit is done.\n\t_init() {\n\t\tthis.forEachChild('com', (c: Component) => c._init());\n\t\ttry {\n\t\t\tif (typeof (this as ComponentRegisterPrototype).init === 'function')\n\t\t\t\t(this as ComponentRegisterPrototype).init();\n\t\t} catch (e) {\n\t\t\tconsole.error(this.entity, this.componentClass.componentName, 'init', e);\n\t\t}\n\t}\n\t_sleep() {\n\t\ttry {\n\t\t\tif (typeof (this as ComponentRegisterPrototype).sleep === 'function')\n\t\t\t\t(this as ComponentRegisterPrototype).sleep();\n\t\t} catch (e) {\n\t\t\tconsole.error(this.entity, this.componentClass.componentName, 'sleep', e);\n\t\t}\n\n\t\tif (this.componentClass.componentName !== 'Transform' && this.scene)\n\t\t\tthis.scene.removeComponent(this);\n\n\t\tthis.forEachChild('com', (c: Component) => c._sleep());\n\n\t\tthis._listenRemoveFunctions.forEach(f => f());\n\t\tthis._listenRemoveFunctions.length = 0;\n\t}\n\tlistenProperty(component: Component, propertyName: string, callback: Function) {\n\t\t// @ifndef OPTIMIZE\n\t\tassert(component, 'listenProperty called without a component');\n\t\t// @endif\n\t\tthis._listenRemoveFunctions.push(component._properties[propertyName].listen(GameEvent.PROPERTY_VALUE_CHANGE, callback));\n\t}\n\tremoveListenerOnSleep(listenerFunction: () => void) {\n\t\tassert(!this.entity.sleeping, 'Cannot call removeListenerOnSleep in sleep mode.');\n\t\tthis._listenRemoveFunctions.push(listenerFunction);\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tn: this.componentClass.componentName,\n\t\t\tcid: this._componentId\n\t\t});\n\t}\n\n\tstatic create(name: string, values = {}) {\n\t\tlet componentClass = componentClasses.get(name);\n\t\tassert(componentClass);\n\t\tlet component = new componentClass();\n\t\tcomponent.initWithPropertyValues(values);\n\t\treturn component;\n\t};\n\tstatic createWithInheritedComponentData(inheritedComponentData) {\n\t\tlet component = new inheritedComponentData.componentClass as Component;\n\t\tcomponent._componentId = inheritedComponentData.componentId;\n\t\tlet properties = inheritedComponentData.properties.map(p => p.clone());\n\t\tcomponent.initWithChildren(properties);\n\t\treturn component;\n\t};\n\n\tstatic reservedPropertyNames = new Set(['id', 'constructor', 'delete', 'children', 'entity', 'env', 'init', 'preInit', 'sleep', 'toJSON', 'fromJSON']);\n\tstatic reservedPrototypeMembers = new Set(['id', 'children', 'entity', 'env', '_preInit', '_init', '_sleep', '_forEachChildComponent', '_properties', '_componentData', 'toJSON', 'fromJSON']);\n\tstatic register({\n\t\tname = '', // required\n\t\tdescription = '',\n\t\tcategory = 'Other',\n\t\ticon = 'fa-puzzle-piece', // in editor\n\t\tcolor = '', // in editor\n\t\tproperties = [],\n\t\trequirements = ['Transform'],\n\t\tchildren = [],\n\t\tparentClass = Component,\n\t\tprototype = {},\n\t\tallowMultiple = true,\n\t\trequiresInitWhenEntityIsEdited = false\n\t}: ComponentRegisterOptions = {}) {\n\t\tassert(name, 'Component must have a name.');\n\t\tassert(name[0] >= 'A' && name[0] <= 'Z', 'Component name must start with capital letter.');\n\t\tassert(!componentClasses.has(name), 'Duplicate component class ' + name);\n\t\tObject.keys(prototype).forEach(k => {\n\t\t\tif (Component.reservedPrototypeMembers.has(k))\n\t\t\t\tassert(false, 'Component prototype can not have a reserved member: ' + k);\n\t\t});\n\n\t\tif (requirements.indexOf('Transform') < 0) requirements.push('Transform');\n\t\tlet colorNum = name.split('').reduce((prev, curr) => prev + curr.charCodeAt(0), 0);\n\n\t\tlet constructorFunction = prototype.constructor;\n\t\tlet deleteFunction = prototype.delete;\n\t\tdelete prototype.constructor;\n\t\tdelete prototype.delete;\n\t\tclass Com extends parentClass {\n\t\t\tconstructor(...args) {\n\t\t\t\tsuper(...args);\n\t\t\t\tif (constructorFunction)\n\t\t\t\t\tconstructorFunction.call(this);\n\t\t\t}\n\t\t\tdelete() {\n\t\t\t\tif (!super.delete()) return false;\n\n\t\t\t\tif (deleteFunction)\n\t\t\t\t\tdeleteFunction.call(this);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tstatic componentName = name;\n\t\t\tstatic category = category;\n\t\t\tstatic requirements = requirements;\n\t\t\tstatic children = children;\n\t\t\tstatic description = description;\n\t\t\tstatic allowMultiple = allowMultiple;\n\t\t\tstatic icon = icon;\n\t\t\tstatic color = color || `hsla(${colorNum % 360}, 40%, 60%, 1)`;\n\t\t\tcomponentClass: typeof Component;\n\t\t}\n\t\tproperties.forEach(p => {\n\t\t\tassert(!Component.reservedPropertyNames.has(p.name), 'Can not have property called ' + p.name);\n\t\t});\n\t\tPropertyOwner.defineProperties(Com, properties); // properties means propertyTypes here\n\n\t\tprototype._name = name;\n\t\tCom.prototype.componentClass = Com;\n\t\tObject.assign(Com.prototype, prototype);\n\t\tcomponentClasses.set(Com.componentName, Com);\n\t\treturn Com;\n\t};\n}\n\ninterface ComponentRegisterPrototype {\n\tconstructor?: Function,\n\tdelete?: () => void,\n\t_name?: string,\n\tpreInit?: () => void,\n\tinit?: () => void,\n\tsleep?: () => void,\n\t[others: string]: any\n};\n\ntype ComponentRegisterOptions = {\n\tname?: string,\n\tdescription?: string,\n\tcategory?: string,\n\ticon?: string,\n\tcolor?: string,\n\tproperties?: Array<any>,\n\trequirements?: Array<string>,\n\tchildren?: Array<any>,\n\tparentClass?: typeof Component,\n\tprototype?: ComponentRegisterPrototype,\n\tallowMultiple?: boolean,\n\trequiresInitWhenEntityIsEdited?: boolean\n};\n\nSerializable.registerSerializable(Component, 'com', json => {\n\tlet component = <Component>new (componentClasses.get(json.n))(json.id);\n\tcomponent._componentId = json.cid || null;\n\treturn component;\n});\n","import Serializable, { createStringId } from './serializable';\nimport assert from '../util/assert';\nimport { componentClasses, Component } from './component';\nimport { isClient } from '../util/environment';\nimport Property from './property';\nimport { PropertyOwnerClass } from './propertyOwner';\nimport Prototype from './prototype';\n\nexport default class ComponentData extends Serializable {\n\tname: string;\n\tcomponentClass: typeof Component & PropertyOwnerClass;\n\tcomponentId: string;\n\n\tconstructor(componentClassName, predefinedId?, predefinedComponentId: string = '') {\n\t\tsuper(predefinedId);\n\t\tthis.name = componentClassName;\n\t\tthis.componentClass = componentClasses.get(this.name);\n\t\tassert(this.componentClass, 'Component class not defined: ' + componentClassName);\n\t\tif (!this.componentClass.allowMultiple)\n\t\t\tpredefinedComponentId = '_' + componentClassName;\n\t\tthis.componentId = predefinedComponentId || createStringId('cid', 10); // what will be the id of component created from this componentData\n\t}\n\tmakeUpAName() {\n\t\treturn this.name;\n\t}\n\taddChild(child) {\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!child.propertyType) {\n\t\t\t\tif (!this.componentClass._propertyTypesByName[child.name]) {\n\t\t\t\t\tif (isClient)\n\t\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\telse\n\t\t\t\t\t\tconsole.log('Property of that name not defined', this.id, this.name, child.name);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tchild.setPropertyType(this.componentClass._propertyTypesByName[child.name]);\n\t\t\t}\n\t\t}\n\t\tsuper.addChild(child);\n\t\treturn this as Serializable;\n\t}\n\tclone(options?) {\n\t\tlet newComponentId = (options && options.cloneComponentId) ? this.componentId : '';\n\t\tlet obj = new ComponentData(this.name, false, newComponentId);\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj as Serializable;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tcid: this.componentId,\n\t\t\tn: this.name\n\t\t});\n\t}\n\t/*\n\tReturns a list of Properties.\n\tThose which don't have an id are temporary properties generated from parents.\n\tDon't set _depth.\n\t */\n\tgetInheritedProperties(_depth = 0) {\n\t\tlet properties = {};\n\n\t\t// properties from parent\n\t\tlet parentComponentData = this.getParentComponentData();\n\t\tif (parentComponentData)\n\t\t\tparentComponentData.getInheritedProperties(_depth + 1).forEach(prop => properties[prop.name] = prop);\n\n\t\t// properties from this. override properties of parents\n\t\tthis.getChildren('prp').forEach((prop: Property) => {\n\t\t\tif (_depth === 0)\n\t\t\t\tproperties[prop.name] = prop;\n\t\t\telse\n\t\t\t\tproperties[prop.name] = prop.clone(true);\n\t\t});\n\n\t\t// fill from propertyType\n\t\tif (_depth === 0) {\n\t\t\treturn this.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\treturn properties[propertyType.name] || propertyType.createProperty({\n\t\t\t\t\tskipSerializableRegistering: true\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn Object.keys(properties).map(key => properties[key]);\n\t\t}\n\t}\n\tgetParentComponentData() {\n\t\tif (!this._parent) return null;\n\t\tlet parentPrototype = (this._parent as Prototype).getParentPrototype() as Prototype;\n\t\twhile (parentPrototype) {\n\t\t\tlet parentComponentData = parentPrototype.findChild('cda', (componentData: ComponentData) => componentData.componentId === this.componentId);\n\t\t\tif (parentComponentData)\n\t\t\t\treturn parentComponentData;\n\t\t\telse\n\t\t\t\tparentPrototype = parentPrototype.getParentPrototype() as Prototype;\n\t\t}\n\t\treturn null;\n\t}\n\tgetPropertyOrCreate(name) {\n\t\tlet property = this.findChild('prp', (prp: Property) => prp.name === name);\n\t\tif (!property) {\n\t\t\tproperty = this.componentClass._propertyTypesByName[name].createProperty();\n\t\t\tthis.addChild(property);\n\t\t}\n\t\treturn property;\n\t}\n\tgetProperty(name) {\n\t\treturn this.findChild('prp', prp => (prp as Property).name === name);\n\t}\n\tsetValue(propertyName, value) {\n\t\tthis.getPropertyOrCreate(propertyName).value = value;\n\t\treturn this;\n\t}\n\tgetValue(name) {\n\t\tlet property = this.getProperty(name);\n\t\tif (property)\n\t\t\treturn property.value;\n\t\tlet parent = this.getParentComponentData();\n\n\t\tif (parent)\n\t\t\treturn parent.getValue(name);\n\n\t\treturn this.componentClass._propertyTypesByName[name].initialValue;\n\t}\n\tcreateComponent() {\n\t\tlet properties = this.getInheritedProperties();\n\t\tlet values = {};\n\t\tproperties.forEach(prop => {\n\t\t\tvalues[prop.name] = prop.value;\n\t\t});\n\t\tlet component = Component.create(this.name, values);\n\t\tcomponent._componentId = this.componentId;\n\t\treturn component;\n\t}\n}\nSerializable.registerSerializable(ComponentData, 'cda', json => {\n\treturn new ComponentData(json.n, json.id, json.cid);\n});\n\n\n/*\n\nFrom Component? Is this needed?\n\n\tcreateComponentData() {\n\t\tlet componentName = this.componentClass.componentName;\n\t\tlet propertyTypes = this.class._propertyTypes;\n\t\tlet componentData = new ComponentData(componentName);\n\t\tlet children = [];\n\t\tpropertyTypes.forEach(pt => {\n\t\t\tchildren.push(pt.createProperty({\n\t\t\t\tvalue: this[pt.name]\n\t\t\t}));\n\t\t});\n\t\tcomponentData.initWithChildren(children);\n\t\treturn componentData;\n\t}\n\n*/\n","import assert, { changeGetter as assertChangeGetter } from '../util/assert';\nimport Serializable, { serializableCallbacks } from './serializable';\n\nexport let serializables = {};\n\nexport function addSerializable(serializable: Serializable) {\n// @ifndef OPTIMIZE\n\tif (serializables[serializable.id] !== undefined)\n\t\tassert(false, (\"Serializable id clash \" + (serializable.id)));\n// @endif\n\tserializables[serializable.id] = serializable;\n}\nserializableCallbacks.addSerializable = addSerializable;\n\nexport function getSerializable(id: string) {\n\treturn serializables[id] || null;\n}\n\nexport function hasSerializable(id: string) {\n\treturn Boolean(serializables[id]);\n}\n\nexport function removeSerializable(id: string) {\n\t/* When deleting a scene, this function is called a lot of times\n\tif (!serializables[id])\n\t\tthrow new Error('Serializable not found!');\n\t*/\n\tdelete serializables[id];\n}\nserializableCallbacks.removeSerializable = removeSerializable;\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport * as performanceTool from '../util/performance';\nimport Prototype, { InheritedComponentData } from './prototype';\nimport { Component } from './component';\nimport { getSerializable } from './serializableManager';\nimport Property from './property';\nimport EntityPrototype from './entityPrototype';\n\nconst ALIVE_ERROR = 'entity is already dead';\n\nexport default class Entity extends Serializable {\n\tcomponents: Map<string, Array<Component>>;\n\tsleeping: boolean;\n\tprototype: EntityPrototype;\n\tlocalMaster: boolean;\n\n\tstatic ENTITY_CREATION_DEBUGGING = false;\n\n\tconstructor(predefinedId?) {\n\t\tsuper(predefinedId);\n\t\tthis.components = new Map(); // name -> array\n\t\tthis.sleeping = false;\n\t\tthis.prototype = null; // should be set immediately after constructor\n\t\tthis.localMaster = true; // set false if entity is controlled over the net\n\n\t\tperformanceTool.eventHappened('Create object');\n\t}\n\n\tmakeUpAName() {\n\t\tif (this.prototype) {\n\t\t\treturn this.prototype.makeUpAName();\n\t\t} else {\n\t\t\treturn 'Entity';\n\t\t}\n\t}\n\n\t// Get the first component of given name\n\tgetComponent(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tlet components = this.components.get(name);\n\t\tif (components !== undefined)\n\t\t\treturn components[0];\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// Get all components with given name\n\tgetComponents(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\treturn this.components.get(name) || [];\n\t}\n\n\tgetListOfAllComponents() {\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value);\n\t\t});\n\t\treturn components;\n\t}\n\n\tclone(parent: Serializable = null) {\n\t\tlet entity = new Entity();\n\t\tentity.prototype = this.prototype.clone() as EntityPrototype;\n\t\tentity.sleeping = this.sleeping;\n\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value.map(c => c.clone()));\n\t\t});\n\t\tentity.addComponents(components, { fullInit: false });\n\n\t\tif (parent) {\n\t\t\tparent.addChild(entity);\n\t\t}\n\n\t\tlet children = [];\n\t\tthis.forEachChild('ent', (ent: Entity) => {\n\t\t\tchildren.push(ent.clone(entity));\n\t\t});\n\t\tif (!entity.sleeping) {\n\t\t\tEntity.initComponents(components);\n\t\t}\n\t\treturn entity;\n\t}\n\n\t/*\n\tAdds multiple components as an array to this Entity.\n\tInitializes components after all components are added.\n\t*/\n\taddComponents(components, { fullInit = true } = {}) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tassert(Array.isArray(components), 'Parameter is not an array.');\n\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('add components for', this.makeUpAName());\n\n\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\tlet component = components[i];\n\t\t\tlet componentList = this.components.get(component._name) || this.components.set(component._name, []).get(component._name);\n\t\t\tcomponentList.push(component);\n\t\t\tcomponent.entity = this;\n\t\t\tcomponent._parent = this;\n\t\t\tcomponent.setRootType(this._rootType);\n\t\t}\n\n\t\tif (!this.sleeping) {\n\t\t\tEntity.preInitComponents(components);\n\t\t\tif (fullInit)\n\t\t\t\tEntity.initComponents(components);\n\t\t}\n\t\treturn this;\n\t}\n\n\tstatic preInitComponents(components) {\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('preInit components for', components[0].entity.makeUpAName());\n\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\tassert(!components[i].entity.sleeping, 'entity can not be sleeping when pre initing components');\n\t\t\tcomponents[i]._preInit();\n\t\t}\n\t}\n\n\tstatic initComponents(components) {\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log(`init ${components.length} components for`, components[0].entity.makeUpAName());\n\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\tassert(!components[i].entity.sleeping, 'entity can not be sleeping when initing components');\n\t\t\tcomponents[i]._init();\n\t\t}\n\t}\n\n\tstatic makeComponentsSleep(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._sleep();\n\t}\n\n\tstatic deleteComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i].delete();\n\t}\n\n\tsleep() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (this.sleeping) return false;\n\n\t\tthis.components.forEach((value, key) => Entity.makeComponentsSleep(value));\n\n\t\tthis.forEachChild('ent', (entity: Entity) => entity.sleep());\n\n\t\tthis.sleeping = true;\n\t\treturn true;\n\t}\n\n\twakeUp() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (!this.sleeping) return false;\n\t\tthis.sleeping = false;\n\n\t\tthis.components.forEach((value, key) => Entity.preInitComponents(value));\n\t\tthis.components.forEach((value, key) => Entity.initComponents(value));\n\n\t\tthis.forEachChild('ent', (entity: Entity) => entity.wakeUp());\n\n\t\treturn true;\n\t}\n\n\tresetComponents() {\n\n\t\tlet inheritedComponentDatas = this.prototype.getInheritedComponentDatas();\n\n\t\tinheritedComponentDatas.forEach((icd: InheritedComponentData) => {\n\t\t\tlet component = this.getComponents(icd.componentClass.componentName).find((comp: Component) => comp._componentId === icd.componentId);\n\t\t\ticd.properties.forEach((prop: Property) => {\n\t\t\t\tif (!component._properties[prop.name].valueEquals(prop.value)) {\n\t\t\t\t\tcomponent[prop.name] = prop.value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// debugger; // TODO: do stuff with inheritedComponentDatas\n\n\t\tthis.forEachChild('ent', (ent: Entity) => ent.resetComponents());\n\t}\n\n\tdelete() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tthis.sleep();\n\t\tif (!super.delete()) return false;\n\n\t\tthis.components.forEach((value, key) => Entity.deleteComponents(value));\n\t\tthis.components.clear();\n\n\t\tperformanceTool.eventHappened('Destroy object');\n\n\t\treturn true;\n\t}\n\n\tdeleteComponent(component) {\n\t\tlet array = this.getComponents(component.constructor.componentName);\n\t\tlet idx = array.indexOf(component);\n\t\tassert(idx >= 0);\n\t\tif (!this.sleeping)\n\t\t\tcomponent._sleep();\n\t\tcomponent.delete();\n\t\tarray.splice(idx, 1);\n\t\treturn this;\n\t}\n\n\tsetRootType(rootType) {\n\t\tif (this._rootType === rootType)\n\t\t\treturn;\n\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('entity added to tree', this.makeUpAName());\n\n\t\tsuper.setRootType(rootType);\n\n\t\tlet i;\n\t\tthis.components.forEach((value, key) => {\n\t\t\tfor (i = 0; i < value.length; ++i) {\n\t\t\t\tvalue[i].setRootType(rootType);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoJSON() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\n\t\tlet components = [];\n\t\tthis.components.forEach(compArray => {\n\t\t\tcompArray.forEach(comp => {\n\t\t\t\tcomponents.push(comp.toJSON());\n\t\t\t});\n\t\t});\n\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tc: components, // overwrite children. earlier this was named 'comp'\n\t\t\tproto: this.prototype.id\n\t\t});\n\t}\n\tget position() {\n\t\treturn this.getComponent('Transform').position;\n\t}\n\tset position(position) {\n\t\tthis.getComponent('Transform').position = position;\n\t}\n\tget Transform() {\n\t\treturn this.getComponent('Transform');\n\t}\n}\n\nSerializable.registerSerializable(Entity, 'ent', json => {\n\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('creating entity from json', json);\n\tlet entity = new Entity(json.id);\n\tentity.prototype = getSerializable(json.proto);\n\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('created entity from json', entity);\n\tif (json.comp) {\n\t\tentity.addComponents((json.c || json.comp).map(Serializable.fromJSON));\n\t}\n\treturn entity;\n});\n\n","import Serializable, { createStringId } from './serializable';\nimport assert from '../util/assert';\nimport Prop, { PropertyType } from './propertyType';\nimport PropertyOwner from './propertyOwner';\nimport ComponentData from './componentData';\nimport Entity from './entity';\nimport { game } from './game';\nimport { Component } from './component';\nimport EntityPrototype from './entityPrototype';\nimport Level from './level';\nimport { globalEventDispatcher, GameEvent } from './eventDispatcher';\nimport Property from './property';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Prototype extends PropertyOwner {\n\tpreviouslyCreatedEntity: Entity;\n\tname: string; // Hack to reveal PropertyOwner property\n\tsiblingId: string;\n\n\tstatic _propertyTypes: Array<PropertyType>;\n\tstatic _propertyTypesByName: { [s: string]: PropertyType };\n\n\tconstructor(predefinedId?: string, siblingId?: string) {\n\t\tsuper(predefinedId);\n\t\tthis.previouslyCreatedEntity = null;\n\t\tthis.siblingId = siblingId || Prototype.createSiblingId()\n\t}\n\n\tstatic createSiblingId() {\n\t\treturn createStringId('', 6)\n\t}\n\n\tmakeUpAName() {\n\t\treturn this.name || 'Prototype';\n\t}\n\n\taddChild(child: Serializable): Prototype {\n\t\t// if (child.threeLetterType === 'cda' && !child.componentClass.allowMultiple)\n\t\tif (child instanceof ComponentData && !(child as ComponentData).componentClass.allowMultiple)\n\t\t\tassert(this.findChild('cda', (cda: ComponentData) => cda.componentId === child.componentId) === null, `Can't have multiple ${child.name} components. See Component.allowMultiple`);\n\t\tsuper.addChild(child);\n\t\treturn this;\n\t}\n\tgetParentPrototype(): Prototype {\n\t\treturn this._parent && this._parent.threeLetterType === 'prt' ? this._parent as Prototype : null;\n\t}\n\n\t/**\n\t * \"\" = path to current prototype\n\t * \"abc\" = path to child prototype that has siblingId \"abc\"\n\t * \"abc/def/ghi\" = path to child of child of child.\n\t */\n\tgetPrototypePath(childTarget: Prototype) {\n\t\tlet path = '';\n\t\twhile (childTarget && childTarget !== this) {\n\t\t\tif (path) {\n\t\t\t\tpath = childTarget.siblingId + '/' + path\n\t\t\t} else {\n\t\t\t\tpath = childTarget.siblingId\n\t\t\t}\n\t\t\tchildTarget = childTarget.getParent() as Prototype\n\t\t}\n\t\tif (childTarget === this) {\n\t\t\treturn path;\n\t\t}\n\t\treturn null;\n\t}\n\tgetPrototypeByPath(path) {\n\t\tif (typeof path !== 'string') {\n\t\t\t// assert(false, 'did not find prototype by path')\n\t\t\treturn null\n\t\t}\n\t\tlet siblingIds = path.split('/').filter(Boolean)\n\t\tlet prototype = this\n\t\tfor (const siblingId of siblingIds) {\n\t\t\tprototype = prototype.findChild(this.threeLetterType, (prt: Prototype) => prt.siblingId === siblingId)\n\t\t\tif (!prototype) {\n\t\t\t\t// assert(false, 'did not find prototype by path')\n\t\t\t\treturn null\n\t\t\t}\n\t\t}\n\t\treturn prototype\n\t}\n\n\t/*\n\tfilter filters component datas\n\n\tReturns JSON:\n\t[\n\t\t{\n\t\t\townComponent: false, // component of a parent prototype\n\t\t\tcomponentClass: [object Object],\n\t\t\tcomponentId: <componentId>,\n\t\t\tthreeLetterType: 'icd',\n\t \t\tgeneratedForPrototype: <this>,\n\t\t\tproperties: [\n\t\t\t\t{ id missing }\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t ownComponentData: <ComponentData> || null, // null if this prototype has 0 properties defined\n\t\t\t componentClass: [object Object],\n\t\t\t componentId: <componentId>,\n\t\t\t threeLetterType: 'icd',\n\t\t\t generatedForPrototype: <this>,\n\t\t\t properties: [\n\t\t\t \t{ id found if own property } // some properties might be from parent prototypes and thus missing id\n\t\t\t ]\n\t\t }\n\t]\n\t */\n\tgetInheritedComponentDatas(filter: (cda: ComponentData) => boolean = null) {\n\t\tlet data = getDataFromPrototype(this, this, filter);\n\t\tlet array = Object.keys(data).map(key => data[key]);\n\t\tlet inheritedComponentData: InheritedComponentData = null;\n\t\tfor (let i = 0; i < array.length; ++i) {\n\t\t\tinheritedComponentData = array[i];\n\t\t\tinheritedComponentData.properties = inheritedComponentData.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\treturn inheritedComponentData.propertyHash[propertyType.name]\n\t\t\t\t\t|| propertyType.createProperty({ skipSerializableRegistering: true });\n\t\t\t});\n\t\t\tdelete inheritedComponentData.propertyHash;\n\t\t}\n\n\t\treturn array.sort(sortInheritedComponentDatas);\n\t}\n\n\thasComponentData(componentName) {\n\t\tlet componentData = this.findChild('cda', (cda: ComponentData) => cda.name === componentName);\n\t\tif (componentData) {\n\t\t\treturn true;\n\t\t}\n\t\tlet parentPrototype = this.getParentPrototype();\n\t\tif (parentPrototype) {\n\t\t\treturn parentPrototype.hasComponentData(componentName);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcreateAndAddPropertyForComponentData(inheritedComponentData, propertyName, propertyValue) {\n\t\tlet propertyType = inheritedComponentData.componentClass._propertyTypesByName[propertyName] as PropertyType;\n\t\tassert(propertyType, 'Invalid propertyName', propertyName, inheritedComponentData);\n\t\tlet componentData = this.findChild('cda', (componentData: ComponentData) => componentData.componentId === inheritedComponentData.componentId);\n\t\tlet componentDataIsNew = false;\n\t\tif (!componentData) {\n\t\t\tconsole.log('no component data. create one', this, inheritedComponentData);\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.componentClass.componentName, false, inheritedComponentData.componentId);\n\t\t\tcomponentDataIsNew = true;\n\t\t}\n\t\tlet property = componentData.findChild('prp', property => property.name === propertyName);\n\t\tif (property) {\n\t\t\tproperty.value = propertyValue;\n\t\t\treturn property;\n\t\t}\n\n\t\tproperty = propertyType.createProperty({\n\t\t\tvalue: propertyValue,\n\t\t});\n\t\tcomponentData.addChild(property);\n\n\t\tif (componentDataIsNew)\n\t\t\tthis.addChild(componentData);\n\n\t\treturn property;\n\t}\n\n\tfindComponentDataByComponentId(componentId: string, alsoFindFromParents = false): ComponentData {\n\t\tlet child = this.findChild('cda', (componentData: ComponentData) => componentData.componentId === componentId) as ComponentData;\n\t\tif (child)\n\t\t\treturn child;\n\t\tif (alsoFindFromParents) {\n\t\t\tlet parent = this.getParentPrototype();\n\t\t\tif (parent)\n\t\t\t\treturn parent.findComponentDataByComponentId(componentId, alsoFindFromParents);\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetOwnComponentDataOrInherit(componentId: string) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, false);\n\t\tif (!componentData) {\n\t\t\tlet inheritedComponentData = this.findComponentDataByComponentId(componentId, true);\n\t\t\tif (!inheritedComponentData)\n\t\t\t\treturn null;\n\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.name, false, componentId);\n\t\t\tthis.addChild(componentData);\n\t\t}\n\t\treturn componentData;\n\t}\n\n\tfindOwnProperty(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId);\n\t\tif (componentData) {\n\t\t\treturn componentData.getProperty(propertyName);\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Parent is needed so that we can init children knowing who is the parent\n\tcreateEntity(parent?: Serializable, _skipNewEntityEvent = false) {\n\t\tlet entity = new Entity();\n\n\t\tlet inheritedComponentDatas = this.getInheritedComponentDatas();\n\t\tlet components = inheritedComponentDatas.map(Component.createWithInheritedComponentData);\n\t\tentity.addComponents(components, { fullInit: false }); // Only do preInit\n\n\t\tentity.prototype = this;\n\n\t\tif (parent)\n\t\t\tparent.addChild(entity);\n\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('create entity', this.makeUpAName());\n\n\t\tthis.forEachChild('epr', (epr: EntityPrototype) => epr.createEntity(entity, true));\n\t\t// let childEntityPrototypes = this.getChildren('epr');\n\t\t// childEntityPrototypes.forEach(epr => epr.createEntity(entity));\n\n\t\tthis.previouslyCreatedEntity = entity;\n\n\t\t// Components have only been preinited. Lets call the init now.\n\t\tEntity.initComponents(components);\n\n\t\tif (!_skipNewEntityEvent)\n\t\t\tglobalEventDispatcher.dispatch('new entity created', entity);\n\n\t\treturn entity;\n\t}\n\n\tgetValue(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, true);\n\t\tif (componentData)\n\t\t\treturn componentData.getValue(propertyName);\n\t\telse\n\t\t\treturn undefined;\n\t}\n\n\tcountEntityPrototypes(findChildren = false) {\n\t\tlet entityPrototypeCount = 0;\n\t\tlet levelIds = new Set();\n\n\t\tif (this.threeLetterType !== 'prt') {\n\t\t\treturn {\n\t\t\t\tentityPrototypeCount,\n\t\t\t\tlevelIds\n\t\t\t};\n\t\t}\n\n\t\tlet levels = game.getChildren('lvl');\n\t\tfor (let i = levels.length - 1; i >= 0; i--) {\n\t\t\tlet entityPrototypes = levels[i].getChildren('epr') as Array<EntityPrototype>;\n\t\t\tlet foundInThisLevel = false;\n\t\t\tfor (let j = entityPrototypes.length - 1; j >= 0; j--) {\n\t\t\t\tif (entityPrototypes[j].prototype === this) {\n\t\t\t\t\tentityPrototypeCount++;\n\t\t\t\t\tfoundInThisLevel = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (foundInThisLevel) {\n\t\t\t\tlevelIds.add(levels[i].id);\n\t\t\t}\n\t\t}\n\n\t\tif (findChildren)\n\t\t\tthis.forEachChild('prt', (prt: Prototype) => {\n\t\t\t\tlet results = prt.countEntityPrototypes(true);\n\t\t\t\tentityPrototypeCount += results.entityPrototypeCount;\n\t\t\t\tresults.levelIds.forEach(levelId => levelIds.add(levelId));\n\t\t\t});\n\n\t\treturn {\n\t\t\tentityPrototypeCount,\n\t\t\tlevelIds\n\t\t};\n\t}\n\n\t/**\n\t * Only works for Prefabs and Prototypes. Not for EntityPrototypes.\n\t */\n\tgetEntityPrototypesThatUseThisPrototype() {\n\t\tlet entityPrototypes: EntityPrototype[] = [];\n\t\tlet levels: Set<Level> = new Set();\n\n\t\tif (this.threeLetterType !== 'prt' && this.threeLetterType !== 'pfa') {\n\t\t\treturn {\n\t\t\t\tentityPrototypes,\n\t\t\t\tlevels\n\t\t\t};\n\t\t}\n\n\t\tlet levelArray = game.getChildren('lvl') as Level[];\n\t\tfor (let i = levelArray.length - 1; i >= 0; i--) {\n\t\t\tlet foundInThisLevel = false;\n\n\t\t\tlevelArray[i].forEachChild('epr', (epr: EntityPrototype) => {\n\t\t\t\tif (epr.prototype === this) {\n\t\t\t\t\tentityPrototypes.push(epr);\n\t\t\t\t\tfoundInThisLevel = true;\n\t\t\t\t}\n\t\t\t}, true);\n\n\t\t\tif (foundInThisLevel) {\n\t\t\t\tlevels.add(levelArray[i]);\n\t\t\t}\n\t\t}\n\n\t\tthis.forEachChild(this.threeLetterType, (prt: Prototype) => {\n\t\t\tlet results = prt.getEntityPrototypesThatUseThisPrototype();\n\t\t\tentityPrototypes.push(...entityPrototypes);\n\t\t\tresults.levels.forEach((level: Level) => levels.add(level));\n\t\t});\n\n\t\treturn {\n\t\t\tentityPrototypes,\n\t\t\tlevels\n\t\t};\n\t}\n\n\tdelete() {\n\t\tlet _gameRoot = this.getRoot();\n\t\tif (!super.delete()) return false;\n\t\tif (this.threeLetterType === 'prt' && _gameRoot.threeLetterType === 'gam') {\n\t\t\t_gameRoot.forEachChild('lvl', (lvl: Level) => {\n\t\t\t\tlet items = lvl.getChildren('epr') as Array<EntityPrototype>;\n\t\t\t\tfor (let i = items.length - 1; i >= 0; i--) {\n\t\t\t\t\tif (items[i].prototype === this) {\n\t\t\t\t\t\tlvl.deleteChild(items[i], i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.previouslyCreatedEntity = null;\n\t\treturn true;\n\t}\n\n\tclone() {\n\t\tlet clone = super.clone() as any as Prototype;\n\t\tclone.siblingId = this.siblingId\n\t\treturn clone\n\t}\n\n\tcloneWithNewSiblingId() {\n\t\tlet clone = this.clone()\n\t\tclone.siblingId = Prototype.createSiblingId()\n\t\treturn clone\n\t}\n\n\ttoJSON() {\n\t\tlet json = super.toJSON();\n\t\tjson.si = this.siblingId;\n\t\treturn json;\n\t}\n\tstatic create(name: string) {\n\t\treturn new Prototype().initWithPropertyValues({ name });\n\t};\n}\nPropertyOwner.defineProperties(Prototype, propertyTypes);\n\nSerializable.registerSerializable(Prototype, 'prt', json => {\n\treturn new Prototype(json.id, json.si);\n});\n\nexport type InheritedComponentData = {\n\townComponentData: ComponentData;\n\tcomponentClass: typeof Component;\n\tcomponentId: string,\n\tpropertyHash?: { [propName: string]: Property }; // First this exists but will be deleted at the end.\n\tproperties?: Property[]; // In the end, this exists.\n\tthreeLetterType: 'icd';\n\tgeneratedForPrototype: Prototype;\n};\n\nfunction getDataFromPrototype(prototype: Prototype, originalPrototype: Prototype, filter?: (cda: ComponentData) => boolean, _depth = 0): { [componentId: string]: InheritedComponentData } {\n\tlet data: { [componentId: string]: InheritedComponentData } = null;\n\n\tlet parentPrototype = prototype.getParentPrototype() as Prototype;\n\tif (parentPrototype)\n\t\tdata = getDataFromPrototype(parentPrototype, originalPrototype, filter, _depth + 1);\n\telse\n\t\tdata = {}; // Top level\n\n\tlet componentDatas = prototype.getChildren('cda') as any as Array<ComponentData>;\n\tif (filter)\n\t\tcomponentDatas = componentDatas.filter(filter);\n\tlet componentData: ComponentData = null;\n\tfor (let i = 0; i < componentDatas.length; ++i) {\n\t\tcomponentData = componentDatas[i];\n\n\t\tif (!data[componentData.componentId]) {\n\t\t\t// Most parent version of this componentId\n\t\t\tdata[componentData.componentId] = {\n\t\t\t\t// ownComponent = true if the original prototype is the first one introducing this componentId\n\t\t\t\townComponentData: null, // will be given value if the original prototype has this componentId\n\t\t\t\tcomponentClass: componentData.componentClass,\n\t\t\t\tcomponentId: componentData.componentId,\n\t\t\t\tpropertyHash: {},\n\t\t\t\tthreeLetterType: 'icd',\n\t\t\t\tgeneratedForPrototype: originalPrototype,\n\t\t\t};\n\t\t}\n\n\t\tif (_depth === 0) {\n\t\t\tdata[componentData.componentId].ownComponentData = componentData;\n\t\t}\n\n\t\tlet propertyHash = data[componentData.componentId].propertyHash;\n\n\t\tlet properties = componentData.getChildren('prp') as Property[];\n\t\tlet property: Property = null;\n\t\tfor (let j = 0; j < properties.length; ++j) {\n\t\t\tproperty = properties[j];\n\t\t\t// Newest version of a property always overrides old property\n\t\t\tpropertyHash[property.name] = _depth === 0 ? property : property.clone(true);\n\t\t}\n\t};\n\n\treturn data;\n}\n\nfunction sortInheritedComponentDatas(a: InheritedComponentData, b: InheritedComponentData) {\n\treturn a.componentClass.componentName.localeCompare(b.componentClass.componentName);\n}\n","import Prototype from './prototype';\nimport Property from './property';\nimport Serializable from './serializable';\nimport { getSerializable } from './serializableManager';\nimport { Prop, componentClasses } from './component';\nimport ComponentData from './componentData';\nimport assert from '../util/assert';\nimport Vector from '../util/vector';\nimport Prefab from './prefab';\nimport PropertyOwner from './propertyOwner';\nimport { PropertyType } from './propertyType';\nimport { selectInEditor } from '../editor/editorSelection';\nimport { GameEvent, globalEventDispatcher } from './eventDispatcher';\n\nlet propertyTypes = [\n\t// Prop('name2', 'No name', Prop.string)\n];\n\n// EntityPrototype is a prototype that always has one Transform ComponentData and optionally other ComponentDatas also.\n// Entities are created based on EntityPrototypes\nexport default class EntityPrototype extends Prototype {\n\n\t// this._parent is level or another entityPrototype, not prototype as in type or prefab. We need a link to parent-prototype. That's why we have prototype property\n\t/**\n\t * prototype stays the same whole EntityPrototype lifetime. It can not change. It is not and will be not supported by server communication.\n\t */\n\tprototype: Prototype = null;\n\n\tconstructor(predefinedId?, siblingId?: string) {\n\t\tsuper(predefinedId, siblingId);\n\t}\n\n\tmakeUpAName(): string {\n\t\tlet nameProperty = this.findChild('prp', (property: Property) => property.name === 'name');\n\t\tif (nameProperty && nameProperty.value)\n\t\t\treturn nameProperty.value;\n\t\telse if (this.prototype)\n\t\t\treturn this.prototype.makeUpAName();\n\t\telse\n\t\t\treturn 'EntityPrototype';\n\t}\n\n\tgetTransform() {\n\t\treturn this.findChild('cda', (cda: ComponentData) => cda.name === 'Transform') as ComponentData;\n\t}\n\tgetParentPrototype(): Prototype {\n\t\treturn this.prototype || null;\n\t}\n\tclone() {\n\t\tlet obj = new EntityPrototype(null, this.siblingId);\n\t\tobj.prototype = this.prototype;\n\t\tlet id = obj.id;\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tif (child.threeLetterType === 'prp' && (child as Property).name === 'name') {\n\t\t\t\tlet property = new Property({\n\t\t\t\t\tvalue: (child as Property).propertyType.type.clone((child as Property).value),\n\t\t\t\t\tname: (child as Property).name,\n\t\t\t\t\tpropertyType: (child as Property).propertyType,\n\t\t\t\t\tpredefinedId: id + '_n'\n\t\t\t\t});\n\t\t\t\tchildren.push(property);\n\t\t\t} else if (child.threeLetterType === 'cda' && (child as ComponentData).name === 'Transform') {\n\t\t\t\tlet transform = new ComponentData('Transform', id + '_t');\n\n\t\t\t\t// Transform component data always has a position\n\t\t\t\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', (prp: Property) => prp.name === 'position').value,\n\t\t\t\t\tpredefinedId: id + '_p'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(position);\n\n\t\t\t\tlet oldScaleProperty = child.findChild('prp', (prp: Property) => prp.name === 'scale');\n\t\t\t\tif (oldScaleProperty) {\n\t\t\t\t\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\t\t\t\t\tvalue: oldScaleProperty.value,\n\t\t\t\t\t\tpredefinedId: id + '_s'\n\t\t\t\t\t});\n\t\t\t\t\ttransform.addChild(scale);\n\t\t\t\t}\n\n\t\t\t\tlet oldAngleProperty = child.findChild('prp', (prp: Property) => prp.name === 'angle');\n\t\t\t\tif (oldAngleProperty) {\n\t\t\t\t\tlet angle = transform.componentClass._propertyTypesByName.angle.createProperty({\n\t\t\t\t\t\tvalue: oldAngleProperty.value,\n\t\t\t\t\t\tpredefinedId: id + '_a'\n\t\t\t\t\t});\n\t\t\t\t\ttransform.addChild(angle);\n\t\t\t\t}\n\n\t\t\t\tchildren.push(transform);\n\t\t\t} else if (child.threeLetterType === 'cda') {\n\t\t\t\tchildren.push((child as ComponentData).clone({ cloneComponentId: true }));\n\t\t\t} else {\n\t\t\t\tchildren.push(child.clone());\n\t\t\t}\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\tcloneWithNewSiblingId() {\n\t\tlet clone = this.clone()\n\t\tclone.siblingId = Prototype.createSiblingId()\n\t\treturn clone\n\t}\n\n\ttoJSON() {\n\t\t/*\n\t\tlet json = super.toJSON();\n\t\tjson.t = this.prototype.id;\n\t\treturn json;\n\t\t*/\n\n\t\t// Below optimization reduces size 88%. child id's have to be generated based on this.id\n\n\t\tlet Transform = this.getTransform();\n\t\tlet json: any = {\n\t\t\tid: this.id,\n\t\t\tsi: this.siblingId\n\t\t};\n\t\tif (this.prototype)\n\t\t\tjson.t = this.prototype.id; // might be prototype or prefab or may not exist. .t as in type\n\n\t\tlet childArrays = [];\n\t\tthis._children.forEach(child => {\n\t\t\tchildArrays.push(child);\n\t\t});\n\t\tlet children = [].concat(...childArrays).filter(child => {\n\t\t\treturn child !== Transform && child !== this._properties.name;\n\t\t});\n\t\tif (children.length > 0)\n\t\t\tjson.c = children.map(child => child.toJSON());\n\n\t\tlet floatToJSON = Prop.float().toJSON;\n\t\tlet handleProperty = prp => {\n\t\t\tif (prp.name === 'name') {\n\t\t\t\tif (prp.value)\n\t\t\t\t\tjson.n = prp.value;\n\t\t\t} else if (prp.name === 'position') {\n\t\t\t\tjson.p = prp.type.toJSON(prp.value);\n\t\t\t} else if (prp.name === 'scale') {\n\t\t\t\tif (!prp.value.isEqualTo(new Vector(1, 1))) {\n\t\t\t\t\tjson.s = prp.type.toJSON(prp.value);\n\t\t\t\t}\n\t\t\t} else if (prp.name === 'angle') {\n\t\t\t\tif (prp.value !== 0)\n\t\t\t\t\tjson.a = floatToJSON(prp.value);\n\t\t\t}\n\t\t};\n\t\thandleProperty(this._properties.name);\n\n\t\tTransform.getChildren('prp').forEach(handleProperty);\n\t\treturn json;\n\t}\n\tspawnEntityToScene(scene, position) {\n\t\tif (!scene)\n\t\t\treturn null;\n\n\t\tif (position) {\n\t\t\tthis.getTransform().getPropertyOrCreate('position').value = position;\n\t\t}\n\n\t\treturn this.createEntity(scene);\n\t}\n\n\t/**\n\t * This function creates a new EntityPrototype and this one will be deleted.\n\t */\n\treplaceWithVersionThatIsDetachedFromPrototype() {\n\t\tlet entityPrototype = new EntityPrototype();\n\t\t// Leave entityPrototype.prototype null to detach\n\n\t\tlet inheritedComponentDatas = this.getInheritedComponentDatas();\n\t\tlet componentDatas: ComponentData[] = inheritedComponentDatas.map(icd => {\n\t\t\treturn new ComponentData(icd.componentClass.componentName, null, icd.componentId)\n\t\t\t\t.initWithChildren(icd.properties.map(prp => prp.clone()));\n\t\t}) as ComponentData[];\n\n\t\tentityPrototype.initWithChildren(componentDatas);\n\t\tentityPrototype.name = this.makeUpAName();\n\n\t\tlet parent = this.getParent();\n\n\t\tthis.delete();\n\n\t\tif (parent) {\n\t\t\tparent.addChild(entityPrototype);\n\t\t}\n\n\t\treturn entityPrototype;\n\t}\n\n\t/**\n\t * WARNING! Only Transform and name are preserved. All other data is lost.\n\t * This should only be called with a prefab that has been created using:\n\t * Prefab.createFromPrototype(entityPrototype)\n\t * This function creates a new EntityPrototype and this one will be deleted\n\t * */\n\treplaceWithVersionThatIsAttachedToPrototype(prototype: Prototype) {\n\t\tlet newEntityPrototype = EntityPrototype.createFromPrototype(prototype);\n\t\tlet thisTransform = this.getTransform();\n\t\tlet Transform = newEntityPrototype.getTransform();\n\t\tTransform.componentClass._propertyTypes.forEach((propertyType: PropertyType) => {\n\t\t\tTransform.setValue(propertyType.name, thisTransform.getValue(propertyType.name));\n\t\t});\n\t\tnewEntityPrototype.name = this.name;\n\n\t\tlet parent = this.getParent();\n\n\t\tthis.delete();\n\n\t\tif (parent) {\n\t\t\tparent.addChild(newEntityPrototype);\n\t\t}\n\t\treturn newEntityPrototype;\n\t}\n\n\t// Optimize this away\n\tsetRootType(rootType) {\n\t\tif (this._rootType === rootType)\n\t\t\treturn;\n\t\tassert(this.getTransform(), 'EntityPrototype must have a Transform');\n\t\tsuper.setRootType(rootType);\n\t\treturn this;\n\t}\n\t/**\n\t * If Transform or Transform.position is missing, they are added.\n\t * prototype can also be Prefab which extends Prototype.\n\t */\n\tstatic createFromPrototype(prototype: Prototype) {\n\t\tif (prototype.threeLetterType === 'pfa') {\n\t\t\treturn (prototype as Prefab).createEntityPrototype();\n\t\t}\n\n\t\t// DEPRECATED\n\t\tconsole.log(`This isn't used anymore because we don't anymore have \"Types\" which are plain Prototypes`);\n\n\t\tlet entityPrototype = new EntityPrototype();\n\t\tentityPrototype.prototype = prototype;\n\t\tlet id = entityPrototype.id;\n\n\t\tlet prototypeTransform = prototype.findChild('cda', (cda: ComponentData) => cda.name === 'Transform');\n\n\t\tif (prototypeTransform)\n\t\t\tassert(false, 'Prototype (prt) can not have a Transform component');\n\n\t\tlet name = createEntityPrototypeNameProperty(id);\n\t\tlet transform = createEntityPrototypeTransform(id);\n\n\t\tentityPrototype.initWithChildren([name, transform]);\n\n\t\t// @ifndef OPTIMIZE\n\t\tassert(entityPrototype.getTransform(), 'EntityPrototype must have a Transform');\n\t\t// @endif\n\n\t\treturn entityPrototype;\n\t}\n\n\tstatic create(name = 'Empty', position = new Vector(0, 0)) {\n\t\tlet entityPrototype = new EntityPrototype();\n\t\tlet transform = createEntityPrototypeTransform(entityPrototype.id);\n\t\ttransform.setValue('position', position);\n\n\t\tlet nameProperty = createEntityPrototypeNameProperty(entityPrototype.id, name);\n\n\t\tentityPrototype.initWithChildren([nameProperty, transform]);\n\t\treturn entityPrototype;\n\t}\n\n\tget position() {\n\t\treturn this.getTransform().findChild('prp', (prp: Property) => prp.name === 'position').value;\n\t}\n\tset position(position) {\n\t\tthis.getTransform().findChild('prp', (prp: Property) => prp.name === 'position').value = position;\n\t}\n}\n\n// PropertyOwner.defineProperties(EntityPrototype, propertyTypes);\n\nexport function createEntityPrototypeNameProperty(entityPrototypeId, name = '') {\n\treturn EntityPrototype._propertyTypesByName.name.createProperty({\n\t\tvalue: name,\n\t\tpredefinedId: entityPrototypeId + '_n'\n\t});\n}\n\nexport function createEntityPrototypeTransform(entityPrototypeId) {\n\tlet transform = new ComponentData('Transform', entityPrototypeId + '_t');\n\n\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\tvalue: new Vector(0, 0),\n\t\tpredefinedId: entityPrototypeId + '_p'\n\t});\n\ttransform.addChild(position);\n\n\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: new Vector(1, 1),\n\t\tpredefinedId: entityPrototypeId + '_s'\n\t});\n\ttransform.addChild(scale);\n\n\tlet angle = transform.componentClass._propertyTypesByName.angle.createProperty({\n\t\tvalue: 0,\n\t\tpredefinedId: entityPrototypeId + '_a'\n\t});\n\ttransform.addChild(angle);\n\n\treturn transform;\n}\n\nSerializable.registerSerializable(EntityPrototype, 'epr', json => {\n\tlet entityPrototype = new EntityPrototype(json.id, json.si);\n\tentityPrototype.prototype = json.t ? getSerializable(json.t) : null;\n\n\t// assert(!json.t || entityPrototype.prototype, `Prototype or Prefab ${json.t} not found`); // .t as in type\n\tif (json.t && !entityPrototype.prototype) {\n\t\tconsole.error(`EntityPrototype ${json.id} thought it had a prototype or prefab ${json.t} but it was not found.`);\n\t}\n\n\tlet nameId = json.id + '_n';\n\tlet transformId = json.id + '_t';\n\tlet positionId = json.id + '_p';\n\tlet scaleId = json.id + '_s';\n\tlet angleId = json.id + '_a';\n\n\tlet name = Prototype._propertyTypesByName.name.createProperty({\n\t\tvalue: json.n === undefined ? '' : json.n,\n\t\tpredefinedId: nameId\n\t});\n\n\tlet transformData = new ComponentData('Transform', transformId);\n\tlet transformClass = componentClasses.get('Transform');\n\n\tlet position = transformClass._propertyTypesByName.position.createProperty({\n\t\tvalue: Vector.fromObject(json.p), // in the future, everything will be using p instead of x and y.\n\t\tpredefinedId: positionId\n\t});\n\ttransformData.addChild(position);\n\n\tlet scale = transformClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: json.s && Vector.fromObject(json.s) || new Vector(1, 1),\n\t\tpredefinedId: scaleId\n\t});\n\ttransformData.addChild(scale);\n\n\tlet angle = transformClass._propertyTypesByName.angle.createProperty({\n\t\tvalue: json.a || 0,\n\t\tpredefinedId: angleId\n\t});\n\ttransformData.addChild(angle);\n\n\tentityPrototype.initWithChildren([name, transformData]);\n\n\treturn entityPrototype;\n});\n","import Prototype from './prototype';\nimport Property from './property';\nimport Serializable from './serializable';\nimport ComponentData from './componentData';\nimport assert from '../util/assert';\nimport EntityPrototype, { createEntityPrototypeNameProperty, createEntityPrototypeTransform } from \"./entityPrototype\";\n\n// Prefab is an EntityPrototype that has been saved to a prefab.\nexport default class Prefab extends Prototype {\n\tconstructor(predefinedId?: string, siblingId?: string) {\n\t\tsuper(predefinedId, siblingId);\n\t}\n\n\tmakeUpAName() {\n\t\tlet nameProperty = this.findChild('prp', (property: Property) => property.name === 'name');\n\t\treturn nameProperty && nameProperty.value || 'Prefab';\n\t}\n\n\tcreateEntity() {\n\t\treturn this.createEntityPrototype().createEntity();\n\t}\n\n\tgetParentPrototype() {\n\t\treturn null;\n\t}\n\t// Meant for entityPrototypes, but works theoretically for prototypes\n\tstatic createFromPrototype(prototype: Prototype) {\n\t\tlet inheritedComponentDatas = prototype.getInheritedComponentDatas();\n\t\tlet children: Array<Serializable> = inheritedComponentDatas.map(icd => {\n\t\t\tconst cda = new ComponentData(icd.componentClass.componentName, null, icd.componentId)\n\t\t\tcda.initWithChildren(icd.properties.map(prp => prp.clone()))\n\t\t\treturn cda\n\t\t}) as any as Array<Serializable>;\n\n\t\tchildren.push(prototype._properties.name.clone());\n\n\t\tprototype.forEachChild('epr', (childEntityPrototype: EntityPrototype) => {\n\t\t\tlet prefab = Prefab.createFromPrototype(childEntityPrototype);\n\t\t\tchildren.push(prefab);\n\t\t});\n\n\t\tlet prefab = new Prefab(null, prototype.siblingId).initWithChildren(children);\n\n\t\t// Don't just prototype.makeUpAName() because it might give you \"Prototype\" or \"EntityPrototype\". Checking them would be a hack.\n\t\tprefab.name = prototype.name || prototype.prototype && prototype.prototype.makeUpAName() || 'Prefab';\n\n\t\treturn prefab;\n\t}\n\n\tcreateEntityPrototype() {\n\t\tlet entityPrototype = new EntityPrototype(null, this.siblingId);\n\t\tentityPrototype.prototype = this;\n\t\tlet id = entityPrototype.id;\n\n\t\tlet prototypeTransform = this.findChild('cda', (cda: ComponentData) => cda.name === 'Transform');\n\n\t\tif (!prototypeTransform)\n\t\t\tassert(false, 'Prefab (pfa) must have a Transform component');\n\n\t\tlet name = createEntityPrototypeNameProperty(id);\n\t\tlet transform = createEntityPrototypeTransform(id);\n\n\t\ttransform.setValue('position', prototypeTransform.getValue('position'));\n\t\ttransform.setValue('scale', prototypeTransform.getValue('scale'));\n\t\ttransform.setValue('angle', prototypeTransform.getValue('angle'));\n\n\t\tlet children: Serializable[] = [name, transform];\n\n\t\tthis.forEachChild('pfa', (pfa: Prefab) => {\n\t\t\tlet childEntityPrototype = pfa.createEntityPrototype();\n\t\t\tchildren.push(childEntityPrototype);\n\t\t});\n\n\t\tentityPrototype.initWithChildren(children);\n\n\t\t/*\n\t\t\t\tlet inheritedComponentDatas = this.getInheritedComponentDatas();\n\t\t\t\tlet children: Array<Serializable> = inheritedComponentDatas.map(icd => {\n\t\t\t\t\treturn new ComponentData(icd.componentClass.componentName, null, icd.componentId)\n\t\t\t\t\t\t.initWithChildren(icd.properties.map(prp => prp.clone()));\n\t\t\t\t}) as any as Array<Serializable>;\n\t\t\t\tchildren.push(this._properties.name.clone());\n\n\t\t\t\tentityPrototype.initWithChildren(children);\n\t\t\t\t*/\n\n\t\t// @ifndef OPTIMIZE\n\t\tassert(entityPrototype.getTransform(), 'EntityPrototype must have a Transform');\n\t\t// @endif\n\n\t\treturn entityPrototype;\n\t}\n\n\t// Do not use EntityPrototype optimization\n\t// This is only needed if Prefab would extend EntityPrototype instead of Prototype\n\t// toJSON() {\n\t// \treturn Serializable.prototype.toJSON.apply(this, arguments);\n\t// }\n\n\t// This is only needed if Prefab would extend EntityPrototype instead of Prototype\n\t// clone() {\n\t// \treturn Serializable.prototype.clone.apply(this, arguments);\n\t// }\n}\n\n/*\nfilter filters component datas\n\nReturns JSON:\n[\n\t{\n\t\townComponent: false, // component of a parent prototype\n\t\tcomponentClass: [object Object],\n\t\tcomponentId: <componentId>,\n\t\tthreeLetterType: 'icd',\n\t\t generatedForPrototype: <this>,\n\t\tproperties: [\n\t\t\t{ id missing }\n\t\t]\n\t},\n\t{\n\t\t ownComponentData: <ComponentData> || null, // null if this prototype has 0 properties defined\n\t\t componentClass: [object Object],\n\t\t componentId: <componentId>,\n\t\t threeLetterType: 'icd',\n\t\t generatedForPrototype: <this>,\n\t\t properties: [\n\t\t\t { id found if own property } // some properties might be from parent prototypes and thus missing id\n\t\t ]\n\t }\n]\n */\n\nSerializable.registerSerializable(Prefab, 'pfa', json => {\n\treturn new Prefab(json.id, json.si);\n});\n","import Serializable from './serializable';\nimport PropertyOwner, { Prop } from './propertyOwner';\nimport Scene, { scene } from './scene';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Level extends PropertyOwner {\n\tname: string;\n\n\tconstructor(predefinedId?) {\n\t\tsuper(predefinedId);\n\t}\n\tcreateScene(predefinedSceneObject: Scene = null) {\n\t\tif (!predefinedSceneObject)\n\t\t\tnew Scene();\n\n\t\tscene.loadLevel(this);\n\n\t\treturn scene;\n\t}\n\tisEmpty() {\n\t\treturn this.getChildren('epr').length === 0;\n\t}\n\n\t/*\n\tOPTIMIZATION DOES NOT WORK, YET\n\ttoJSON() {\n\t\tlet json = super.toJSON();\n\t\tconsole.log('before', json);\n\t\tif (json.c) {\n\t\t\tlet prototypeIds = new Set();\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tconsole.log('child', child);\n\t\t\t\tprototypeIds.add(child.p);\n\t\t\t});\n\n\t\t\tlet prototypeIdToNum = {};\n\t\t\tlet prototypeIdArray = [];\n\t\t\tlet num = 0;\n\t\t\tprototypeIds.forEach(key => {\n\t\t\t\tprototypeIdArray[num] = key;\n\t\t\t\tprototypeIdToNum[key] = num++;\n\t\t\t});\n\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tchild.p = prototypeIdToNum[child.p] || child.p;\n\t\t\t});\n\n\t\t\tjson.p = prototypeIdArray;\n\n\t\t\tconsole.log(json, prototypeIds, prototypeIdToNum, prototypeIdArray);\n\t\t}\n\t\treturn json;\n\t}\n\t*/\n}\nPropertyOwner.defineProperties(Level, propertyTypes);\n\nSerializable.registerSerializable(Level, 'lvl');\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport {default as PIXI} from '../features/graphics';\n\nComponent.register({\n\tname: 'Transform',\n\ticon: 'fa-dot-circle-o',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('position', new Vector(0, 0), Prop.vector),\n\t\tProp('scale', new Vector(1, 1), Prop.vector),\n\t\tProp('angle', 0, Prop.float, Prop.float.modulo(0, Math.PI * 2), Prop.flagDegreesInEditor)\n\t],\n\tprototype: {\n\t\tconstructor() {\n\t\t\tthis.layer = this.scene.layers.main;\n\t\t},\n\t\tpreInit() {\n\t\t\tthis.container = new PIXI.Container();\n\t\t\tthis.container._debug = this.entity.makeUpAName() + ' ' + this.name;\n\t\t\tthis.container.position.set(this.position.x, this.position.y);\n\t\t\tthis.container.scale.set(this.scale.x, this.scale.y);\n\t\t\tthis.container.rotation = this.angle;\n\t\t},\n\t\tinit() {\n\n\t\t\t// TODO: move add code to parent? Because container logic is needed in init() of physics component.\n\t\t\tlet parentTransform = this.getParentTransform();\n\t\t\tif (parentTransform) {\n\t\t\t\tparentTransform.container.addChild(this.container);\n\t\t\t\tparentTransform.listen('globalTransformChanged', () => {\n\t\t\t\t\tthis.dispatch('globalTransformChanged', this);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.layer.addChild(this.container);\n\t\t\t}\n\n\t\t\t// Optimize this. Shouldn't be called multiple times per frame.\n\t\t\tlet change = () => {\n\t\t\t\tthis.dispatch('globalTransformChanged', this);\n\t\t\t};\n\n\t\t\tthis.listenProperty(this, 'position', position => {\n\t\t\t\tthis.container.position.set(position.x, position.y);\n\t\t\t\tchange();\n\t\t\t});\n\t\t\tthis.listenProperty(this, 'angle', angle => {\n\t\t\t\tthis.container.rotation = angle;\n\t\t\t\tchange();\n\t\t\t});\n\t\t\tthis.listenProperty(this, 'scale', scale => {\n\t\t\t\tthis.container.scale.set(scale.x, scale.y);\n\t\t\t\tchange();\n\t\t\t});\n\t\t\t// change();\n\t\t},\n\t\tgetParentTransform() {\n\t\t\tif (this.parentTransform !== undefined)\n\t\t\t\treturn this.parentTransform;\n\n\t\t\tlet parentEntity = this.entity.getParent();\n\t\t\tif (parentEntity && parentEntity.threeLetterType === 'ent')\n\t\t\t\tthis.parentTransform = parentEntity.getComponent('Transform');\n\t\t\telse\n\t\t\t\tthis.parentTransform = null;\n\n\t\t\treturn this.parentTransform;\n\t\t},\n\t\tgetGlobalPosition() {\n\t\t\treturn Vector.fromObject(this.layer.toLocal(zeroPoint, this.container, tempPoint));\n\t\t},\n\t\t// given position is altered\n\t\tsetGlobalPosition(position: Vector) {\n\t\t\tthis.position = position.set(this.container.parent.toLocal(position, this.layer, tempPoint));\n\t\t},\n\t\tgetLocalPosition(globalPosition: Vector) {\n\t\t\treturn Vector.fromObject(this.container.parent.toLocal(globalPosition, this.layer, tempPoint));\n\t\t},\n\t\tgetGlobalAngle() {\n\t\t\tlet angle = this.angle;\n\t\t\tlet parent = this.getParentTransform();\n\t\t\twhile (parent) {\n\t\t\t\tangle += parent.angle;\n\t\t\t\tparent = parent.getParentTransform();\n\t\t\t}\n\t\t\treturn angle;\n\t\t},\n\t\tsetGlobalAngle(newGlobalAngle: number) {\n\t\t\tlet globalAngle = this.getGlobalAngle();\n\t\t\tlet change = newGlobalAngle - globalAngle;\n\t\t\tthis.angle = (this.angle + change + Math.PI * 2) % (Math.PI * 2);\n\t\t},\n\t\t// This may give wrong numbers if there are rotations and scale included in object tree.\n\t\tgetGlobalScale() {\n\t\t\tlet scale = this.scale.clone() as Vector;\n\t\t\tlet parentEntity = this.entity.getParent();\n\t\t\twhile (parentEntity && parentEntity.threeLetterType === 'ent') {\n\t\t\t\tscale.multiply(parentEntity.Transform.scale);\n\t\t\t\tparentEntity = parentEntity.getParent();\n\t\t\t}\n\t\t\treturn scale;\n\t\t},\n\t\tsleep() {\n\t\t\tthis.container.destroy();\n\t\t\tthis.container = null;\n\n\t\t\tdelete this.parentTransform;\n\t\t}\n\n\t}\n});\n\nlet zeroPoint = new PIXI.Point();\nlet tempPoint = new PIXI.Point();\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'TransformVariance',\n\tcategory: 'Logic',\n\tdescription: `Adds random factor to object's transform/orientation.`,\n\ticon: 'fa-dot-circle-o',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('positionVariance', new Vector(0, 0), Prop.vector),\n\t\tProp('scaleVariance', new Vector(0, 0), Prop.vector),\n\t\tProp('angleVariance', 0, Prop.float, Prop.float.range(0, Math.PI), Prop.flagDegreesInEditor)\n\t],\n\tprototype: {\n\t\tonStart() {\n\t\t\tif (!this.positionVariance.isZero())\n\t\t\t\tthis.Transform.position = this.Transform.position.add(this.positionVariance.clone().multiplyScalar(-1 + 2 * Math.random()));\n\n\t\t\tif (!this.scaleVariance.isZero())\n\t\t\t\tthis.Transform.scale = this.Transform.scale.add(this.scaleVariance.clone().multiplyScalar(Math.random()));\n\t\t\t\n\t\t\tif (this.angleVariance)\n\t\t\t\tthis.Transform.angle += this.angleVariance * (-1 + 2 * Math.random());\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport { Color } from '../util/color';\nimport { default as PIXI, generateTextureAndAnchor, getHashedTextureAndAnchor, hitTest } from '../features/graphics';\nimport { GameEvent, globalEventDispatcher } from '../core/eventDispatcher';\n\nComponent.register({\n\tname: 'Shape',\n\tcategory: 'Graphics',\n\ticon: 'fa-stop',\n\tallowMultiple: true,\n\tdescription: 'Draws shape on the screen.',\n\tproperties: [\n\t\tProp('type', 'rectangle', Prop.enum, Prop.enum.values('rectangle', 'circle', 'convex')),\n\t\tProp('radius', 20, Prop.float, Prop.visibleIf('type', ['circle', 'convex'])),\n\t\tProp('size', new Vector(20, 20), Prop.vector, Prop.visibleIf('type', 'rectangle')),\n\t\tProp('points', 3, Prop.int, Prop.int.range(3, 16), Prop.visibleIf('type', 'convex')),\n\t\tProp('topPointDistance', 0.5, Prop.float, Prop.float.range(0.001, 1), Prop.visibleIf('type', 'convex'), 'Only works with at most 8 points'), // Value 0\n\t\tProp('fillColor', new Color(222, 222, 222), Prop.color),\n\t\tProp('borderColor', new Color(255, 255, 255), Prop.color),\n\t\tProp('borderWidth', 1, Prop.float, Prop.float.range(0, 30))\n\t],\n\tprototype: {\n\t\tgraphicsContainPointFunc: null,\n\t\tinit() {\n\t\t\tthis.initSprite();\n\t\t\tthis.Transform.listen('globalTransformChanged', transform => {\n\t\t\t\t/*\n\t\t\t\tthis.sprite.x = transform.globalPosition.x;\n\t\t\t\tthis.sprite.y = transform.globalPosition.y;\n\n\t\t\t\t// rotation setter function has a function call. lets optimize.\n\t\t\t\tif (this.sprite.rotation !== transform.globalAngle)\n\t\t\t\t\tthis.sprite.rotation = transform.globalAngle;\n\n\t\t\t\tthis.sprite.scale.set(transform.globalScale.x, transform.globalScale.y);\n\t\t\t\t*/\n\t\t\t});\n\n\t\t\t/*\n\t\t\tthis.listenProperty(this.Transform, 'position', position => {\n\t\t\t\tthis.sprite.x = position.x;\n\t\t\t\tthis.sprite.y = position.y;\n\t\t\t});\n\n\t\t\tthis.listenProperty(this.Transform, 'angle', angle => {\n\t\t\t\tthis.sprite.rotation = angle;\n\t\t\t});\n\t\t\t*/\n\n\t\t\tlet redrawGraphics = () => {\n\t\t\t\tthis.updateTexture();\n\t\t\t};\n\n\t\t\t// this.listenProperty(this.Transform, 'scale', redrawGraphics);\n\n\t\t\tlet propertiesThatRequireRedraw = [\n\t\t\t\t'type',\n\t\t\t\t'radius',\n\t\t\t\t'size',\n\t\t\t\t'fillColor',\n\t\t\t\t'borderColor',\n\t\t\t\t'borderWidth',\n\t\t\t\t'points',\n\t\t\t\t'topPointDistance'\n\t\t\t];\n\n\t\t\tpropertiesThatRequireRedraw.forEach(propName => {\n\t\t\t\tthis.listenProperty(this, propName, redrawGraphics);\n\t\t\t});\n\t\t},\n\t\tcontainsPoint(vec: Vector) {\n\t\t\tif (this.graphicsContainPointFunc) {\n\t\t\t\treturn this.graphicsContainPointFunc(vec);\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tinitSprite() {\n\t\t\tlet textureAndAnchor = this.getTextureAndAnchor();\n\t\t\tthis.sprite = new PIXI.Sprite(textureAndAnchor.texture);\n\t\t\tthis.sprite.anchor.set(textureAndAnchor.anchor.x, textureAndAnchor.anchor.y);\n\t\t\tthis.graphicsContainPointFunc = textureAndAnchor.containsPoint;\n\n\t\t\tthis.sprite.selectableEntityOfSprite = this.entity;\n\t\t\tthis.sprite.selectableEntityHitTest = (sprite, pixiCoordinates: Vector, stage) => {\n\t\t\t\tlet localMousePoint = sprite.toLocal(pixiCoordinates, stage);\n\t\t\t\treturn this.containsPoint(localMousePoint);\n\t\t\t}\n\n\t\t\tthis.Transform.container.addChild(this.sprite);\n\t\t},\n\t\tupdateTexture() {\n\t\t\tlet textureAndAnchor = this.getTextureAndAnchor();\n\t\t\tthis.graphicsContainPointFunc = textureAndAnchor.containsPoint;\n\t\t\tthis.sprite.texture = textureAndAnchor.texture;\n\t\t\tthis.sprite.anchor.set(textureAndAnchor.anchor.x, textureAndAnchor.anchor.y);\n\t\t},\n\t\tgetTextureAndAnchor() {\n\t\t\tlet hash = this.createPropertyHash();// + this.Transform.scale;\n\t\t\tlet textureAndAnchor = getHashedTextureAndAnchor(hash);\n\n\t\t\tif (!textureAndAnchor) {\n\t\t\t\tlet graphics = this.createGraphics();\n\t\t\t\ttextureAndAnchor = generateTextureAndAnchor(graphics, hash);\n\t\t\t\t// graphics.destroy();\n\t\t\t}\n\t\t\treturn textureAndAnchor;\n\t\t},\n\t\tcreateGraphics() {\n\t\t\tlet scale = new Vector(1, 1);// this.Transform.scale;\n\t\t\tlet graphics = new PIXI.Graphics();\n\n\t\t\tif (this.type === 'rectangle') {\n\t\t\t\tlet\n\t\t\t\t\tx = -this.size.x / 2 * scale.x,\n\t\t\t\t\ty = -this.size.y / 2 * scale.y,\n\t\t\t\t\tw = this.size.x * scale.x,\n\t\t\t\t\th = this.size.y * scale.y;\n\n\t\t\t\tgraphics.lineStyle(this.borderWidth, this.borderColor.toHexNumber(), 1);\n\t\t\t\tgraphics.beginFill(this.fillColor.toHexNumber());\n\t\t\t\tgraphics.drawRect(x, y, w, h);\n\t\t\t\tgraphics.endFill();\n\t\t\t} else if (this.type === 'circle') {\n\t\t\t\tlet averageScale = (scale.x + scale.y) / 2;\n\n\t\t\t\tgraphics.lineStyle(this.borderWidth, this.borderColor.toHexNumber(), 1);\n\t\t\t\tgraphics.beginFill(this.fillColor.toHexNumber());\n\t\t\t\tgraphics.drawCircle(0, 0, this.radius * averageScale);\n\t\t\t\tgraphics.endFill();\n\t\t\t} else if (this.type === 'convex') {\n\t\t\t\tlet path = this.getConvexPoints(PIXI.Point, false);\n\t\t\t\tpath.push(path[0]); // Close the path\n\n\t\t\t\tgraphics.lineStyle(this.borderWidth, this.borderColor.toHexNumber(), 1);\n\t\t\t\tgraphics.beginFill(this.fillColor.toHexNumber());\n\t\t\t\tgraphics.drawPolygon(path);\n\t\t\t\tgraphics.endFill();\n\t\t\t}\n\n\t\t\treturn graphics;\n\t\t},\n\t\tgetConvexPoints(vectorClass = Vector, takeScaleIntoAccount = true) {\n\t\t\tconst centerAngle = Math.PI * 2 / this.points;\n\t\t\tconst isNotEventPolygon = this.topPointDistance !== 0.5 && this.points <= 8;\n\n\t\t\tlet minDistanceMultiplier;\n\t\t\tlet maxDistanceMultiplier;\n\t\t\tif (isNotEventPolygon) {\n\t\t\t\tconst segmentAngle = Math.PI - centerAngle;\n\t\t\t\tconst unitSegmentLength = 2 * Math.sin(centerAngle / 2);\n\t\t\t\tconst defaultMinDistanceMultiplier = 1 - unitSegmentLength * Math.cos(segmentAngle / 2);\n\n\t\t\t\tif (this.points === 3) {\n\t\t\t\t\tminDistanceMultiplier = 0.2;\n\t\t\t\t\tmaxDistanceMultiplier = 5;\n\t\t\t\t} else if (this.points === 8) {\n\t\t\t\t\tminDistanceMultiplier = defaultMinDistanceMultiplier;\n\t\t\t\t\tmaxDistanceMultiplier = 3;\n\t\t\t\t} else {\n\t\t\t\t\tminDistanceMultiplier = defaultMinDistanceMultiplier;\n\t\t\t\t\tmaxDistanceMultiplier = 5;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet path = [];\n\n\t\t\tlet currentAngle = 0;\n\t\t\tfor (let i = 0; i < this.points; ++i) {\n\t\t\t\tlet x = Math.sin(currentAngle) * this.radius;\n\t\t\t\tlet y = Math.cos(currentAngle) * this.radius;\n\n\t\t\t\tif (isNotEventPolygon && i === 0) {\n\t\t\t\t\tif (this.topPointDistance > 0.5) {\n\t\t\t\t\t\ty *= 1 + (this.topPointDistance - 0.5) * (maxDistanceMultiplier - 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ty *= 2 * this.topPointDistance * (1 - minDistanceMultiplier) + minDistanceMultiplier;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tpath.push(new vectorClass(x, -y));\n\t\t\t\tcurrentAngle += centerAngle;\n\t\t\t}\n\t\t\tif (isNotEventPolygon) {\n\t\t\t\t// put weight to center\n\t\t\t\tlet averageY = path.reduce((prev, curr) => prev + curr.y, 0) / this.points;\n\t\t\t\tpath.forEach(p => p.y -= averageY);\n\t\t\t}\n\n\t\t\tif (takeScaleIntoAccount) {\n\t\t\t\tconst scale = this.Transform.getGlobalScale();\n\t\t\t\tif (scale.x !== 1 || scale.y !== 1) {\n\t\t\t\t\tpath.forEach(p => {\n\t\t\t\t\t\tp.x *= scale.x;\n\t\t\t\t\t\tp.y *= scale.y;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn path;\n\t\t},\n\t\tsleep() {\n\t\t\tthis.sprite.destroy();\n\t\t\tthis.sprite = null;\n\t\t\tthis.graphicsContainPointFunc = null;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport { default as PIXI, generateTextureAndAnchor, getHashedTextureAndAnchor, hitTest } from '../features/graphics';\n\nComponent.register({\n\tname: 'Sprite',\n\tcategory: 'Graphics',\n\ticon: 'fa-stop',\n\tallowMultiple: true,\n\tdescription: 'Draws a sprite on the screen.',\n\tproperties: [\n\t\tProp('resource', 'character.png', Prop.enum, Prop.enum.values('character.png', 'profile.png', 'sprite.png')),\n\t\tProp('anchor', new Vector(0.5, 0.5), Prop.vector)\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\tthis.initSprite();\n\n\t\t\tthis.listenProperty(this, 'anchor', anchor => {\n\t\t\t\tif (!this.sprite) return;\n\t\t\t\telse this.sprite.anchor.set(this.anchor.x, this.anchor.y);\n\t\t\t});\n\n\t\t\tthis.listenProperty(this, 'resource', resource => {\n\t\t\t\tthis.initSprite();\n\t\t\t});\n\t\t},\n\t\tinitSprite() {\n\t\t\tif (this.sprite) {\n\t\t\t\tthis.sprite.destroy();\n\t\t\t}\n\n\t\t\tthis.sprite = PIXI.Sprite.fromImage('/img/' + this.resource);\n\t\t\tthis.sprite.anchor.set(this.anchor.x, this.anchor.y);\n\t\t\tthis.sprite.selectableEntityOfSprite = this.entity;\n\t\t\tthis.sprite.selectableEntityHitTest = hitTest;\n\n\t\t\tthis.Transform.container.addChild(this.sprite);\n\t\t},\n\t\tsleep() {\n\t\t\tthis.sprite.destroy();\n\t\t\tthis.sprite = null;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport EntityPrototype from '../core/entityPrototype';\n\nComponent.register({\n\tname: 'Spawner',\n\tcategory: 'Logic',\n\tdescription: 'Spawns types to world.',\n\tproperties: [\n\t\tProp('typeName', '', Prop.string),\n\t\tProp('trigger', 'start', Prop.enum, Prop.enum.values('start', 'interval')),\n\t\tProp('interval', 10, Prop.float, Prop.float.range(0.1, 1000000), Prop.visibleIf('trigger', 'interval'), 'Interval in seconds')\n\t],\n\tprototype: {\n\t\tconstructor() {\n\t\t\tthis.lastSpawn = 0;\n\t\t},\n\t\tinit() {\n\t\t\tthis.lastSpawn = this.scene.time;\n\t\t},\n\t\tonStart() {\n\t\t\tif (this.trigger === 'start')\n\t\t\t\tthis.spawn();\n\t\t},\n\t\tonUpdate() {\n\t\t\tif (this.scene.time > this.lastSpawn + this.interval)\n\t\t\t\tthis.spawn();\n\t\t},\n\t\tonDrawHelper(context) {\n\t\t\tlet size = 30;\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - size * this.Transform.scale.x/2,\n\t\t\t\ty = this.Transform.position.y - size * this.Transform.scale.y/2,\n\t\t\t\tw = size * this.Transform.scale.x,\n\t\t\t\th = size * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = 'blue';\n\t\t\tcontext.strokeStyle = 'white';\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.font = '40px Font Awesome 5 Free';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.fillText('\\uF21D', this.Transform.position.x + 2, this.Transform.position.y);\n\t\t\tcontext.strokeText('\\uf21d', this.Transform.position.x + 2, this.Transform.position.y);\n\n\t\t\tcontext.restore();\n\t\t},\n\t\tspawn() {\n\t\t\t// window['testi']++;\n\t\t\tlet prototype = this.game.findChild('prt', prt => prt.name === this.typeName, true);\n\n\t\t\tif (!prototype)\n\t\t\t\treturn;\n\n\t\t\tlet entityPrototype = EntityPrototype.createFromPrototype(prototype);\n\t\t\tentityPrototype.spawnEntityToScene(this.scene, this.Transform.position);\n\t\t\tentityPrototype.delete();\n\t\t\tthis.lastSpawn = this.scene.time;\n\t\t}\n\t},\n\t/* TODO: This kind of thing can improve update performance by 2x or more\n\tsystems: {\n\t\tonUpdate(setOfSpawners, scene) {\n\t\t\tlet sceneTime = scene.time;\n\t\t\tsetOfSpawners.forEach(comp => {\n\t\t\t\tif (sceneTime > comp.lastSpawn + comp.interval)\n\t\t\t\t\tcomp.spawn();\n\t\t\t});\n\t\t}\n\t}\n\t*/\n});\n\n/*\nwindow['testi'] = 0;\nsetInterval(() => {\n\tconsole.log('testi', window['testi']);\n\twindow['testi'] = 0;\n}, 1000);\n*/","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Trigger',\n\tdescription: 'When _ then _.',\n\tcategory: 'Logic',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('trigger', 'playerComesNear', Prop.enum, Prop.enum.values('playerComesNear')),\n\t\tProp('radius', 40, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('trigger', 'playerComesNear')),\n\t\tProp('action', 'win', Prop.enum, Prop.enum.values('win'))\n\t],\n\tprototype: {\n\t\tpreInit() {\n\t\t\tthis.storeProp = `__Trigger_${this._componentId}`;\n\t\t},\n\t\tonUpdate() {\n\t\t\tif (this.trigger === 'playerComesNear') {\n\t\t\t\tlet componentSet = this.scene.getComponents('CharacterController');\n\t\t\t\tlet entities = [];\n\t\t\t\tcomponentSet.forEach(c => entities.push(c.entity));\n\t\t\t\tlet distSq = this.radius * this.radius;\n\t\t\t\tlet pos = this.Transform.getGlobalPosition();\n\t\t\t\tfor (let i = 0; i < entities.length; ++i) {\n\t\t\t\t\tif (entities[i].Transform.getGlobalPosition().distanceSq(pos) < distSq) {\n\t\t\t\t\t\tif (!entities[i][this.storeProp] && this.launchTrigger(entities[i]) !== false)\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tentities[i][this.storeProp] = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentities[i][this.storeProp] = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Return false if other triggers should not be checked\n\t\t// Note: check this return false logic. Looks weird.\n\t\tlaunchTrigger(entity) {\n\t\t\tif (this.action === 'win') {\n\t\t\t\tthis.scene.win();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport p2, { addBody, deleteBody, createMaterial, getWorld } from '../features/physics';\nimport assert from '../util/assert';\n\nconst PHYSICS_SCALE = 1 / 50;\nexport { PHYSICS_SCALE };\nconst PHYSICS_SCALE_INV = 1 / PHYSICS_SCALE;\n\nconst DENSITY_SCALE = 3 / 10;\n\nconst type = {\n\tdynamic: p2.Body.DYNAMIC,\n\tkinematic: p2.Body.KINEMATIC,\n\tstatic: p2.Body.STATIC\n};\n\nconst SLEEPING = p2.Body.SLEEPING;\nconst STATIC = p2.Body.STATIC;\n\nComponent.register({\n\tname: 'Physics',\n\tcategory: 'Dynamics',\n\tdescription: 'Forms physical rules for <span style=\"color: #84ce84;\">Shapes</span>.',\n\ticon: 'fa-stop',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('type', 'dynamic', Prop.enum, Prop.enum.values('dynamic', 'static')),\n\t\tProp('density', 1, Prop.float, Prop.float.range(0, 100), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('drag', 0.1, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('rotationalDrag', 0.1, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('bounciness', 0, Prop.float, Prop.float.range(0, 1)),\n\t\tProp('friction', 0.1, Prop.float, Prop.float.range(0, 1))\n\t],\n\trequirements: [\n\t\t'Shape'\n\t],\n\trequiresInitWhenEntityIsEdited: true,\n\tprototype: {\n\t\tinited: false,\n\t\tinit() {\n\t\t\tthis.inited = true;\n\t\t\tlet update = callback => {\n\t\t\t\treturn value => {\n\t\t\t\t\tif (!this.updatingOthers && this.body) {\n\t\t\t\t\t\tcallback(value);\n\t\t\t\t\t\tif (this.type === 'dynamic')\n\t\t\t\t\t\t\tthis.body.wakeUp();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlet Shapes = this.entity.getComponents('Shape');\n\t\t\tconst shapePropertiesThatShouldUpdateShape = [\n\t\t\t\t'type',\n\t\t\t\t'size',\n\t\t\t\t'radius',\n\t\t\t\t'points',\n\t\t\t\t'topPointDistance'\n\t\t\t];\n\t\t\tfor (let i = 0; i < Shapes.length; ++i) {\n\t\t\t\tshapePropertiesThatShouldUpdateShape.forEach(property => {\n\t\t\t\t\tthis.listenProperty(Shapes[i], property, update(() => this.updateShape()));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.listenProperty(this.Transform, 'position', update(position => {\n\t\t\t\tthis.body.position = fromTransformToBodyPosition(this.Transform);\n\t\t\t\tthis.body.updateAABB();\n\t\t\t}));\n\t\t\tthis.listenProperty(this.Transform, 'angle', update(angle => {\n\t\t\t\tlet globalAngle = this.Transform.getGlobalAngle();\n\t\t\t\tthis.body.angle = globalAngle;\n\t\t\t\tthis.body.updateAABB();\n\t\t\t}));\n\t\t\tthis.listenProperty(this.Transform, 'scale', update(scale => this.updateShape()));\n\t\t\tthis.listenProperty(this, 'density', update(density => {\n\t\t\t\tthis.body.setDensity(density * DENSITY_SCALE);\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'friction', update(friction => this.updateMaterial()));\n\t\t\tthis.listenProperty(this, 'drag', update(drag => this.body.damping = drag));\n\t\t\tthis.listenProperty(this, 'rotationalDrag', update(rotationalDrag => {\n\t\t\t\tthis.body.angularDamping = rotationalDrag > 0.98 ? 1 : rotationalDrag;\n\t\t\t\tthis.body.fixedRotation = rotationalDrag === 1;\n\t\t\t\tthis.body.updateMassProperties();\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'type', update(type => {\n\t\t\t\tthis.body.type = type[this.type];\n\t\t\t\tthis.entity.sleep();\n\t\t\t\tthis.entity.wakeUp();\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'bounciness', update(bounciness => this.updateMaterial()));\n\n\t\t\tif (this._rootType)\n\t\t\t\tthis.createBody();\n\t\t},\n\t\t// This is here because createBody in init() doesn't have access to Transform's global position because parents are inited later.\n\t\tonStart() {\n\t\t\tthis.body.position = fromTransformToBodyPosition(this.Transform);\n\t\t\tthis.body.angle = this.Transform.getGlobalAngle();\n\t\t\tthis.updateShape();\n\t\t},\n\t\tcreateBody() {\n\t\t\tassert(!this.body);\n\n\t\t\tthis.body = new p2.Body({\n\t\t\t\ttype: type[this.type],\n\n\t\t\t\t// position and angle are updated at onStart\n\t\t\t\tposition: [0, 0], // fromTransformToBodyPosition(this.Transform),\n\t\t\t\tangle: 0, // this.Transform.getGlobalAngle(),\n\t\t\t\tvelocity: [0, 0],\n\t\t\t\tangularVelocity: 0,\n\t\t\t\tsleepTimeLimit: 0.6,\n\t\t\t\tsleepSpeedLimit: 0.3,\n\t\t\t\tdamping: this.drag,\n\t\t\t\tangularDamping: this.rotationalDrag > 0.98 ? 1 : this.rotationalDrag,\n\t\t\t\tfixedRotation: this.rotationalDrag === 1\n\t\t\t});\n\t\t\t// this.updateShape(); // This is done at onStart. No need to do it here.\n\n\t\t\tthis.body.entity = this.entity;\n\n\t\t\taddBody(this.scene, this.body);\n\t\t},\n\t\tupdateShape() {\n\t\t\tif (this.body.shapes.length > 0) {\n\t\t\t\t// We update instead of create.\n\t\t\t\t// Should remove existing shapes\n\n\t\t\t\t// The library does not support updating shapes during the step.\n\t\t\t\tlet world = getWorld(this.scene);\n\t\t\t\tassert(!world.stepping);\n\n\t\t\t\tlet shapes = this.body.shapes;\n\t\t\t\tfor (let i = 0; i < shapes.length; ++i) {\n\t\t\t\t\tshapes[i].body = null;\n\t\t\t\t}\n\t\t\t\tshapes.length = 0;\n\t\t\t}\n\n\t\t\tlet Shapes = this.entity.getComponents('Shape');\n\t\t\tlet scale = this.Transform.getGlobalScale();\n\n\t\t\tShapes.forEach(Shape => {\n\t\t\t\tlet shape;\n\n\t\t\t\tif (Shape.type === 'rectangle') {\n\t\t\t\t\tshape = new p2.Box({\n\t\t\t\t\t\twidth: Shape.size.x * PHYSICS_SCALE * scale.x,\n\t\t\t\t\t\theight: Shape.size.y * PHYSICS_SCALE * scale.y\n\t\t\t\t\t});\n\t\t\t\t} else if (Shape.type === 'circle') {\n\t\t\t\t\tlet averageScale = (scale.x + scale.y) / 2;\n\n\t\t\t\t\tshape = new p2.Circle({\n\t\t\t\t\t\tradius: Shape.radius * PHYSICS_SCALE * averageScale\n\t\t\t\t\t});\n\t\t\t\t} else if (Shape.type === 'convex') {\n\t\t\t\t\tshape = new p2.Convex({\n\t\t\t\t\t\tvertices: Shape.getConvexPoints().map(p => ([p.x * PHYSICS_SCALE, p.y * PHYSICS_SCALE]))\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (shape)\n\t\t\t\t\tthis.body.addShape(shape);\n\t\t\t});\n\n\t\t\tthis.updateMass();\n\t\t\tthis.updateMaterial();\n\t\t},\n\t\tupdateMaterial()  {\n\t\t\tlet material = createMaterial(this.scene, {\n\t\t\t\tfriction: this.friction,\n\t\t\t\trestitution: this.bounciness,\n\t\t\t\t// stiffness: 1e6,\n\t\t\t\t// relaxation: 4,\n\t\t\t\t// frictionStiffness: 1e6,\n\t\t\t\t// frictionRelaxation: 4,\n\t\t\t\t// surfaceVelocity: 0\n\t\t\t});\n\t\t\tthis.body.shapes.forEach(s => s.material = material);\n\t\t},\n\t\tupdateMass() {\n\t\t\tif (this.type === 'dynamic')\n\t\t\t\tthis.body.setDensity(this.density * DENSITY_SCALE);\n\t\t},\n\t\tsetRootType(rootType) {\n\t\t\tif (rootType) {\n\t\t\t\tif (this.inited)\n\t\t\t\t\tthis.createBody();\n\t\t\t}\n\t\t\treturn Component.prototype.setRootType.call(this, rootType);\n\t\t},\n\t\tonUpdate() {\n\t\t\tlet b = this.body;\n\t\t\tif (!b || b.sleepState === SLEEPING || b.type === STATIC)\n\t\t\t\treturn;\n\n\t\t\tthis.updatingOthers = true;\n\n\t\t\t// TODO: find out should these be optimized.\n\t\t\tlet newGlobalPosition = fromBodyPositionToGlobalVector(b.position);\n\t\t\tlet oldGlobalPosition = this.Transform.getGlobalPosition();\n\t\t\tif (!oldGlobalPosition.isEqualTo(newGlobalPosition))\n\t\t\t\tthis.Transform.setGlobalPosition(newGlobalPosition);\n\n\t\t\tif (this.Transform.getGlobalAngle() !== b.angle)\n\t\t\t\tthis.Transform.setGlobalAngle(b.angle);\n\n\t\t\tthis.updatingOthers = false;\n\t\t},\n\t\tsleep() {\n\t\t\tif (this.body) {\n\t\t\t\tdeleteBody(this.scene, this.body);\n\t\t\t\tthis.body = null;\n\t\t\t}\n\t\t\tthis.inited = false;\n\t\t},\n\t\tgetMass() {\n\t\t\treturn this.body.mass;\n\t\t},\n\t\tapplyForce(forceVector) {\n\t\t\tthis.body.applyForce(forceVector.toArray());\n\t\t\tthis.body.wakeUp();\n\t\t},\n\t\tsetAngularForce(force) {\n\t\t\tthis.body.angularForce = force;\n\t\t\tthis.body.wakeUp();\n\t\t}\n\t}\n});\n\nfunction fromTransformToBodyPosition(Transform): Array<number> {\n\treturn Transform.getGlobalPosition().toArray().map(x => x * PHYSICS_SCALE);\n}\nfunction fromBodyPositionToGlobalVector(bodyPosition): Vector {\n\treturn Vector.fromArray(bodyPosition).multiplyScalar(PHYSICS_SCALE_INV);\n}\n","import { Component, Prop } from '../core/component';\n\n// Export so that other components can have this component as parent\nexport default Component.register({\n\tname: 'Lifetime',\n\tdescription: 'Set the object to be destroyed after a time period.',\n\tcategory: 'Logic', // You can also make up new categories.\n\ticon: 'fa-bars', // Font Awesome id\n\trequirements: ['Transform'], // These shared components are autofilled. Error if component is not found.\n\tproperties: [\n\t\tProp('lifetime', 3, Prop.float, Prop.float.range(0.01, 1000), 'Life time seconds')\n\t],\n\tparentClass: Component,\n\tprototype: {\n\t\tonUpdate() {\n\t\t\tlet lifetime = this.scene.time - this.startTime;\n\t\t\tif (lifetime >= this.lifetime) {\n\t\t\t\tif (this.entity)\n\t\t\t\t\tthis.entity.delete();\n\t\t\t}\n\t\t},\n\t\tinit() {\n\t\t\tthis.startTime = this.scene.time;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport { Color } from '../util/color';\nimport { default as PIXI, generateTextureAndAnchor, getHashedTextureAndAnchor } from '../features/graphics';\nimport { isClient } from '../util/environment';\n\nimport { PHYSICS_SCALE } from './Physics';\nimport { GameEvent } from '../core/eventDispatcher';\nimport Entity from '../core/entity';\n\nComponent.register({\n\tname: 'Particles',\n\tcategory: 'Graphics',\n\tdescription: 'Particle engine gives eye candy.',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('startColor', new Color('#68c07f'), Prop.color),\n\t\tProp('endColor', new Color('#59abc0'), Prop.color),\n\t\tProp('alpha', 1, Prop.float, Prop.float.range(0, 1)),\n\t\tProp('particleSize', 10, Prop.float, Prop.float.range(1, 100)),\n\t\tProp('particleCount', 30, Prop.int, Prop.int.range(0, 10000)),\n\t\tProp('particleLifetime', 1, Prop.float, Prop.float.range(0.1, 10), 'in seconds'),\n\t\tProp('particleHardness', 0.2, Prop.float, Prop.float.range(0, 1)),\n\t\tProp('blendMode', 'add', Prop.enum, Prop.enum.values('add', 'normal')),\n\t\tProp('spawnType', 'circle', Prop.enum, Prop.enum.values('circle', 'rectangle')),\n\t\tProp('spawnRadius', 20, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('spawnType', 'circle')),\n\t\tProp('spawnRandom', 0.5, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('spawnType', 'circle')),\n\t\tProp('spawnRect', new Vector(50, 50), Prop.vector, Prop.visibleIf('spawnType', 'rectangle')),\n\t\tProp('speedToOutside', 50, Prop.float, Prop.float.range(-1000, 1000), Prop.visibleIf('spawnType', 'circle')),\n\t\tProp('speed', new Vector(0, 0), Prop.vector),\n\t\tProp('speedRandom', 0, Prop.float, Prop.float.range(0, 1000), 'Max random velocity to random direction'),\n\t\tProp('acceleration', new Vector(0, 0), Prop.vector),\n\t\tProp('globalCoordinates', true, Prop.bool),\n\t\tProp('followObject', 0.4, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('globalCoordinates', true))\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\t//ParticleContainer does not work properly!\n\n\t\t\t// maxSize < 40 will crash\n\t\t\t// With many Particle-components with few particles, this is deadly-expensive.\n\t\t\t// And also crashes now and then with low maxValue.\n\t\t\t// this.container = new PIXI.particles.ParticleContainer(5000, {\n\t\t\t// \tposition: true,\n\t\t\t// \talpha: true,\n\t\t\t// \tscale: false,\n\t\t\t// \trotation: false,\n\t\t\t// \tuvs: false\n\t\t\t// });\n\n\n\t\t\t// Use normal container instead\n\t\t\tthis.container = new PIXI.Container();\n\n\t\t\t// Texture\n\t\t\tthis.updateTexture();\n\t\t\t['particleSize', 'particleHardness', 'alpha'].forEach(propertyName => {\n\t\t\t\tthis.listenProperty(this, propertyName, () => {\n\t\t\t\t\tthis.updateTexture();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Blend mode\n\t\t\tthis.listenProperty(this, 'blendMode', blendMode => {\n\t\t\t\tif (!this.particles)\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite)\n\t\t\t\t\t\tp.sprite.blendMode = blendModes[blendMode];\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// this.scene.layers.main.addChild(this.container);\n\n\t\t\tthis.initParticles();\n\t\t\t['particleLifetime', 'particleCount'].forEach(propertyName => {\n\t\t\t\tthis.listenProperty(this, propertyName, () => {\n\t\t\t\t\tthis.initParticles();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.updateGlobalCoordinatesProperty();\n\t\t\tthis.listenProperty(this, 'globalCoordinates', () => {\n\t\t\t\tthis.updateGlobalCoordinatesProperty();\n\t\t\t});\n\n\t\t\tlet physicsEntity = this.entity as Entity;\n\t\t\twhile (physicsEntity && physicsEntity.threeLetterType === 'ent' && !this.Physics) {\n\t\t\t\tthis.Physics = physicsEntity.getComponent('Physics');\n\t\t\t\tphysicsEntity = physicsEntity.getParent() as Entity;\n\t\t\t}\n\t\t},\n\n\t\tupdateGlobalCoordinatesProperty() {\n\t\t\tif (this.positionListener) {\n\t\t\t\tthis.positionListener();\n\t\t\t\tthis.positionListener = null;\n\t\t\t}\n\t\t\tif (this.globalCoordinates) {\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite) {\n\t\t\t\t\t\tp.sprite.x += this.container.position.x;\n\t\t\t\t\t\tp.sprite.y += this.container.position.y;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// this.container.position.set(0, 0);\n\t\t\t\tthis.container.setParent(this.scene.layers.main);\n\t\t\t} else {\n\t\t\t\t/*\n\t\t\t\tthis.positionListener = this.Transform.listen('globalTransformChanged', Transform => {\n\t\t\t\t\tlet position = Transform.getGlobalPosition();\n\t\t\t\t\tthis.container.position.set(position.x, position.y);\n\t\t\t\t});\n\t\t\t\t*/\n\t\t\t\t// this.container.position.set(this.Transform.position.x, this.Transform.position.y);\n\t\t\t\tthis.container.setParent(this.Transform.container);\n\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite) {\n\t\t\t\t\t\tp.sprite.x -= this.container.position.x;\n\t\t\t\t\t\tp.sprite.y -= this.container.position.y;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tupdateTexture() {\n\t\t\tthis.texture = getParticleTexture(this.particleSize, this.particleHardness * 0.9, { r: 255, g: 255, b: 255, a: this.alpha });\n\t\t\t// this.container.baseTexture = this.texture;\n\t\t\tif (this.particles) {\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite)\n\t\t\t\t\t\tp.sprite.texture = this.texture;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tinitParticles() {\n\t\t\tif (this.particles) {\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite)\n\t\t\t\t\t\tp.sprite.destroy();\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.particles = [];\n\t\t\tlet interval = this.particleLifetime / this.particleCount;\n\t\t\tlet firstBirth = this.scene.time + Math.random() * interval;\n\t\t\tfor (let i = 0; i < this.particleCount; ++i) {\n\t\t\t\tthis.particles.push({\n\t\t\t\t\talive: false,\n\t\t\t\t\tnextBirth: firstBirth + i * interval\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tresetParticle(p) {\n\n\t\t\tp.vx = this.speed.x;\n\t\t\tp.vy = this.speed.y;\n\t\t\tif (this.speedRandom > 0) {\n\t\t\t\tlet randomSpeed = this.speedRandom * Math.random();\n\t\t\t\tlet randomAngle = Math.random() * Math.PI * 2;\n\t\t\t\tp.vx += Math.sin(randomAngle) * randomSpeed;\n\t\t\t\tp.vy += Math.cos(randomAngle) * randomSpeed;\n\t\t\t}\n\n\t\t\t// Calculate starting position\n\t\t\tif (this.spawnType === 'circle') {\n\t\t\t\tlet r = this.spawnRadius;\n\t\t\t\tif (this.spawnRandom > 0) {\n\t\t\t\t\tr = this.spawnRandom * Math.random() * r + (1 - this.spawnRandom) * r;\n\t\t\t\t}\n\t\t\t\tlet angle = Math.random() * Math.PI * 2;\n\t\t\t\tp.sprite.x = Math.cos(angle) * r;\n\t\t\t\tp.sprite.y = Math.sin(angle) * r;\n\t\t\t\tif (this.speedToOutside !== 0) {\n\t\t\t\t\tp.vx += Math.cos(angle) * this.speedToOutside;\n\t\t\t\t\tp.vy += Math.sin(angle) * this.speedToOutside;\n\t\t\t\t}\n\t\t\t} else if (this.spawnType === 'rectangle') {\n\t\t\t\t// Rectangle\n\t\t\t\tp.sprite.x = -this.spawnRect.x / 2 + Math.random() * this.spawnRect.x;\n\t\t\t\tp.sprite.y = -this.spawnRect.y / 2 + Math.random() * this.spawnRect.y;\n\t\t\t}\n\n\t\t\tp.age = this.scene.time - p.nextBirth;\n\t\t\tp.nextBirth += this.particleLifetime;\n\n\t\t\tif (this.globalCoordinates) {\n\t\t\t\t// Change sprite position from Transform coordinates to main layer coordinates.\n\t\t\t\tVector.fromObject(this.container.toLocal(p.sprite.position, this.Transform.container, p.sprite.position));\n\n\t\t\t\tif (this.Physics && this.Physics.body) {\n\t\t\t\t\tlet vel = this.Physics.body.velocity;\n\t\t\t\t\tp.vx = p.vx + this.followObject * vel[0] / PHYSICS_SCALE;\n\t\t\t\t\tp.vy = p.vy + this.followObject * vel[1] / PHYSICS_SCALE;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tonUpdate(dt, t) {\n\t\t\tconst particleLifetime = this.particleLifetime;\n\t\t\tconst invParticleLifetime = 1 / particleLifetime;\n\t\t\tconst particles = this.particles;\n\t\t\tconst accelerationX = this.acceleration.x * dt;\n\t\t\tconst accelerationY = this.acceleration.y * dt;\n\n\t\t\t// Fast color interpolation\n\t\t\tconst startColor = this.startColor;\n\t\t\tconst endColor = this.endColor;\n\t\t\tfunction colorLerp(lerp) {\n\t\t\t\tlet startMultiplier = 1 - lerp;\n\t\t\t\tlet r = (startColor.r * startMultiplier + endColor.r * lerp) | 0; // to int\n\t\t\t\tlet g = (startColor.g * startMultiplier + endColor.g * lerp) | 0;\n\t\t\t\tlet b = (startColor.b * startMultiplier + endColor.b * lerp) | 0;\n\t\t\t\treturn 65536 * r + 256 * g + b;\n\t\t\t}\n\n\t\t\tlet sprite,\n\t\t\t\tspritePos,\n\t\t\t\tscale,\n\t\t\t\tlerp,\n\t\t\t\tp\n\t\t\t\t;\n\n\t\t\tfor (let i = 0; i < this.particleCount; i++) {\n\t\t\t\tp = particles[i];\n\n\t\t\t\tif (!p.alive) {\n\t\t\t\t\t// Not alive\n\t\t\t\t\tif (t >= p.nextBirth) {\n\t\t\t\t\t\t// The birth!\n\t\t\t\t\t\tp.sprite = new PIXI.Sprite(this.texture);\n\t\t\t\t\t\tp.sprite.blendMode = blendModes[this.blendMode];\n\t\t\t\t\t\tp.sprite.anchor.set(0.5, 0.5);\n\t\t\t\t\t\tp.alive = true;\n\t\t\t\t\t\tthis.resetParticle(p);\n\t\t\t\t\t\tthis.container.addChild(p.sprite);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Is alive\n\n\t\t\t\tsprite = p.sprite;\n\t\t\t\tspritePos = sprite.transform.position;\n\n\t\t\t\tp.age += dt;\n\t\t\t\tlerp = p.age * invParticleLifetime;\n\t\t\t\tif (lerp >= 1) {\n\t\t\t\t\tthis.resetParticle(p);\n\t\t\t\t\tlerp = p.age * invParticleLifetime;\n\t\t\t\t} else {\n\t\t\t\t\tp.vx += accelerationX;\n\t\t\t\t\tp.vy += accelerationY;\n\t\t\t\t\tspritePos.x += p.vx * dt;\n\t\t\t\t\tspritePos.y += p.vy * dt;\n\t\t\t\t}\n\n\t\t\t\tsprite.tint = colorLerp(lerp);\n\n\t\t\t\tsprite.alpha = alphaLerp(lerp);\n\n\t\t\t\tscale = scaleLerp(lerp);\n\t\t\t\tsprite.scale.set(scale, scale);\n\n\t\t\t}\n\t\t},\n\n\t\tsleep() {\n\t\t\tthis.particles = null;\n\n\t\t\tthis.container.destroy();\n\t\t\tthis.container = null;\n\n\t\t\tif (this.positionListener) {\n\t\t\t\tthis.positionListener();\n\t\t\t\tthis.positionListener = null;\n\t\t\t}\n\n\t\t\t// do not destroy textures. we can reuse them.\n\t\t}\n\t}\n});\n\nfunction alphaLerp(lerp) {\n\tif (lerp > 0.5) {\n\t\treturn (1 - lerp) / 0.5;\n\t} else if (lerp > 0.2) {\n\t\treturn 1;\n\t} else {\n\t\treturn lerp * 5;\n\t}\n}\n\nfunction scaleLerp(lerp) {\n\tif (lerp > 0.5) {\n\t\treturn 1;\n\t} else {\n\t\treturn 0.5 + lerp;\n\t}\n}\n\nconst blendModes = {\n\tadd: isClient ? PIXI.BLEND_MODES.ADD : 0,\n\tnormal: isClient ? PIXI.BLEND_MODES.NORMAL : 0\n};\n\nlet textureCache = {};\n\n// size: pixels\n// gradientHardness: 0..1\nfunction getParticleTexture(size, gradientHardness = 0, rgb = { r: 255, g: 255, b: 255, a: 1 }) {\n\tlet hash = `${size}-${gradientHardness}-${rgb.r}-${rgb.g}-${rgb.b}-${rgb.a}`;\n\tif (!textureCache[hash]) {\n\t\tlet canvas = document.createElement('canvas');\n\t\tcanvas.width = size;\n\t\tcanvas.height = size;\n\t\tlet context = canvas.getContext('2d');\n\t\tvar gradient = context.createRadialGradient(\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5 * (gradientHardness), // inner r\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5 // outer r\n\t\t);\n\t\tgradient.addColorStop(0, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${rgb.a})`);\n\t\tgradient.addColorStop(1, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0)`);\n\t\tcontext.fillStyle = gradient;\n\t\tcontext.fillRect(0, 0, size, size);\n\t\ttextureCache[hash] = PIXI.Texture.fromCanvas(canvas);\n\t}\n\treturn textureCache[hash];\n}\n","export function removeTheDeadFromArray(array) {\n\tfor (let i = array.length - 1; i >= 0; --i) {\n\t\tif (array[i]._alive === false)\n\t\t\tarray.splice(i, 1);\n\t}\n}\n\nexport function absLimit(value, absMax) {\n\tif (value > absMax)\n\t\treturn absMax;\n\telse if (value < -absMax)\n\t\treturn -absMax;\n\telse\n\t\treturn value;\n}\n","import { Component, Prop } from '../core/component';\nimport { key, keyPressed, listenKeyDown } from '../util/input';\nimport assert from '../util/assert'\nimport Vector from '../util/vector';\nimport { getWorld, default as p2 } from '../features/physics';\nimport {PHYSICS_SCALE} from './Physics'\nimport { absLimit } from '../util/algorithm';\n\nconst JUMP_SAFE_DELAY = 0.1; // seconds\n\nComponent.register({\n\tname: 'CharacterController',\n\tdescription: 'Lets user control the object.',\n\tcategory: 'Dynamics',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('type', 'player', Prop.enum, Prop.enum.values('player', 'AI')),\n\t\tProp('keyboardControls', 'arrows or WASD', Prop.enum, Prop.enum.values('arrows', 'WASD', 'arrows or WASD')),\n\t\tProp('controlType', 'jumper', Prop.enum, Prop.enum.values('jumper', 'top down'/*, 'space ship'*/)),\n\t\tProp('jumpSpeed', 300, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('controlType', 'jumper')),\n\t\tProp('jumpAddedToVelocity', 0.4, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('controlType', 'jumper'), '1 means that jump speed is added to y velocity when object has y velocity.'),\n\t\tProp('breakInTheAir', true, Prop.bool, Prop.visibleIf('controlType', 'jumper')),\n\t\tProp('speed', 200, Prop.float, Prop.float.range(0, 1000)),\n\t\tProp('acceleration', 2000, Prop.float, Prop.float.range(0, 10000)),\n\t\tProp('breaking', 2000, Prop.float, Prop.float.range(0, 10000))\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\tthis.Physics = this.entity.getComponent('Physics');\n\n\t\t\tthis.lastJumpTime = 0;\n\n\t\t\tthis.keyListener = listenKeyDown(keyCode => {\n\t\t\t\tif (this.controlType !== 'jumper' || !this.scene.playing)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (this.keyboardControls === 'arrows') {\n\t\t\t\t\tif (keyCode === key.up)\n\t\t\t\t\t\tthis.jump();\n\t\t\t\t} else if (this.keyboardControls === 'WASD') {\n\t\t\t\t\tif (keyCode === key.w)\n\t\t\t\t\t\tthis.jump();\n\t\t\t\t} else if (this.keyboardControls === 'arrows or WASD') {\n\t\t\t\t\tif (keyCode === key.up || keyCode === key.w)\n\t\t\t\t\t\tthis.jump();\n\t\t\t\t} else {\n\t\t\t\t\tassert(false, 'Invalid CharacterController.keyboardControls');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsleep() {\n\t\t\tif (this.keyListener) {\n\t\t\t\tthis.keyListener();\n\t\t\t\tthis.keyListener = null;\n\t\t\t}\n\t\t},\n\t\tgetInput() {\n\t\t\tif (this.keyboardControls === 'arrows') {\n\t\t\t\treturn {\n\t\t\t\t\tup: keyPressed(key.up),\n\t\t\t\t\tdown: keyPressed(key.down),\n\t\t\t\t\tleft: keyPressed(key.left),\n\t\t\t\t\tright: keyPressed(key.right)\n\t\t\t\t};\n\t\t\t} else if (this.keyboardControls === 'WASD') {\n\t\t\t\treturn {\n\t\t\t\t\tup: keyPressed(key.w),\n\t\t\t\t\tdown: keyPressed(key.s),\n\t\t\t\t\tleft: keyPressed(key.a),\n\t\t\t\t\tright: keyPressed(key.d)\n\t\t\t\t};\n\t\t\t} else if (this.keyboardControls === 'arrows or WASD') {\n\t\t\t\treturn {\n\t\t\t\t\tup: keyPressed(key.up) || keyPressed(key.w),\n\t\t\t\t\tdown: keyPressed(key.down) || keyPressed(key.s),\n\t\t\t\t\tleft: keyPressed(key.left) || keyPressed(key.a),\n\t\t\t\t\tright: keyPressed(key.right) || keyPressed(key.d)\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tassert(false, 'Invalid CharacterController.keyboardControls');\n\t\t\t}\n\t\t},\n\t\tonUpdate(dt, t) {\n\t\t\tlet { up, down, left, right } = this.getInput();\n\n\t\t\tlet dx = 0,\n\t\t\t\tdy = 0;\n\n\t\t\tif (right) dx++;\n\t\t\tif (left) dx--;\n\t\t\tif (up) dy--;\n\t\t\tif (down) dy++;\n\n\t\t\tif (this.controlType === 'top down') {\n\t\t\t\tthis.moveTopDown(dx, dy, dt);\n\t\t\t} else if (this.controlType === 'jumper') {\n\t\t\t\tthis.moveJumper(dx, dy, dt);\n\t\t\t}\n\t\t},\n\t\t// dx and dy between [-1, 1]\n\t\tmoveTopDown(dx, dy, dt) {\n\t\t\tif (!this.Physics) {\n\t\t\t\tif (dx !== 0 || dy !== 0) {\n\t\t\t\t\tlet Transform = this.Transform;\n\t\t\t\t\tlet p = Transform.position;\n\t\t\t\t\tlet delta = this.speed * dt;\n\t\t\t\t\tTransform.position = new Vector(p.x + dx * delta, p.y + dy * delta);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.Physics.body)\n\t\t\t\treturn;\n\n\t\t\t// Physics based\n\t\t\t// #############\n\n\t\t\tlet bodyVelocity = this.Physics.body.velocity;\n\n\t\t\tbodyVelocity[0] = absLimit(this.calculateNewVelocity(bodyVelocity[0] / PHYSICS_SCALE, dx, dt), this.speed) * PHYSICS_SCALE;\n\t\t\tbodyVelocity[1] = absLimit(this.calculateNewVelocity(bodyVelocity[1] / PHYSICS_SCALE, dy, dt), this.speed) * PHYSICS_SCALE;\n\t\t},\n\t\tmoveJumper(dx, dy, dt) {\n\t\t\tif (!this.Physics || !this.Physics.body)\n\t\t\t\treturn false;\n\n\t\t\tlet bodyVelocity = this.Physics.body.velocity;\n\n\t\t\tbodyVelocity[0] = this.calculateNewVelocity(bodyVelocity[0] / PHYSICS_SCALE, dx, dt) * PHYSICS_SCALE;\n\t\t},\n\t\tjump() {\n\t\t\tif (this.scene.time > this.lastJumpTime + JUMP_SAFE_DELAY && this.checkIfCanJump()) {\n\t\t\t\tthis.lastJumpTime = this.scene.time;\n\n\t\t\t\tlet bodyVelocity = this.Physics.body.velocity;\n\t\t\t\tif (bodyVelocity[1] > 0) {\n\t\t\t\t\t// going down\n\t\t\t\t\tbodyVelocity[1] = -this.jumpSpeed * PHYSICS_SCALE;\n\t\t\t\t} else {\n\t\t\t\t\t// going up\n\t\t\t\t\tlet velocityVector = Vector.fromArray(bodyVelocity);\n\n\t\t\t\t\tlet contactEquations = getWorld(this.scene).narrowphase.contactEquations;\n\t\t\t\t\tlet body = this.Physics.body;\n\n\t\t\t\t\tfor (let i = contactEquations.length - 1; i >= 0; --i) {\n\t\t\t\t\t\tlet contact = contactEquations[i];\n\t\t\t\t\t\tif (contact.bodyA === body || contact.bodyB === body) {\n\t\t\t\t\t\t\tlet normal = Vector.fromArray(contact.normalA);\n\t\t\t\t\t\t\tif (contact.bodyB === body)\n\t\t\t\t\t\t\t\tnormal.multiplyScalar(-1);\n\t\t\t\t\t\t\tlet dotProduct = velocityVector.dot(normal);\n\t\t\t\t\t\t\tif (dotProduct < 0) {\n\t\t\t\t\t\t\t\t// character is moving away from the contact. could be caused by physics engine.\n\t\t\t\t\t\t\t\tvelocityVector.subtract(normal.multiplyScalar(dotProduct));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbodyVelocity[1] = velocityVector.y * this.jumpAddedToVelocity - this.jumpSpeed * PHYSICS_SCALE;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcheckIfCanJump() {\n\t\t\tif (!this.Physics || this.controlType !== 'jumper')\n\t\t\t\treturn false;\n\n\t\t\tlet contactEquations = getWorld(this.scene).narrowphase.contactEquations;\n\t\t\tlet body = this.Physics.body;\n\n\t\t\tif (!body)\n\t\t\t\treturn false;\n\n\t\t\tif (body.sleepState === p2.Body.SLEEPING)\n\t\t\t\treturn true;\n\n\t\t\tfor (let i = contactEquations.length - 1; i >= 0; --i) {\n\t\t\t\tlet contact = contactEquations[i];\n\t\t\t\tif (contact.bodyA === body || contact.bodyB === body) {\n\t\t\t\t\tlet normalY = contact.normalA[1];\n\t\t\t\t\tif (contact.bodyB === body)\n\t\t\t\t\t\tnormalY *= -1;\n\t\t\t\t\tif (normalY > 0.5)\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tcalculateNewVelocity(velocity, input, dt) {\n\t\t\tif (input !== 0) {\n\t\t\t\tif (velocity >= this.speed && input > 0) {\n\t\t\t\t\t// don't do anything\n\t\t\t\t} else if (velocity <= -this.speed && input < 0) {\n\t\t\t\t\t// don't do anything\n\t\t\t\t} else {\n\t\t\t\t\t// do something\n\t\t\t\t\tvelocity += input * this.acceleration * dt;\n\n\t\t\t\t\tif (input < 0 && velocity < -this.speed)\n\t\t\t\t\t\tvelocity = -this.speed;\n\n\t\t\t\t\tif (input > 0 && velocity > this.speed)\n\t\t\t\t\t\tvelocity = this.speed;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (velocity !== 0 && (this.controlType !== 'jumper' || this.breakInTheAir || this.checkIfCanJump())) {\n\t\t\t\t\tlet absVel = Math.abs(velocity);\n\t\t\t\t\tabsVel -= this.breaking * dt;\n\t\t\t\t\tif (absVel < 0)\n\t\t\t\t\t\tabsVel = 0;\n\n\t\t\t\t\tif (velocity > 0)\n\t\t\t\t\t\tvelocity = absVel;\n\t\t\t\t\telse\n\t\t\t\t\t\tvelocity = -absVel;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn velocity;\n\t\t}\n\t}\n});\n","// Animation clashes with typescript lib \"DOM\" (lib.dom.d.ts). Therefore we have namespace.\nexport namespace animation {\n\n    // Changing this will break games\n    export const DEFAULT_FRAME_COUNT = 24;\n    export const DEFAULT_FRAME_RATE = 24;\n    export const MAX_FRAME_COUNT = 100;\n    export const MAX_FRAME_RATE = 100;\n\n    export type AnimationData = {\n        animations: AnimationDataAnimation[];\n    };\n    export type AnimationDataAnimation = {\n        name: string;\n        tracks: AnimationDataTrack[];\n        frames?: number; // If falsy, use DEFAULT_FRAME_COUNT\n        fps?: number; // If falsy, use DEFAULT_FRAME_RATE\n    };\n    export type AnimationDataTrack = {\n        path: string;\n        cId: string;\n        prpName: string;\n        keyFrames: { [frame: number]: any }\n    };\n\n    // export function parseAnimationData\n\n    /**\n     * @param animationDataString data from Animation component\n     */\n    export function parseAnimationData(animationDataString) {\n        let animationData;\n        try {\n            animationData = JSON.parse(animationDataString);\n        } catch (e) {\n            animationData = {};\n        }\n\n        animationData.animations = animationData.animations || [];\n        return animationData as AnimationData;\n    }\n\n    /**\n     * Helper class for editor. Just JSON.stringify this to get valid animationData animation out.\n     */\n    export class Animation {\n        // If frames is falsy, use DEFAULT_FRAME_COUNT\n        constructor(\n            public name: string,\n            public tracks: Track[] = [],\n            public frames: number = undefined,\n            public fps: number = undefined\n        ) {}\n\n        /**\n         *\n         * @param entityPrototypeId\n         * @param componendId\n         * @param value jsoned property value\n         */\n        saveValue(path: string, componendId: string, propertyName: string, frameNumber: number, value: any) {\n            let track = this.tracks.find(track => track.cId === componendId && track.path === path && track.prpName === propertyName);\n            if (!track) {\n                track = new Track(path, componendId, propertyName);\n                this.tracks.push(track);\n            }\n            track.saveValue(frameNumber, value);\n        }\n\n        getKeyFrames(path: string, componendId: string, propertyName: string) {\n            let track = this.tracks.find(track => track.cId === componendId && track.path === path && track.prpName === propertyName);\n            if (track) {\n                return track.keyFrames;\n            } else {\n                return null;\n            }\n        }\n\n        deleteEmptyTracks() {\n            for (let i = this.tracks.length - 1; i >= 0; i--) {\n                if (Object.keys(this.tracks[i].keyFrames).length === 0) {\n                    this.tracks.splice(i, 1);\n                }\n            }\n        }\n\n        deleteOutOfBoundsKeyFrames() {\n            let frameCount = this.frames || DEFAULT_FRAME_COUNT;\n            for (const track of this.tracks) {\n                let keyFrameKeys = Object.keys(track.keyFrames);\n                for (const keyFrameKey of keyFrameKeys) {\n                    if (+keyFrameKey > frameCount) {\n                        delete track.keyFrames[keyFrameKey];\n                    }\n                }\n            }\n        }\n\n        getHighestKeyFrame() {\n            let highestKeyFrame = 0;\n            for (const track of this.tracks) {\n                let keyFrameKeys = Object.keys(track.keyFrames);\n                for (const keyFrameKey of keyFrameKeys) {\n                    if (+keyFrameKey > highestKeyFrame) {\n                        highestKeyFrame = +keyFrameKey;\n                    }\n                }\n            }\n            return highestKeyFrame;\n        }\n\n        static create(json)  {\n            let tracks = (json.tracks || []).map(Track.create);\n            return new Animation(json.name, tracks, json.frames, json.fps);\n        }\n    }\n\n    export class Track {\n        constructor(public path: string, public cId: string, public prpName: string, public keyFrames: { [frame: number]: any } = {}) {\n        }\n\n        saveValue(frameNumber: number, value) {\n            this.keyFrames[frameNumber] = value;\n        }\n\n        static create(json) {\n            let keyFrames = json.keyFrames || {};\n            return new Track(json.path, json.cId, json.prpName, keyFrames);\n        }\n    }\n}\n","import { Component, Prop } from '../core/component';\nimport { animation } from '../features/animation/animation';\nimport { getSerializable } from '../core/serializableManager';\nimport EntityPrototype from '../core/entityPrototype';\nimport Entity from '../core/entity';\nimport assert from '../util/assert';\nimport Property from '../core/property';\nimport Vector from '../util/vector';\nimport { PropertyType } from '../core/propertyType';\nimport { Color } from '../util/color';\n\n// Export so that other components can have this component as parent\nexport default Component.register({\n\tname: 'Animation',\n\tdescription: 'Allows animation of children',\n\tcategory: 'Graphics', // You can also make up new categories.\n\ticon: 'fa-bars', // Font Awesome id\n\tproperties: [\n\t\tProp('animationData', '{}', Prop.longString, 'temporary var for development')\n\t],\n\tallowMultiple: false, // see prototype.ts clone(). Would need multi-component support\n\tprototype: {\n\t\tanimator: null,\n\t\tconstructor() {\n\t\t},\n\t\tpreInit() {\n\t\t},\n\t\tinit() {\n\t\t\tthis.listenProperty(this, 'animationData', () => this.loadAnimation());\n\t\t\tthis.loadAnimation();\n\t\t},\n\t\tonUpdate(dt) {\n\t\t\tthis.animator.update(dt);\n\t\t},\n\t\tloadAnimation() {\n\t\t\tif (this.animator) {\n\t\t\t\tthis.animator.delete();\n\t\t\t}\n\t\t\tthis.animator = new Animator(animation.parseAnimationData(this.animationData), this);\n\t\t},\n\t\tsleep() {\n\t\t\tthis.animator.delete();\n\t\t\tthis.animator = null;\n\t\t}\n\t}\n});\n\nconst controlPointDistanceFactor = 0.33333; // 0.33333333;\n\nclass Animator {\n\ttime: number = 0;\n\tanimations: AnimatorAnimation[];\n\tcurrentAnimation: AnimatorAnimation;\n\tconstructor(animationData: animation.AnimationData, public component: Component) {\n\t\tthis.animations = animationData.animations.map(anim => new AnimatorAnimation(anim, component.entity.prototype));\n\t\tthis.currentAnimation = this.animations[0];\n\t}\n\tupdate(dt) {\n\t\tif (!this.currentAnimation) {\n\t\t\treturn;\n\t\t}\n\t\tconst animationLength = this.currentAnimation.frames / this.currentAnimation.fps;\n\t\tthis.time += dt;\n\t\tif (this.time >= animationLength) {\n\t\t\tthis.time -= animationLength;\n\t\t}\n\t\tlet totalFrames = this.currentAnimation.frames;\n\t\tlet frame = this.time / animationLength * totalFrames + 1;\n\t\tthis.currentAnimation.setFrame(frame);\n\t}\n\tsetAnimation(name: string) {\n\t\tif (!name) {\n\t\t\tthis.time = 0;\n\t\t\tthis.currentAnimation = null;\n\t\t\tthis.component.entity.resetComponents();\n\t\t\treturn;\n\t\t}\n\t\tlet anim = this.animations.find(anim => anim.name === name);\n\t\tif (anim) {\n\t\t\tthis.currentAnimation = anim;\n\t\t\tthis.time = 0;\n\t\t}\n\t}\n\tdelete() {\n\t\tdelete this.animations;\n\t\tdelete this.currentAnimation;\n\t}\n}\n\nclass AnimatorAnimation {\n\tname: string;\n\ttracks: AnimatorTrack[];\n\tframes: number;\n\tfps: number;\n\tconstructor(animationJSON: animation.AnimationDataAnimation, rootEntityPrototype: EntityPrototype) {\n\t\tthis.name = animationJSON.name;\n\t\tthis.frames = animationJSON.frames || animation.DEFAULT_FRAME_COUNT;\n\t\tthis.fps = animationJSON.fps || animation.DEFAULT_FRAME_RATE;\n\t\tthis.tracks = animationJSON.tracks.map(trackData => new AnimatorTrack(trackData, this.frames, rootEntityPrototype));\n\t}\n\tsetFrame(frame: number) {\n\t\tassert(frame >= 1 && frame < this.frames + 1, 'invalid frame number: ' + frame);\n\t\tfor (let track of this.tracks) {\n\t\t\ttrack.setFrame(frame);\n\t\t}\n\t}\n}\n\nclass AnimatorTrack {\n\tentityPrototype: EntityPrototype;\n\tentity: Entity;\n\tanimatedProperty: Property;\n\tcurrentKeyFrameIndex: number = 0;\n\tkeyFrames: Array<{\n\t\tframe: number;\n\t\tvalue: any;\n\t\tcontrol1: any;\n\t\tcontrol2: any;\n\t}> = [];\n\tconstructor(trackData: animation.AnimationDataTrack, public frames: number, rootEntityPrototype: EntityPrototype) {\n\t\tthis.entityPrototype = rootEntityPrototype.getPrototypeByPath(trackData.path) as EntityPrototype;\n\t\tif (!this.entityPrototype) {\n\t\t\tconsole.warn('Animation path did not match anything:', trackData.path)\n\t\t\treturn\n\t\t}\n\t\tlet componentData = this.entityPrototype.findComponentDataByComponentId(trackData.cId, true);\n\t\tlet componentName = componentData.componentClass.componentName;\n\t\tthis.entity = this.entityPrototype.previouslyCreatedEntity;\n\t\tassert(this.entity, 'must have entity');\n\t\tlet component = this.entity.getComponents(componentName).find(c => c._componentId === trackData.cId);\n\t\tassert(component, 'component must be found');\n\t\tthis.animatedProperty = component._properties[trackData.prpName];\n\t\tlet keyFrameFrames = Object.keys(trackData.keyFrames).map(key => ~~key).sort((a, b) => a - b);\n\n\t\tfor (let frame of keyFrameFrames) {\n\t\t\tlet value = this.animatedProperty.propertyType.type.fromJSON(trackData.keyFrames[frame]);\n\t\t\tthis.keyFrames.push({\n\t\t\t\tframe,\n\t\t\t\tvalue,\n\t\t\t\tcontrol1: value,\n\t\t\t\tcontrol2: value\n\t\t\t});\n\t\t}\n\t\tlet propertyTypeName = this.animatedProperty.propertyType.type.name;\n\t\tlet propertyType = this.animatedProperty.propertyType;\n\t\tconst color = value => Math.min(Math.max(value, 0), 255);\n\t\tfor (let i = 0; i < this.keyFrames.length; i++) {\n\t\t\tlet prev = this.keyFrames[i];\n\t\t\tlet curr = this.keyFrames[(i + 1) % this.keyFrames.length];\n\t\t\tlet next = this.keyFrames[(i + 2) % this.keyFrames.length];\n\n\t\t\tif (propertyTypeName === 'float') {\n\t\t\t\tlet controlPoints;\n\t\t\t\tif (propertyType.getFlag(Prop.flagDegreesInEditor)) {\n\t\t\t\t\t// It's angle we are dealing with.\n\t\t\t\t\tcontrolPoints = calculateControlPointsForScalar(\n\t\t\t\t\t\tgetClosestAngle(curr.value, prev.value),\n\t\t\t\t\t\tcurr.value,\n\t\t\t\t\t\tgetClosestAngle(curr.value, next.value)\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tcontrolPoints = calculateControlPointsForScalar(prev.value, curr.value, next.value);\n\t\t\t\t}\n\t\t\t\tcurr.control1 = controlPoints.control1;\n\t\t\t\tcurr.control2 = controlPoints.control2;\n\t\t\t} else if (propertyTypeName === 'vector') {\n\t\t\t\tlet prevValue = prev.value as Vector;\n\t\t\t\tlet currValue = curr.value as Vector;\n\t\t\t\tlet nextValue = next.value as Vector;\n\n\t\t\t\tlet prevToCurr = currValue.clone().subtract(prevValue);\n\t\t\t\tlet currToNext = nextValue.clone().subtract(currValue);\n\n\t\t\t\tlet angleFactor = (Math.PI - prevToCurr.angleTo(currToNext)) / Math.PI;\n\t\t\t\tangleFactor *= 2;\n\t\t\t\tif (angleFactor > 1) {\n\t\t\t\t\tangleFactor = 1\n\t\t\t\t}\n\n\t\t\t\t// Look at this cool way to reduce sqrt calls to 1! :D\n\t\t\t\t// let smallerDistance = Math.sqrt(Math.min(prevToCurr.lengthSq(), currToNext.lengthSq()))\n\t\t\t\tlet controlPointDistance = controlPointDistanceFactor * angleFactor * 0.5 * (prevToCurr.length() + currToNext.length())\n\n\n\t\t\t\t// let angleFactor = prevToCurr.closestAngleTo(currToNext) * 2 / Math.PI;\n\n\t\t\t\tlet prevKeyFrameFrames = curr.frame - prev.frame;\n\t\t\t\tif (prevKeyFrameFrames <= 0) {\n\t\t\t\t\tprevKeyFrameFrames += this.frames;\n\t\t\t\t}\n\n\t\t\t\tlet currKeyFrameFrames = next.frame - curr.frame;\n\t\t\t\tif (currKeyFrameFrames <= 0) {\n\t\t\t\t\tcurrKeyFrameFrames += this.frames;\n\t\t\t\t}\n\n\t\t\t\tlet speedIncreaseSq = Math.sqrt(prevKeyFrameFrames / currKeyFrameFrames);\n\n\t\t\t\t// let controlPointDistance = Math.max(prevToCurr.length(), currToNext.length()) * controlPointDistanceFactor * angleFactor;\n\t\t\t\tlet prevControlDist = controlPointDistance;\n\t\t\t\tlet nextControlDist = controlPointDistance;\n\n\t\t\t\tif (speedIncreaseSq > 1) {\n\t\t\t\t\tnextControlDist /= speedIncreaseSq;\n\t\t\t\t\tprevControlDist *= speedIncreaseSq;\n\t\t\t\t} else {\n\t\t\t\t\tprevControlDist *= speedIncreaseSq;\n\t\t\t\t\tnextControlDist /= speedIncreaseSq;\n\t\t\t\t}\n\n\t\t\t\tlet prevNextDirection = nextValue.clone().subtract(prevValue).setLength(1);\n\n\t\t\t\tcurr.control1 = currValue.clone().subtract(prevNextDirection.clone().multiplyScalar(prevControlDist));\n\t\t\t\tcurr.control2 = currValue.clone().add(prevNextDirection.multiplyScalar(nextControlDist));\n\n\t\t\t\t// let xControl = calculateControlPointsForScalar(prev.value.x, curr.value.x, next.value.x);\n\t\t\t\t// let yControl = calculateControlPointsForScalar(prev.value.y, curr.value.y, next.value.y);\n\t\t\t\t// curr.control1 = new Vector(xControl.control1, yControl.control1);\n\t\t\t\t// curr.control2 = new Vector(xControl.control2, yControl.control2);\n\t\t\t} else if (propertyTypeName === 'color') {\n\t\t\t\tlet rControl = calculateControlPointsForScalar(prev.value.r, curr.value.r, next.value.r);\n\t\t\t\tlet gControl = calculateControlPointsForScalar(prev.value.g, curr.value.g, next.value.g);\n\t\t\t\tlet bControl = calculateControlPointsForScalar(prev.value.b, curr.value.b, next.value.b);\n\t\t\t\tcurr.control1 = new Color(color(rControl.control1), color(gControl.control1), color(bControl.control1));\n\t\t\t\tcurr.control2 = new Color(color(rControl.control2), color(gControl.control2), color(bControl.control2));\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * @param frame float because of interpolation\n\t */\n\tsetFrame(frame: number) {\n\t\tlet keyFrames = this.keyFrames;\n\t\tif (keyFrames.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet prev, next;\n\n\t\t// This is optimal enough. This for loop takes 0 time compared to setting the property value.\n\t\tfor (let i = 0; i < keyFrames.length; i++) {\n\t\t\tif (keyFrames[i].frame > frame) {\n\t\t\t\tnext = keyFrames[i];\n\t\t\t\tprev = keyFrames[(i - 1 + keyFrames.length) % keyFrames.length];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!prev) {\n\t\t\tprev = keyFrames[keyFrames.length - 1];\n\t\t\tnext = keyFrames[0];\n\t\t}\n\n\t\tlet newValue;\n\t\tif (prev === next) {\n\t\t\tnewValue = prev.value;\n\t\t} else {\n\t\t\tlet prevFrame: number = prev.frame;\n\t\t\tif (prevFrame > frame) {\n\t\t\t\tprevFrame -= this.frames;\n\t\t\t}\n\n\t\t\tlet nextFrame: number = next.frame;\n\t\t\tif (nextFrame < frame) {\n\t\t\t\tnextFrame += this.frames;\n\t\t\t}\n\n\t\t\tlet t = (frame - prevFrame) / (nextFrame - prevFrame);\n\t\t\tnewValue = interpolateBezier(prev.value, prev.control2, next.control1, next.value, t, this.animatedProperty.propertyType);\n\t\t\t// newValue = interpolateLinear(prev.value, next.value, t, this.animatedProperty.propertyType);\n\t\t}\n\n\t\tif (this.animatedProperty.value !== newValue) {\n\t\t\tthis.animatedProperty.value = newValue;\n\t\t}\n\t\treturn newValue;\n\t}\n}\n\n// Returns angle that is at most Math.PI away.\nfunction getClosestAngle(origin, target) {\n\tlet diff = target - origin;\n\tif (diff > Math.PI) {\n\t\treturn target - Math.PI * 2;\n\t} else if (diff < -Math.PI) {\n\t\treturn target + Math.PI * 2;\n\t}\n\treturn target;\n}\n\nfunction interpolateBezier(fromValue, control1Value, control2Value, targetValue, t: number, propertyType: PropertyType) {\n\tlet typeName = propertyType.type.name;\n\tif (typeName === 'float') {\n\t\tif (propertyType.getFlag(Prop.flagDegreesInEditor)) {\n\t\t\t// It's angle we are dealing with.\n\t\t\tcontrol1Value = getClosestAngle(fromValue, control1Value);\n\t\t\tcontrol2Value = getClosestAngle(fromValue, control2Value);\n\t\t\ttargetValue = getClosestAngle(fromValue, targetValue);\n\t\t}\n\t\tlet t2 = 1 - t;\n\t\treturn t2 ** 3 * fromValue +\n\t\t\t3 * t2 * t2 * t * control1Value +\n\t\t\t3 * t2 * t * t * control2Value +\n\t\t\tt ** 3 * targetValue;\n\t} else if (typeName === 'vector') {\n\t\treturn fromValue.interpolateCubic(targetValue, control1Value, control2Value, t);\n\t} else if (typeName === 'color') {\n\t\treturn fromValue.interpolateCubic(targetValue, control1Value, control2Value, t);\n\t} else {\n\t\treturn fromValue;\n\t}\n}\n\nfunction bezier(fromValue, control1Value, control2Value, targetValue, t) {\n\tlet t2 = 1 - t;\n\treturn t2 ** 3 * fromValue +\n\t\t3 * t2 * t2 * t * control1Value +\n\t\t3 * t2 * t * t * control2Value +\n\t\tt ** 3 * targetValue;\n}\nwindow.bezier = bezier\n\nfunction interpolateLinear(fromValue, targetValue, t: number, propertyType: PropertyType) {\n\tlet typeName = propertyType.type.name;\n\tif (typeName === 'float') {\n\t\tif (propertyType.getFlag(Prop.flagDegreesInEditor)) {\n\t\t\t// It's angle we are dealing with.\n\t\t\ttargetValue = getClosestAngle(fromValue, targetValue);\n\t\t}\n\t\treturn fromValue + t * (targetValue - fromValue);\n\t} else if (typeName === 'vector') {\n\t\treturn fromValue.interpolateLinear(targetValue, t);\n\t} else if (typeName === 'color') {\n\t\treturn fromValue.interpolateLinear(targetValue, t);\n\t} else {\n\t\treturn fromValue;\n\t}\n}\n\nfunction calculateControlPointsForScalar(prev: number, curr: number, next: number) {\n\treturn {\n\t\tcontrol1: curr + (prev - next) / 3,\n\t\tcontrol2: curr + (next - prev) / 3\n\t}\n\n\tif (curr >= prev && curr >= next || curr <= prev && curr <= next) {\n\t\treturn {\n\t\t\tcontrol1: curr,\n\t\t\tcontrol2: curr\n\t\t};\n\t}\n\n\tlet prevDist = Math.abs(curr - prev);\n\tlet nextDist = Math.abs(next - curr);\n\n\tlet prevNextDirection = (next - prev) < 0 ? -1 : 1;\n\n\treturn {\n\t\tcontrol1: curr - prevNextDirection * prevDist * controlPointDistanceFactor,\n\t\tcontrol2: curr + prevNextDirection * nextDist * controlPointDistanceFactor,\n\t};\n}\n\nfunction calculateControlPointsForScalar2(prev: number, curr: number, next: number) {\n\tlet prevDist = Math.abs(curr - prev);\n\tlet nextDist = Math.abs(next - curr);\n\tlet dist = Math.min(prevDist, nextDist);\n\n\tlet prevNextDirection = (next - prev) < 0 ? -1 : 1;\n\n\treturn {\n\t\tcontrol1: curr - prevNextDirection * prevDist * controlPointDistanceFactor,\n\t\tcontrol2: curr + prevNextDirection * nextDist * controlPointDistanceFactor,\n\t};\n}\n","/*\n milliseconds: how often callback can be called\n callbackLimitMode:\n \t- instant: if it has been quiet, call callback() instantly\n \t- soon: if it has been quiet, call callback() instantly after current code loop\n \t- next: if it has been quiet, call callback() after waiting milliseconds.\n\n When calling the callback, limitMode can be overridden: func(callLimitMode);\n */\nexport function limit(milliseconds, callbackLimitMode = 'soon', callback) {\n\tif (!['instant', 'soon', 'next'].includes(callbackLimitMode))\n\t\tthrow new Error('Invalid callbackLimitMode');\n\n\tlet queueTimeout = null; // non-null when call is in queue\n\tlet lastCall = 0; // last time when callback was called\n\n\tfunction callCallback() {\n\t\tlastCall = Date.now();\n\t\tqueueTimeout = null;\n\t\tcallback();\n\t}\n\tfunction callCallbackWithDelay(delayMilliseconds) {\n\t\tqueueTimeout = setTimeout(callCallback, delayMilliseconds);\n\t}\n\n\treturn function(callLimitMode?) {\n\t\tif (queueTimeout)\n\t\t\treturn;\n\n\t\tlet timeToNextPossibleCall = lastCall + milliseconds - Date.now();\n\t\tif (timeToNextPossibleCall > 0) {\n\t\t\tcallCallbackWithDelay(timeToNextPossibleCall);\n\t\t} else {\n\t\t\tlet mode = callLimitMode || callbackLimitMode;\n\t\t\tif (mode === 'instant')\n\t\t\t\tcallCallback();\n\t\t\telse if (mode === 'soon')\n\t\t\t\tcallCallbackWithDelay(0)\n\t\t\telse if (mode === 'next')\n\t\t\t\tcallCallbackWithDelay(milliseconds)\n\t\t}\n\t}\n}\n","import {\n\texecuteExternal,\n\tchangeType,\n\tChange\n} from './change'\nimport Serializable from './serializable';\nimport {game} from './game';\nimport {limit} from '../util/callLimiter';\nimport {stickyNonModalErrorPopup} from \"../util/popup\";\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nimport Property from './property';\nimport { GameEvent, globalEventDispatcher } from './eventDispatcher';\nimport { isServer } from '../util/environment';\n\nlet options = {\n\tcontext: null, // 'play' or 'edit'. This is communicated to server. Doesn't affect client.\n\tserverToClientEnabled: true,\n\tclientToServerEnabled: false\n};\n\nexport function configureNetSync(_options) {\n\toptions = Object.assign(options, _options);\n}\n\nlet changes = [];\nlet valueChanges = {}; // id => change\n\nfunction isInSceneTree(change) {\n\treturn change.reference._rootType === 'sce';\n}\n\nfunction getQueryVariable(variable) {\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split('=');\n\t\tif (decodeURIComponent(pair[0]) == variable) {\n\t\t\treturn decodeURIComponent(pair[1]);\n\t\t}\n\t}\n\tconsole.log('Query variable %s not found', variable);\n}\n\nfunction changeReceivedOverNet(packedChanges) {\n\tif (!options.serverToClientEnabled)\n\t\treturn;\n\tpackedChanges.forEach(change => {\n\t\tchange = unpackChange(change);\n\t\tif (change) {\n\t\t\texecuteChange(change);\n\t\t}\n\t});\n}\nfunction gameReceivedOverNet(gameData) {\n\tconsole.log('receive gameData', gameData);\n\tif (!gameData)\n\t\treturn console.error('Game data was not received');\n\ttry {\n\t\texecuteExternal(() => {\n\t\t\tSerializable.fromJSON(gameData);\n\t\t\tglobalEventDispatcher.dispatch(GameEvent.GLOBAL_GAME_CREATED, game);\n\t\t});\n\t\tlocalStorage.openEditPlayGameId = gameData.id;\n\t\t// location.replace(`${location.origin}${location.pathname}?gameId=${gameData.id}`);\n\t\thistory.replaceState({}, null, `?gameId=${gameData.id}`);\n\t} catch(e) {\n\t\tconsole.error('Game is corrupt.', e);\n\t\tstickyNonModalErrorPopup('Game is corrupt.');\n\t}\n}\n\nglobalEventDispatcher.listen(GameEvent.GLOBAL_CHANGE_OCCURED, change => {\n\tif (change.external || !options.clientToServerEnabled)\n\t\treturn; // Don't send a change that you have received.\n\n\tif (isInSceneTree(change)) // Don't sync scene\n\t\treturn;\n\n\tif (change.type === changeType.setPropertyValue) {\n\t\tlet duplicateChange = valueChanges[change.id];\n\t\tif (duplicateChange) {\n\t\t\tchanges.splice(changes.indexOf(duplicateChange), 1);\n\t\t}\n\t\tvalueChanges[change.id] = change;\n\t}\n\tchanges.push(change);\n\n\tif (sendChanges)\n\t\tsendChanges();\n});\n\nfunction parseSocketMessage(message) {\n\tlet type = message.split(' ')[0];\n\tlet body = message.substring(type.length + 1);\n\tif (body.length > 0)\n\t\tbody = JSON.parse(body);\n\n\tconsole.log('parseSocketMessage', type, body);\n\n\treturn {\n\t\ttype,\n\t\tbody\n\t};\n}\n\nfunction sendSocketMessage(eventName, data) {\n\tif (!socket)\n\t\treturn console.log('Could not send', eventName);\n\n\tif (eventName)\n\t\tsocket.emit(eventName, data);\n\telse\n\t\tsocket.emit(data);\n}\n\nlet listeners = {\n\tdata(result) {\n\t\tlet {profile, gameData, editAccess} = result;\n\t\tlocalStorage.openEditPlayUserId = profile.id;\n\t\tlocalStorage.openEditPlayUserToken = profile.userToken;\n\n\t\tif (!editAccess) {\n\t\t\tglobalEventDispatcher.dispatch('noEditAccess');\n\t\t}\n\n\t\tdelete profile.userToken;\n\t\twindow.user = profile;\n\n\t\tgameReceivedOverNet(gameData);\n\t},\n\tidentifyYourself() {\n\t\tif (game)\n\t\t\treturn location.reload();\n\n\t\tlet gameId = getQueryVariable('gameId') || localStorage.openEditPlayGameId;\n\t\tlet userId = localStorage.openEditPlayUserId; // if doesn't exist, server will create one\n\t\tlet userToken = localStorage.openEditPlayUserToken; // if doesn't exist, server will create one\n\t\tlet context = options.context;\n\t\tsendSocketMessage('identify', {userId, userToken, gameId, context});\n\t},\n\terrorMessage(result) {\n\t\tlet {message, isFatal, data} = result;\n\t\tconsole.error(`Server sent ${isFatal ? 'FATAL ERROR' : 'error'}:`, message, data);\n\t\tif (isFatal) {\n\t\t\tstickyNonModalErrorPopup(message);\n\t\t\t// document.body.textContent = message;\n\t\t}\n\t}\n};\n\nlet sendChanges = limit(200, 'soon', () => {\n\tif (!socket || changes.length === 0 || !options.clientToServerEnabled)\n\t\treturn;\n\n\tlet packedChanges = changes.map(packChange);\n\tchanges.length = 0;\n\tvalueChanges = {};\n\tconsole.log('send change', packedChanges);\n\tsendSocketMessage('', packedChanges);\n});\n\nsetTimeout(() => {\n\tgameReceivedOverNet({\n\t\tid: 'gam_dumb',\n\t\tc: [{\"id\":\"prtrQ10Xvlt26lKIsrk\",\"c\":[{\"id\":\"cdaP5MbwTHjlNTtsbOf\",\"c\":[{\"id\":\"prp7GBI7ptGoOB0czCf\",\"v\":1,\"n\":\"rotationalDrag\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdalev0lEyN36HMU1yq\",\"cid\":\"_CharacterController\",\"n\":\"CharacterController\"},{\"id\":\"cdatyGx2WHvS86caySN\",\"cid\":\"cidhFIVThaem3\",\"n\":\"Shape\"},{\"id\":\"prp_testPrototypeName\",\"v\":\"Actor\",\"n\":\"name\"}],\"si\":\"M19cq\"},{\"id\":\"prte2f3KiHuM0sF8fGr\",\"c\":[{\"id\":\"cdaUTyhrNmhJgbj3hWz\",\"c\":[{\"id\":\"prptvjNMPCRfYOB18By\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdayHf6lKxMHybf1UDm\",\"cid\":\"cidAqAv86xu0G\",\"n\":\"Shape\"},{\"id\":\"prpQUR3Ei2tKQ10XL40\",\"v\":\"Static\",\"n\":\"name\"}],\"si\":\"XaLeF\"},{\"id\":\"prtTsDqevlt2okzITrF\",\"c\":[{\"id\":\"cda9QvRA0RtxAJ2Y73E\",\"cid\":\"cidPNowJEkdoK\",\"n\":\"Shape\"},{\"id\":\"cdaGVd0cK6exGIvPlm8\",\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"prpcCUqrxeQMOamqIbc\",\"v\":\"Dynamic\",\"n\":\"name\"}],\"si\":\"OXlXy\"},{\"id\":\"lvloRefeYW72V69c3Q1\",\"c\":[{\"id\":\"eprBsqCAnWgyaoVfyiM\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaEpszsej3gKpA0ZaQ\",\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"},{\"id\":\"cdadevJLE9pHC8ITKrc\",\"c\":[{\"id\":\"prpHBLerc9GTmQe5JBO\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"}],\"n\":\"Floor\",\"p\":{\"x\":-182.1158,\"y\":78.5093},\"s\":{\"x\":4.0126,\"y\":0.5846}},{\"id\":\"eprCyIXOLETKXtrmRzf\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaQXPj6dFUQBtbOREZ\",\"cid\":\"_CharacterController\",\"n\":\"CharacterController\"},{\"id\":\"cdaRpjAVXeYHIAvRPtQ\",\"c\":[{\"id\":\"prpDPLnUOytA2bb2gXF\",\"v\":\"circle\",\"n\":\"type\"}],\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"},{\"id\":\"cdazw3hJYQKgeidpVbB\",\"c\":[{\"id\":\"prpwFGr3IBoruOTBIbr\",\"v\":\"dynamic\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"}],\"n\":\"guy\",\"p\":{\"x\":-72.9377,\"y\":-12.0532}},{\"id\":\"eprTK6vWjNyLCU2lmC3\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaFtZvXSTpnde2mCaw\",\"c\":[{\"id\":\"prpHcFA2HUNovmcJw7D\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdaw8rjFsM9mw8jMbEz\",\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"}],\"n\":\"Floor\",\"p\":{\"x\":-254.0626,\"y\":33.7312},\"s\":{\"x\":4.0126,\"y\":0.5846}},{\"id\":\"epra8MzE4b0YWUS8bAu\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaZr6GMN5zlVAHCl2X\",\"c\":[{\"id\":\"prpRxYyZV8HU42ht82h\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdarBCjhtof8Sy9pDdt\",\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"}],\"n\":\"Floor\",\"p\":{\"x\":-75.4687,\"y\":42.7656},\"s\":{\"x\":4.0126,\"y\":0.5846}},{\"id\":\"prpfI8ByaPzgGnGavwE\",\"v\":\"Level 1\",\"n\":\"name\"}]}]\n\t})\n}, 0)\n\nlet socket;\nfunction connect() {\n\tif (isServer || 'Just make this work without a server') {\n\t\t// Electron app, not using sockets\n\t\tgameReceivedOverNet({\n\t\t\tid: 'gam_dumb',\n\t\t\tc: [{\"id\":\"prtrQ10Xvlt26lKIsrk\",\"c\":[{\"id\":\"cdaP5MbwTHjlNTtsbOf\",\"c\":[{\"id\":\"prp7GBI7ptGoOB0czCf\",\"v\":1,\"n\":\"rotationalDrag\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdalev0lEyN36HMU1yq\",\"cid\":\"_CharacterController\",\"n\":\"CharacterController\"},{\"id\":\"cdatyGx2WHvS86caySN\",\"cid\":\"cidhFIVThaem3\",\"n\":\"Shape\"},{\"id\":\"prp_testPrototypeName\",\"v\":\"Actor\",\"n\":\"name\"}],\"si\":\"M19cq\"},{\"id\":\"prte2f3KiHuM0sF8fGr\",\"c\":[{\"id\":\"cdaUTyhrNmhJgbj3hWz\",\"c\":[{\"id\":\"prptvjNMPCRfYOB18By\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdayHf6lKxMHybf1UDm\",\"cid\":\"cidAqAv86xu0G\",\"n\":\"Shape\"},{\"id\":\"prpQUR3Ei2tKQ10XL40\",\"v\":\"Static\",\"n\":\"name\"}],\"si\":\"XaLeF\"},{\"id\":\"prtTsDqevlt2okzITrF\",\"c\":[{\"id\":\"cda9QvRA0RtxAJ2Y73E\",\"cid\":\"cidPNowJEkdoK\",\"n\":\"Shape\"},{\"id\":\"cdaGVd0cK6exGIvPlm8\",\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"prpcCUqrxeQMOamqIbc\",\"v\":\"Dynamic\",\"n\":\"name\"}],\"si\":\"OXlXy\"},{\"id\":\"lvloRefeYW72V69c3Q1\",\"c\":[{\"id\":\"eprBsqCAnWgyaoVfyiM\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaEpszsej3gKpA0ZaQ\",\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"},{\"id\":\"cdadevJLE9pHC8ITKrc\",\"c\":[{\"id\":\"prpHBLerc9GTmQe5JBO\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"}],\"n\":\"Floor\",\"p\":{\"x\":-182.1158,\"y\":78.5093},\"s\":{\"x\":4.0126,\"y\":0.5846}},{\"id\":\"eprCyIXOLETKXtrmRzf\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaQXPj6dFUQBtbOREZ\",\"cid\":\"_CharacterController\",\"n\":\"CharacterController\"},{\"id\":\"cdaRpjAVXeYHIAvRPtQ\",\"c\":[{\"id\":\"prpDPLnUOytA2bb2gXF\",\"v\":\"circle\",\"n\":\"type\"}],\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"},{\"id\":\"cdazw3hJYQKgeidpVbB\",\"c\":[{\"id\":\"prpwFGr3IBoruOTBIbr\",\"v\":\"dynamic\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"}],\"n\":\"guy\",\"p\":{\"x\":-72.9377,\"y\":-12.0532}},{\"id\":\"eprTK6vWjNyLCU2lmC3\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaFtZvXSTpnde2mCaw\",\"c\":[{\"id\":\"prpHcFA2HUNovmcJw7D\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdaw8rjFsM9mw8jMbEz\",\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"}],\"n\":\"Floor\",\"p\":{\"x\":-254.0626,\"y\":33.7312},\"s\":{\"x\":4.0126,\"y\":0.5846}},{\"id\":\"epra8MzE4b0YWUS8bAu\",\"si\":\"GxMPD\",\"c\":[{\"id\":\"cdaZr6GMN5zlVAHCl2X\",\"c\":[{\"id\":\"prpRxYyZV8HU42ht82h\",\"v\":\"static\",\"n\":\"type\"}],\"cid\":\"_Physics\",\"n\":\"Physics\"},{\"id\":\"cdarBCjhtof8Sy9pDdt\",\"cid\":\"cidW8yFNDGQX9\",\"n\":\"Shape\"}],\"n\":\"Floor\",\"p\":{\"x\":-75.4687,\"y\":42.7656},\"s\":{\"x\":4.0126,\"y\":0.5846}},{\"id\":\"prpfI8ByaPzgGnGavwE\",\"v\":\"Level 1\",\"n\":\"name\"}]}]\n\t\t})\n\n\t\t// TODO: Save stuff to file system\n\n\t\treturn\n\t}\n\n\tlet io = window['io'];\n\tif (!io) {\n\t\treturn console.error('socket.io not defined after window load.');\n\t}\n\n\tsocket = new io();\n\tsocket.on('connect', () => {\n\t\tsocket.onevent = packet => {\n\t\t\tlet param1 = packet.data[0];\n\t\t\tif (typeof param1 === 'string') {\n\t\t\t\tlisteners[param1](packet.data[1]);\n\t\t\t} else {\n\t\t\t\t// Optimized change-event\n\t\t\t\tchangeReceivedOverNet(param1);\n\t\t\t}\n\t\t};\n\t\tsocket.on('disconnect', () => {\n\t\t\tconsole.warn('Disconnected!');\n\t\t\tstickyNonModalErrorPopup('Disconnected!');\n\t\t\toptions.serverToClientEnabled = false;\n\t\t\toptions.clientToServerEnabled = false;\n\t\t});\n\t});\n}\n// window.addEventListener('load', connect);\n\nlet keyToShortKey = {\n\tid: 'i', // obj.id\n\ttype: 't', // changeType.*\n\tvalue: 'v', // value after toJSON\n\tparentId: 'p' // obj._parent.id\n};\nlet shortKeyToKey = {};\nObject.keys(keyToShortKey).forEach(k => {\n\tshortKeyToKey[keyToShortKey[k]] = k;\n});\n\nfunction packChange(change) {\n\tif (change.packedChange)\n\t\treturn change.packedChange; // optimization\n\n\tlet packed = {};\n\ttry {\n\t\tif (change.parent)\n\t\t\tchange.parentId = change.parent.id;\n\n\t\tif (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.reference) {\n\t\t\t\tchange.value = change.reference.toJSON();\n\t\t\t} else {\n\t\t\t\tassert(false, 'invalid change of type addSerializableToTree', change);\n\t\t\t}\n\t\t} else if (change.value !== undefined) {\n\t\t\tchange.value = change.reference.propertyType.type.toJSON(change.value);\n\t\t}\n\n\t\tObject.keys(keyToShortKey).forEach(key => {\n\t\t\tif (change[key] !== undefined) {\n\t\t\t\tif (key === 'type' && change[key] === changeType.setPropertyValue) return; // optimize most common type\n\t\t\t\tpacked[keyToShortKey[key]] = change[key];\n\t\t\t}\n\t\t});\n\t} catch (e) {\n\t\tconsole.log('PACK ERROR', e);\n\t}\n\treturn packed;\n}\n\nfunction unpackChange(packedChange): Change {\n\tlet change: any = {\n\t\tpackedChange // optimization\n\t};\n\tObject.keys(packedChange).forEach(shortKey => {\n\t\tlet key = shortKeyToKey[shortKey];\n\t\tchange[key] = packedChange[shortKey];\n\t});\n\tif (!change.type)\n\t\tchange.type = changeType.setPropertyValue;\n\n\tif (change.type === changeType.addSerializableToTree) {\n\t\t// reference does not exist because it has not been created yet\n\t\tchange.id = change.value.id;\n\t} else {\n\t\tchange.reference = getSerializable(change.id);\n\t\tif (change.reference) {\n\t\t\tchange.id = change.reference.id;\n\t\t} else {\n\t\t\tconsole.error('received a change with unknown id', change, 'packed:', packedChange);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (change.parentId)\n\t\tchange.parent = getSerializable(change.parentId);\n\treturn change as Change;\n}\n\nfunction executeChange(change: Change) {\n\tlet newScene;\n\n\texecuteExternal(() => {\n\t\tif (change.type === changeType.setPropertyValue) {\n\t\t\t(change.reference as Property).value = (change.reference as Property).propertyType.type.fromJSON(change.value);\n\t\t} else if (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.parent) {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value);\n\t\t\t\tchange.parent.addChild(obj);\n\t\t\t\tif (obj.threeLetterType === 'ent') {\n\t\t\t\t\tobj.localMaster = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value); // Scene does not need a parent\n\t\t\t\tif (obj.threeLetterType === 'sce')\n\t\t\t\t\tnewScene = obj;\n\t\t\t}\n\t\t} else if (change.type === changeType.deleteAllChildren) {\n\t\t\tchange.reference.deleteChildren();\n\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\tchange.reference.delete();\n\t\t} else if (change.type === changeType.move) {\n\t\t\tchange.reference.move(change.parent);\n\t\t}\n\t});\n\n\tif (newScene)\n\t\tnewScene.play();\n}\n","// DOM / ReDom event system\n\nexport function redomDispatch(view, type, data?) {\n\tconst el = view === window ? view : view.el || view;\n\tconst debug = 'Debug info ' + new Error().stack;\n\tel.dispatchEvent(new CustomEvent(type, {\n\t\tdetail: { data, debug, view },\n\t\tbubbles: true\n\t}));\n}\nexport function redomListen(view, type, handler) {\n\tlet el = view === window ? view : view.el || view;\n\tel.addEventListener(type, event => {\n\t\tif (event instanceof CustomEvent)\n\t\t\thandler(event.detail.data, event.detail.view);\n\t\telse\n\t\t\thandler(event);\n\t});\n}\n","let options = null;\n\nfunction loadOptions() {\n\tif (!options) {\n\t\ttry {\n\t\t\toptions = JSON.parse(localStorage['openEditPlayOptions']);\n\t\t} catch (e) {\n\t\t\t// default options\n\t\t\toptions = {\n\t\t\t\tmoduleContainerPacked_bottom: true\n\t\t\t};\n\t\t}\n\t}\n}\n\nexport function setOption(id, stringValue) {\n\tloadOptions();\n\toptions[id] = stringValue;\n\ttry {\n\t\tlocalStorage['openEditPlayOptions'] = JSON.stringify(options);\n\t} catch (e) {\n\t}\n}\n\nexport function getOption(id) {\n\tloadOptions();\n\treturn options[id];\n}\n","import { el, list, mount, List, RedomComponent } from 'redom';\nimport { redomDispatch, redomListen } from '../../util/redomEvents';\nimport * as performance from '../../util/performance';\nimport Module from '../module/module';\nimport { editorEventDispacher } from '../editorEventDispatcher';\nimport { getOption, setOption } from '../util/options';\n\nexport default class ModuleContainer {\n\tel: HTMLElement;\n\tpackButtonEnabled: boolean;\n\tpackButton: HTMLElement;\n\ttabs: List;\n\tmoduleElements: HTMLElement;\n\tmodules: Array<Module>;\n\n\tconstructor(moduleContainerName = 'unknownClass.anotherClass', packButtonIcon = 'fa-chevron-left') {\n\t\tthis.modules = [];\n\t\tthis.packButtonEnabled = !!packButtonIcon;\n\t\tthis.el = el(`div.moduleContainer.packable.${moduleContainerName}`,\n\t\t\tthis.packButton = packButtonIcon && el(`i.packButton.button.iconButton.fas.${packButtonIcon}`),\n\t\t\tthis.tabs = list('div.tabs.select-none', ModuleTab),\n\t\t\tthis.moduleElements = el('div.moduleElements')\n\t\t);\n\n\t\tif (packButtonIcon) {\n\t\t\tlet packId = 'moduleContainerPacked_' + moduleContainerName;\n\t\t\tif (getOption(packId)) {\n\t\t\t\tthis.el.classList.add('packed');\n\t\t\t}\n\n\t\t\tthis.el.onclick = () => {\n\t\t\t\tsetOption(packId, '');\n\t\t\t\teditorEventDispacher.dispatch('layoutResize');\n\t\t\t\tthis.el.classList.contains('packed') && this.el.classList.remove('packed');\n\t\t\t\tthis.update();\n\t\t\t\treturn;\n\t\t\t};\n\t\t\tthis.packButton.onclick = e => {\n\t\t\t\tthis.el.classList.add('packed');\n\t\t\t\teditorEventDispacher.dispatch('layoutResize');\n\t\t\t\tsetOption(packId, 'true');\n\t\t\t\te.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\teditorEventDispacher.listen('registerModule_' + moduleContainerName.split('.')[0], (moduleClass, editor) => {\n\t\t\tlet module = new moduleClass(editor);\n\t\t\tmodule.el.classList.add('module-' + module.id);\n\t\t\tmodule.moduleContainer = this;\n\t\t\tthis.modules.push(module);\n\t\t\tthis.el.classList.remove('noModules');\n\t\t\tif (this.modules.length !== 1) {\n\t\t\t\tmodule._hide();\n\t\t\t}\n\t\t\tmount(this.moduleElements, module.el);\n\t\t\tthis._updateTabs();\n\t\t});\n\n\t\tredomListen(this, 'moduleClicked', module => {\n\t\t\tthis.activateModule(module);\n\t\t});\n\n\t\tthis._updateTabs();\n\t}\n\tupdate() {\n\t\tthis.modules.forEach(m => {\n\t\t\tlet performanceName = 'Editor: ' + m.id[0].toUpperCase() + m.id.substring(1);\n\t\t\tperformance.start(performanceName);\n\t\t\tif (m.update() !== false) {\n\t\t\t\tthis._enableModule(m);\n\t\t\t} else\n\t\t\t\tthis._disableModule(m);\n\t\t\tperformance.stop(performanceName);\n\t\t});\n\t\tthis._updateTabs();\n\t}\n\t_updateTabs() {\n\t\tif (!this.tabs) return;\n\n\t\tthis.tabs.update(this.modules);\n\n\t\tif (!this.packButtonEnabled && this.modules.length <= 1)\n\t\t\tthis.tabs.el.style.display = 'none';\n\t\telse\n\t\t\tthis.tabs.el.style.display = 'block';\n\n\t\tlet noModules = !this.modules.find(m => m._enabled);\n\t\tthis.el.classList.toggle('noModules', noModules);\n\t}\n\tactivateModule(module, unpackModuleView = true, ...args) {\n\t\tif (unpackModuleView) {\n\t\t\tthis.el.classList.remove('packed');\n\t\t\teditorEventDispacher.dispatch('layoutResize');\n\t\t}\n\t\tthis._activateModule(module, args);\n\t}\n\tactivateOneOfModules(modules, unpackModuleView = true, ...args) {\n\t\tif (unpackModuleView) {\n\t\t\tthis.el.classList.remove('packed');\n\t\t\teditorEventDispacher.dispatch('layoutResize');\n\t\t}\n\n\t\tfor (let i = 0; i < this.modules.length; ++i) {\n\t\t\tlet m = this.modules[i];\n\t\t\tif (m._selected && modules.indexOf(m) >= 0) {\n\t\t\t\t// Already selected\n\t\t\t\tif (args.length > 0) {\n\t\t\t\t\tthis.activateModule(m, unpackModuleView, ...args);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < this.modules.length; ++i) {\n\t\t\tlet m = this.modules[i];\n\t\t\tif (m._enabled && modules.indexOf(m) >= 0)\n\t\t\t\treturn this.activateModule(m, unpackModuleView, ...args);\n\t\t}\n\t}\n\t_activateModule(module, args) {\n\t\tthis.modules.forEach(m => {\n\t\t\tif (m !== module) {\n\t\t\t\tm._hide();\n\t\t\t}\n\t\t});\n\t\tmodule._enabled = true;\n\t\tmodule._show();\n\t\tthis._updateTabs();\n\t\tmodule.update();\n\t\tmodule.activate(...args);\n\t}\n\t_enableModule(module) {\n\t\tif (!module._enabled) {\n\t\t\tmodule._enabled = true;\n\t\t\tlet selectedModule = this.modules.find(m => m._selected);\n\t\t\tif (!selectedModule)\n\t\t\t\tthis._activateModule(module);\n\t\t\tthis._updateTabs();\n\t\t}\n\t}\n\t_disableModule(module) {\n\t\tif (module._enabled) {\n\t\t\tmodule._enabled = false;\n\t\t\tif (module._selected) {\n\t\t\t\tmodule._selected = false;\n\t\t\t\tlet enabledModule = this.modules.find(m => m._enabled);\n\t\t\t\tif (enabledModule)\n\t\t\t\t\tthis._activateModule(enabledModule);\n\t\t\t}\n\t\t\tmodule._hide();\n\t\t\tthis._updateTabs();\n\t\t}\n\t}\n\tisPacked() {\n\t\treturn this.el.classList.contains('packed');\n\t}\n}\n\nclass ModuleTab implements RedomComponent {\n\tel: HTMLElement;\n\tmodule: Module;\n\t_sel: boolean;\n\t_ena: boolean;\n\n\tconstructor() {\n\t\tthis.el = el('span.moduleTab.button');\n\t\tthis.module = null;\n\t\tthis.el.onclick = () => {\n\t\t\tredomDispatch(this, 'moduleClicked', this.module);\n\t\t};\n\t}\n\tupdate(module) {\n\t\tif (this.module === module && this._sel === module._selected && this._ena === module._enabled)\n\t\t\treturn;\n\n\t\tthis.el.setAttribute('moduleid', module.id);\n\n\t\tthis.module = module;\n\t\tif (this.el.innerHTML !== module.name)\n\t\t\tthis.el.innerHTML = module.name;\n\n\t\tthis._sel = module._selected;\n\t\tthis._ena = module._enabled;\n\n\t\tthis.el.classList.toggle('moduleSelected', module._selected);\n\t\tthis.el.classList.toggle('moduleEnabled', module._enabled);\n\t}\n}\n","import { el, list, mount, RedomComponent } from 'redom';\nimport ModuleContainer from './moduleContainer';\n\nexport default class Layout implements RedomComponent {\n\tel: HTMLElement;\n\tmoduleContainers: Array<ModuleContainer> = [];\n\n\tconstructor() {\n\t\tlet addContainer = (...args) => {\n\t\t\tlet container = new ModuleContainer(...args);\n\t\t\tthis.moduleContainers.push(container);\n\t\t\treturn container;\n\t\t};\n\t\tthis.el = el('div.editorLayout',\n\t\t\tel('div.nonRight',\n\t\t\t\taddContainer('top', null),\n\t\t\t\tel('div.bottomLeft',\n\t\t\t\t\taddContainer('left', 'fa-chevron-left'),\n\t\t\t\t\tel('div.middle',\n\t\t\t\t\t\taddContainer('center', null),\n\t\t\t\t\t\taddContainer('bottom', 'fa-chevron-down')\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t),\n\t\t\taddContainer('right', 'fa-chevron-right')\n\t\t);\n\t}\n\tupdate() {\n\t\tthis.moduleContainers.forEach(mc => mc.update());\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport ModuleContainer from '../layout/moduleContainer';\nimport { editorEventDispacher } from '../editorEventDispatcher';\n\nlet moduleIdToModule: { [moduleId: string]: Module } = {};\n\nexport default class Module {\n\tid: string;\n\ttype: string;\n\tname: string;\n\n\t/**\n\t * Wether this module is selected in this module container.\n\t */\n\t_selected: boolean;\n\n\t/**\n\t * Wether this module can be accessed in this module container.\n\t */\n\t_enabled: boolean;\n\n\tel: HTMLElement;\n\tmoduleContainer: ModuleContainer;\n\n\tconstructor() {\n\t\tthis.type = 'module';\n\t\tthis.name = this.name || 'Module';\n\t\tthis.id = this.id || 'module';\n\t\tthis.el = el('div.module');\n\t\tthis._selected = true;\n\t\tthis._enabled = true;\n\n\t\t// Timeout so that module constructor has time to set this.id after calling super.\n\t\tsetTimeout(() => {\n\t\t\tmoduleIdToModule[this.id] = this;\n\t\t});\n\t}\n\taddElements(...elements) {\n\t\tfor (let element of elements) {\n\t\t\tmount(this.el, element);\n\t\t}\n\t}\n\t// Called when this module is opened. Other modules can call Module.activateModule('Module', ...args);\n\tactivate() {\n\t}\n\t// Called when changes happen. return false to hide from ui\n\tupdate() {\n\t}\n\t_show() {\n\t\tthis.el.classList.remove('hidden');\n\t\tthis._selected = true;\n\t\tthis._enabled = true;\n\t}\n\t_hide() {\n\t\tthis.el.classList.add('hidden');\n\t\tthis._selected = false;\n\t}\n\n\t/**\n\t * Modules must be in same moduleContainer\n\t * You might want to first call editor update to first enable the modules you want to activate.\n\t*/\n\tstatic activateModule(moduleId, unpackModuleView = true, ...args) {\n\t\tmoduleIdToModule[moduleId].moduleContainer.activateModule(moduleIdToModule[moduleId], unpackModuleView, ...args);\n\t};\n\t/**\n\t * Modules must be in same moduleContainer\n\t * You might want to first call editor update to first enable the modules you want to activate.\n\t*/\n\tstatic activateOneOfModules(moduleIds: string[], unpackModuleView = true, ...args) {\n\t\tmoduleIdToModule[moduleIds[0]].moduleContainer.activateOneOfModules(moduleIds.map(mId => moduleIdToModule[mId]), unpackModuleView, ...args);\n\t};\n\tstatic packModuleContainer(moduleContainerName) {\n\t\tdocument.querySelectorAll(`.moduleContainer.${moduleContainerName}`)[0].classList.add('packed');\n\t};\n\tstatic unpackModuleContainer(moduleContainerName) {\n\t\tdocument.querySelectorAll(`.moduleContainer.${moduleContainerName}`)[0].classList.remove('packed');\n\t};\n\n\t// moduleContainerName = left | middle | right | bottom\n\tstatic register(moduleClass, moduleContainerName) {\n\t\tregisterPromise = registerPromise.then(() => {\n\t\t\teditorEventDispacher.dispatch('registerModule_' + moduleContainerName, moduleClass);\n\t\t});\n\t};\n}\n\n\n\nlet registerPromise: Promise<void> = new Promise(function (resolve) {\n\teditorEventDispacher.listen('registerModules', function () {\n\t\tregisterPromise.then(() => {\n\t\t\teditorEventDispacher.dispatch('modulesRegistered');\n\t\t});\n\t\tresolve();\n\t});\n});\n","import Serializable from \"../core/serializable\";\nimport assert from \"../util/assert\";\nimport { editorEventDispacher, EditorEvent } from \"./editorEventDispatcher\";\nimport Level from \"../core/level\";\n\ntype EditorSelection = { type: string, items: Serializable[], focused: boolean, getText: () => string };\n\n\nexport let selectedLevel: Level = null;\nexport let selectedTool: string = null;\nexport let editorSelection: EditorSelection = {\n    type: 'none',\n    items: [],\n    focused: false,\n    getText: function() {\n        let itemCount = this.items.length;\n        if (itemCount < 1) {\n            return null;\n        }\n        let typeName = serializableNames[this.type][itemCount === 1 ? 0 : 1];\n        let text = `${itemCount} ${typeName}`;\n        if (itemCount === 1) {\n            let item = this.items[0] as Serializable;\n            text += ` \"${item.makeUpAName()}\"`;\n        }\n        return text;\n    }\n};\n\nlet serializableNames = {\n    gam: ['game', 'games'],\n    sce: ['scene', 'scenes'],\n    prt: ['prototype', 'prototypes'],\n    prp: ['property', 'properties'],\n    cda: ['component', 'components'],\n    com: ['component instance', 'component instances'],\n    epr: ['object', 'objects'],\n    ent: ['object instance', 'object instances'],\n    lvl: ['level', 'levels'],\n    pfa: ['prefab', 'prefabs'],\n    mixed: ['mixed', 'mixeds'],\n};\n\n/**\n *\n * @param items These items will be selected in editor.\n * @param origin\n */\nexport function selectInEditor(items: Array<Serializable> | Serializable, origin: any) {\n    if (!items)\n        items = [];\n    else if (!Array.isArray(items))\n        items = [items];\n\n    assert(items.filter(item => item == null).length === 0, 'Can not select null');\n    assert(origin, 'origin must be given when selecting in editor');\n\n    editorSelection.items = [].concat(items);\n\n    let types = Array.from(new Set(items.map(i => i.threeLetterType)));\n    if (types.length === 0)\n        editorSelection.type = 'none';\n    else if (types.length === 1)\n        editorSelection.type = types[0];\n    else\n        editorSelection.type = 'mixed';\n\n    editorSelection.focused = true;\n\n    editorEventDispacher.dispatch(EditorEvent.EDITOR_CHANGE, {\n        type: 'editorSelection',\n        reference: editorSelection,\n        origin\n    });\n}\n\nexport function unfocus() {\n    editorSelection.focused = false;\n    editorEventDispacher.dispatch(EditorEvent.EDITOR_UNFOCUS);\n}\n\nexport function setLevel(level: Level) {\n    if (level && level.threeLetterType === 'lvl')\n        selectedLevel = level;\n    else\n        selectedLevel = null;\n\n    selectInEditor([], 'editor selection');\n    editorEventDispacher.dispatch('setLevel', selectedLevel);\n}\n\nexport let sceneToolName = 'multiTool'; // in top bar\nexport function setSceneTool(newToolName: string) {\n    if (sceneToolName !== newToolName) {\n        sceneToolName = newToolName;\n        editorEventDispacher.dispatch(EditorEvent.EDITOR_SCENE_TOOL_CHANGED, newToolName);\n    }\n}\n\neditorEventDispacher.listen(EditorEvent.EDITOR_LOADED, () => {\n    editorEventDispacher.dispatch(EditorEvent.EDITOR_REGISTER_HELP_VARIABLE, 'editorSelection', editorSelection);\n});\n","import { editorEventDispacher, EditorEvent } from \"./editorEventDispatcher\";\nimport EntityPrototype from \"../core/entityPrototype\";\n\nclass EditorGlobals {\n    /**\n     * If true, all entity changed are recorded as a KeyFrame.\n     */\n    _sceneMode: SceneMode = SceneMode.NORMAL;\n    get sceneMode() {\n        return this._sceneMode;\n    }\n    set sceneMode(recording: SceneMode) {\n        if (recording !== this._sceneMode) {\n            this._sceneMode = recording;\n            editorEventDispacher.dispatch(EditorEvent.EDITOR_SCENE_MODE_CHANGED);\n        }\n    }\n\n    /**\n     * What entityPrototype is selected in Animation view\n     */\n    animationEntityPrototype: EntityPrototype = null;\n    temporaryEntityEditing: boolean = false;\n\n}\n\nexport enum SceneMode {\n    NORMAL = 'normal',\n    RECORDING = 'rec',\n    PREVIEW = 'preview'\n};\n\nexport const editorGlobals = new EditorGlobals();\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport { forEachScene, scene } from '../../core/scene';\nimport { listenKeyDown, key } from \"../../util/input\";\nimport { GameEvent, globalEventDispatcher } from '../../core/eventDispatcher';\nimport { editorEventDispacher, EditorEvent } from '../editorEventDispatcher';\nimport { setSceneTool, sceneToolName, editorSelection, unfocus } from '../editorSelection';\nimport { Button } from '../views/popup/Popup';\nimport { editorGlobals, SceneMode } from '../editorGlobals';\nimport { setChangeOrigin } from '../../core/change';\n\nexport class TopBarModule extends Module {\n\tlogo: HTMLElement;\n\tbuttons: HTMLElement;\n\tcontrolButtons: HTMLElement;\n\ttoolSelectionButtons: HTMLElement;\n\tkeyboardShortcuts: { [code: number]: Function } = {}; // key.x -> func\n\tselectionView: HTMLElement;\n\tselectionText: HTMLElement;\n\tselectionButtons: HTMLElement;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.addElements(\n\t\t\tthis.logo = el('img.logo.button.iconButton.select-none', { src: '/img/logo_graphics.png' }),\n\t\t\t// this.buttons = el('div.buttonContainer.select-none'),\n\t\t\tthis.controlButtons = el('div.topButtonGroup.topSceneControlButtons'),\n\t\t\tthis.toolSelectionButtons = el('div.topButtonGroup.topToolSelectionButtons'),\n\t\t\tthis.selectionView = el('div.selectionView',\n\t\t\t\tthis.selectionText = el('div'),\n\t\t\t\tthis.selectionButtons = el('div.selectionButtons')\n\t\t\t)\n\t\t);\n\n\t\tthis.id = 'topbar';\n\t\tthis.name = 'TopBar'; // not visible\n\n\t\tthis.logo.onclick = () => {\n\t\t\tlocation.href = '/';\n\t\t};\n\n\t\tlistenKeyDown(keyCode => {\n\t\t\tthis.keyboardShortcuts[keyCode] && this.keyboardShortcuts[keyCode]();\n\t\t});\n\n\t\tthis.initControlButtons();\n\t\tthis.initToolSelectionButtons();\n\t\tthis.initSelectionButtons();\n\t}\n\n\tupdate() {\n\t\tthis.selectionText.textContent = editorSelection.getText() || '';\n\n\t\tif (editorSelection.items.length > 0 && editorSelection.focused) {\n\t\t\tthis.selectionView.classList.add('selectionFocused');\n\t\t} else {\n\t\t\tthis.selectionView.classList.remove('selectionFocused');\n\t\t}\n\t}\n\n\taddKeyboardShortcut(key: number, buttonOrCallback: Callback) {\n\t\tif (typeof buttonOrCallback === 'function') {\n\t\t\tthis.keyboardShortcuts[key] = buttonOrCallback;\n\t\t} else {\n\t\t\tthis.keyboardShortcuts[key] = () => buttonOrCallback.callback(buttonOrCallback.el);\n\t\t}\n\t}\n\n\tinitControlButtons() {\n\t\tlet playButtonData = {\n\t\t\ttitle: 'Play (P)',\n\t\t\ticon: 'fa-play',\n\t\t\ttype: 'play',\n\t\t\tcallback: () => editorEventDispacher.dispatch(EditorEvent.EDITOR_PLAY)\n\t\t};\n\t\tlet pauseButtonData = {\n\t\t\ttitle: 'Pause (P)',\n\t\t\ticon: 'fa-pause',\n\t\t\ttype: 'pause',\n\t\t\tcallback: () => editorEventDispacher.dispatch(EditorEvent.EDITOR_PAUSE)\n\t\t};\n\t\tlet recButtonData = {\n\t\t\ttitle: 'Recording animation keyframes',\n\t\t\ticon: 'fa-circle',\n\t\t\ttype: 'rec',\n\t\t\tcallback: () => {\n\t\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\t}\n\t\t};\n\t\tlet previewButtonData = {\n\t\t\ttitle: 'Previewing animation frame',\n\t\t\ticon: 'fa-eye',\n\t\t\ttype: 'preview',\n\t\t\tcallback: () => {\n\t\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\t\tif (editorGlobals.animationEntityPrototype && editorGlobals.animationEntityPrototype.previouslyCreatedEntity) {\n\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\teditorGlobals.animationEntityPrototype.previouslyCreatedEntity.resetComponents();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet playButton = new SceneControlButton(playButtonData);\n\t\tlet stopButton = new SceneControlButton({\n\t\t\ttitle: 'Reset (R)',\n\t\t\ticon: 'fa-stop',\n\t\t\ttype: 'reset',\n\t\t\tcallback: () => editorEventDispacher.dispatch(EditorEvent.EDITOR_RESET)\n\t\t});\n\n\t\tconst updateButtons = () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (scene.playing) {\n\t\t\t\t\tplayButton.update(pauseButtonData);\n\t\t\t\t} else if (editorGlobals.sceneMode === SceneMode.NORMAL) {\n\t\t\t\t\tplayButton.update(playButtonData);\n\t\t\t\t} else if (editorGlobals.sceneMode === SceneMode.RECORDING) {\n\t\t\t\t\tplayButton.update(recButtonData);\n\t\t\t\t} else if (editorGlobals.sceneMode === SceneMode.PREVIEW) {\n\t\t\t\t\tplayButton.update(previewButtonData);\n\t\t\t\t}\n\n\t\t\t\tlet paused = !scene.playing && !scene.isInInitialState();\n\t\t\t\tthis.controlButtons.classList.toggle('topSceneControlButtonsPaused', paused);\n\t\t\t}, 0);\n\t\t};\n\n\t\tthis.addKeyboardShortcut(key.p, playButton);\n\t\tthis.addKeyboardShortcut(key.r, stopButton);\n\n\t\tforEachScene(() => {\n\t\t\tscene.listen(GameEvent.SCENE_RESET, updateButtons);\n\t\t\tscene.listen(GameEvent.SCENE_PLAY, updateButtons);\n\t\t\tscene.listen(GameEvent.SCENE_PAUSE, updateButtons);\n\t\t\tglobalEventDispatcher.listen('scene load level', updateButtons);\n\t\t\teditorEventDispacher.listen(EditorEvent.EDITOR_SCENE_MODE_CHANGED, updateButtons);\n\t\t});\n\n\t\tmount(this.controlButtons, playButton);\n\t\tmount(this.controlButtons, stopButton);\n\t}\n\n\tinitToolSelectionButtons() {\n\t\tconst createCallback = (callback) => {\n\t\t\treturn (element) => {\n\t\t\t\tthis.toolSelectionButtons.querySelectorAll('.topSceneControlButton').forEach((button: HTMLElement) => {\n\t\t\t\t\tbutton.classList.remove('selected');\n\t\t\t\t});\n\t\t\t\telement.classList.add('selected');\n\t\t\t\tcallback && callback();\n\t\t\t}\n\t\t};\n\t\tlet tools = {\n\t\t\tglobalMoveTool: new SceneControlButton({\n\t\t\t\ttitle: 'Global move tool (1)',\n\t\t\t\ticon: 'fa-arrows-alt',\n\t\t\t\tcallback: createCallback(() => {\n\t\t\t\t\tsetSceneTool('globalMoveTool');\n\t\t\t\t})\n\t\t\t}),\n\t\t\tlocalMoveTool: new SceneControlButton({\n\t\t\t\ttitle: 'Local move tool (2)',\n\t\t\t\ticon: 'fa-expand-arrows-alt',\n\t\t\t\tcallback: createCallback(() => {\n\t\t\t\t\tsetSceneTool('localMoveTool');\n\t\t\t\t})\n\t\t\t}),\n\t\t\tmoveTool: new SceneControlButton({\n\t\t\t\ttitle: 'Move tool (1)',\n\t\t\t\ticon: 'fa-arrows-alt',\n\t\t\t\tcallback: createCallback(() => {\n\t\t\t\t\tsetSceneTool('moveTool');\n\t\t\t\t})\n\t\t\t}),\n\t\t\trotateTool: new SceneControlButton({\n\t\t\t\ttitle: 'Rotate tool (2)',\n\t\t\t\ticon: 'fa-sync-alt',\n\t\t\t\tcallback: createCallback(() => {\n\t\t\t\t\tsetSceneTool('rotateTool');\n\t\t\t\t})\n\t\t\t}),\n\t\t\tscaleTool: new SceneControlButton({\n\t\t\t\ttitle: 'Scale tool (3)',\n\t\t\t\ticon: 'fa-expand-arrows-alt',\n\t\t\t\tcallback: createCallback(() => {\n\t\t\t\t\tsetSceneTool('scaleTool');\n\t\t\t\t})\n\t\t\t}),\n\t\t\tmultiTool: new SceneControlButton({\n\t\t\t\ttitle: 'Multitool (4)',\n\t\t\t\ticon: 'fa-hand-spock',\n\t\t\t\tcallback: createCallback(() => {\n\t\t\t\t\tsetSceneTool('multiTool');\n\t\t\t\t})\n\t\t\t})\n\t\t};\n\n\t\tthis.addKeyboardShortcut(key[1], tools.moveTool);\n\t\tthis.addKeyboardShortcut(key[2], tools.rotateTool);\n\t\tthis.addKeyboardShortcut(key[3], tools.scaleTool);\n\t\tthis.addKeyboardShortcut(key[4], tools.multiTool);\n\n\n\n\t\t// mount(this.toolSelectionButtons, new SceneControlButton({ icon: 'fa-hand-spock', callback: createCallback(() => {}) }));\n\t\tmount(this.toolSelectionButtons, tools.moveTool);\n\t\tmount(this.toolSelectionButtons, tools.rotateTool);\n\t\tmount(this.toolSelectionButtons, tools.scaleTool);\n\t\tmount(this.toolSelectionButtons, tools.multiTool);\n\t\t// mount(this.toolSelectionButtons, tools.globalMoveTool);\n\t\t// mount(this.toolSelectionButtons, tools.localMoveTool);\n\n\t\t// mount(this.toolSelectionButtons, new SceneControlButton({ icon: 'fa-sync-alt', callback: createCallback(() => {}) }));\n\t\t// mount(this.toolSelectionButtons, new SceneControlButton({ icon: 'fa-vector-square', callback: createCallback(() => {}) }));\n\t\t// mount(this.toolSelectionButtons, new SceneControlButton({ icon: 'fa-bezier-curve', callback: createCallback(() => {}) }));\n\n\n\t\ttools[sceneToolName].click();\n\t\t// this.multipurposeTool.click(); // if you change the default tool, scene.js must also be changed\n\t}\n\n\tinitSelectionButtons() {\n\t\tlet copyButton = new SelectionButton({\n\t\t\ttitle: 'Clone/Copy selected objects (C)',\n\t\t\tclassName: 'fa-copy',\n\t\t\ttype: 'copy',\n\t\t\tcallback: () => editorSelection.focused && editorEventDispacher.dispatch(EditorEvent.EDITOR_CLONE)\n\t\t});\n\n\t\tlet deleteButton = new SelectionButton({\n\t\t\ttitle: 'Delete selected objects (Backspace)',\n\t\t\tclassName: 'fa-trash',\n\t\t\ttype: 'delete',\n\t\t\tcallback: () => editorSelection.focused && editorEventDispacher.dispatch(EditorEvent.EDITOR_DELETE)\n\t\t});\n\n\t\tthis.addKeyboardShortcut(key.c, copyButton);\n\t\tthis.addKeyboardShortcut(key.backspace, deleteButton);\n\n\t\tmount(this.selectionButtons, copyButton);\n\t\tmount(this.selectionButtons, deleteButton);\n\t}\n}\nModule.register(TopBarModule, 'top');\n\ntype Callback = Function | { callback: Function, el: HTMLElement }\n\nclass SceneControlButton {\n\tel: HTMLElement;\n\tcallback: (HTMLElement) => void;\n\n\tconstructor(data) {\n\t\tthis.el = el('div.button.topSceneControlButton', {\n\t\t\tonclick: () => this.click()\n\t\t});\n\t\tthis.update(data);\n\t}\n\tupdate(data) {\n\t\tthis.el.setAttribute('title', data.title || '');\n\t\tthis.el.setAttribute('controlButtonType', data.type || '');\n\t\tthis.el.innerHTML = '';\n\t\tthis.callback = data.callback;\n\t\tmount(this.el, el(`i.fas.${data.icon}`));\n\t}\n\tclick() {\n\t\tthis.callback && this.callback(this.el);\n\t}\n}\n\nclass SelectionButton {\n\tel: HTMLElement;\n\tcallback: () => void;\n\tclassName: string = '';\n\n\tconstructor(data) {\n\t\tthis.el = el('i.fas.iconButton.button', {\n\t\t\tonclick: () => this.click()\n\t\t});\n\t\tif (data)\n\t\t\tthis.update(data);\n\t}\n\tupdate(data) {\n\t\tif (this.className) {\n\t\t\tthis.el.classList.remove(this.className);\n\t\t}\n\t\tthis.className = data.className;\n\t\tthis.el.classList.add(this.className);\n\n\t\tthis.el.setAttribute('title', data.title || '');\n\t\tthis.el.setAttribute('selectionButtonType', data.type || '');\n\t\tthis.callback = data.callback;\n\t}\n\tclick() {\n\t\tthis.callback && this.callback();\n\t}\n}\n\nexport class TopButton {\n\tpriority: number;\n\tcallback: (TopButton) => void;\n\ticon: HTMLElement;\n\ttext: HTMLElement;\n\tel: HTMLElement;\n\n\n\tconstructor({\n\t\ttext = 'Button',\n\t\tcallback = null,\n\t\ticonClass = 'fa-circle',\n\t\tpriority = 1\n\t} = {}) {\n\t\tthis.priority = priority || 0;\n\t\tthis.callback = callback;\n\t\tthis.el = el('div.button.topIconTextButton',\n\t\t\tel('div.topIconTextButtonContent',\n\t\t\t\tthis.icon = el(`i.fas.${iconClass}`),\n\t\t\t\tthis.text = el('span', text)\n\t\t\t)\n\t\t);\n\t\tthis.el.onclick = () => {\n\t\t\tthis.click();\n\t\t};\n\t}\n\tclick() {\n\t\tif (this.callback) {\n\t\t\tthis.callback(this);\n\t\t}\n\t}\n}\n","import { scene } from '../../core/scene';\nimport { editor } from '../editor';\nimport { changeType } from '../../core/change';\nimport assert from '../../util/assert';\nimport Vector from '../../util/vector';\nimport { centerWidgetRadius } from '../widget/widget'\nimport { filterChildren } from \"../../core/serializable\";\nimport { Component } from \"../../core/component\";\nimport { selectedLevel } from '../editorSelection';\nimport Entity from '../../core/entity';\nimport EntityPrototype from '../../core/entityPrototype';\nimport { editorEventDispacher, EditorEvent } from '../editorEventDispatcher';\nimport { editorGlobals, SceneMode } from '../editorGlobals';\nimport { disableAllChanges, executeWithoutEntityPropertyChangeCreation } from '../../core/property';\nimport { keyPressed, key } from '../../util/input';\n\nexport function shouldSyncLevelToScene() {\n\treturn scene && scene.isInInitialState() && selectedLevel && editorGlobals.sceneMode === SceneMode.NORMAL;\n}\n\nexport function isMultiSelectModifierPressed() {\n\treturn keyPressed(key.shift) /*|| keyPressed(key.ctrl) buggy right click */ || keyPressed(key.appleLeft) || keyPressed(key.appleRight)\n}\n\nfunction setEntityPropertyValue(entity, componentName, componentId, sourceProperty) {\n\tlet component = entity.getComponents(componentName)\n\t\t.filter(c => c._componentId === componentId)[0];\n\n\tif (component)\n\t\tcomponent._properties[sourceProperty.name].value = sourceProperty.value;\n}\n\nfunction getAffectedEntities(prototypeOrEntityPrototype, prototypeFilter = null) {\n\tif (prototypeOrEntityPrototype.threeLetterType === 'epr') {\n\t\t// EntityPrototype\n\n\t\tlet entity = prototypeOrEntityPrototype.previouslyCreatedEntity;\n\t\tif (entity && entity._alive)\n\t\t\treturn [entity];\n\t\telse\n\t\t\treturn [];\n\t}\n\n\t// Prototype\n\n\tlet affectedPrototypes = new Set();\n\n\tfunction goThroughChildren(prototype) {\n\t\tprototype.getChildren('prt').forEach(proto => {\n\t\t\tif (typeof prototypeFilter === 'function') {\n\t\t\t\tif (prototypeFilter(proto))  {\n\t\t\t\t\taffectedPrototypes.add(proto);\n\t\t\t\t\tgoThroughChildren(proto);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\taffectedPrototypes.add(proto);\n\t\t\t\tgoThroughChildren(proto);\n\t\t\t}\n\t\t});\n\t}\n\n\taffectedPrototypes.add(prototypeOrEntityPrototype);\n\tgoThroughChildren(prototypeOrEntityPrototype);\n\n\tlet entities = scene.level.getChildren('epr').filter((epr: EntityPrototype) => {\n\t\treturn affectedPrototypes.has(epr.prototype)\n\t\t\t&& (!prototypeFilter || prototypeFilter(epr));\n\t}).map((epr: EntityPrototype) => epr.previouslyCreatedEntity).filter(ent => ent && ent._alive);\n\treturn entities;\n}\n\n// Call setChangeOrigin(this) before calling this\n// Does modifications to entities in editor scene based on levels prototypes\nexport function syncAChangeFromLevelToScene(change) {\n\tif (!scene || !scene.level) return;\n\n\tif (!shouldSyncLevelToScene())\n\t\treturn;\n\n\tif (change.type === 'editorSelection')\n\t\treturn;\n\n\tlet ref = change.reference;\n\tassert(ref && ref._rootType);\n\n\tif (ref._rootType !== 'gam')\n\t\treturn;\n\n\tlet threeLetterType = ref && ref.threeLetterType || null;\n\n\tif (change.type === changeType.addSerializableToTree) {\n\t\tif (threeLetterType === 'epr') {\n\t\t\tlet epr = ref as EntityPrototype;\n\t\t\tif (epr.findParent('lvl') === selectedLevel)\n\t\t\t\tepr.createEntity(scene);\n\t\t} else if (threeLetterType === 'cda') {\n\t\t\tlet parent = ref.getParent();\n\t\t\tlet entities;\n\t\t\tif (parent.threeLetterType === 'prt') {\n\t\t\t\tentities = getAffectedEntities(parent);\n\t\t\t} else {\n\t\t\t\t// epr\n\t\t\t\tentities = [parent.previouslyCreatedEntity].filter(ent => ent && ent._alive);\n\t\t\t}\n\n\t\t\tentities.forEach(entity => {\n\n\t\t\t\tlet oldComponent = entity.getComponents(ref.name).find(com => com._componentId === ref.componentId);\n\t\t\t\tif (oldComponent)\n\t\t\t\t\tentity.deleteComponent(oldComponent);\n\n\t\t\t\tlet proto = entity.prototype;\n\t\t\t\tlet componentData = proto.findComponentDataByComponentId(ref.componentId, true);\n\t\t\t\tif (componentData) {\n\t\t\t\t\tlet component = componentData.createComponent();\n\t\t\t\t\tentity.addComponents([component]);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (threeLetterType === 'prp') {\n\t\t\tlet property = ref;\n\t\t\tlet componentData = property.findParent('cda');\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tentities.forEach(entity => {\n\t\t\t\tlet epr = entity.prototype;\n\t\t\t\tlet value = epr.getValue(componentData.componentId, property.name);\n\t\t\t\tlet component = entity.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tcomponent._properties[property.name].value = value;\n\t\t\t})\n\t\t}\n\t} else if (change.type === changeType.setPropertyValue) {\n\t\tlet property = ref;\n\t\tlet cda = property.findParent('cda');\n\t\tif (!cda)\n\t\t\treturn;\n\t\tlet prototype = cda.getParent();\n\t\tif (prototype.threeLetterType === 'epr') {\n\t\t\t// EntityPrototype\n\n\t\t\tif (prototype.previouslyCreatedEntity) {\n\t\t\t\t//setEntityPropertyValue(prototype.previouslyCreatedEntity, cda.name, cda.componentId, property);\n\t\t\t\texecuteWithoutEntityPropertyChangeCreation(() => {\n\t\t\t\t\tsetEntityPropertyValue(prototype.previouslyCreatedEntity, cda.name, cda.componentId, property);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t// Prototype\n\n\t\t\tlet entities = getAffectedEntities(prototype, prt => prt.findOwnProperty(cda.componentId, property.name) === null);\n\n\t\t\tentities.forEach(ent => {\n\t\t\t\tsetEntityPropertyValue(ent, cda.name, cda.componentId, property);\n\t\t\t});\n\t\t}\n\t} else if (change.type === changeType.deleteAllChildren) {\n\t\tif (threeLetterType === 'cda') {\n\t\t\tlet componentData = ref;\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tentities.forEach(entity => {\n\t\t\t\tlet epr = entity.prototype;\n\t\t\t\tlet oldComponent = entity.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tentity.deleteComponent(oldComponent);\n\n\t\t\t\tlet inheritedComponentDatas = epr.getInheritedComponentDatas();\n\t\t\t\tlet icd = inheritedComponentDatas.find(i => i.componentId === componentData.componentId);\n\t\t\t\tif (icd) {\n\t\t\t\t\tlet newComponent = Component.createWithInheritedComponentData(icd);\n\t\t\t\t\tentity.addComponents([newComponent]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t} else if (change.type === changeType.deleteSerializable) {\n\t\tif (threeLetterType === 'epr') {\n\t\t\tlet epr = ref;\n\t\t\tif (epr.previouslyCreatedEntity)\n\t\t\t\tepr.previouslyCreatedEntity.delete();\n\t\t} else if (threeLetterType === 'prp') {\n\t\t\tlet property = ref;\n\t\t\tlet componentData = property.findParent('cda');\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tentities.forEach(ent => {\n\t\t\t\tlet epr = ent.prototype;\n\t\t\t\tlet cda = epr.findComponentDataByComponentId(componentData.componentId, true);\n\t\t\t\tlet componentClass = cda.componentClass;\n\t\t\t\tlet valueProperty = cda.getProperty(property.name);\n\t\t\t\tlet value;\n\t\t\t\tif (valueProperty === property) {\n\t\t\t\t\tcda = cda.getParentComponentData();\n\t\t\t\t\tif (cda)\n\t\t\t\t\t\tvalue = cda.getValue(property.name);\n\t\t\t\t\telse\n\t\t\t\t\t\tvalue = componentClass._propertyTypesByName[property.name].initialValue;\n\t\t\t\t} else if (valueProperty) {\n\t\t\t\t\tvalue = valueProperty.value;\n\t\t\t\t} else {\n\t\t\t\t\tvalue = componentClass._propertyTypesByName[property.name].initialValue;\n\t\t\t\t}\n\t\t\t\tlet component = ent.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tif (component)\n\t\t\t\t\tcomponent._properties[property.name].value = value;\n\t\t\t});\n\t\t} else if (threeLetterType === 'cda') {\n\t\t\tlet componentData = ref;\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tentities.forEach(entity => {\n\t\t\t\tlet epr = entity.prototype;\n\t\t\t\tlet oldComponent = entity.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tentity.deleteComponent(oldComponent);\n\n\t\t\t\tlet inheritedComponentDatas = epr.getInheritedComponentDatas(cda => cda !== componentData);\n\t\t\t\tlet icd = inheritedComponentDatas.find(i => i.componentId === componentData.componentId);\n\t\t\t\tif (icd) {\n\t\t\t\t\tlet newComponent = Component.createWithInheritedComponentData(icd);\n\t\t\t\t\tentity.addComponents([newComponent]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// If Prototype is deleted, all entity prototypes are also deleted so we can ignore Prototype here\n\t} else if (change.type === changeType.move) {\n\t\t// This might be difficult to achieve without reseting the whole scene.\n\n\t\t// So...\n\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_RESET);\n\t}\n}\n\nexport function addEntitiesToLevel(entities: Entity[]) {\n\tconsole.log('addEntitiesToLevel', entities);\n\n\tlet entityPrototypes = entities.map(entity => {\n\t\tlet parentEntity = entity.getParent() as Entity;\n\t\tlet parentEntityPrototype: EntityPrototype;\n\t\tif (parentEntity && parentEntity.threeLetterType === 'ent') {\n\t\t\tparentEntityPrototype = parentEntity.prototype as EntityPrototype;\n\t\t}\n\t\tlet epr = entity.prototype.cloneWithNewSiblingId() as EntityPrototype;\n\t\tepr.position = entity.position;\n\t\t(parentEntityPrototype || selectedLevel).addChild(epr);\n\n\t\treturn epr\n\t});\n\n\treturn entityPrototypes;\n}\n\nexport function getEntitiesInSelection(start: Vector, end: Vector)  {\n\tlet entities = [];\n\n\tlet minX = Math.min(start.x, end.x) * scene.pixelDensity.x;\n\tlet maxX = Math.max(start.x, end.x) * scene.pixelDensity.x;\n\tlet minY = Math.min(start.y, end.y) * scene.pixelDensity.y;\n\tlet maxY = Math.max(start.y, end.y) * scene.pixelDensity.y;\n\n\tscene.forEachChild('ent', (ent: Entity) => {\n\t\t// This is an optimized way of getting Transform component\n\t\t// getBounds is actually faster than this anonymous function.\n\t\tlet bounds = ent.components.get('Transform')[0].container.getBounds();\n\n\t\tif (bounds.x < minX) return;\n\t\tif (bounds.x + bounds.width > maxX) return;\n\t\tif (bounds.y < minY) return;\n\t\tif (bounds.y + bounds.height > maxY) return;\n\n\t\tentities.push(ent);\n\t}, true);\n\n\treturn entities;\n}\n\nexport function setOrCreateTransformDataPropertyValue(transformComponentData, transform, propertyName = 'position', idPostfix = '_p', valueCompareFunc = (a, b) => a === b) {\n\tlet property = transformComponentData.getProperty(propertyName);\n\tif (property) {\n\t\tif (!valueCompareFunc(property.value, transform[propertyName])) {\n\t\t\tproperty.value = transform[propertyName];\n\t\t\t// console.log('updated', propertyName, 'to', transform[propertyName]);\n\t\t}\n\t} else {\n\t\tproperty = transformComponentData.componentClass._propertyTypesByName[propertyName].createProperty({\n\t\t\tvalue: transform[propertyName],\n\t\t\tpredefinedId: transformComponentData.getParent().id + idPostfix\n\t\t});\n\t\ttransformComponentData.addChild(property);\n\t\tconsole.log('created', propertyName, 'valued', transform[propertyName]);\n\t}\n}\n\nexport function moveEntities(entities, change) {\n\tif (entities.length === 0)\n\t\treturn;\n\n\tentities.forEach(entity => {\n\t\tlet transform = entity.getComponent('Transform');\n\t\ttransform.position = transform.position.add(change);\n\t});\n}\n\nexport function setEntityPositions(entities: Entity[], position: Vector) {\n\tif (entities.length === 0)\n\t\treturn;\n\n\tlet globalPositions = entities.map(e => e.Transform.getGlobalPosition());\n\n\tlet averageGlobalPosition = new Vector(0, 0);\n\n\tglobalPositions.forEach(globalPosition => {\n\t\taverageGlobalPosition.add(globalPosition);\n\t});\n\n\taverageGlobalPosition.divideScalar(entities.length);\n\n\tlet change = averageGlobalPosition.multiplyScalar(-1).add(position);\n\n\tentities.forEach(entity => {\n\t\tentity.Transform.setGlobalPosition(entity.Transform.getGlobalPosition().add(change));\n\t});\n}\n\n// export function entityModifiedInEditor(entity, change) {\n// \tif (!entity || entity.threeLetterType !== 'ent' || !change || change.type !== changeType.setPropertyValue)\n// \t\treturn;\n\n// \tif (shouldSyncSceneToLevel()) {\n// \t\tlet entityPrototype = entity.prototype;\n// \t\tconsole.log('before', entityPrototype);\n// \t\tlet property = change.reference;\n// \t\tlet component = property.getParent();\n// \t\tlet changeComponentId = component._componentId;\n// \t\tlet changePropertyName = change.reference.name;\n// \t\tlet componentData = entityPrototype.getOwnComponentDataOrInherit(changeComponentId);\n// \t\tconsole.log('componentData', componentData);\n// \t\tlet entityPrototypeProperty = componentData.getPropertyOrCreate(changePropertyName);\n// \t\tconsole.log('entityPrototypeProperty', entityPrototypeProperty);\n// \t\tentityPrototypeProperty.value = property.value;\n// \t\tconsole.log('after', entityPrototype);\n// \t}\n// }\n\nexport function setEntitiesInSelectionArea(entities, inSelectionArea) {\n\tentities.forEach(entity => {\n\t\tlet Selection = entity.getComponent('EditorSelection');\n\t\tSelection.setIsInSelectionArea(inSelectionArea);\n\t});\n}\n","import {Component} from '../../core/component';\nimport PIXI from '../../features/graphics';\n\n// Export so that other components can have this component as parent\nexport default Component.register({\n\tname: 'EditorSelection',\n\tcategory: 'Editor', // You can also make up new categories.\n\ticon: 'fa-bars', // Font Awesome id\n\tproperties: [\n\t\t// Prop('selected', false, Prop.bool)\n\t],\n\tprototype: {\n\t\tselected: false, // this entity is selected in editor -> all widgets are visible\n\t\tinSelectionArea: false,\n\n\t\tselect() {\n\t\t\tif (!this.selected) {\n\t\t\t\tthis.selected = true;\n\t\t\t\tthis.Transform.container.filters = selectedEntityFilters;\n\t\t\t}\n\t\t},\n\t\tdeselect() {\n\t\t\tif (this.selected) {\n\t\t\t\tthis.selected = false;\n\t\t\t\tthis.Transform.container.filters = null;\n\t\t\t}\n\t\t},\n\t\tinit() {\n\t\t\tif (this.selected) {\n\t\t\t\tthis.Transform.container.filters = selectedEntityFilters;\n\t\t\t}\n\t\t},\n\n\t\tsetIsInSelectionArea(inSelectionArea) {\n\t\t\tif (!this.selected) {\n\t\t\t\tif (inSelectionArea) {\n\t\t\t\t\tthis.Transform.container.filters = inSelectionAreaFilter;\n\t\t\t\t} else {\n\t\t\t\t\tthis.Transform.container.filters = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\nfunction createEntityFilters() {\n\tconst contrast = new PIXI.filters.ColorMatrixFilter();\n\tcontrast.contrast(-0.3);\n\n\tconst brightness = new PIXI.filters.ColorMatrixFilter();\n\tbrightness.brightness(1.25);\n\n\treturn [\n\t\tcontrast,\n\t\tbrightness,\n\t\tnew PIXI.filters.OutlineFilter(1.2, 0xeceb61, 0.1)\n\t];\n}\n\nconst selectedEntityFilters = createEntityFilters();\n\nfunction createSelectionAreaFilters() {\n\tconst contrast = new PIXI.filters.ColorMatrixFilter();\n\tcontrast.negative();\n\n\treturn [\n\t\t// contrast,\n\t\tnew PIXI.filters.OutlineFilter(1.2, 0xeceb61, 0.1)\n\t];\n}\nconst inSelectionAreaFilter = createSelectionAreaFilters();\n","import { el, mount, list, RedomComponent } from 'redom';\nimport { listenKeyDown, key } from '../../../util/input';\n\nexport let popupDepth = 0;\n\ntype PopupParameters = {\n\ttitle?: string,\n\tcancelCallback?: Function,\n\twidth?: number,\n\tcontent?: RedomComponent\n};\n\nexport default class Popup {\n\tel: HTMLElement;\n\ttext: HTMLElement;\n\tcontent: RedomComponent;\n\tdepth: number;\n\tkeyListener: any;\n\n\t/**\n\t * Callback to call when user click outside of this popup or if user presses esc and thus removing the popup.\n\t */\n\tcancelCallback: Function;\n\n\tconstructor({\n\t\ttitle = 'Undefined popup',\n\t\tcancelCallback = null,\n\t\twidth = null,\n\t\tcontent = el('div.genericCustomContent', 'Undefined content')\n\t}: PopupParameters = {}) {\n\t\tthis.el = el('div.popup',\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\t'z-index': 1000 + popupDepth++\n\t\t\t\t}\n\t\t\t},\n\t\t\tnew Layer(this),\n\t\t\tel('div.popupContent',\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\twidth\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tthis.text = el('div.popupTitle'),\n\t\t\t\tthis.content = content\n\t\t\t)\n\t\t);\n\t\tthis.depth = popupDepth;\n\t\tthis.text.innerHTML = title;\n\t\tthis.cancelCallback = cancelCallback;\n\n\n\t\tthis.keyListener = listenKeyDown(keyChar => {\n\t\t\tif (keyChar === key.esc && this.depth === popupDepth) {\n\t\t\t\tthis.remove();\n\t\t\t\tthis.cancelCallback && this.cancelCallback();\n\t\t\t}\n\t\t});\n\n\t\tmount(document.body, this.el);\n\t}\n\tremove() {\n\t\tpopupDepth--;\n\t\tthis.el.parentNode.removeChild(this.el);\n\t\tthis.keyListener();\n\t\tthis.keyListener = null;\n\t}\n}\n\nexport type ButtonOptions = {\n\tclass?: string,\n\tcolor?: string,\n\ttext: string,\n\ticon?: string,\n\tcallback: () => void\n};\n\nexport class Button {\n\tel: HTMLElement;\n\tcallback: () => void;\n\t_prevIcon: string;\n\n\tconstructor() {\n\t\tthis.el = el('button.button', {\n\t\t\tonclick: () => {\n\t\t\t\tthis.callback();\n\t\t\t}\n\t\t});\n\t}\n\tupdate(button: ButtonOptions) {\n\t\tlet newClassName = button.class ? `button ${button.class}` : 'button';\n\n\t\tif (\n\t\t\tthis.el.textContent === button.text\n\t\t\t&& this._prevIcon === button.icon\n\t\t\t&& this.el.className === newClassName\n\t\t\t&& (!button.color || this.el.style['border-color'] === button.color)\n\t\t) {\n\t\t\treturn; // optimization\n\t\t}\n\n\t\tthis.el.textContent = button.text;\n\n\t\tthis._prevIcon = button.icon;\n\t\tif (button.icon) {\n\t\t\tlet icon = el('i.fas.' + button.icon);\n\t\t\tif (button.color)\n\t\t\t\ticon.style.color = button.color;\n\t\t\tmount(this.el, icon, this.el.firstChild);\n\t\t}\n\t\tthis.el.className = newClassName;\n\t\tthis.callback = button.callback;\n\t\tif (button.color) {\n\t\t\tthis.el.style['border-color'] = button.color;\n\t\t\tthis.el.style['color'] = button.color;\n\t\t\t// this.el.style['background'] = button.color;\n\t\t}\n\t}\n}\n\nexport type ButtonWithDescriptionOptions = ButtonOptions & {\n\tdescription?: string,\n\tdisabledReason?: string\n}\n\nexport class ButtonWithDescription {\n\tel: HTMLElement;\n\tbutton: Button;\n\tdescription: HTMLElement;\n\n\tconstructor() {\n\t\tthis.el = el('div.buttonWithDescription',\n\t\t\tthis.button = new Button(),\n\t\t\tthis.description = el('span.description')\n\t\t);\n\t}\n\n\tupdate(buttonData: ButtonWithDescriptionOptions) {\n\t\tthis.description.innerHTML = buttonData.description;\n\t\tif (buttonData.disabledReason) {\n\t\t\tthis.button.el.setAttribute('disabled', 'disabled');\n\t\t} else {\n\t\t\tthis.button.el.removeAttribute('disabled');\n\t\t}\n\t\tthis.button.el.setAttribute('title', buttonData.disabledReason || '');\n\t\tthis.button.update(buttonData);\n\t}\n}\n\nclass Layer {\n\tel: HTMLElement;\n\n\tconstructor(popup) {\n\t\tthis.el = el('div.popupLayer', {\n\t\t\tonclick: () => {\n\t\t\t\tpopup.remove();\n\t\t\t\tpopup.cancelCallback && popup.cancelCallback();\n\t\t\t}\n\t\t});\n\t}\n}\n","import Popup, { Button, popupDepth } from './Popup';\nimport { el, mount, list } from 'redom';\n\nexport default class Confirmation extends Popup {\n\t/*\n\tbuttonOptions:\n\t- text\n\t- color\n\t- icon (fa-plus)\n\t */\n\tconstructor(question: string, buttonOptions, callback, cancelCallback) {\n\t\tsuper({\n\t\t\ttitle: question,\n\t\t\twidth: '500px',\n\t\t\tcontent: list('div.confirmationButtons', Button),\n\t\t\tcancelCallback\n\t\t});\n\n\t\tthis.content.update([{\n\t\t\ttext: 'Cancel',\n\t\t\tcallback: () => {\n\t\t\t\tthis.remove();\n\t\t\t\tthis.cancelCallback && this.cancelCallback();\n\t\t\t}\n\t\t}, Object.assign({\n\t\t\ttext: 'Confirm'\n\t\t}, buttonOptions, {\n\t\t\tcallback: () => {\n\t\t\t\tcallback();\n\t\t\t\tthis.remove();\n\t\t\t}\n\t\t})]);\n\n\t\tlet confirmButton = this.content.views[1];\n\t\tconfirmButton.el.focus();\n\t}\n\n\tremove() {\n\t\tsuper.remove();\n\t}\n}\n","import Popup, { Button, ButtonWithDescription } from './Popup';\nimport { componentClasses } from '../../../core/component';\nimport ComponentData from '../../../core/componentData';\nimport { list, el, List, RedomComponent } from 'redom';\nimport assert from '../../../util/assert';\nimport { setChangeOrigin } from '../../../core/change';\nimport Confirmation from './Confirmation';\nimport { redomDispatch, redomListen } from '../../../util/redomEvents';\nimport Serializable from '../../../core/serializable';\n\nconst CATEGORY_ORDER = [\n\t'Common',\n\t'Logic',\n\t'Graphics'\n];\n\nconst HIDDEN_COMPONENTS = ['Transform'];\n\nexport default class ComponentAdder extends Popup {\n\tcontent: List;\n\tconstructor(parent: Serializable) {\n\t\tsuper({\n\t\t\ttitle: 'Add Component',\n\t\t\tcontent: list('div.componentAdderContent', Category, null, parent)\n\t\t});\n\n\n\t\tlet componentClassArray = Array.from(componentClasses.values())\n\t\t\t.filter(cl => !HIDDEN_COMPONENTS.includes(cl.componentName))\n\t\t\t.sort((a, b) => a.componentName.localeCompare(b.componentName));\n\n\t\t// console.log('before set', componentClassArray.map(c => c.category))\n\t\t// console.log('set', new Set(componentClassArray.map(c => c.category)))\n\t\t// console.log('set array', Array.from(new Set(componentClassArray.map(c => c.category))))\n\n\t\tlet categories = Array.from(new Set(componentClassArray.map(c => c.category))).map(categoryName => ({\n\t\t\tcategoryName,\n\t\t\tcomponents: componentClassArray.filter(c => c.category === categoryName)\n\t\t}));\n\n\t\tcategories.sort((a, b) => {\n\t\t\tlet aIdx = CATEGORY_ORDER.indexOf(a.categoryName);\n\t\t\tlet bIdx = CATEGORY_ORDER.indexOf(b.categoryName);\n\n\t\t\tif (aIdx < 0) aIdx = 999;\n\t\t\tif (bIdx < 0) bIdx = 999;\n\n\t\t\tif (aIdx < bIdx) return -1;\n\t\t\telse return 1;\n\t\t});\n\n\t\tthis.update(categories);\n\n\t\tredomListen(this, 'refresh', () => {\n\t\t\tthis.update(categories);\n\t\t})\n\t}\n\n\tupdate(categories) {\n\t\tthis.content.update(categories);\n\t}\n}\n\nclass Category implements RedomComponent {\n\tel: HTMLElement;\n\tname: HTMLElement;\n\tlist: List;\n\n\tconstructor(public parent: Serializable) {\n\t\tthis.el = el('div.categoryItem',\n\t\t\tthis.name = el('div.categoryName'),\n\t\t\tthis.list = list('div.categoryButtons', ButtonWithDescription)\n\t\t);\n\t}\n\n\taddComponentToParent(componentClass) {\n\t\tsetChangeOrigin(this);\n\n\t\tfunction addComponentDatas(parent, componentNames) {\n\t\t\treturn parent.addChildren(componentNames.map(name => new ComponentData(name)));\n\t\t}\n\n\t\tif (['epr', 'prt'].indexOf(this.parent.threeLetterType) >= 0) {\n\t\t\tlet missingRequirements = getMissingRequirements(this.parent, componentClass.requirements);\n\n\t\t\tif (missingRequirements.length === 0) {\n\t\t\t\taddComponentDatas(this.parent, [componentClass.componentName]);\n\t\t\t\tredomDispatch(this, 'refresh');\n\t\t\t} else {\n\t\t\t\tnew Confirmation(`<b>${componentClass.componentName}</b> needs these components in order to work: <b>${missingRequirements.join(', ')}</b>`, {\n\t\t\t\t\ttext: `Add all (${missingRequirements.length + 1}) components`,\n\t\t\t\t\tcolor: '#4ba137',\n\t\t\t\t\ticon: 'fa-plus'\n\t\t\t\t}, () => {\n\t\t\t\t\taddComponentDatas(this.parent, missingRequirements.concat(componentClass.componentName));\n\t\t\t\t\tredomDispatch(this, 'refresh');\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tassert(false);\n\t}\n\n\tupdate(category) {\n\t\tthis.name.textContent = category.categoryName;\n\n\t\tlet componentCounts = {};\n\t\tthis.parent.forEachChild('cda', (cda: ComponentData) => {\n\t\t\tif (!componentCounts[cda.name])\n\t\t\t\tcomponentCounts[cda.name] = 0;\n\t\t\tcomponentCounts[cda.name]++;\n\t\t});\n\n\t\tlet componentButtonData = category.components.map(comp => {\n\t\t\tlet disabledReason;\n\t\t\tif (!comp.allowMultiple && this.parent.findChild('cda', (cda: ComponentData) => cda.name === comp.componentName) !== null) {\n\t\t\t\tdisabledReason = `Only one ${comp.componentName} component is allowed at the time`;\n\t\t\t}\n\t\t\tlet count = componentCounts[comp.componentName];\n\t\t\treturn {\n\t\t\t\ttext: comp.componentName + (count ? ` (${count})` : ''),\n\t\t\t\tdescription: comp.description,\n\t\t\t\tcolor: comp.color,\n\t\t\t\ticon: comp.icon,\n\t\t\t\tdisabledReason,\n\t\t\t\tcallback: () => {\n\t\t\t\t\tif ('activeElement' in document)\n\t\t\t\t\t\t(document.activeElement as HTMLElement).blur();\n\n\t\t\t\t\tthis.addComponentToParent(comp);\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\tthis.list.update(componentButtonData);\n\t}\n}\n\nfunction getMissingRequirements(parent, requirements) {\n\tfunction isMissing(componentName) {\n\t\tlet componentData = parent.findChild('cda', componentData => componentData.name === componentName)\n\t\treturn !componentData;\n\t}\n\n\treturn requirements.filter(isMissing).filter(r => r !== 'Transform');\n}\n","import Popup, { Button, popupDepth } from './Popup';\nimport { el, mount, list } from 'redom';\nimport Entity from \"../../../core/entity\";\nimport EntityPrototype from \"../../../core/entityPrototype\";\nimport { scene } from \"../../../core/scene\";\nimport { addEntitiesToLevel } from \"../../util/sceneEditUtil\";\nimport Vector from '../../../util/vector';\nimport { selectInEditor } from '../../editorSelection';\nimport Module from '../../module/module';\nimport { editorEventDispacher, EditorEvent } from '../../editorEventDispatcher';\nimport { setChangeOrigin } from '../../../core/change';\nimport ComponentAdder from \"./componentAdder\"\n\nexport default class CreateObject extends Popup {\n\t/*\n\tbuttonOptions:\n\t- text\n\t- color\n\t- icon (fa-plus)\n\t */\n\tconstructor() {\n\t\tsuper({\n\t\t\ttitle: 'Create Object',\n\t\t\twidth: 500,\n\t\t\tcontent: list('div.confirmationButtons', Button)\n\t\t});\n\n\t\tthis.remove();\n\n\t\tconst selectCreatedObjects = (entities: Entity[]) => {\n\t\t\tif (entities.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (entities[0].prototype && entities[0].prototype.threeLetterType === 'epr') {\n\t\t\t\tlet entityPrototypes = entities.map(e => e.prototype).filter(Boolean);\n\t\t\t\tselectInEditor(entityPrototypes, this);\n\t\t\t} else {\n\t\t\t\tselectInEditor(entities, this);\n\t\t\t}\n\n\t\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_FORCE_UPDATE);\n\t\t\tModule.activateModule('object', true, 'focusOnProperty', 'name');\n\t\t}\n\n\t\tsetChangeOrigin(this);\n\t\tlet entityPrototype = EntityPrototype.create('Empty', scene.cameraPosition.clone());\n\n\t\tlet entity = entityPrototype.createEntity(null, true);\n\t\tlet levelEntityPrototype = addEntitiesToLevel([entity]);\n\n\t\tselectCreatedObjects([entity]);\n\n\t\tnew ComponentAdder(levelEntityPrototype[0]);\n\n\t\tthis.remove();\n\n\t\t// this.content.update([{\n\t\t// \ttext: 'Empty Object',\n\t\t// \tcallback: () => {\n\t\t// \t\tsetChangeOrigin(this);\n\t\t// \t\tlet entityPrototype = EntityPrototype.create('Empty', scene.cameraPosition.clone());\n\t\t//\n\t\t// \t\tlet entity = entityPrototype.createEntity(null, true);\n\t\t// \t\tlet entitiesInScene = addEntitiesToLevel([entity]);\n\t\t//\n\t\t// \t\t// selectCreatedObjects(entitiesInScene);\n\t\t//\n\t\t// \t\tthis.remove();\n\t\t// \t}\n\t\t// }]);\n\t}\n}\n","import { editorEventDispacher, EditorEvent } from \"../editorEventDispatcher\";\nimport { Change, setChangeOrigin } from \"../../core/change\";\nimport { editorSelection, sceneToolName } from \"../editorSelection\";\nimport Entity from \"../../core/entity\";\nimport EntityPrototype from \"../../core/entityPrototype\";\nimport { globalEventDispatcher, GameEvent } from \"../../core/eventDispatcher\";\nimport { RedomComponent, el, mount } from \"redom\";\nimport Vector from \"../../util/vector\";\nimport { listenMouseUp, listenMouseMove, listenMouseDown, keyPressed, key } from \"../../util/input\";\nimport Scene, { scene, forEachScene } from \"../../core/scene\";\nimport { filterChildren } from \"../../core/serializable\";\nimport assert from \"../../util/assert\";\nimport { editorGlobals, SceneMode } from \"../editorGlobals\";\n\nconst WIDGET_DISTANCE = 50;\n\n// Widgets usually edit entityPrototypes, but in case sceneMode is recording, entities itself are edited.\nexport class WidgetManager {\n    entities: Entity[] = [];\n    widgetRoot: WidgetRoot;\n    transformIsDirty: boolean = false;\n    constructor() {\n        editorEventDispacher.listen(EditorEvent.EDITOR_CHANGE, (change: Change) => {\n            if (change.type === 'editorSelection') {\n                this.entities.length = 0;\n                if (editorSelection.type === 'epr') {\n                    this.entities = filterChildren(editorSelection.items.map((epr: EntityPrototype) => epr.previouslyCreatedEntity)) as Entity[];\n                    assert(!this.entities.find(ent => !ent), 'all entityPrototypes of widgetManager must have previouslyCreatedEntity');\n                } else if (editorSelection.type === 'ent') {\n                    this.entities = filterChildren(editorSelection.items) as Entity[];\n                }\n                this.updateWidgets();\n            }\n        });\n        editorEventDispacher.listen(EditorEvent.EDITOR_UNFOCUS, () => {\n            this.clear();\n        });\n        globalEventDispatcher.listen('scene load level', () => {\n            this.clear();\n        });\n        editorEventDispacher.listen(EditorEvent.EDITOR_SCENE_TOOL_CHANGED, newTool => {\n            this.updateWidgets();\n        });\n        editorEventDispacher.listen(EditorEvent.EDITOR_SCENE_MODE_CHANGED, () => {\n            this.updateWidgets();\n        });\n\n        forEachScene((scene: Scene) => {\n            scene.listen(GameEvent.SCENE_DRAW, () => {\n                if (this.transformIsDirty) {\n                    this.widgetRoot.updateTransform();\n                    this.transformIsDirty = false;\n                }\n            });\n        });\n    }\n    updateWidgets() {\n        if (!this.widgetRoot) {\n            return;\n        }\n        if (editorGlobals.sceneMode === SceneMode.PREVIEW) {\n            // In preview mode, you cannot edit anything\n            this.widgetRoot.update([]);\n        } else {\n            this.widgetRoot.update(this.entities);\n        }\n        this.transformIsDirty = false;\n    }\n    setParentElement(parent: HTMLElement) {\n        this.widgetRoot = new WidgetRoot();\n        mount(parent, this.widgetRoot);\n        this.updateWidgets();\n    }\n    clear() {\n        this.entities.length = 0;\n        this.updateWidgets();\n    }\n    updateTransform() {\n        if (this.widgetRoot) {\n            this.transformIsDirty = true;\n\n            // to activate movement effect when clicking down with mouse and dragging with keyboard movement\n            for (const widget of this.widgetRoot.widgets) {\n                widget.control.onMouseMove();\n            }\n        }\n    }\n}\n\nfunction editEntityInsteadOfEntityPrototype() {\n    return editorGlobals.sceneMode === SceneMode.RECORDING || !scene.isInInitialState()\n}\n\nclass WidgetRoot implements RedomComponent {\n    el: HTMLElement;\n    entities: Entity[];\n    worldPosition: Vector;\n    mousePosition: Vector;\n    angle: number;\n    widgets: Widget[] = [];\n\n    constructor() {\n        this.el = el('div.widgetRoot');\n    }\n    update(entities: Entity[]) {\n        this.entities = entities;\n        this.el.innerHTML = '';\n        this.widgets.length = 0;\n\n        if (entities.length === 0) {\n            return;\n        }\n\n        this.updateTransform();\n\n        if (sceneToolName === 'moveTool') {\n            this.widgets = [\n                new MoveWidget(this, 1, 0, '#ff0000'),\n                new MoveWidget(this, 0, 1, '#00ff00'),\n                new PositionWidget(this)\n            ];\n        } else if (sceneToolName === 'rotateTool') {\n            this.widgets = [\n                new AngleWidget(this, 'centerAngleWidget')\n            ];\n        } else if (sceneToolName === 'scaleTool') {\n            this.widgets = [\n                new ScaleWidget(this, new Vector(1, 0), new Vector(1, 0), '#ff0000', 5),\n                new ScaleWidget(this, new Vector(0, -1), new Vector(0, 1), '#00ff00', 5),\n                // new ScaleWidget(this, new Vector(0.85, -0.85), new Vector(1, 1), '#0000ff'),\n                new ScaleWidget(this, new Vector(0, 0), new Vector(1, 1), '#0000ff'),\n            ];\n        } else if (sceneToolName === 'multiTool') {\n            this.widgets = [\n                new ScaleWidget(this, new Vector(-1, 0), new Vector(1, 0), '#ff0000', 0),\n                new ScaleWidget(this, new Vector(0, 1), new Vector(0, 1), '#00ff00', 0),\n                new ScaleWidget(this, new Vector(0.85, 0.85), new Vector(1, 1), '#0000ff', 0),\n                new MoveWidget(this, 1, 0, '#ff0000'),\n                new MoveWidget(this, 0, 1, '#00ff00'),\n                new AngleWidget(this, 'littleAngleWidget'),\n                new PositionWidget(this)\n            ];\n        } else if (sceneToolName === 'globalMoveTool') {\n            this.widgets = [\n                new MoveWidget(this, 1, 0, '#ff0000'),\n                new MoveWidget(this, 0, 1, '#00ff00'),\n                new PositionWidget(this)\n            ];\n        }\n        for (const widget of this.widgets) {\n            mount(this.el, widget);\n        }\n    }\n\n    updateTransform() {\n        if (!this.entities || this.entities.length === 0) {\n            return;\n        }\n        let averagePosition = new Vector(0, 0);\n        for (const entity of this.entities) {\n            averagePosition.add(entity.Transform.getGlobalPosition());\n        }\n        this.setPosition(averagePosition.divideScalar(this.entities.length));\n        this.setAngle(this.entities[0].Transform.getGlobalAngle());\n    }\n\n    setPosition(worldPosition: Vector) {\n        this.worldPosition = worldPosition;\n        this.mousePosition = scene.worldToMouse(this.worldPosition);\n\n        this.el.style.left = this.mousePosition.x + 'px';\n        this.el.style.top = this.mousePosition.y + 'px';\n    }\n    move(worldMoveVector: Vector) {\n        this.setPosition(this.worldPosition.add(worldMoveVector));\n    }\n    setAngle(angle: number) {\n        this.angle = angle;\n        let angleDeg = angle * 180 / Math.PI;\n        this.el.style.transform = `rotate(${angleDeg}deg)`;\n    }\n    rotate(angleDifference: number) {\n        this.setAngle(this.angle + angleDifference);\n    }\n}\n\ntype Widget = RedomComponent & {\n    control: WidgetControl;\n};\n\nclass MoveWidget implements Widget {\n    el: HTMLElement;\n    relativePosition: Vector;\n    control: WidgetControl;\n    constructor(public widgetRoot: WidgetRoot, dx: number, dy: number, color: string, lineStartPixels: number = 30) {\n        this.relativePosition = new Vector(dx, -dy);\n        let angle = this.relativePosition.horizontalAngle() * 180 / Math.PI;\n        // let angle = this.relativePosition.angleTo(new Vector(1, 0)) * 180 / Math.PI;\n        this.el = el('div.widget.moveWidget',\n            new WidgetLine(WIDGET_DISTANCE, color, lineStartPixels),\n            this.control = new WidgetControl('.fas.fa-caret-right', {\n                left: WIDGET_DISTANCE + 'px',\n                color\n            }, (worldChange: Vector, worldPos: Vector) => {\n                let rotatedRelativePosition = this.relativePosition.clone();\n\n                let globalCoordinates = false;\n                if (!globalCoordinates)\n                    rotatedRelativePosition.rotate(this.widgetRoot.angle);\n\n                let moveVector = worldChange.getProjectionOn(rotatedRelativePosition);\n                this.widgetRoot.entities.forEach(entity => {\n                    const Transform = entity.getComponent('Transform');\n                    const newLocalPosition = Transform.getLocalPosition(Transform.getGlobalPosition().add(moveVector));\n                    if (editEntityInsteadOfEntityPrototype()) {\n                        entity.Transform.position = newLocalPosition\n                    } else {\n                        entity.prototype.getTransform().setValue('position', newLocalPosition)\n                    }\n\n                    // Transform.setGlobalPosition(Transform.getGlobalPosition().add(moveVector));\n                });\n\n                this.widgetRoot.move(moveVector);\n\n                // this.component.Transform.position = moveVector.add(this.component.Transform.position);\n            }),\n            {\n                style: {\n                    transform: `rotate(${angle}deg)`\n                }\n            }\n        );\n    }\n    update(data) {\n    }\n}\n\nclass PositionWidget implements Widget {\n    el: HTMLElement;\n    relativePosition: Vector;\n    control: WidgetControl;\n    constructor(public widgetRoot: WidgetRoot) {\n        //'.fas.fa-circle'\n        this.el = el('div.widget.positionWidget',\n            this.control = new WidgetControl(el('div.widgetControl.positionWidgetControl'),\n                null,\n                (worldChange: Vector, worldPos: Vector) => {\n                    this.widgetRoot.entities.forEach(entity => {\n                        let Transform = entity.getComponent('Transform');\n                        let newLocalPosition = Transform.getLocalPosition(Transform.getGlobalPosition().add(worldChange));\n\n                        if (editEntityInsteadOfEntityPrototype()) {\n                            entity.Transform.position = newLocalPosition\n                        } else {\n                            entity.prototype.getTransform().setValue('position', newLocalPosition);\n                        }\n                    });\n                    this.widgetRoot.move(worldChange);\n                }\n            )\n        )\n    }\n    update(data) {\n    }\n}\n\nconst MIN_SCALE = 0.01;\nclass ScaleWidget implements Widget {\n    el: HTMLElement;\n    control: WidgetControl;\n    /**\n     *\n     * @param widgetRoot\n     * @param relativePosition for example (1, 0) or (-1, 1)\n     * @param color\n     */\n    constructor(public widgetRoot: WidgetRoot, public relativePosition: Vector, public scaleDirection: Vector, color: string, lineStartPixels: number = 30) {\n        this.scaleDirection.normalize();\n\n        let length = this.relativePosition.length() * WIDGET_DISTANCE;\n        let angle = this.relativePosition.horizontalAngle() * 180 / Math.PI;\n\n        if (relativePosition.isZero()) {\n            // hacky\n            relativePosition.setScalars(1, -1);\n        }\n\n        this.el = el('div.widget.scaleWidget',\n            new WidgetLine(length, color, lineStartPixels),\n            this.control = new WidgetControl('.fas.fa-square', {\n                left: length + 'px',\n                color,\n                transform: `translateX(-50%) translateY(-50%) rotate(${-angle}deg)`\n            }, (worldChange: Vector, worldPos: Vector) => {\n                let widgetRootWorldPosition = this.widgetRoot.worldPosition;\n\n                let oldMousePosition = worldPos.clone().subtract(worldChange);\n                let widgetPosition = scene.mouseToWorld(scene.worldToMouse(widgetRootWorldPosition).add(this.relativePosition.clone().rotate(this.widgetRoot.angle).multiplyScalar(WIDGET_DISTANCE)));\n\n                let relativeWidgetPosition = widgetPosition.clone().subtract(widgetRootWorldPosition);\n                let relativeMousePosition = worldPos.clone().subtract(widgetRootWorldPosition);\n                let relativeOldMousePosition = oldMousePosition.subtract(widgetRootWorldPosition);\n\n                let mousePositionValue = relativeWidgetPosition.dot(relativeMousePosition) / relativeWidgetPosition.lengthSq();\n                let oldMousePositionValue = relativeWidgetPosition.dot(relativeOldMousePosition) / relativeWidgetPosition.lengthSq();\n\n                let change = mousePositionValue - oldMousePositionValue;\n\n                let changeVector = new Vector(1, 1).add(this.scaleDirection.clone().multiplyScalar(change / Math.max(1, Math.pow(mousePositionValue, 1))));\n\n                this.widgetRoot.entities.forEach(entity => {\n                    let scaleProperty\n\n                    if (editEntityInsteadOfEntityPrototype()) {\n                        scaleProperty = entity.Transform._properties['scale']\n                    } else {\n                        scaleProperty = entity.prototype.getTransform().getProperty('scale')\n                    }\n\n                    let newScale = scaleProperty.value.clone().multiply(changeVector);\n                    if (newScale.x < MIN_SCALE)\n                        newScale.x = MIN_SCALE;\n                    if (newScale.y < MIN_SCALE)\n                        newScale.y = MIN_SCALE;\n                    scaleProperty.value = newScale\n                });\n            }),\n            {\n                style: {\n                    transform: `rotate(${angle}deg)`\n                }\n            });\n    }\n    update(data) {\n    }\n}\n\nconst SHIFT_STEPS = 16;\nclass AngleWidget implements Widget {\n    el: HTMLElement;\n    relativePosition: Vector;\n    control: WidgetControl;\n    constructor(public widgetRoot: WidgetRoot, extraClass: 'centerAngleWidget' | 'littleAngleWidget' = 'centerAngleWidget') {\n        let color = '#0000ff';\n        this.el = el('div.widget.angleWidget.' + extraClass,\n            this.control = new WidgetControl('.fas.fa-sync-alt', {\n            }, (worldChange: Vector, worldPos: Vector) => {\n                let widgetRootWorldPosition = this.widgetRoot.worldPosition;\n                let oldMousePosition = worldPos.clone().subtract(worldChange);\n\n                let relativeMousePosition = worldPos.clone().subtract(widgetRootWorldPosition);\n                let relativeOldMousePosition = oldMousePosition.subtract(widgetRootWorldPosition);\n\n                let angle = relativeMousePosition.horizontalAngle();\n                let oldAngle = relativeOldMousePosition.horizontalAngle();\n\n                let angleDifference = angle - oldAngle;\n\n                // TODO: Needs to remember original drag cursor pos\n                /*\n                if (keyPressed(key.shift)) {\n                    let newWidgetAngle = this.widgetRoot.angle + angleDifference;\n                    newWidgetAngle += Math.PI / SHIFT_STEPS;\n                    newWidgetAngle -= newWidgetAngle % (Math.PI / SHIFT_STEPS * 2);\n                    angleDifference = newWidgetAngle - this.widgetRoot.angle;\n                }*/\n\n                this.widgetRoot.entities.forEach(entity => {\n                    let angleProperty\n                    if (editEntityInsteadOfEntityPrototype()) {\n                        angleProperty = entity.Transform._properties['angle']\n                    } else {\n                        angleProperty = entity.prototype.getTransform().getProperty('angle')\n                    }\n\n                    angleProperty.value = angleProperty.value + angleDifference\n                });\n\n                this.widgetRoot.rotate(angleDifference);\n\n                /*\n                let T = this.component.Transform;\n                let entityPosition = T.getGlobalPosition();\n\n                let relativeMousePosition = worldChange.clone().subtract(entityPosition);\n                let relativeWidgetPosition = new Vector(this.x, this.y).subtract(entityPosition);\n\n                let oldAngle = T.getGlobalAngle();\n                let mouseAngle = Math.PI + relativeMousePosition.horizontalAngle();\n                let widgetAngle = Math.PI + relativeWidgetPosition.horizontalAngle();\n\n                let newAngle = oldAngle + (mouseAngle - widgetAngle);\n                if (newAngle < 0)\n                    newAngle += Math.PI * 2;\n\n                if (keyPressed(key.shift)) {\n                    newAngle += Math.PI / SHIFT_STEPS;\n                    newAngle -= newAngle % (Math.PI / SHIFT_STEPS * 2);\n                }\n                let angleDifference = newAngle - oldAngle;\n\n                this.widgetRoot.entities.forEach(entity => {\n                    let Transform = entity.getComponent('Transform');\n                    Transform.angle = Transform.angle + angleDifference;\n                });\n\n                T.angle += angleDifference;\n                */\n            })\n        );\n    }\n    update(data) {\n    }\n}\n\nclass WidgetLine implements RedomComponent {\n    el: HTMLElement;\n    constructor(public length: number, public color: string, public startDrawingPos: number = 0) {\n        this.startDrawingPos = this.startDrawingPos;\n        this.el = el('div.widgetLine', {\n            style: {\n                left: this.startDrawingPos + 'px',\n                width: (length - this.startDrawingPos) + 'px',\n                backgroundColor: color,\n            }\n        });\n    }\n    update(data) {\n    }\n}\n\nclass WidgetControl implements RedomComponent {\n    el: HTMLElement;\n    previousWorldPos: Vector = new Vector(0, 0);\n    previousMousePos: Vector = new Vector(0, 0);\n    pressed: boolean = false;\n    constructor(iconClass: string | HTMLElement, style: object = {}, public callback: (worldChange: Vector, worldPos: Vector) => void, mouseDownCallback?: (worldPosition: Vector) => void) {\n        if (typeof iconClass === 'string') {\n            this.el = el('i.widgetControl' + iconClass, {\n                style\n            });\n        } else {\n            this.el = iconClass;\n        }\n        listenMouseDown(this.el, (worldPos: Vector, mouseEvent) => {\n            mouseEvent.stopPropagation();\n            this.pressed = true;\n            if (mouseDownCallback) {\n                mouseDownCallback(this.previousWorldPos)\n            }\n            document.getElementsByClassName('widgetRoot')[0].classList.add('dragging');\n            this.el.classList.add('dragging');\n        });\n        listenMouseUp(document.body, () => {\n            this.pressed = false;\n            document.getElementsByClassName('widgetRoot')[0].classList.remove('dragging');\n            this.el.classList.remove('dragging');\n        });\n        // TODO: Listen document body, but make the mouse position relative to canvas (0, 0)\n        // It would cause less stuckness when mouse leaves canvas\n        listenMouseMove(scene.canvas.parentElement, (mousePos, event) => {\n            this.onMouseMove(mousePos);\n        });\n    }\n    onMouseMove(mousePos: Vector = new Vector(0, 0)) {\n        if (!scene) {\n            return;\n        }\n        if (mousePos.isZero()) {\n            mousePos.set(this.previousMousePos);\n        }\n        this.previousMousePos.set(mousePos);\n        if (!this.pressed) {\n            this.previousWorldPos.set(scene.mouseToWorld(mousePos));\n            return;\n        }\n\n        let newWorldPos = scene.mouseToWorld(mousePos);\n        let change = newWorldPos.subtract(this.previousWorldPos);\n        if (change.isZero()) {\n            return;\n        }\n\n        this.previousWorldPos.add(change);\n\n        setChangeOrigin(this);\n        this.callback(change, this.previousWorldPos);\n    }\n    update(data) {\n    }\n}\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport {\n\tlistenMouseMove,\n\tlistenMouseDown,\n\tlistenMouseUp,\n\tlistenKeyDown,\n\tlistenKeyUp,\n\tkey,\n\tkeyPressed\n} from '../../util/input';\nimport Scene, { scene, forEachScene } from '../../core/scene';\nimport { game } from '../../core/game';\nimport EntityPrototype from '../../core/entityPrototype';\nimport assert from '../../util/assert';\nimport Entity from '../../core/entity';\nimport { Component } from '../../core/component';\nimport { setChangeOrigin, executeWithOrigin } from '../../core/change';\nimport * as sceneEdit from '../util/sceneEditUtil';\nimport Vector from '../../util/vector';\nimport { removeTheDeadFromArray, absLimit } from '../../util/algorithm';\nimport PIXI, { hitTest } from '../../features/graphics';\nimport * as performanceTool from '../../util/performance';\nimport { enableAllChanges, filterSceneChanges, disableAllChanges, setPropertyChangeSettings } from '../../core/property';\n\nimport '../components/EditorSelection';\n\nimport Serializable, { filterChildren } from \"../../core/serializable\";\nimport { limit } from \"../../util/callLimiter\";\nimport Level from '../../core/level';\nimport { GameEvent, globalEventDispatcher } from '../../core/eventDispatcher';\nimport { editorEventDispacher, EditorEvent } from '../editorEventDispatcher';\nimport { selectInEditor, editorSelection, unfocus } from '../editorSelection';\nimport Prefab from '../../core/prefab';\nimport CreateObject from '../views/popup/createObject';\nimport { editorGlobals, SceneMode } from '../editorGlobals';\nimport ComponentData from '../../core/componentData';\nimport { WidgetManager } from '../widget/widgetManager';\n\nconst MOVEMENT_KEYS = [key.w, key.a, key.s, key.d, key.up, key.left, key.down, key.right, key.plus, key.minus, key.questionMark, key.q, key.e];\nconst MIN_ZOOM = 0.1;\nconst MAX_ZOOM = 10;\n\n/**\n * Data flow:\n * SceneModule is in charge of scene entities.\n * If changes are made to prototypes, SceneModule will update changes to entities.\n * If changes are made to entities, it won't affect entityPrototypes automatically.\n */\n\n/*\n\nLevel-Scene sync:\n\n- If scene.isInInitialState & state = normal:\n\t- Edit level. addChange enabled in level edits\n\t- Don't edit scene. addChange disabled in scene edits\n\t- Sync everything from level to scene\n\t- state = preview:\n\t\t- Can also edit scene, but values are not stored.\n\t\t- preview state is mainly visual hint for user.\n\t- state = recording:\n\t\t- Edit scene & level\n\t\t- addChange enabled in scene & level\n\t\t- No sync in either direction\n- If not scene.isInInitialState:\n\t- Don't sync from level to scene. addChange enabled in level edits\n\t- Don't sync from scene to level. addChange enabled in scene edits only when properties of selected entities change. (for property editor)\n\nHow to do:\n- search for 'TODO: Level-Scene sync' (actually there aren't any yet)\n\n*/\n\nclass SceneModule extends Module {\n\tcanvas: HTMLCanvasElement;\n\thomeButton: HTMLElement;\n\tglobeButton: HTMLElement;\n\tcanvasParentSize: Vector = new Vector(0, 0);\n\tpreviousMousePosInWorldCoordinates: Vector = new Vector(0, 0);\n\tpreviousMousePosInMouseCoordinates: Vector = new Vector(0, 0);\n\tparentToAddNewEntitiesOn: EntityPrototype = null;\n\n\twidgetManager: WidgetManager = new WidgetManager();\n\n\twidgetEntity: Entity = null;\n\n\t/**\n\t * selectedEntities is the entity that is used in editing.\n\t * selectedEntities is needed in addition to editorSelection.\n\t * When entities are selected in scene, editorSelection will contain entityPrototype instead of entity.\n\t * */\n\tselectedEntities: Entity[] = [];\n\n\t/**\n\t * New entities are not in tree. This is the only link to them and their entityPrototype.\n\t * But it's going to change. These will be the links to entities in tree. If cancel (esc) is pressed, these are deleted from the tree.\n\t * It's because newEntities must be able to have parents with funny transforms.\n\t * */\n\tnewEntities: Entity[] = [];\n\n\t/**\n\t * Press 'v' to clone these to newEntities. copiedEntities are sleeping.\n\t */\n\tcopiedEntityPrototypes: EntityPrototype[] = [];\n\tselectionStart: Vector = null;\n\tselectionEnd: Vector = null;\n\teditorCameraPosition: Vector = new Vector(0, 0);\n\n\teditorCameraZoom: number = 1;\n\tselectionArea: PIXI.Graphics = null;\n\trequestAnimationFrameId: number;\n\tzoomInButtonPressed: boolean = false;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tlet disableMouseDown = e => {\n\t\t\te.returnValue = false;\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\treturn false;\n\t\t};\n\n\t\tthis.addElements(\n\t\t\tthis.canvas = <HTMLCanvasElement>el('canvas.openEditPlayCanvas.select-none', {\n\t\t\t\t// width and height will be fixed after loading\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t}),\n\t\t\tel('div.pauseInfo', `Paused. Editing objects will not affect the level.`),\n\t\t\tel('i.fas.fa-pause.pauseInfo.topLeft'),\n\t\t\tel('i.fas.fa-pause.pauseInfo.topRight'),\n\t\t\tel('i.fas.fa-pause.pauseInfo.bottomLeft'),\n\t\t\tel('i.fas.fa-pause.pauseInfo.bottomRight'),\n\t\t\tel('div.sceneEditorSideBarButtons',\n\n\t\t\t\tel('i.fas.fa-arrows-alt.iconButton.button.movement', {\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\talert('Move in editor with arrow keys or WASD');\n\t\t\t\t\t},\n\t\t\t\t\ttitle: 'Move in editor with arrow keys or WASD'\n\t\t\t\t}),\n\t\t\t\tel('i.fas.fa-plus-circle.iconButton.button.zoomIn', {\n\t\t\t\t\tonclick: (mouseEvent) => {\n\t\t\t\t\t\tif (!scene) return;\n\t\t\t\t\t\tscene.setZoom(Math.min(MAX_ZOOM, scene.cameraZoom * 1.4));\n\t\t\t\t\t\tthis.cameraPositionOrZoomUpdated();\n\t\t\t\t\t\tthis.draw();\n\t\t\t\t\t\tmouseEvent.stopPropagation(); // Don't unfocus\n\t\t\t\t\t\tmouseEvent.preventDefault();\n\t\t\t\t\t},\n\t\t\t\t\ttitle: 'Zoom in (+ or E)'\n\t\t\t\t}),\n\t\t\t\tel('i.fas.fa-minus-circle.iconButton.button.zoomOut', {\n\t\t\t\t\tonclick: (mouseEvent) => {\n\t\t\t\t\t\tif (!scene) return;\n\t\t\t\t\t\tscene.setZoom(Math.max(MIN_ZOOM, scene.cameraZoom / 1.4));\n\t\t\t\t\t\tthis.cameraPositionOrZoomUpdated();\n\t\t\t\t\t\tthis.draw();\n\t\t\t\t\t\tmouseEvent.stopPropagation(); // Don't unfocus\n\t\t\t\t\t\tmouseEvent.preventDefault();\n\t\t\t\t\t},\n\t\t\t\t\ttitle: 'Zoom out (- or Q)'\n\t\t\t\t}),\n\t\t\t\tthis.globeButton = el('i.fas.fa-globe.iconButton.button', {\n\t\t\t\t\tonclick: (mouseEvent) => {\n\t\t\t\t\t\tif (!scene) return;\n\n\t\t\t\t\t\tlet bounds = scene.layers.move.getLocalBounds();\n\n\t\t\t\t\t\tscene.cameraPosition.setScalars(\n\t\t\t\t\t\t\tbounds.x + bounds.width / 2,\n\t\t\t\t\t\t\tbounds.y + bounds.height / 2\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tlet maxXZoom = this.canvas.width / bounds.width;\n\t\t\t\t\t\tlet maxYZoom = this.canvas.height / bounds.height;\n\t\t\t\t\t\tscene.setZoom(Math.min(Math.min(maxXZoom, maxYZoom) * 0.9, 1));\n\t\t\t\t\t\tthis.cameraPositionOrZoomUpdated();\n\n\t\t\t\t\t\tthis.draw();\n\t\t\t\t\t\tmouseEvent.stopPropagation(); // Don't unfocus\n\t\t\t\t\t\tmouseEvent.preventDefault();\n\t\t\t\t\t},\n\t\t\t\t\ttitle: 'Zoom to globe (G)'\n\t\t\t\t}),\n\t\t\t\tthis.homeButton = el('i.fas.fa-home.iconButton.button', {\n\t\t\t\t\tonclick: (mouseEvent) => {\n\t\t\t\t\t\tif (!scene) return;\n\t\t\t\t\t\tscene.cameraPosition.setScalars(0, 0); // If there are no players\n\t\t\t\t\t\tscene.setCameraPositionToPlayer();\n\t\t\t\t\t\tscene.setZoom(1);\n\t\t\t\t\t\tthis.cameraPositionOrZoomUpdated();\n\t\t\t\t\t\tthis.draw();\n\t\t\t\t\t\tmouseEvent.stopPropagation(); // Don't unfocus\n\t\t\t\t\t\tmouseEvent.preventDefault();\n\t\t\t\t\t},\n\t\t\t\t\ttitle: 'Go home to player or to default start position (H)'\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\t\tthis.el.classList.add('hideScenePauseInformation');\n\t\tthis.widgetManager.setParentElement(this.el);\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_CLONE, () => {\n\t\t\tif (editorSelection.type === 'epr') {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tthis.deleteNewEntities();\n\t\t\t\tlet entityPrototypes = filterChildren(editorSelection.items) as EntityPrototype[]\n\t\t\t\tthis.copyEntityPrototypes(entityPrototypes)\n\t\t\t\tthis.newEntities.push(...entityPrototypes.map(epr => epr.cloneWithNewSiblingId().createEntity(epr.previouslyCreatedEntity.getParent())))\n\t\t\t\tthis.clearSelectedEntities();\n\t\t\t\tsceneEdit.setEntityPositions(this.newEntities, this.previousMousePosInWorldCoordinates);\n\t\t\t\tthis.draw();\n\t\t\t\tselectInEditor([], this);\n\t\t\t} else if (editorSelection.type === 'ent') {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tthis.deleteNewEntities();\n\t\t\t\tlet entities = filterChildren(editorSelection.items) as Entity[]\n\t\t\t\tthis.copyEntityPrototypes(entities.map(ent => ent.prototype) as EntityPrototype[]);\n\t\t\t\tthis.newEntities.push(...entities.map(ent => ent.clone(ent.getParent())))\n\t\t\t\tthis.clearSelectedEntities();\n\t\t\t\tsceneEdit.setEntityPositions(this.newEntities, this.previousMousePosInWorldCoordinates);\n\t\t\t\tthis.draw();\n\t\t\t\tselectInEditor([], this);\n\t\t\t}\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_SCENE_MODE_CHANGED, () => {\n\t\t\tthis.updatePropertyChangeCreationFilter()\n\t\t\tthis.widgetManager.updateWidgets()\n\t\t}, 10000)\n\n\t\teditorEventDispacher.listen('locate serializable', serializable => {\n\t\t\tif (serializable.threeLetterType === 'epr') {\n\t\t\t\tlet entityPrototype = serializable;\n\t\t\t\tif (entityPrototype.previouslyCreatedEntity) {\n\t\t\t\t\tlet globalPosition = entityPrototype.previouslyCreatedEntity.getComponent('Transform').getGlobalPosition();\n\t\t\t\t\tthis.goToLocation(globalPosition);\n\t\t\t\t} else {\n\t\t\t\t\tthis.goToLocation(entityPrototype.position);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_SCENE_TOOL_CHANGED, () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.draw();\n\t\t\t}, 0);\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_PRE_DELETE_SELECTION, () => {\n\t\t\tif (editorSelection.type === 'ent' && sceneEdit.shouldSyncLevelToScene()) {\n\t\t\t\teditorSelection.items.forEach((e: Entity) => e.prototype.delete());\n\t\t\t}\n\t\t});\n\n\t\tglobalEventDispatcher.listen(GameEvent.GLOBAL_ENTITY_CLICKED, (entity: Entity, component: Component) => {\n\t\t\tthis.entityClicked(entity, component);\n\t\t});\n\n\t\tlet fixAspectRatio = () => this.fixAspectRatio();\n\n\t\twindow.addEventListener(\"resize\", fixAspectRatio);\n\t\teditorEventDispacher.listen('layoutResize', () => {\n\t\t\tsetTimeout(fixAspectRatio, 500);\n\t\t});\n\t\tsetTimeout(fixAspectRatio, 0);\n\n\t\tthis.id = 'scene';\n\t\tthis.name = 'Scene';\n\n\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_REGISTER_HELP_VARIABLE, 'sceneModule', this);\n\n\t\tthis.previousMousePosInWorldCoordinates = null;\n\t\tthis.previousMousePosInMouseCoordinates = null;\n\n\t\tthis.entitiesToEdit = []; // A widget is editing these entities when mouse is held down.\n\n\t\tthis.entitiesInSelection = [];\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_RESET, () => {\n\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\tunfocus();\n\n\t\t\tsetChangeOrigin(this);\n\t\t\tthis.stopAndReset();\n\n\t\t\tif (scene && scene.layers.editorLayer)\n\t\t\t\tscene.layers.editorLayer.visible = true;\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_PLAY, () => {\n\t\t\tif (!scene || !scene.level)\n\t\t\t\treturn;\n\n\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\n\t\t\tunfocus();\n\n\t\t\tsetChangeOrigin(this);\n\t\t\tthis.clearState();\n\n\t\t\tif (scene.isInInitialState())\n\t\t\t\tscene.setZoom(1);\n\n\t\t\tscene.layers.editorLayer.visible = false;\n\t\t\tscene.play();\n\t\t\tthis.playingModeChanged();\n\t\t\tthis.updatePropertyChangeCreationFilter();\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_PAUSE, () => {\n\t\t\tif (!scene || !scene.level)\n\t\t\t\treturn;\n\n\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\n\t\t\tunfocus();\n\n\t\t\tsetChangeOrigin(this);\n\t\t\tthis.clearState();\n\n\t\t\tif (scene.isInInitialState())\n\t\t\t\tscene.setZoom(1);\n\n\t\t\tscene.layers.editorLayer.visible = true;\n\t\t\tscene.pause();\n\n\t\t\tthis.draw();\n\t\t\tthis.playingModeChanged();\n\t\t\tthis.updatePropertyChangeCreationFilter();\n\t\t});\n\t\t/*\n\t\t\t\tthis.primaryButton = new TopButton({\n\t\t\t\t\ttext: el('span', el('u', 'P'), 'lay'),\n\t\t\t\t\ticonClass: 'fa-play',\n\t\t\t\t\tcallback: btn => {\n\t\t\t\t\t\tif (!scene || !scene.level)\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tsetChangeOrigin(this);\n\n\t\t\t\t\t\t// this.makeSureSceneHasEditorLayer();\n\n\t\t\t\t\t\tthis.clearState();\n\n\t\t\t\t\t\tif (scene.isInInitialState())\n\t\t\t\t\t\t\tscene.setZoom(1);\n\n\t\t\t\t\t\tif (scene.playing) {\n\t\t\t\t\t\t\tscene.layers.editorLayer.visible = true;\n\t\t\t\t\t\t\tscene.pause();\n\t\t\t\t\t\t\tthis.draw();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tscene.layers.editorLayer.visible = false;\n\t\t\t\t\t\t\tscene.play();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.playingModeChanged();\n\t\t\t\t\t\tthis.updatePropertyChangeCreationFilter();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.stopButton = new TopButton({\n\t\t\t\t\ttext: el('span', el('u', 'R'), 'eset'),\n\t\t\t\t\ticonClass: 'fa-stop',\n\t\t\t\t\tcallback: btn => {\n\t\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\t\tthis.stopAndReset();\n\n\t\t\t\t\t\tif (scene.layers.editorLayer)\n\t\t\t\t\t\t\tscene.layers.editorLayer.visible = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t*/\n\n\t\tgame.listen(GameEvent.GAME_LEVEL_COMPLETED, () => {\n\t\t\tthis.playingModeChanged();\n\t\t\tthis.draw();\n\t\t});\n\n\t\teditorEventDispacher.listen('setLevel', (lvl: Level) => {\n\t\t\tif (lvl)\n\t\t\t\tlvl.createScene(null);\n\t\t\telse if (scene) {\n\t\t\t\tscene.delete();\n\t\t\t}\n\n\t\t\tthis.playingModeChanged();\n\n\t\t\tthis.clearState();\n\t\t\tthis.draw();\n\n\t\t\tthis.canvasParentSize.setScalars(0, 0); // force aspect ratio fix for new scene\n\t\t\tthis.fixAspectRatio();\n\t\t});\n\n\t\tglobalEventDispatcher.listen('scene load level before entities', (scene, level) => {\n\t\t\tassert(!scene.layers.editorLayer, 'editorLayer should not be there');\n\n\t\t\tscene.layers.editorLayer = new PIXI.Container();\n\t\t\tscene.layers.move.addChild(scene.layers.editorLayer);\n\n\t\t\tscene.layers.widgetLayer = new PIXI.Container();\n\t\t\tscene.layers.positionHelperLayer = new PIXI.Container();\n\t\t\tscene.selectionLayer = new PIXI.Container();\n\n\t\t\tscene.layers.editorLayer.addChild(\n\t\t\t\tscene.layers.widgetLayer,\n\t\t\t\tscene.layers.positionHelperLayer,\n\t\t\t\tscene.selectionLayer\n\t\t\t);\n\t\t});\n\n\t\t// Change in serializable tree\n\t\teditorEventDispacher.listen('prototypeClicked', prototype => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\n\t\t\tperformanceTool.start('Editor: Scene');\n\n\t\t\tthis.clearState();\n\n\t\t\t/*\n\t\t\t let entityPrototype = EntityPrototype.createFromPrototype(prototype, []);\n\t\t\t entityPrototype.position = new Vector(this.canvas.width/2, this.canvas.height/2);\n\t\t\t let newEntity = entityPrototype.createEntity(this);\n\t\t\t this.newEntities.push(newEntity);\n\t\t\t */\n\n\t\t\tthis.draw();\n\n\t\t\tperformanceTool.stop('Editor: Scene');\n\t\t});\n\n\t\tglobalEventDispatcher.listen('new entity created', entity => {\n\t\t\tif (!entity.prototype._rootType) {\n\t\t\t\treturn; // Temporary entity. (new entities are probably like this. they appear when you copy entities) No need to make them selectable.\n\t\t\t}\n\t\t\tlet handleEntity = entity => {\n\t\t\t\tentity.addComponents([\n\t\t\t\t\tComponent.create('EditorSelection')\n\t\t\t\t]);\n\t\t\t};\n\n\t\t\thandleEntity(entity);\n\t\t\tentity.forEachChild('ent', handleEntity, true);\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_DRAW_NEEDED, () => this.draw())\n\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_CHANGE, change => {\n\t\t\tif (scene && scene.resetting) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tperformanceTool.start('Editor: Scene');\n\n\t\t\tif (change.type === 'editorSelection' && change.origin !== this) {\n\t\t\t\tthis.updatePropertyChangeCreationFilter();\n\t\t\t\tthis.clearSelectedEntities();\n\t\t\t\tif (change.reference.type === 'epr') {\n\t\t\t\t\tlet idSet = new Set(change.reference.items.map(item => item.id));\n\t\t\t\t\tlet entities: Entity[] = [];\n\t\t\t\t\tscene.forEachChild('ent', (ent: Entity) => {\n\t\t\t\t\t\tif (idSet.has(ent.prototype.id)) {\n\t\t\t\t\t\t\tentities.push(ent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t\tthis.selectEntities(entities);\n\t\t\t\t} else if (change.reference.type === 'ent') {\n\t\t\t\t\t/*\n\t\t\t\t\tlet idSet = new Set(change.reference.items.map(item => item.id));\n\t\t\t\t\tlet entities: Entity[] = [];\n\t\t\t\t\tscene.forEachChild('ent', (ent: Entity) => {\n\t\t\t\t\t\tif (idSet.has(ent.prototype.id)) {\n\t\t\t\t\t\t\tentities.push(ent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);*/\n\t\t\t\t\tthis.selectEntities(change.reference.items);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\texecuteWithOrigin(this, () => {\n\t\t\t\tsceneEdit.syncAChangeFromLevelToScene(change);\n\t\t\t})\n\t\t\tthis.draw();\n\n\t\t\tperformanceTool.stop('Editor: Scene');\n\t\t});\n\n\t\tlistenKeyDown(k => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\n\t\t\tsetChangeOrigin(this);\n\t\t\tif (k === key.esc) {\n\t\t\t\tthis.clearState();\n\t\t\t\tthis.draw();\n\t\t\t} else if (k === key.v) {\n\t\t\t\tthis.pasteEntities();\n\t\t\t\tthis.draw();\n\t\t\t} else if (k === key.n) {\n\t\t\t\tnew CreateObject();\n\t\t\t} else if (scene) {\n\t\t\t\t// Scene controls\n\t\t\t\tif (k === key['0']) {\n\t\t\t\t\tscene.setZoom(1);\n\t\t\t\t\tthis.cameraPositionOrZoomUpdated();\n\t\t\t\t\tthis.draw();\n\t\t\t\t} else if (MOVEMENT_KEYS.includes(k)) {\n\t\t\t\t\tif (k === key.plus || k === key.questionMark || k === key.e)\n\t\t\t\t\t\tthis.zoomInButtonPressed = true;\n\n\t\t\t\t\tthis.startListeningMovementInput();\n\t\t\t\t} else if (!scene.playing) {\n\t\t\t\t\tif (k === key.g) {\n\t\t\t\t\t\tthis.globeButton.click();\n\t\t\t\t\t} else if (k === key.h) {\n\t\t\t\t\t\tthis.homeButton.click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tlistenKeyUp(k => {\n\t\t\tif (k === key.plus || k === key.questionMark || k === key.e)\n\t\t\t\tthis.zoomInButtonPressed = false;\n\t\t});\n\n\t\tlistenMouseMove(this.el, this.onMouseMove.bind(this));\n\n\t\tfunction getEntityUnderMouse(pixiCoordinates: Vector, displayObject = scene.stage): Entity {\n\t\t\tif (displayObject.selectableEntityHitTest) {\n\t\t\t\tif (displayObject.selectableEntityHitTest(displayObject, pixiCoordinates, scene.stage)) {\n\t\t\t\t\treturn displayObject.selectableEntityOfSprite\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet children = displayObject.children;\n\t\t\t\tfor (let i = children.length - 1; i >= 0; i--) {\n\t\t\t\t\tlet entity = getEntityUnderMouse(pixiCoordinates, children[i]);\n\t\t\t\t\tif (entity) {\n\t\t\t\t\t\treturn entity;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\tlistenMouseDown(this.el, mousePos => {\n\t\t\t// Also see what happens in GameEvent.GLOBAL_ENTITY_CLICKED\n\n\t\t\tif (!scene || !mousePos || scene.playing) // !mousePos if mouse has not moved since refresh\n\t\t\t\treturn;\n\n\t\t\t// this.makeSureSceneHasEditorLayer();\n\n\t\t\tlet pixiCoordinates = scene.mouseToPIXI(mousePos);\n\t\t\tmousePos = scene.mouseToWorld(mousePos);\n\n\t\t\tsetChangeOrigin(this);\n\n\t\t\tif (this.newEntities.length > 0)\n\t\t\t\tsceneEdit.addEntitiesToLevel(this.newEntities);\n\t\t\telse {\n\t\t\t\tlet clickedEntity = getEntityUnderMouse(pixiCoordinates);\n\t\t\t\tif (clickedEntity) {\n\t\t\t\t\tthis.entityClicked(clickedEntity);\n\t\t\t\t\tthis.updatePropertyChangeCreationFilter()\n\t\t\t\t} else if (!sceneEdit.isMultiSelectModifierPressed()) {\n\t\t\t\t\tthis.clearSelectedEntities();\n\t\t\t\t\tunfocus();\n\n\t\t\t\t\t// Start selection\n\t\t\t\t\tthis.selectionStart = mousePos;\n\t\t\t\t\tthis.selectionEnd = mousePos.clone();\n\t\t\t\t\tthis.destroySelectionArea();\n\t\t\t\t\tthis.selectionArea = new PIXI.Graphics();\n\t\t\t\t\tscene.selectionLayer.addChild(this.selectionArea);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.draw();\n\t\t});\n\t\tlistenMouseUp(this.el, (/*mousePos*/) => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\t\t\t// mousePos = scene.mouseToWorld(mousePos);\n\n\t\t\tthis.selectionStart = null;\n\t\t\tthis.selectionEnd = null;\n\t\t\tthis.destroySelectionArea();\n\t\t\tthis.entitiesToEdit.length = 0;\n\n\t\t\tif (this.entitiesInSelection.length > 0) {\n\t\t\t\tif (sceneEdit.isMultiSelectModifierPressed()) {\n\t\t\t\t\tthis.entitiesInSelection.push(...this.selectedEntities);\n\t\t\t\t}\n\t\t\t\tthis.selectEntities(this.entitiesInSelection);\n\n\t\t\t\tsceneEdit.setEntitiesInSelectionArea(this.entitiesInSelection, false);\n\t\t\t\tthis.entitiesInSelection.length = 0;\n\t\t\t\tthis.selectSelectedEntitiesInEditor();\n\t\t\t}\n\n\t\t\tthis.draw();\n\t\t});\n\n\t\teditorEventDispacher.listen('dragPrefabsStarted', (prefabs: Prefab[]) => {\n\t\t\tthis.newEntities = prefabs.map(pfa => pfa.createEntity());\n\t\t});\n\t\teditorEventDispacher.listen('dragPrototypeStarted', prototypes => {\n\t\t\tlet entityPrototypes = prototypes.map(prototype => {\n\t\t\t\tlet entityPrototype = EntityPrototype.createFromPrototype(prototype);\n\t\t\t\t// entityPrototype.position = this.previousMousePosInWorldCoordinates;\n\t\t\t\treturn entityPrototype;\n\t\t\t});\n\n\t\t\tthis.newEntities = entityPrototypes.map(epr => epr.createEntity());\n\t\t});\n\t\tlet entityDragEnd = () => {\n\t\t\tsetChangeOrigin(this);\n\t\t\tsceneEdit.addEntitiesToLevel(this.newEntities);\n\n\t\t\tthis.clearState();\n\t\t\tthis.selectEntities([]);\n\t\t\tthis.selectSelectedEntitiesInEditor();\n\n\t\t\tthis.draw();\n\t\t};\n\t\teditorEventDispacher.listen('dragPrototypeToCanvas', entityDragEnd);\n\t\teditorEventDispacher.listen('dragPrefabsToScene', entityDragEnd);\n\n\t\teditorEventDispacher.listen('dragPrototypeToNonCanvas', () => {\n\t\t\tthis.clearState();\n\t\t});\n\t\teditorEventDispacher.listen('dragPrefabsToNonScene', () => {\n\t\t\tthis.clearState();\n\t\t});\n\t}\n\n\tentityClicked(entity: Entity, component?: Component) {\n\t\tif (!scene || scene.playing) // !mousePos if mouse has not moved since refresh\n\t\t\treturn;\n\n\t\tif (this.selectedEntities.indexOf(entity) < 0) {\n\t\t\t// debugger;\n\t\t\tif (sceneEdit.isMultiSelectModifierPressed()) {\n\t\t\t\tthis.selectEntities([...this.selectedEntities, entity]);\n\t\t\t} else {\n\t\t\t\tthis.selectEntities([entity]);\n\t\t\t}\n\n\t\t\tthis.selectSelectedEntitiesInEditor();\n\t\t}\n\t}\n\n\t// mousePos is optional. returns true if scene has been drawn\n\tonMouseMove(mouseCoordinatePosition?) {\n\t\tif (!scene || !mouseCoordinatePosition && !this.previousMousePosInMouseCoordinates)\n\t\t\treturn false;\n\n\t\tperformanceTool.start('Editor: Scene');\n\n\t\t// let mousePosInScreenCoordinates = mouseCoordinatePosition || this.previousMousePosInMouseCoordinates;\n\t\tlet mousePos = scene.mouseToWorld(mouseCoordinatePosition || this.previousMousePosInMouseCoordinates);\n\n\t\tif (mouseCoordinatePosition)\n\t\t\tthis.previousMousePosInMouseCoordinates = mouseCoordinatePosition;\n\n\t\tlet needsDraw = false;\n\n\t\tsetChangeOrigin(this);\n\t\tlet change = this.previousMousePosInWorldCoordinates ? mousePos.clone().subtract(this.previousMousePosInWorldCoordinates) : mousePos;\n\n\t\tif (this.newEntities.length > 0) {\n\t\t\tsceneEdit.setEntityPositions(this.newEntities, mousePos); // these are not in scene\n\t\t\tneedsDraw = true;\n\t\t}\n\n\t\tif (this.selectionEnd) {\n\t\t\tthis.selectionEnd.add(change);\n\t\t\tthis.redrawSelectionArea();\n\n\t\t\tif (this.entitiesInSelection.length > 0) {\n\t\t\t\tsceneEdit.setEntitiesInSelectionArea(this.entitiesInSelection, false);\n\t\t\t}\n\t\t\tthis.entitiesInSelection = sceneEdit.getEntitiesInSelection(scene.worldToMouse(this.selectionStart), scene.worldToMouse(this.selectionEnd));\n\t\t\tsceneEdit.setEntitiesInSelectionArea(this.entitiesInSelection, true);\n\n\t\t\tneedsDraw = true;\n\t\t}\n\n\t\tthis.previousMousePosInWorldCoordinates = mousePos;\n\n\t\tif (needsDraw)\n\t\t\tthis.draw();\n\n\t\tperformanceTool.stop('Editor: Scene');\n\n\t\treturn needsDraw;\n\t}\n\n\tredrawSelectionArea() {\n\t\tthis.selectionArea.clear();\n\t\tthis.selectionArea.lineStyle(scene.screenPixelsToWorldPixels(2.5), 0xFFFFFF, 0.7);\n\t\tthis.selectionArea.beginFill(0xFFFFFF, 0.3);\n\t\tthis.selectionArea.drawRect(\n\t\t\tthis.selectionStart.x,\n\t\t\tthis.selectionStart.y,\n\t\t\tthis.selectionEnd.x - this.selectionStart.x,\n\t\t\tthis.selectionEnd.y - this.selectionStart.y\n\t\t);\n\n\t\tthis.selectionArea.endFill();\n\t}\n\n\tstartListeningMovementInput() {\n\t\t// clearTimeout(this.movementInputTimeout);\n\t\twindow.cancelAnimationFrame(this.requestAnimationFrameId);\n\n\t\tconst cameraPositionSpeed = 300;\n\t\tconst cameraZoomSpeed = 0.8;\n\t\tlet lastTime = performance.now();\n\n\t\tconst update = () => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\n\t\t\tlet currentTime = performance.now();\n\t\t\tlet dt = (currentTime - lastTime) / 1000;\n\t\t\tlastTime = currentTime;\n\n\t\t\tlet dx = 0,\n\t\t\t\tdy = 0,\n\t\t\t\tdz = 0;\n\n\t\t\tif (keyPressed(key.up) || keyPressed(key.w)) dy -= 1;\n\t\t\tif (keyPressed(key.down) || keyPressed(key.s)) dy += 1;\n\t\t\tif (keyPressed(key.left) || keyPressed(key.a)) dx -= 1;\n\t\t\tif (keyPressed(key.right) || keyPressed(key.d)) dx += 1;\n\t\t\tif (this.zoomInButtonPressed) dz += 1;\n\t\t\tif (keyPressed(key.minus) || keyPressed(key.q)) dz -= 1;\n\n\t\t\tif (dx === 0 && dy === 0 && dz === 0) {\n\t\t\t\tif (!MOVEMENT_KEYS.find(keyPressed))\n\t\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tlet speed = 1;\n\t\t\t\tif (keyPressed(key.shift))\n\t\t\t\t\tspeed *= 3;\n\n\t\t\t\tlet cameraMovementSpeed = speed * cameraPositionSpeed * dt / scene.cameraZoom;\n\t\t\t\tscene.cameraPosition.x = absLimit(scene.cameraPosition.x + dx * cameraMovementSpeed, 5000);\n\t\t\t\tscene.cameraPosition.y = absLimit(scene.cameraPosition.y + dy * cameraMovementSpeed, 5000);\n\n\n\t\t\t\tif (dz !== 0) {\n\t\t\t\t\tlet zoomMultiplier = 1 + speed * cameraZoomSpeed * dt;\n\n\t\t\t\t\tif (dz > 0)\n\t\t\t\t\t\tscene.setZoom(Math.min(MAX_ZOOM, scene.cameraZoom * zoomMultiplier));\n\t\t\t\t\telse if (dz < 0)\n\t\t\t\t\t\tscene.setZoom(Math.max(MIN_ZOOM, scene.cameraZoom / zoomMultiplier));\n\t\t\t\t}\n\n\t\t\t\tthis.cameraPositionOrZoomUpdated();\n\t\t\t\tscene.updateCamera();\n\n\t\t\t\tlet drawHappened = this.onMouseMove();\n\n\t\t\t\tif (!drawHappened)\n\t\t\t\t\tthis.draw();\n\t\t\t}\n\n\t\t\tthis.requestAnimationFrameId = requestAnimationFrame(update);\n\t\t\t// this.movementInputTimeout = setTimeout(update, 17);\n\t\t};\n\n\t\tif (scene && !scene.playing) {\n\t\t\tupdate();\n\t\t}\n\t}\n\n\tgoToLocation(vector) {\n\t\tscene.cameraPosition.set(vector);\n\t\tthis.cameraPositionOrZoomUpdated();\n\t\tscene.updateCamera();\n\t\tthis.onMouseMove();\n\t\tthis.draw();\n\t}\n\n\tcameraPositionOrZoomUpdated() {\n\t\tif (scene && scene.isInInitialState()) {\n\t\t\tthis.editorCameraPosition = scene.cameraPosition.clone();\n\t\t\tthis.editorCameraZoom = scene.cameraZoom;\n\t\t}\n\t\tthis.widgetManager.updateTransform();\n\t}\n\n\tupdate() {\n\t\tthis.draw();\n\t}\n\n\tplayingModeChanged() {\n\t\tif (!scene) {\n\t\t\tthis.el.classList.add('noScene');\n\t\t\tthis.el.classList.remove('playing', 'hideScenePauseInformation');\n\t\t\treturn;\n\t\t}\n\n\t\tlet isInitialState = scene.isInInitialState();\n\n\t\tthis.el.classList.toggle('isInitialState', isInitialState);\n\n\t\tif (scene.playing) {\n\t\t\tthis.el.classList.remove('noScene');\n\t\t\tthis.el.classList.add('hideScenePauseInformation', 'playing');\n\t\t} else {\n\t\t\tthis.el.classList.remove('noScene', 'playing');\n\t\t\tthis.el.classList.toggle('hideScenePauseInformation', isInitialState);\n\t\t}\n\t}\n\n\tfixAspectRatio(secondaryCheck?= false) {\n\t\tif (scene && this.canvas) {\n\t\t\tlet change = false;\n\t\t\tif (this.canvasParentSize.x !== this.canvas.parentElement.offsetWidth && this.canvas.parentElement.offsetWidth\n\t\t\t\t|| this.canvasParentSize.y !== this.canvas.parentElement.offsetHeight && this.canvas.parentElement.offsetHeight) {\n\n\t\t\t\t// Here you can tweak the game resolution in editor.\n\t\t\t\t// scene.renderer.resize(this.canvas.parentElement.offsetWidth / 2, this.canvas.parentElement.offsetHeight / 2);\n\t\t\t\tlet width = this.canvas.parentElement.offsetWidth;\n\t\t\t\tlet height = this.canvas.parentElement.offsetHeight;\n\n\t\t\t\tthis.canvasParentSize.setScalars(width, height);\n\n\t\t\t\t// Here you can change the resolution of the canvas\n\t\t\t\tlet pixels = width * height;\n\t\t\t\tlet quality = 1;\n\n\t\t\t\t/*\n\t\t\t\tThis doesn't work. Mouse position gets messed up.\n\t\t\t\t*/\n\t\t\t\tconst MAX_PIXELS = 800 * 400;\n\t\t\t\tif (pixels > MAX_PIXELS) {\n\t\t\t\t\tquality = Math.sqrt(MAX_PIXELS / pixels);\n\t\t\t\t}\n\n\t\t\t\tlet screenResolution = new Vector(width, height);\n\t\t\t\tlet gameResolution = screenResolution.clone().multiplyScalar(quality);\n\n\t\t\t\tscene.resizeCanvas(gameResolution, screenResolution);\n\n\t\t\t\tchange = true;\n\t\t\t}\n\n\t\t\t// scene.renderer.resize(this.canvas.width, this.canvas.height);\n\n\t\t\tif (change) {\n\t\t\t\tglobalEventDispatcher.dispatch('canvas resize', scene);\n\t\t\t\tthis.widgetManager.updateTransform();\n\t\t\t\tthis.draw();\n\t\t\t}\n\n\t\t\t// Lets see if it has changed after 200ms.\n\t\t\tsetTimeout(() => this.fixAspectRatio(true), 200);\n\t\t}\n\t}\n\n\tdraw() {\n\t\tif (scene) {\n\t\t\tif (!scene.playing) {\n\t\t\t\tthis.filterDeadSelection();\n\t\t\t\tmakeADrawRequest();\n\t\t\t}\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (game.getChildren('lvl').length === 0) {\n\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\teditorEventDispacher.dispatch('createBlankLevel');\n\t\t\t\t}\n\t\t\t}, 500)\n\t\t}\n\t}\n\n\tdrawNoLevel() {\n\t\t/*\n\t\t this.canvas.width = this.canvas.width;\n\t\t let context = this.canvas.getContext('2d');\n\t\t context.font = '20px arial';\n\t\t context.fillStyle = 'white';\n\t\t context.fillText('No level selected', 20, 35);\n\t\t */\n\t}\n\n\tdrawEmptyLevel() {\n\t\t/*\n\t\t let context = this.canvas.getContext('2d');\n\t\t context.font = '20px arial';\n\t\t context.fillStyle = 'white';\n\t\t context.fillText('Empty level. Click a type and place it here.', 20, 35);\n\t\t */\n\t}\n\n\tselectEntities(entities: Entity[]) {\n\t\tif (editorGlobals.sceneMode === SceneMode.RECORDING) {\n\t\t\tentities = entities.filter((entity: Entity) => {\n\t\t\t\tlet parent: Serializable = entity.prototype;\n\t\t\t\twhile (parent && parent !== editorGlobals.animationEntityPrototype) {\n\t\t\t\t\tparent = parent._parent;\n\t\t\t\t}\n\t\t\t\treturn parent === editorGlobals.animationEntityPrototype;\n\t\t\t});\n\t\t} else if (editorGlobals.sceneMode === SceneMode.PREVIEW) {\n\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t}\n\t\tthis.clearSelectedEntities();\n\t\tthis.selectedEntities.push(...entities);\n\t\tthis.selectedEntities.forEach(entity => {\n\t\t\tentity.getComponent('EditorSelection').select();\n\t\t});\n\t}\n\n\tclearSelectedEntities() {\n\t\tthis.selectedEntities.forEach(entity => {\n\t\t\tif (entity._alive)\n\t\t\t\tentity.getComponent('EditorSelection').deselect();\n\t\t});\n\t\tthis.selectedEntities.length = 0;\n\t}\n\n\tclearState() {\n\t\tthis.deleteNewEntities();\n\n\t\tthis.clearSelectedEntities();\n\t\tthis.entitiesToEdit.length = 0;\n\n\t\tthis.selectionStart = null;\n\t\tthis.selectionEnd = null;\n\t}\n\n\tdeleteNewEntities() {\n\t\tthis.newEntities.forEach(e => {\n\t\t\te.prototype.delete();\n\t\t\te.delete();\n\t\t});\n\t\tthis.newEntities.length = 0;\n\t}\n\n\tselectSelectedEntitiesInEditor() {\n\t\tif (sceneEdit.shouldSyncLevelToScene() && editorGlobals.sceneMode !== SceneMode.RECORDING) {\n\t\t\tselectInEditor(this.selectedEntities.map(ent => ent.prototype), this);\n\t\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_FORCE_UPDATE);\n\t\t\tModule.activateModule('object', false);\n\t\t} else {\n\t\t\tselectInEditor(this.selectedEntities, this);\n\t\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_FORCE_UPDATE);\n\t\t\tModule.activateModule('object', false);\n\t\t}\n\t}\n\n\tstopAndReset() {\n\t\tthis.clearState();\n\t\tif (editorSelection.type === 'ent') {\n\t\t\tselectInEditor(editorSelection.items.map((ent: Entity) => ent.prototype), this);\n\t\t}\n\t\tif (scene) {\n\t\t\tscene.reset();\n\t\t\tscene.cameraPosition = this.editorCameraPosition.clone();\n\t\t\tscene.setZoom(this.editorCameraZoom);\n\t\t\t// scene.updateCamera(); // this is called before every scene.draw. no need to do it here.\n\t\t}\n\t\tthis.playingModeChanged();\n\t\t// this.draw(); // scene.reset() already does drawing.\n\n\t\tthis.updatePropertyChangeCreationFilter();\n\t}\n\n\tfilterDeadSelection() {\n\t\tremoveTheDeadFromArray(this.selectedEntities);\n\t\tremoveTheDeadFromArray(this.entitiesToEdit);\n\n\t\tfor (let i = this.newEntities.length - 1; i >= 0; --i) {\n\t\t\tlet prototypeOfEntityPrototype = this.newEntities[i].prototype.prototype;\n\t\t\tif (prototypeOfEntityPrototype && prototypeOfEntityPrototype.threeLetterType === 'prt' && prototypeOfEntityPrototype._alive === false) {\n\t\t\t\tlet entity = this.newEntities.splice(i, 1)[0];\n\t\t\t\tentity.prototype.delete();\n\t\t\t\tentity.delete();\n\t\t\t}\n\t\t}\n\t}\n\n\tupdatePropertyChangeCreationFilter() {\n\t\tif (!scene)\n\t\t\treturn;\n\n\t\t\t/*\n\n- If scene.isInInitialState & state = normal:\n\t- Edit level. addChange enabled in level edits\n\t- Don't edit scene. addChange disabled in scene edits\n\t- Sync everything from level to scene\n\t- state = preview:\n\t\t- Can also edit scene, but values are not stored.\n\t\t- preview state is mainly visual hint for user.\n\t- state = recording:\n\t\t- Edit scene & level\n\t\t- addChange enabled in scene & level\n\t\t- No sync in either direction\n- If not scene.isInInitialState:\n\t- Don't sync from level to scene. addChange enabled in level edits\n\t- Don't sync from scene to level. addChange enabled in scene edits only when properties of selected entities change. (for property editor)\n\n\n\t\t\t*/\n\n\t\tif (scene.isInInitialState()) {\n\t\t\tif (editorGlobals.sceneMode === SceneMode.RECORDING) {\n\t\t\t\tsetPropertyChangeSettings(true, true)\n\t\t\t} else {\n\t\t\t\tsetPropertyChangeSettings(true, false)\n\t\t\t}\n\t\t} else if (editorSelection.type === 'ent') {\n\t\t\tsetPropertyChangeSettings(true, property => {\n\t\t\t\tlet selectedEntities = editorSelection.items;\n\t\t\t\treturn !!property.findParent('ent', serializable => selectedEntities.includes(serializable));\n\t\t\t})\n\t\t} else {\n\t\t\tsetPropertyChangeSettings(true, false)\n\t\t}\n\t}\n\n\tcopyEntityPrototypes(entityPrototypes: EntityPrototype[]) {\n\t\tthis.copiedEntityPrototypes.forEach(epr => epr.delete());\n\t\tthis.copiedEntityPrototypes.length = 0;\n\t\tthis.copiedEntityPrototypes.push(...entityPrototypes.map(epr => epr.cloneWithNewSiblingId()));\n\t}\n\n\tpasteEntities() {\n\t\tthis.deleteNewEntities();\n\t\tthis.newEntities.push(...this.copiedEntityPrototypes.map(epr => epr.cloneWithNewSiblingId().createEntity()));\n\t\t// this.newEntities.forEach(entity => entity.wakeUp());\n\n\t\tif (this.previousMousePosInWorldCoordinates)\n\t\t\tsceneEdit.setEntityPositions(this.newEntities, this.previousMousePosInWorldCoordinates);\n\t}\n\n\tdestroySelectionArea() {\n\t\tif (!this.selectionArea)\n\t\t\treturn;\n\t\tthis.selectionArea.destroy();\n\t\tthis.selectionArea = null;\n\t}\n}\n\nModule.register(SceneModule, 'center');\n\nlet makeADrawRequest = limit(15, 'soon', () => scene && scene.draw());\n","export class DragAndDropEvent {\n\ttype: string;\n\n\tconstructor(public idList: Array<string>, public targetElement: HTMLElement, public state: string) {\n\t\tthis.type = null;\n\t\tlet types = Array.from(new Set(this.idList.map(id => id.substring(0, 3))));\n\t\tif (types.length === 0)\n\t\t\tthis.type = 'none';\n\t\telse if (types.length === 1)\n\t\t\tthis.type = types[0];\n\t\telse\n\t\t\tthis.type = 'mixed';\n\t}\n}\n\nexport class DragAndDropStartEvent extends DragAndDropEvent {\n\tconstructor(idList: Array<string>, targetElement: HTMLElement) {\n\t\tsuper(idList, targetElement, 'start');\n\t}\n}\n\nexport class DragAndDropMoveEvent extends DragAndDropEvent {\n\tconstructor(idList: Array<string>, targetElement: HTMLElement, public helper: any) {\n\t\tsuper(idList, targetElement, 'move');\n\t}\n\thideValidationIndicator() {\n\t\tthis.helper.find('.jstree-icon').css({\n\t\t\tvisibility: 'hidden'\n\t\t});\n\t}\n}\n\nexport class DragAndDropStopEvent extends DragAndDropEvent {\n\tconstructor(idList: Array<string>, targetElement: HTMLElement) {\n\t\tsuper(idList, targetElement, 'stop');\n\t}\n}\n","import {el, list, mount, RedomComponent} from 'redom';\nimport {DragAndDropMoveEvent, DragAndDropStartEvent, DragAndDropStopEvent} from \"../util/dragAndDrop\";\nimport { editorEventDispacher } from '../editorEventDispatcher';\n\ndeclare var $: any;\n\nexport default class TreeView implements RedomComponent {\n\toptions: any;\n\tel: HTMLElement;\n\n\tconstructor(options) {\n\t\tthis.options = Object.assign({\n\t\t\tid: '',\n\t\t\tdefaultIcon: 'fas fa-book',\n\t\t\tselectionChangedCallback: null,\n\t\t\tmoveCallback: null, // if many items are moved, this is called many times\n\t\t\tdoubleClickCallback: null\n\t\t}, options);\n\n\t\tif (!this.options.id)\n\t\t\tthrow new Error('Id missing');\n\n\t\tthis.el = el('div.treeView');\n\n\t\tlet jstree = $(this.el).attr('id', this.options.id).on('move_node.jstree', (e, data) => {\n\t\t\tlet serializableId = data.node.id;\n\t\t\tlet parentId = data.parent;\n\t\t\tthis.options.moveCallback && this.options.moveCallback(serializableId, parentId);\n\t\t}).on('changed.jstree', (e, data) => {\n\t\t\tthis.options.selectionChangedCallback && data.selected.length > 0 && this.options.selectionChangedCallback(data.selected);\n\t\t}).jstree({\n\t\t\tcore: {\n\t\t\t\tcheck_callback: true,\n\t\t\t\tdata: [],\n\t\t\t\tforce_text: true\n\t\t\t},\n\t\t\tplugins: ['types', 'dnd', 'sort', 'search'/*, 'state'*/],\n\t\t\ttypes: {\n\t\t\t\tdefault: {\n\t\t\t\t\ticon: this.options.defaultIcon\n\t\t\t\t}\n\t\t\t},\n\t\t\tsort: function (a, b) {\n\t\t\t\treturn this.get_text(a).toLowerCase() > this.get_text(b).toLowerCase() ? 1 : -1;\n\t\t\t},\n\t\t\tdnd: {\n\t\t\t\tcopy: false // jstree makes it way too hard to copy multiple prototypes\n\t\t\t},\n\t\t\tsearch: {\n\t\t\t\tfuzzy: true,\n\t\t\t\tshow_only_matches: true,\n\t\t\t\tshow_only_matches_children: true,\n\t\t\t\tclose_opened_onclear: false\n\t\t\t}\n\t\t});\n\n\t\tif (this.options.doubleClickCallback) {\n\t\t\tjstree.bind(\"dblclick.jstree\", (event) => {\n\t\t\t\tvar element = $(event.target).closest(\"li\")[0];\n\t\t\t\tthis.options.doubleClickCallback(element.id);\n\t\t\t});\n\t\t}\n\t}\n\n\tcreateNode(id, text, parent) {\n\t\t$(this.el).jstree().create_node(parent || '#', { id, text }, 'last');\n\t}\n\tdeleteNode(id) {\n\t\tlet jstree = $(this.el).jstree(true);\n\t\tjstree.delete_node(jstree.get_node(id));\n\t}\n\n\tselect(idOrList) {\n\t\tif (!idOrList)\n\t\t\treturn;\n\n\t\tlet jstree = $(this.el).jstree(true);\n\t\tjstree.deselect_all(true);\n\t\tif (typeof idOrList === 'number')\n\t\t\tidOrList = [idOrList];\n\n\t\tif (idOrList.length > 0) {\n\t\t\tidOrList.forEach(id => {\n\t\t\t\tjstree.select_node(jstree.get_node(id));\n\t\t\t});\n\n\t\t\tlet node = document.getElementById(idOrList[0]);\n\t\t\tif (!node)\n\t\t\t\treturn console.warn(`id ${idOrList[0]} not found from the tree`);\n\n\t\t\tlet module = this.el.parentNode;\n\t\t\twhile (module && !module.classList.contains('module')) {\n\t\t\t\tmodule = module.parentNode;\n\t\t\t}\n\n\t\t\tconst NODE_HEIGHT = 24;\n\t\t\tconst SAFETY_MARGIN = 15;\n\n\t\t\tlet minScroll = node.offsetTop - module.offsetHeight + NODE_HEIGHT + SAFETY_MARGIN;\n\t\t\tlet maxScroll = node.offsetTop - SAFETY_MARGIN;\n\n\t\t\tif (module.scrollTop < minScroll)\n\t\t\t\tmodule.scrollTop = minScroll;\n\t\t\telse if (module.scrollTop > maxScroll)\n\t\t\t\tmodule.scrollTop = maxScroll;\n\t\t}\n\t}\n\n\tsearch(query) {\n\t\t$(this.el).jstree().search(query.trim());\n\t}\n\n\tupdate(data) {\n\t\tlet jstree = $(this.el).jstree(true);\n\t\tjstree.settings.core.data = data;\n\t\tjstree.refresh(true, state => {\n\t\t\tdelete state.core.selected;\n\t\t\treturn state;\n\t\t});\n\t}\n}\n\n$(document).on('dnd_start.vakata', function (e, data) {\n\tlet idList = data.data.nodes;\n\tlet targetElement = data.event.target;\n\tlet event = new DragAndDropStartEvent(idList, targetElement);\n\teditorEventDispacher.dispatch('treeView drag start ' + data.data.origin.element[0].id, event);\n});\n\n$(document).on('dnd_move.vakata', function (e, data) {\n\tdata.helper.find('.jstree-icon').css({\n\t\tvisibility: 'visible'\n\t});\n\tlet idList = data.data.nodes;\n\tlet targetElement = data.event.target;\n\tlet event = new DragAndDropMoveEvent(idList, targetElement, data.helper);\n\teditorEventDispacher.dispatch('treeView drag move ' + data.data.origin.element[0].id, event);\n});\n\n$(document).on('dnd_stop.vakata', function (e, data) {\n\tlet idList = data.data.nodes;\n\tlet targetElement = data.event.target;\n\tlet event = new DragAndDropStopEvent(idList, targetElement);\n\teditorEventDispacher.dispatch('treeView drag stop ' + data.data.origin.element[0].id, event);\n});\n","import Vector from \"../../util/vector\";\nimport ComponentData from \"../../core/componentData\";\nimport assert from \"../../util/assert\";\nimport Property from \"../../core/property\";\nimport PIXI from \"../../features/graphics\";\n\nexport class PositionAngleScale {\n\n    // PIXI Container\n    container: any = new PIXI.Container();\n\n    child: PositionAngleScale = null;\n    parent: PositionAngleScale = null;\n\n    constructor(public position: Vector = new Vector(0, 0), public angle: number = 0, public scale: Vector = new Vector(1, 1)) {\n        this.container.position.set(position.x, position.y);\n        this.container.rotation = angle;\n        this.container.scale.set(scale.x, scale.y);\n    }\n\n    addChild(pas: PositionAngleScale) {\n        this.child = pas;\n        pas.parent = this;\n        this.container.addChild(pas.container);\n    }\n\n    static fromTransformComponentData(fromTransformComponentData: ComponentData) {\n        assert(fromTransformComponentData.name === 'Transform', 'fromTransformComponentData must take Transform ComponentData');\n\n        let map: any = {};\n        fromTransformComponentData.forEachChild('prp', (prp: Property) => {\n            map[prp.name] = prp.value;\n        });\n\n        assert(map['position'], 'position is missing');\n        assert(!isNaN(map['angle']), 'angle is missing');\n        assert(map['scale'], 'scale is missing');\n\n        return new PositionAngleScale(map['position'].clone(), map['angle'], map['scale'].clone());\n    }\n\n    static getLeafDelta(from: PositionAngleScale, to: PositionAngleScale) {\n        // First go to root\n        while (from.parent) from = from.parent;\n        while (to.parent) to = to.parent;\n\n        // We are at root. Let travel to leaf and calculate angle and scale\n\n        let fromAngle = from.angle;\n        let toAngle = to.angle;\n\n        let fromScale = from.scale;\n        let toScale = to.scale;\n\n        while (from.child) {\n            from = from.child;\n            fromAngle += from.angle;\n            fromScale.multiply(from.scale);\n        }\n        while (to.child) {\n            to = to.child;\n            toAngle += to.angle;\n            toScale.multiply(to.scale);\n        }\n\n        // We are at leaf.\n\n        // Get delta angle and scale.\n\n        let deltaScale = fromScale.divide(toScale);\n        let deltaAngle = (fromAngle - toAngle + Math.PI * 2) % (Math.PI * 2);\n\n        // Now we shall calculate the delta position using PIXI Container Matrix.\n\n        let deltaPosition = Vector.fromObject(to.container.toLocal(new PIXI.Point(), from.container));\n\n        return new PositionAngleScale(deltaPosition, deltaAngle, deltaScale);\n    }\n}\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport TreeView from \"../views/treeView\";\nimport { editor } from '../editor';\nimport { forEachScene, scene } from '../../core/scene';\nimport { getSerializable } from \"../../core/serializableManager\";\nimport { changeType, setChangeOrigin, Change, getChangeOrigin } from \"../../core/change\";\nimport * as performance from \"../../util/performance\";\nimport CreateObject from \"../views/popup/createObject\";\nimport Game, { game } from \"../../core/game\";\nimport Prefab from \"../../core/prefab\";\nimport Serializable, { filterChildren } from \"../../core/serializable\";\nimport assert from '../../util/assert';\nimport { GameEvent, globalEventDispatcher } from '../../core/eventDispatcher';\nimport { editorEventDispacher, EditorEvent } from '../editorEventDispatcher';\nimport { selectInEditor, selectedLevel, editorSelection } from '../editorSelection';\nimport Entity from '../../core/entity';\nimport EntityPrototype from '../../core/entityPrototype';\nimport Vector from '../../util/vector';\nimport { PositionAngleScale } from '../util/positionAngleScaleUtil';\nimport Property from '../../core/property';\n\nclass ObjectsModule extends Module {\n\ttreeView: TreeView;\n\tdirty: boolean;\n\ttreeType: string;\n\n\t/**\n\t * Don't send selection changes outside of this module if the selection has been done outside of this module.\n\t */\n\texternalChange: boolean;\n\n\ttasks: Array<any> = [];\n\ttaskTimeout = null;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.name = 'Objects';\n\t\tthis.id = 'objects';\n\n\t\tlet createButton = el('button.button', 'Create ', el('u', 'N'), 'ew', {\n\t\t\tonclick: () => {\n\t\t\t\tcreateButton.blur();\n\t\t\t\tnew CreateObject();\n\t\t\t},\n\t\t\ttitle: 'Create new object (N)'\n\t\t});\n\t\tmount(this.el, createButton);\n\n\t\tthis.treeView = new TreeView({\n\t\t\tid: 'objects-tree',\n\t\t\tselectionChangedCallback: selectedIds => {\n\t\t\t\tif (this.externalChange) return;\n\t\t\t\tlet serializables = selectedIds.map(getSerializable).filter(Boolean);\n\t\t\t\tif (serializables.length === 1 && editorSelection.items.length === 1 && serializables[0] === editorSelection.items[0]) {\n\t\t\t\t\t// Skip select because it is causing unexpected behaviour when trying to locate entity in preview mode by double clicking\n\t\t\t\t} else {\n\t\t\t\t\tselectInEditor(serializables, this);\n\t\t\t\t}\n\t\t\t\tModule.activateModule('object', false);\n\t\t\t},\n\t\t\tmoveCallback: (serializableId: string, parentId: string) => {\n\t\t\t\tif (serializableId.substring(0, 3) === 'epr') {\n\t\t\t\t\tlet entityPrototype = getSerializable(serializableId) as EntityPrototype;\n\t\t\t\t\tlet parent = parentId === '#' ? selectedLevel : getSerializable(parentId);\n\n\t\t\t\t\tlet transformComponentDataChain1 = [];\n\t\t\t\t\tlet transformComponentDataChain2 = [];\n\n\t\t\t\t\tlet traverser = entityPrototype;\n\t\t\t\t\twhile (traverser && traverser.threeLetterType === 'epr') {\n\t\t\t\t\t\ttransformComponentDataChain1.unshift(traverser.getTransform());\n\t\t\t\t\t\ttraverser = traverser._parent as EntityPrototype;\n\t\t\t\t\t}\n\n\t\t\t\t\ttraverser = parent;\n\t\t\t\t\twhile (traverser && traverser.threeLetterType === 'epr') {\n\t\t\t\t\t\ttransformComponentDataChain2.unshift(traverser.getTransform());\n\t\t\t\t\t\ttraverser = traverser._parent as EntityPrototype;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet pas1 = PositionAngleScale.fromTransformComponentData(transformComponentDataChain1[0]);\n\t\t\t\t\tfor (let i = 1; i < transformComponentDataChain1.length; i++) {\n\t\t\t\t\t\tpas1.addChild(PositionAngleScale.fromTransformComponentData(transformComponentDataChain1[i]));\n\t\t\t\t\t\tpas1 = pas1.child;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet pas2 = transformComponentDataChain2.length > 0\n\t\t\t\t\t\t? PositionAngleScale.fromTransformComponentData(transformComponentDataChain2[0])\n\t\t\t\t\t\t: new PositionAngleScale();\n\t\t\t\t\tfor (let i = 1; i < transformComponentDataChain2.length; i++) {\n\t\t\t\t\t\tpas2.addChild(PositionAngleScale.fromTransformComponentData(transformComponentDataChain2[i]));\n\t\t\t\t\t\tpas2 = pas2.child;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet diffPas = PositionAngleScale.getLeafDelta(pas1, pas2);\n\n\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\tentityPrototype.move(parent);\n\n\t\t\t\t\tlet TCD = entityPrototype.getTransform();\n\t\t\t\t\tTCD.setValue('position', diffPas.position);\n\t\t\t\t\tTCD.setValue('angle', diffPas.angle);\n\t\t\t\t\tTCD.setValue('scale', diffPas.scale);\n\t\t\t\t}\n\t\t\t},\n\t\t\tdoubleClickCallback: serializableId => {\n\t\t\t\tlet serializable = getSerializable(serializableId);\n\t\t\t\tif (serializable)\n\t\t\t\t\teditorEventDispacher.dispatch('locate serializable', serializable);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error(`Locate serializable ${serializableId} not found`);\n\t\t\t}\n\t\t});\n\t\tmount(this.el, this.treeView);\n\n\t\teditorEventDispacher.listen('treeView drag start objects-tree', event => {\n\t\t});\n\t\teditorEventDispacher.listen('treeView drag move objects-tree', event => {\n\t\t\tif (event.type === 'epr' && event.targetElement.getAttribute('moduleid') === 'prefabs')\n\t\t\t\tevent.hideValidationIndicator();\n\t\t\t// if (event.targetElement.classList.contains('openEditPlayCanvas'))\n\t\t\t// \tevent.hideValidationIndicator();\n\t\t});\n\t\teditorEventDispacher.listen('treeView drag stop objects-tree', event => {\n\t\t\t// console.log('event', event)\n\t\t\tif (event.type === 'epr' && event.targetElement.getAttribute('moduleid') === 'prefabs') {\n\t\t\t\tlet entityPrototypes = event.idList.map(getSerializable);\n\t\t\t\tentityPrototypes = filterChildren(entityPrototypes);\n\t\t\t\tentityPrototypes.forEach((epr: EntityPrototype) => {\n\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\tlet prefab = Prefab.createFromPrototype(epr);\n\t\t\t\t\tgame.addChild(prefab);\n\t\t\t\t\tlet newEpr = epr.replaceWithVersionThatIsAttachedToPrototype(prefab);\n\t\t\t\t\tconsole.log('created', newEpr, 'out of', epr);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn;\n\t\t\tif (event.type === 'epr') {\n\t\t\t\tlet target = event.targetElement;\n\t\t\t\twhile (!target.classList.contains('jstree-node')) {\n\t\t\t\t\ttarget = target.parentElement;\n\t\t\t\t\tif (!target) {\n\t\t\t\t\t\tconsole.error('Invalid target', event.targetElement);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconsole.log('target.id', target.id)\n\t\t\t\tlet targetSerializable = getSerializable(target.id);\n\n\t\t\t\tlet idSet = new Set(event.idList);\n\t\t\t\tlet serializables = event.idList.map(getSerializable).filter(serializable => {\n\t\t\t\t\tlet parent = serializable.getParent();\n\t\t\t\t\twhile (parent) {\n\t\t\t\t\t\tif (idSet.has(parent.id))\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\tparent = parent.getParent();\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\n\t\t\t\tconsole.log('move serializables', serializables, 'to', targetSerializable);\n\t\t\t\tserializables.forEach(serializable => {\n\t\t\t\t\tserializable.move(targetSerializable);\n\t\t\t\t});\n\t\t\t\tconsole.log('Done!')\n\t\t\t}\n\t\t});\n\n\t\tthis.dirty = true;\n\t\tthis.treeType = null;\n\n\t\t// This will be called when play and reset has already happened. After all the\n\t\tlet updateWithDelay = () => {\n\t\t\tthis.dirty = true;\n\t\t\tsetTimeout(() => this.update(), 100);\n\t\t};\n\t\tforEachScene(() => {\n\t\t\tscene.listen(GameEvent.SCENE_START, updateWithDelay);\n\t\t\tscene.listen(GameEvent.SCENE_RESET, updateWithDelay);\n\t\t});\n\n\t\t// Set dirty so that every single serializable deletion and addition won't separately update the tree.\n\t\tlet setDirty = () => {\n\t\t\tthis.dirty = true;\n\t\t};\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_PLAY, setDirty, -1);\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_RESET, setDirty, -1);\n\t\tgame.listen(GameEvent.GAME_LEVEL_COMPLETED, setDirty, -1);\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_CHANGE, (change: Change) => {\n\t\t\tif (this.dirty || !this._selected)\n\t\t\t\treturn;\n\n\t\t\tperformance.start('Editor: Objects');\n\n\t\t\tthis.externalChange = true;\n\n\t\t\tlet newTask = null;\n\n\t\t\tif (change.type === changeType.addSerializableToTree) {\n\t\t\t\tif (change.reference.threeLetterType === this.treeType) {\n\t\t\t\t\tlet serializable = change.reference;\n\t\t\t\t\tconst addToTree = (s: Serializable) => {\n\t\t\t\t\t\tlet parent = s.getParent();\n\t\t\t\t\t\tlet treeParent = parent.threeLetterType === this.treeType ? parent.id : '#';\n\t\t\t\t\t\tthis.treeView.createNode(s.id, s.makeUpAName(), treeParent);\n\t\t\t\t\t};\n\t\t\t\t\tnewTask = () => {\n\t\t\t\t\t\taddToTree(serializable);\n\t\t\t\t\t\tserializable.forEachChild(this.treeType, (child: Serializable) => {\n\t\t\t\t\t\t\taddToTree(child);\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\t\tif (change.reference.threeLetterType === this.treeType) {\n\t\t\t\t\tlet serializable = change.reference;\n\t\t\t\t\tnewTask = () => {\n\t\t\t\t\t\tthis.treeView.deleteNode(serializable.id);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else if (change.type === 'editorSelection') {\n\t\t\t\tif (change.origin != this) {\n\t\t\t\t\tthis.selectBasedOnEditorSelection();\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.setPropertyValue && this._selected) {\n\t\t\t\tlet property = change.reference as Property;\n\t\t\t\tif (property.name === 'name') {\n\t\t\t\t\tlet entityPrototype = property.getParent() as EntityPrototype;\n\t\t\t\t\tif (entityPrototype && entityPrototype.threeLetterType === 'epr') {\n\t\t\t\t\t\tthis.dirty = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (newTask) {\n\t\t\t\tthis.addTask(newTask);\n\t\t\t}\n\n\t\t\tthis.externalChange = false;\n\n\t\t\tperformance.stop('Editor: Objects');\n\t\t});\n\t}\n\t/**\n\t * Runs task with delay for optimization. If small amount of tasks is added, they are just added.\n\t * If big number of tasks is added, they are ignored and this module is flagged as dirty.\n\t * @param task function to run in delay\n\t */\n\taddTask(task) {\n\t\tthis.tasks.push(task);\n\n\t\tif (this.taskTimeout)\n\t\t\tclearTimeout(this.taskTimeout);\n\n\t\tif (this.tasks.length > 1000) {\n\t\t\tthis.tasks.length = 0;\n\t\t\tthis.dirty = true;\n\t\t\treturn;\n\t\t}\n\n\t\tlet delay = scene.playing ? 500 : 50;\n\n\t\tthis.taskTimeout = setTimeout(() => {\n\t\t\tthis.taskTimeout = null;\n\t\t\tif (this.tasks.length < 5) {\n\t\t\t\tthis.tasks.forEach(task => task());\n\t\t\t} else {\n\t\t\t\tthis.dirty = true;\n\t\t\t}\n\t\t\tthis.tasks.length = 0;\n\t\t}, delay);\n\t}\n\tselectBasedOnEditorSelection(runInstantly = false) {\n\t\tlet task = null;\n\n\t\tif (editorSelection.type === this.treeType) {\n\t\t\ttask = () => {\n\t\t\t\tlet oldExternalState = this.externalChange;\n\t\t\t\tthis.externalChange = true;\n\t\t\t\tthis.treeView.select(editorSelection.items.map((item: Serializable) => item.id));\n\t\t\t\tthis.externalChange = oldExternalState;\n\t\t\t};\n\t\t} else {\n\t\t\ttask = () => {\n\t\t\t\tlet oldExternalState = this.externalChange;\n\t\t\t\tthis.externalChange = true;\n\t\t\t\tthis.treeView.select(null);\n\t\t\t\tthis.externalChange = oldExternalState;\n\t\t\t};\n\t\t}\n\n\t\tif (runInstantly) {\n\t\t\ttask();\n\t\t} else {\n\t\t\tthis.addTask(task);\n\t\t}\n\t}\n\tactivate() {\n\t\tthis.dirty = true;\n\t}\n\tupdate() {\n\t\tif (!scene || !selectedLevel)\n\t\t\treturn false;\n\n\t\tif (!this._selected)\n\t\t\treturn true;\n\n\t\tlet newTreeType = this.treeType;\n\t\tif (scene.isInInitialState()) {\n\t\t\tnewTreeType = 'epr';\n\t\t} else {\n\t\t\tnewTreeType = 'ent';\n\t\t}\n\n\t\tif (!this.dirty && newTreeType === this.treeType)\n\t\t\treturn true;\n\n\t\tthis.treeType = newTreeType;\n\n\t\tlet data = [];\n\t\tif (this.treeType === 'epr') {\n\t\t\tselectedLevel.forEachChild('epr', epr => {\n\t\t\t\tlet parent = epr.getParent();\n\t\t\t\tdata.push({\n\t\t\t\t\ttext: epr.makeUpAName(),\n\t\t\t\t\tid: epr.id,\n\t\t\t\t\tparent: parent.threeLetterType === 'epr' ? parent.id : '#'\n\t\t\t\t});\n\t\t\t}, true);\n\t\t} else if (this.treeType === 'ent') {\n\t\t\tscene.forEachChild('ent', (ent: Entity) => {\n\t\t\t\tlet parent = ent.getParent();\n\t\t\t\tdata.push({\n\t\t\t\t\ttext: ent.prototype ? ent.prototype.makeUpAName() : 'Object',\n\t\t\t\t\tid: ent.id,\n\t\t\t\t\tparent: parent.threeLetterType === 'ent' ? parent.id : '#'\n\t\t\t\t});\n\t\t\t}, true);\n\t\t}\n\t\tthis.treeView.update(data);\n\n\t\t// Sometimes treeView.update takes a bit time. Therefore hacky timeout.\n\t\tsetTimeout(() => {\n\t\t\tthis.externalChange = true;\n\t\t\tthis.selectBasedOnEditorSelection();\n\t\t\tthis.externalChange = false;\n\t\t}, 30);\n\t\tthis.dirty = false;\n\n\t\treturn true;\n\t}\n}\n\nModule.register(ObjectsModule, 'left');\n","import Popup, { Button, popupDepth, ButtonOptions, ButtonWithDescription, ButtonWithDescriptionOptions } from './Popup';\nimport { el, mount, list, text } from 'redom';\nimport Prototype from '../../../core/prototype';\nimport EntityPrototype from '../../../core/entityPrototype';\nimport Level from '../../../core/level';\nimport { filterChildren } from '../../../core/serializable';\nimport { setChangeOrigin } from '../../../core/change';\n\n/**\n * Handles everything else than prototype deletion itself.\n * Asks if user wants to delete entityPrototypes that are using these prototypes or bake data to entityPrototypes.\n */\nexport default class PrototypeDeleteConfirmation extends Popup {\n\tconstructor(prototypes: Array<Prototype>, callback: Function) {\n\t\tprototypes = filterChildren(prototypes) as Prototype[];\n\n\t\tlet entityPrototypes: EntityPrototype[] = [];\n\t\tlet levels: Set<Level> = new Set();\n\n\t\tprototypes.forEach(prototype => {\n\t\t\tlet results = prototype.getEntityPrototypesThatUseThisPrototype();\n\t\t\tentityPrototypes.push(...results.entityPrototypes);\n\t\t\tresults.levels.forEach(lvl => levels.add(lvl));\n\t\t});\n\n\t\tlet isPfa = prototypes[0].threeLetterType === 'pfa';\n\t\tlet onlyOne = prototypes.length === 1;\n\n\t\tlet nameText = onlyOne ? `${isPfa ? 'Prefab' : 'Type'} <b>${prototypes[0].name}</b>` : `These ${prototypes.length} ${isPfa ? 'prefabs' : 'types'}`;\n\t\tlet isText = onlyOne ? 'is' : 'are';\n\t\tlet levelText = levels.size === 1 ? '1 level' : `${levels.size} levels`;\n\t\tlet confirmMessage = `${nameText} ${isText} used in ${levelText} by ${entityPrototypes.length} objects.`;\n\n\t\tlet listView;\n\t\tsuper({\n\t\t\ttitle: confirmMessage,\n\t\t\twidth: 500,\n\t\t\tcontent: el('div',\n\t\t\t\t// el('div.genericCustomContent', textContent),\n\t\t\t\tlistView = list('div.confirmationButtons', ButtonWithDescription)\n\t\t\t),\n\t\t\tcancelCallback: () => {\n\t\t\t\tcallback(false);\n\t\t\t}\n\t\t});\n\n\t\tif (entityPrototypes.length === 0) {\n\t\t\tcallback(true);\n\t\t\tthis.remove();\n\t\t}\n\n\t\tlet buttonOptions: Array<ButtonWithDescriptionOptions> = [{\n\t\t\ttext: entityPrototypes.length === 1 ? 'Delete 1 object' : `Delete ${entityPrototypes.length} objects`,\n\t\t\tcallback: () => {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tentityPrototypes.forEach(epr => epr.delete());\n\t\t\t\tthis.remove();\n\t\t\t\tcallback(true);\n\t\t\t},\n\t\t\tclass: 'dangerButton',\n\t\t\tdescription: `Get rid of everything related to ${nameText[0].toLowerCase() + nameText.substring(1)}.`\n\t\t}, {\n\t\t\ttext: entityPrototypes.length === 1 ? 'Keep object' : 'Keep objects',\n\t\t\tcallback: () => {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tentityPrototypes.forEach(epr => epr.replaceWithVersionThatIsDetachedFromPrototype());\n\t\t\t\tthis.remove();\n\t\t\t\tcallback(true);\n\t\t\t},\n\t\t\tclass: 'greenButton',\n\t\t\tdescription: `All data of ${isPfa ? (onlyOne ? 'this prefab' : 'these prefabs') : (onlyOne ? 'this type' : 'these types')} is bundled within the objects.`\n\t\t}, {\n\t\t\ttext: 'Cancel',\n\t\t\tcallback: () => {\n\t\t\t\tthis.remove();\n\t\t\t\tthis.cancelCallback(false);\n\t\t\t},\n\t\t\tdescription: `Don't delete anything.`\n\t\t}];\n\n\t\tlistView.update(buttonOptions);\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport TreeView from \"../views/treeView\";\nimport Module from './module';\nimport { game } from \"../../core/game\";\nimport { getSerializable } from \"../../core/serializableManager\";\nimport { editor } from \"../editor\";\nimport { selectInEditor, editorSelection } from '../editorSelection';\nimport { editorEventDispacher, EditorEvent } from '../editorEventDispatcher';\nimport { changeType } from '../../core/change';\nimport Prefab from '../../core/prefab';\nimport PrototypeDeleteConfirmation from '../views/popup/PrototypeDeleteConfirmation';\nimport Serializable from '../../core/serializable';\nimport Property from '../../core/property';\n\nclass PrefabsModule extends Module {\n\ttreeView: TreeView;\n\tdirty: boolean = true;\n\thelperText: HTMLElement;\n\texternalChange = false;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.name = 'Prefabs';\n\t\tthis.id = 'prefabs';\n\n\t\tthis.treeView = new TreeView({\n\t\t\tid: 'prefabs-tree',\n\t\t\tselectionChangedCallback: selectedIds => {\n\t\t\t\tlet serializables = selectedIds.map(getSerializable).filter(Boolean);\n\t\t\t\tselectInEditor(serializables, this);\n\t\t\t\tModule.activateModule('prefab', false);\n\t\t\t},\n\t\t});\n\t\tthis.addElements(\n\t\t\tthis.treeView,\n\t\t\tthis.helperText = el('div.typesDragHelper',\n\t\t\t\tel('i.fas.fa-long-arrow-right'),\n\t\t\t\t'Drag',\n\t\t\t\tel('i.fas.fa-long-arrow-right')\n\t\t\t)\n\t\t);\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_CHANGE, change => {\n\t\t\tif (change.type === changeType.addSerializableToTree) {\n\t\t\t\tif (change.reference.threeLetterType === 'pfa') {\n\t\t\t\t\tlet serializable = change.reference as Prefab;\n\t\t\t\t\tthis.treeView.createNode(serializable.id, serializable.makeUpAName(), '#');\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\t\tif (change.reference.threeLetterType === 'pfa') {\n\t\t\t\t\tlet serializable = change.reference as Prefab;\n\t\t\t\t\tthis.treeView.deleteNode(serializable.id);\n\t\t\t\t}\n\t\t\t} else if (change.type === 'editorSelection') {\n\t\t\t\tif (change.origin != this) {\n\t\t\t\t\tthis.selectBasedOnEditorSelection();\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.setPropertyValue && this._selected) {\n\t\t\t\tlet property = change.reference as Property;\n\t\t\t\tif (property.name === 'name') {\n\t\t\t\t\tlet prefab = property.getParent() as Prefab;\n\t\t\t\t\tif (prefab && prefab.threeLetterType === 'pfa') {\n\t\t\t\t\t\tthis.dirty = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_DELETE_CONFIRMATION, () => {\n\t\t\tif (editorSelection.type === 'pfa') {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tnew PrototypeDeleteConfirmation(editorSelection.items as Prefab[], (canDelete) => {\n\t\t\t\t\t\tif (canDelete) {\n\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject('User cancelled');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\teditorEventDispacher.listen('treeView drag start prefabs-tree', event => {\n\t\t\tlet prefabs = event.idList.map(getSerializable);\n\t\t\teditorEventDispacher.dispatch('dragPrefabsStarted', prefabs);\n\t\t});\n\t\teditorEventDispacher.listen('treeView drag move prefabs-tree', event => {\n\t\t\tif (event.targetElement.tagName === 'CANVAS' && event.targetElement.classList.contains('openEditPlayCanvas'))\n\t\t\t\tevent.hideValidationIndicator();\n\t\t});\n\t\teditorEventDispacher.listen('treeView drag stop prefabs-tree', event => {\n\t\t\tlet prefabs = event.idList.map(getSerializable);\n\t\t\tif (event.targetElement.tagName === 'CANVAS' && event.targetElement.classList.contains('openEditPlayCanvas'))\n\t\t\t\teditorEventDispacher.dispatch('dragPrefabsToScene', prefabs);\n\t\t\telse\n\t\t\t\teditorEventDispacher.dispatch('dragPrefabsToNonScene', prefabs);\n\t\t});\n\t}\n\tactivate() {\n\t\tthis.dirty = true;\n\t}\n\tupdate() {\n\t\tif (!this._selected)\n\t\t\treturn true;\n\n\t\tif (!this.dirty)\n\t\t\treturn true;\n\n\t\tlet data = [];\n\t\tgame.forEachChild('pfa', pfa => {\n\t\t\tdata.push({\n\t\t\t\ttext: pfa.makeUpAName(),\n\t\t\t\tid: pfa.id,\n\t\t\t\tparent: '#'\n\t\t\t});\n\t\t});\n\n\t\tthis.treeView.update(data);\n\t\tthis.dirty = false;\n\n\t\treturn true;\n\t}\n\tselectBasedOnEditorSelection() {\n\t\tif (editorSelection.type === 'pfa') {\n\t\t\tthis.externalChange = true;\n\t\t\tthis.treeView.select(editorSelection.items.map((item: Serializable) => item.id));\n\t\t\tthis.externalChange = false;\n\t\t}\n\t}\n}\n\nModule.register(PrefabsModule, 'left');\n","import { el, list, mount, List, RedomComponent } from 'redom';\nimport Module from './module';\nimport { game } from '../../core/game';\nimport Level from '../../core/level';\nimport { Button } from '../views/popup/Popup';\nimport { redomDispatch, redomListen } from '../../util/redomEvents';\nimport { setChangeOrigin } from \"../../core/change\";\nimport { selectInEditor, setLevel } from '../editorSelection';\nimport { editorEventDispacher } from '../editorEventDispatcher';\n\nexport function createNewLevel() {\n\tlet lvl = new Level();\n\n\tlet levelNumber = 1;\n\tlet newLevelName;\n\twhile (true) {\n\t\tnewLevelName = 'Level ' + levelNumber;\n\t\tif (!game.findChild('lvl', (lvl: Level) => lvl.name === newLevelName, false)) {\n\t\t\tbreak;\n\t\t}\n\t\tlevelNumber++;\n\t}\n\n\tlvl.initWithPropertyValues({\n\t\tname: newLevelName\n\t});\n\tgame.addChild(lvl);\n\tsetLevel(lvl);\n\n\treturn lvl;\n}\n\neditorEventDispacher.listen('createBlankLevel', createNewLevel);\n\nclass LevelsModule extends Module {\n\tcontent: HTMLElement;\n\tbuttons: List;\n\tcreateButton: Button;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.addElements(\n\t\t\tthis.content = el('div',\n\t\t\t\tthis.buttons = list('div.levelSelectorButtons', LevelItem),\n\t\t\t\t'Create: ',\n\t\t\t\tthis.createButton = new Button\n\t\t\t)\n\t\t);\n\t\tthis.name = 'Levels';\n\t\tthis.id = 'levels';\n\n\t\tthis.createButton.update({\n\t\t\ttext: 'New level',\n\t\t\ticon: 'fa-area-chart',\n\t\t\tcallback: () => {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tlet lvl = createNewLevel();\n\t\t\t\tselectInEditor(lvl, this);\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tModule.activateModule('level', true, 'focusOnProperty', 'name');\n\t\t\t\t}, 100);\n\t\t\t}\n\t\t});\n\n\t\tredomListen(this.el, 'selectLevel', level => {\n\t\t\tsetLevel(level);\n\t\t\tselectInEditor(level, this);\n\t\t});\n\t\t/*\n\t\t\t\tlisten(this.el, 'deleteLevel', level => {\n\t\t\t\t\tif (level.isEmpty() || confirm('Are you sure you want to delete level: ' + level.name)) {\n\t\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\t\tlevel.delete();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t*/\n\t}\n\n\tupdate() {\n\t\tthis.buttons.update(game.getChildren('lvl'));\n\t}\n}\n\nModule.register(LevelsModule, 'left');\n\nclass LevelItem implements RedomComponent {\n\tel: HTMLElement;\n\tnumber: HTMLElement;\n\tselectButton: Button;\n\tlevel: Level;\n\n\tconstructor() {\n\t\tthis.el = el('div.levelItem',\n\t\t\tthis.number = el('span'),\n\t\t\tthis.selectButton = new Button\n\t\t\t//,this.deleteButton = new Button\n\t\t)\n\t}\n\n\tselectClicked() {\n\t\tredomDispatch(this, 'selectLevel', this.level);\n\t}\n\n\t/*\n\tdeleteClicked() {\n\t\tdispatch(this, 'deleteLevel', this.level);\n\t}\n\t*/\n\tupdate(level, idx) {\n\t\tthis.level = level;\n\t\tthis.number.textContent = (idx + 1) + '.';\n\t\tthis.selectButton.update({\n\t\t\ttext: level.name,\n\t\t\ticon: 'fa-area-chart',\n\t\t\tcallback: () => this.selectClicked()\n\t\t});\n\t\t/*\n\t\tthis.deleteButton.update({\n\t\t\ttext: 'Delete',\n\t\t\tclass: 'dangerButton',\n\t\t\ticon: 'fa-cross',\n\t\t\tcallback: () => this.deleteClicked()\n\t\t});\n\t\t*/\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport Vector from '../../../util/vector';\n\nconst EDITOR_FLOAT_PRECISION = Math.pow(10, 3);\n\n// <dataTypeName>: createFunction(container, oninput, onchange) -> setValueFunction\nlet editors: {\n\t[editor: string]: (container: HTMLElement, oninput: Function, onchange: Function, options: any) => ((val: any) => any)\n} = {\n};\nexport default editors;\n\nconst MAX_STRING_LENGTH = 32;\nconst MAX_LONG_STRING_LENGTH = 65500; // in database, value is stored as TEXT.\n\neditors.default = editors.string = (container, oninput, onchange, options) => {\n\tlet input: HTMLInputElement = <HTMLInputElement>el('input', {\n\t\tplaceholder: options.placeholder || '',\n\t\toninput: () => oninput(input.value.substring(0, MAX_STRING_LENGTH)),\n\t\tonchange: () => onchange(input.value.substring(0, MAX_STRING_LENGTH).substring(0, MAX_STRING_LENGTH))\n\t});\n\tmount(container, input);\n\n\treturn val => input.value = val.substring(0, MAX_STRING_LENGTH);\n};\n\neditors.longString = (container, oninput, onchange, options) => {\n\tlet input: HTMLInputElement = <HTMLInputElement>el('input', {\n\t\tplaceholder: options.placeholder || '',\n\t\toninput: () => oninput(input.value.substring(0, MAX_LONG_STRING_LENGTH)),\n\t\tonchange: () => onchange(input.value.substring(0, MAX_LONG_STRING_LENGTH).substring(0, MAX_LONG_STRING_LENGTH))\n\t});\n\tmount(container, input);\n\n\treturn val => input.value = val.substring(0, MAX_LONG_STRING_LENGTH);\n};\n\neditors.float = editors.int = (container, oninput, onchange) => {\n\tlet input: HTMLInputElement = <HTMLInputElement>el('input', {\n\t\ttype: 'number',\n\t\toninput: () => oninput(+input.value),\n\t\tonchange: () => onchange(+input.value)\n\t});\n\tmount(container, input);\n\treturn val => input.value = String(Math.round(val * EDITOR_FLOAT_PRECISION) / EDITOR_FLOAT_PRECISION);\n};\n\neditors.bool = (container, oninput, onchange) => {\n\tlet input: HTMLInputElement = <HTMLInputElement>el('input', {\n\t\ttype: 'checkbox',\n\t\tonchange: () => {\n\t\t\tonchange(input.checked);\n\t\t\tlabel.textContent = input.checked ? 'Yes' : 'No';\n\t\t}\n\t});\n\tlet label = el('span');\n\tmount(container, el('label', input, label));\n\treturn val => {\n\t\tinput.checked = val;\n\t\tlabel.textContent = val ? 'Yes' : 'No';\n\t}\n};\n\neditors.vector = (container, oninput, onchange) => {\n\tfunction getValue() {\n\t\treturn new Vector(+xInput.value, +yInput.value);\n\t}\n\tlet xInput: HTMLInputElement = <HTMLInputElement>el('input.xInput', {\n\t\ttype: 'number',\n\t\toninput: () => oninput(getValue()),\n\t\tonchange: () => onchange(getValue())\n\t});\n\tlet yInput: HTMLInputElement = <HTMLInputElement>el('input', {\n\t\ttype: 'number',\n\t\toninput: () => oninput(getValue()),\n\t\tonchange: () => onchange(getValue())\n\t});\n\tmount(container, el('div', el('span', 'x:'), xInput, el('span', 'y:'), yInput));\n\treturn val => {\n\t\txInput.value = String(Math.round(val.x * EDITOR_FLOAT_PRECISION) / EDITOR_FLOAT_PRECISION);\n\t\tyInput.value = String(Math.round(val.y * EDITOR_FLOAT_PRECISION) / EDITOR_FLOAT_PRECISION);\n\t};\n};\n\neditors.enum = (container, oninput, onchange, options) => {\n\tlet select: HTMLSelectElement = <HTMLSelectElement>el('select', ...options.propertyType.validator.parameters.map(p => el('option', p)));\n\tselect.onchange = () => {\n\t\tonchange(select.value);\n\t};\n\tmount(container, select);\n\treturn val => {\n\t\tselect.value = val;\n\t}\n};\n\neditors.color = (container, oninput, onchange) => {\n\tlet input: HTMLInputElement = <HTMLInputElement>el('input', {\n\t\ttype: 'color',\n\t\toninput: () => oninput(input.value),\n\t\tonchange: () => onchange(input.value)\n\t});\n\tmount(container, input);\n\treturn val => input.value = val.toHexString();\n};\n","import Popup, { Button } from './Popup';\nimport { componentClasses } from '../../../core/component';\nimport ComponentData from '../../../core/componentData';\nimport { list, el } from 'redom';\nimport assert from '../../../util/assert';\nimport { setChangeOrigin } from '../../../core/change';\nimport { game } from '../../../core/game'\n\nexport default class ObjectMoreButtonContextMenu extends Popup {\n\tconstructor(property) {\n\t\tsuper({\n\t\t\ttitle: 'Object Property: ' + property.name,\n\t\t\twidth: '500px',\n\t\t\tcontent: list('div', Button)\n\t\t});\n\n\t\tthis.buttons = this.content;\n\n\t\tlet value = property.value;\n\t\tlet component = property.getParent();\n\t\tlet componentId = component._componentId;\n\t\tlet entityPrototype = component.entity.prototype;\n\t\tlet prototype = entityPrototype.prototype;\n\n\t\tlet actions = [\n\t\t\t{\n\t\t\t\ttext: 'Copy value to type ' + prototype.name,\n\t\t\t\tcallback: () => {\n\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\tlet componentData = prototype.getOwnComponentDataOrInherit(componentId);\n\t\t\t\t\tif (componentData) {\n\t\t\t\t\t\tlet newProperty = componentData.getPropertyOrCreate(property.name);\n\t\t\t\t\t\tnewProperty.value = property.value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\talert('Error: Component data not found');\n\t\t\t\t\t}\n\t\t\t\t\tthis.remove();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: 'Save value for this object',\n\t\t\t\tcallback: () => {\n\t\t\t\t\tsetChangeOrigin(this);\n\n\t\t\t\t\tlet componentData = entityPrototype.getOwnComponentDataOrInherit(componentId);\n\t\t\t\t\tif (componentData) {\n\t\t\t\t\t\tlet newProperty = componentData.getPropertyOrCreate(property.name);\n\t\t\t\t\t\tnewProperty.value = property.value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\talert('Error: Component data not found');\n\t\t\t\t\t}\n\t\t\t\t\tthis.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tthis.update(actions);\n\t}\n\tupdate(data) {\n\t\tthis.buttons.update(data);\n\t}\n}\n","export function skipTransitions(element) {\n\treturn;\n\telement.classList.add('skipPropertyEditorTransitions');\n\tsetTimeout(() => {\n\t\telement.classList.remove('skipPropertyEditorTransitions');\n\t}, 10);\n}\n","import { el, list, mount, List } from 'redom';\nimport { redomListen, redomDispatch } from '../../../util/redomEvents';\nimport showPopup from '../popup/Popup';\nimport ComponentData from '../../../core/componentData';\nimport assert from '../../../util/assert';\nimport editors from './propertyEditorTypes';\nimport ComponentAdder from '../popup/componentAdder';\nimport { changeType, setChangeOrigin } from '../../../core/change';\nimport { Prop } from '../../../core/component';\nimport { scene } from '../../../core/scene';\nimport * as sceneEdit from '../../util/sceneEditUtil';\nimport PropertyOwner from '../../../core/propertyOwner';\nimport * as performance from '../../../util/performance'\nimport ObjectMoreButtonContextMenu from '../popup/objectMoreButtonContextMenu'\nimport Confirmation from \"../popup/Confirmation\";\nimport { listenKeyDown, key } from '../../../util/input';\nimport { parseTextAndNumber, skipTransitions } from './util';\nimport Serializable from '../../../core/serializable';\nimport Property from '../../../core/property';\nimport { GameEvent } from '../../../core/eventDispatcher';\nimport { editorEventDispacher, EditorEvent } from '../../editorEventDispatcher';\nimport { selectInEditor } from '../../editorSelection';\nimport { setOption, getOption } from '../../util/options';\nimport Prototype from '../../../core/prototype';\n\n/*\nReference: Unbounce\n https://cdn8.webmaster.net/pics/Unbounce2.jpg\n */\n\nexport default class PropertyEditor {\n\tel: HTMLElement;\n\tlist: List;\n\tdirty: boolean;\n\teditingProperty: boolean;\n\titem: Serializable;\n\n\tconstructor() {\n\t\tthis.el = el('div.propertyEditor',\n\t\t\tthis.list = list('div.propertyEditorList', Container)\n\t\t);\n\t\tthis.dirty = true;\n\t\tthis.editingProperty = false;\n\n\t\t// Change in serializable tree\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_CHANGE, change => {\n\t\t\tif (change.type === 'editorSelection') {\n\t\t\t\tthis.dirty = true;\n\t\t\t} else if (change.type === changeType.setPropertyValue) {\n\t\t\t\tif (this.item && this.item.hasDescendant(change.reference)) {\n\t\t\t\t\t// TODO: Level-Scene sync - What's happening here?\n\t\t\t\t\tif (change.origin === this) {\n\t\t\t\t\t\t// if (this.item.threeLetterType === 'ent') {\n\t\t\t\t\t\t// \tsceneEdit.entityModifiedInEditor(this.item, change);\n\t\t\t\t\t\t// }\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.dirty = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.addSerializableToTree) {\n\t\t\t\tif (change.parent === this.item || this.item && this.item.hasDescendant(change.parent))\n\t\t\t\t\tthis.dirty = true;\n\t\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\t\tif (this.item && this.item.hasDescendant(change.reference)) {\n\t\t\t\t\tthis.dirty = true;\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.deleteAllChildren) {\n\t\t\t\tif (this.item && this.item.hasDescendant(change.reference)) {\n\t\t\t\t\tthis.dirty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tredomListen(this, 'makingChanges', () => {\n\t\t\tsetChangeOrigin(this);\n\t\t});\n\n\t\t// Change in this editor\n\t\tredomListen(this, 'markPropertyEditorDirty', () => {\n\t\t\tthis.dirty = true;\n\t\t});\n\n\t\tredomListen(this, 'propertyEditorSelect', items => {\n\t\t\tselectInEditor(items, this);\n\t\t});\n\n\t\tlistenKeyDown(keyCode => {\n\t\t\tif (keyCode === key.esc) {\n\t\t\t\tif ('activeElement' in document && document.activeElement.tagName === 'INPUT') {\n\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tupdate(items, threeLetterType) {\n\t\tif (!this.dirty) return;\n\t\tif (!items) return;\n\n\t\tif (['prt', 'ent', 'epr'].indexOf(threeLetterType) >= 0 && items.length === 1\n\t\t\t|| items.length === 1 && items[0] instanceof PropertyOwner) {\n\t\t\tthis.item = items[0];\n\t\t\tthis.list.update([this.item]);\n\t\t} else {\n\t\t\tthis.list.update([]);\n\t\t}\n\n\t\tthis.dirty = false;\n\t}\n}\n\n/*\n\t// item gives you happy\n\t   happy makes you jump\n\t{\n\t\tif (item)\n\t\t\t[happy]\n\t\t\tif happy [then]\n\t\t\t\t[jump]\n\t\t\telse\n\t\tif (lahna)\n\t\t\t}\n*/\n\nclass Container {\n\tel: HTMLElement;\n\ttitle: HTMLElement;\n\ttitleText: HTMLElement;\n\ttitleIcon: HTMLElement;\n\tcontent: HTMLElement;\n\tcontrols: HTMLElement;\n\tproperties: List;\n\tcontainers: List;\n\ttitleClickedCallback: () => void;\n\titem: Serializable;\n\n\n\tconstructor() {\n\t\tthis.el = el('div.container',\n\t\t\tthis.title = el('div.containerTitle',\n\t\t\t\tthis.titleText = el('span.containerTitleText'),\n\t\t\t\tthis.titleIcon = el('i.icon.fa')\n\t\t\t),\n\t\t\tthis.content = el('div.containerContent',\n\t\t\t\tthis.properties = list('div.propertyEditorProperties', PropertyElement, null),\n\t\t\t\tthis.containers = list('div', Container, null),\n\t\t\t\tthis.controls = el('div'),\n\t\t\t\tel('i.button.logButton.fas.fa-eye', {\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tconsole.log(this.item);\n\t\t\t\t\t\twindow['item'] = this.item;\n\t\t\t\t\t\tconsole.log(`you can use variable 'item'`);\n\t\t\t\t\t\tlet element = el('span', ' logged to console');\n\t\t\t\t\t\tmount(this.title, element);\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.title.removeChild(element);\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\t\tthis.titleClickedCallback = null;\n\t\tthis.title.onclick = () => {\n\t\t\tthis.titleClickedCallback && this.titleClickedCallback();\n\t\t};\n\n\t\tredomListen(this, 'propertyInherited', (property, view) => {\n\t\t\tif (this.item.threeLetterType !== 'icd') return;\n\t\t\t// this.item is inheritedComponentData\n\t\t\tlet proto = this.item.generatedForPrototype;\n\t\t\tlet newProperty = proto.createAndAddPropertyForComponentData(this.item, property.name, property.value);\n\t\t\tview.update(newProperty);\n\t\t\t// dispatch(this, 'markPropertyEditorDirty');\n\t\t});\n\t}\n\tupdate(state) {\n\t\tlet itemChanged = this.item !== state;\n\n\t\tif (itemChanged) {\n\t\t\tthis.item = state;\n\t\t\tthis.el.setAttribute('type', this.item.threeLetterType);\n\n\t\t\t// Skip transitions when changing item\n\t\t\tskipTransitions(this.el);\n\t\t}\n\n\t\tthis.clearControls();\n\n\t\tthis.titleClickedCallback = null;\n\n\t\tif (this.item.threeLetterType === 'icd') this.updateInheritedComponentData();\n\t\telse if (this.item.threeLetterType === 'ent') this.updateEntity();\n\t\telse if (this.item.threeLetterType === 'com') this.updateComponent();\n\t\telse if (this.item.threeLetterType === 'prt') this.updatePrototype();\n\t\telse if (this.item.threeLetterType === 'epr') this.updateEntityPrototype();\n\t\telse if (this.item.threeLetterType === 'pfa') this.updatePrefab();\n\t\telse if (this.item instanceof PropertyOwner) this.updatePropertyOwner();\n\t}\n\tclearControls() {\n\t\tif (this.controls.innerHTML !== '')\n\t\t\tthis.controls.innerHTML = '';\n\t}\n\tupdatePrototype() {\n\t\tlet inheritedComponentDatas = this.item.getInheritedComponentDatas();\n\t\tthis.containers.update(inheritedComponentDatas);\n\t\tthis.properties.update(this.item.getChildren('prp'));\n\n\t\tlet addButton;\n\t\tmount(this.controls, addButton = el('button.button', el('i.fas.fa-puzzle-piece'), 'Add Component', {\n\t\t\tonclick: () => {\n\t\t\t\tnew ComponentAdder(this.item);\n\t\t\t}\n\t\t}));\n\t\tif (inheritedComponentDatas.length === 0)\n\t\t\taddButton.classList.add('clickMeEffect');\n\n\t\t\t/*\n\t\tmount(this.controls, el('button.button', el('i.fas.fa-clone'), 'Clone Type', {\n\t\t\tonclick: () => {\n\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\tlet clone = this.item.clone();\n\t\t\t\tlet { text, number } = parseTextAndNumber(clone.name);\n\t\t\t\tlet nameSuggestion = text + number++;\n\t\t\t\twhile (this.item.getParent().findChild('prt', prt => prt.name === nameSuggestion)) {\n\t\t\t\t\tnameSuggestion = text + number++;\n\t\t\t\t}\n\t\t\t\tclone.name = nameSuggestion;\n\t\t\t\tthis.item.getParent().addChild(clone);\n\t\t\t\tredomDispatch(this, 'propertyEditorSelect', clone);\n\t\t\t}\n\t\t}));\n\t\t*/\n\t\tmount(this.controls, el('button.dangerButton.button', el('i.fas.fa-times'), 'Delete Type (OLD!!!)', {\n\t\t\tonclick: () => {\n\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\tlet entityPrototypeCount = (this.item as Prototype).countEntityPrototypes(true);\n\t\t\t\tif (entityPrototypeCount) {\n\t\t\t\t\tif (confirm(`Type ${this.item.name} is used in levels ${entityPrototypeCount} times. Are you sure you want to delete this type and all ${entityPrototypeCount} objects that are using it?`))\n\t\t\t\t\t\tthis.item.delete();\n\t\t\t\t} else {\n\t\t\t\t\tthis.item.delete();\n\t\t\t\t}\n\t\t\t\tselectInEditor([], this);\n\t\t\t}\n\t\t}));\n\t}\n\tupdateEntityPrototype() {\n\t\tlet inheritedComponentDatas = this.item.getInheritedComponentDatas();\n\t\tthis.containers.update(inheritedComponentDatas);\n\t\tlet properties = this.item.getChildren('prp');\n\t\tproperties.forEach(prop => {\n\t\t\tprop._editorPlaceholder = this.item.makeUpAName();//.prototype.findChild('prp', prp => prp.name === prop.name).value;\n\t\t});\n\t\tthis.properties.update(properties);\n\t\tmount(this.controls, el(`button.button`, el('i.fas.fa-puzzle-piece'), 'Add Component', {\n\t\t\tonclick: () => {\n\t\t\t\tnew ComponentAdder(this.item);\n\t\t\t}\n\t\t}));\n\t}\n\tupdatePrefab() {\n\t\tlet inheritedComponentDatas = this.item.getInheritedComponentDatas();\n\t\tthis.containers.update(inheritedComponentDatas);\n\t\tlet properties = this.item.getChildren('prp');\n\t\tproperties.forEach(prop => {\n\t\t\tprop._editorPlaceholder = this.item.makeUpAName();//.prototype.findChild('prp', prp => prp.name === prop.name).value;\n\t\t});\n\t\tthis.properties.update(properties);\n\t\tmount(this.controls, el(`button.button`, el('i.fas.fa-puzzle-piece'), 'Add Component', {\n\t\t\tonclick: () => {\n\t\t\t\tnew ComponentAdder(this.item);\n\t\t\t}\n\t\t}));\n\t}\n\tupdateInheritedComponentData() {\n\t\tthis.updateComponentKindOfThing(this.item.componentClass);\n\n\t\tlet packId = 'pack' + this.item.componentClass.componentName;\n\t\tlet packedStatus = getOption(packId);\n\t\tif (packedStatus === 'true') {\n\t\t\tthis.el.classList.add('packed');\n\t\t} else if (packedStatus === 'false') {\n\t\t\tthis.el.classList.remove('packed');\n\t\t} else {\n\t\t\tthis.el.classList.toggle('packed', !this.item.ownComponentData);\n\t\t}\n\n\t\tthis.titleClickedCallback = () => {\n\t\t\tthis.el.classList.toggle('packed');\n\t\t\tsetOption(packId, this.el.classList.contains('packed') ? 'true' : 'false');\n\t\t};\n\n\t\tlet parentComponentData = this.item.ownComponentData && this.item.ownComponentData.getParentComponentData();\n\t\tlet hasOwnProperties = false;\n\t\tthis.item.properties.forEach(prop => {\n\t\t\tif (prop.id)\n\t\t\t\thasOwnProperties = true;\n\t\t\tif (prop.propertyType.visibleIf) {\n\t\t\t\tprop._editorVisibleIfTarget = this.item.properties.find(p => p.name === prop.propertyType.visibleIf.propertyName);\n\t\t\t}\n\t\t});\n\t\tthis.properties.update(this.item.properties);\n\n\t\tif (!this.item.ownComponentData || parentComponentData) {\n\t\t\tmount(this.controls, el('button.button', 'Show Parent', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tlet componentData = this.item.generatedForPrototype.getParentPrototype().findComponentDataByComponentId(this.item.componentId, true);\n\t\t\t\t\tredomDispatch(this, 'propertyEditorSelect', componentData.getParent());\n\t\t\t\t\tredomDispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tif (this.item.componentClass.componentName === 'Transform'\n\t\t\t&& this.item.generatedForPrototype.threeLetterType === 'epr')\n\t\t\treturn;\n\n\t\tif (this.item.componentClass.allowMultiple) {\n\t\t\tmount(this.controls, el('button.button', el('i.fas.fa-clone'), 'Clone', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\t\tif (this.item.ownComponentData) {\n\t\t\t\t\t\tlet clone = this.item.ownComponentData.clone();\n\t\t\t\t\t\tthis.item.generatedForPrototype.addChild(clone);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Is empty component data\n\t\t\t\t\t\tlet componentData = new ComponentData(this.item.componentClass.componentName);\n\t\t\t\t\t\tcomponentData.initWithChildren();\n\t\t\t\t\t\tthis.item.generatedForPrototype.addChild(componentData);\n\t\t\t\t\t}\n\t\t\t\t\tredomDispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tif (hasOwnProperties) {\n\t\t\tmount(this.controls, el('button.dangerButton.button', el('i.fas.fa-refresh'), 'Reset', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\t\tredomDispatch(this, 'markPropertyEditorDirty', 'fromReset');\n\t\t\t\t\tif (this.item.ownComponentData.getParentComponentData()) {\n\t\t\t\t\t\tthis.item.ownComponentData.delete();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item.ownComponentData.deleteChildren();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tif (this.item.ownComponentData && !parentComponentData) {\n\t\t\tmount(this.controls, el('button.dangerButton.button', el('i.fas.fa-times'), 'Delete', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tlet deleteOperation = () => {\n\t\t\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\t\t\tredomDispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t\t\tthis.item.ownComponentData.delete();\n\t\t\t\t\t}\n\n\t\t\t\t\tlet componentName = this.item.componentClass.componentName;\n\t\t\t\t\tlet parent = this.item.ownComponentData.getParent();\n\t\t\t\t\tlet similarComponent = parent.findChild('cda', cda => cda.name === componentName && cda !== this.item.ownComponentData);\n\t\t\t\t\tif (!similarComponent) {\n\t\t\t\t\t\tlet componentsThatRequire = parent.getChildren('cda').filter(componentData => componentData.componentClass.requirements.includes(componentName));\n\t\t\t\t\t\tif (componentsThatRequire.length > 0) {\n\t\t\t\t\t\t\tnew Confirmation(`<b>${componentName}</b> is needed by: <b>${componentsThatRequire.map(cda => cda.name).join(', ')}</b>`, {\n\t\t\t\t\t\t\t\ttext: `Delete all (${componentsThatRequire.length + 1}) components`,\n\t\t\t\t\t\t\t\tcolor: '#cd4148'\n\t\t\t\t\t\t\t}, () => {\n\t\t\t\t\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\t\t\t\t\tredomDispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t\t\t\t\tcomponentsThatRequire.forEach(cda => {\n\t\t\t\t\t\t\t\t\tcda.delete();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.item.ownComponentData.delete();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\t\tredomDispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t\tthis.item.ownComponentData.delete();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\tupdateEntity() {\n\t\tlet entityName = this.item.makeUpAName();\n\t\tif (this.titleText.textContent !== entityName)\n\t\t\tthis.titleText.textContent = entityName;\n\t\tthis.containers.update(this.item.getListOfAllComponents());\n\t\t// this.properties.update(this.item.getChildren('prp'));\n\t}\n\tupdateComponent() {\n\t\tif (this.el.classList.contains('packed'))\n\t\t\tthis.el.classList.remove('packed');\n\n\t\tthis.updateComponentKindOfThing(this.item.constructor);\n\n\t\tlet getChildren = this.item.getChildren('prp');\n\n\t\tthis.properties.update(getChildren);\n\t}\n\tupdateComponentKindOfThing(componentClass) {\n\t\tif (this.titleText.textContent !== componentClass.componentName)\n\t\t\tthis.titleText.textContent = componentClass.componentName;\n\n\t\tlet className = 'icon fas ' + componentClass.icon;\n\t\tif (this.titleIcon.className !== className)\n\t\t\tthis.titleIcon.className = className;\n\n\t\tif (this.componentClassColorCache !== componentClass.color) {\n\t\t\tthis.componentClassColorCache = componentClass.color;\n\n\t\t\tthis.title.style.color = componentClass.color;\n\t\t\tthis.el.style['border-color'] = componentClass.color;\n\t\t}\n\n\t\tif (this.title.getAttribute('title') !== componentClass.description)\n\t\t\tthis.title.setAttribute('title', componentClass.description);\n\t}\n\tupdatePropertyOwner() {\n\t\tthis.properties.update(this.item.getChildren('prp'));\n\t}\n}\n\nclass PropertyElement {\n\tel: HTMLElement;\n\tname: HTMLElement;\n\tcontent: HTMLElement;\n\tproperty: Property;\n\tsetValue: (any) => void;\n\t_previousValue: any;\n\tvisibleIfListener: Function;\n\n\tconstructor() {\n\t\tthis.el = el('div.property', { name: '' },\n\t\t\tthis.name = el('div.nameCell'),\n\t\t\tthis.content = el('div.propertyContent')\n\t\t);\n\t}\n\treset() {\n\t\tlet componentData = this.property.getParent() as any as ComponentData;\n\t\tthis.property.delete();\n\t\tif (componentData._children.size === 0) {\n\t\t\tif (componentData.getParentComponentData())\n\t\t\t\tcomponentData.delete();\n\t\t}\n\n\t\tredomDispatch(this, 'markPropertyEditorDirty');\n\t}\n\tfocus() {\n\t\tthis.el.querySelector('input').focus();\n\t}\n\toninput(val) {\n\t\ttry {\n\t\t\tthis.property.propertyType.validator.validate(this.convertFromInputToPropertyValue(val));\n\t\t\tthis.el.removeAttribute('error');\n\t\t} catch (e) {\n\t\t\tthis.el.setAttribute('error', 'true');\n\t\t}\n\t}\n\tonchange(val) {\n\t\tlet originalValue = this.property.value;\n\t\ttry {\n\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\tthis.property.value = this.property.propertyType.validator.validate(this.convertFromInputToPropertyValue(val));\n\t\t\tif (!this.property.id) {\n\t\t\t\tredomDispatch(this, 'propertyInherited', this.property);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// console.log('Error while changing property value', this.property, this.input.value);\n\t\t\tthis.property.value = originalValue;\n\t\t}\n\t\tthis.setValueFromProperty();\n\t\tthis.el.removeAttribute('error');\n\t}\n\tsetValueFromProperty() {\n\t\tlet val = this.property.value;\n\t\tif (this.property.propertyType.getFlag(Prop.flagDegreesInEditor))\n\t\t\tval = Math.round(val * 180 / Math.PI * 10) / 10;\n\t\tthis.setValue(val);\n\t}\n\tconvertFromInputToPropertyValue(val) {\n\t\tif (this.property.propertyType.getFlag(Prop.flagDegreesInEditor))\n\t\t\treturn val * Math.PI / 180;\n\t\telse\n\t\t\treturn val;\n\t}\n\tupdateVisibleIf() {\n\t\tif (!this.property._editorVisibleIfTarget)\n\t\t\treturn;\n\t\tthis.el.classList.toggle('hidden', !this.property.propertyType.visibleIf.values.includes(this.property._editorVisibleIfTarget.value));\n\t}\n\tupdate(property) {\n\t\t// Optimization\n\t\tif (this.property === property && this._previousValue === property.value)\n\t\t\treturn;\n\n\t\tconst propertyChanged = this.property !== property;\n\t\tlet keepOldInput = false;\n\t\tif (this.property && this.property.propertyType === property.propertyType && !this.property.id && property.id) {\n\t\t\t// Special case.\n\t\t\tkeepOldInput = true;\n\t\t}\n\n\t\tthis._previousValue = property.value;\n\n\t\tif (this.visibleIfListener) {\n\t\t\tthis.visibleIfListener(); // unlisten\n\t\t\tthis.visibleIfListener = null;\n\t\t}\n\t\tthis.property = property;\n\t\tif (propertyChanged) {\n\t\t\tthis.el.setAttribute('name', property.name);\n\t\t\tthis.el.setAttribute('type', property.propertyType.type.name);\n\t\t\tthis.name.textContent = variableNameToPresentableName(property.propertyType.name);\n\t\t\tthis.name.setAttribute('title', `${property.propertyType.name} (${property.propertyType.type.name}) ${property.propertyType.description}`);\n\t\t\tthis.name.style['font-size'] = this.name.textContent.length > 18 ? '0.8rem' : '1rem';\n\t\t\tif (property.propertyType.description) {\n\t\t\t\tmount(this.name, el('span.infoI', 'i'));\n\t\t\t}\n\n\t\t\tif (!keepOldInput) {\n\t\t\t\tthis.content.innerHTML = '';\n\t\t\t\tthis.propertyEditorInstance = editors[this.property.propertyType.type.name] || editors.default;\n\t\t\t\tthis.setValue = this.propertyEditorInstance(this.content, val => this.oninput(val), val => this.onchange(val), {\n\t\t\t\t\tpropertyType: property.propertyType,\n\t\t\t\t\tplaceholder: property._editorPlaceholder\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.el.classList.toggle('visibleIf', !!property.propertyType.visibleIf);\n\t\t\tthis.el.classList.toggle('ownProperty', !!this.property.id);\n\n\t\t\tif (this.property.id) {\n\t\t\t\tlet parent = this.property.getParent();\n\t\t\t\tif (parent.threeLetterType === 'cda'\n\t\t\t\t\t&& (parent.name !== 'Transform' || parent.getParent().threeLetterType !== 'epr'))\n\t\t\t\t// Can not delete anything from entity prototype transform\n\t\t\t\t{\n\t\t\t\t\tthis.name.style.color = parent.componentClass.color;\n\n\t\t\t\t\tmount(this.content, el('i.fas.fa-times.button.resetButton.iconButton', {\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tredomDispatch(this, 'makingChanges');\n\t\t\t\t\t\t\tthis.reset();\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t} else if (parent.threeLetterType === 'com') {\n\t\t\t\t\tthis.name.style.color = parent.constructor.color;\n\n\t\t\t\t\tmount(this.content, el('i.fas.fa-ellipsis-v.button.moreButton.iconButton', {\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tnew ObjectMoreButtonContextMenu(this.property);\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tthis.name.style.color = 'inherit';\n\t\t}\n\t\tthis.setValueFromProperty();\n\t\tif (property._editorVisibleIfTarget) {\n\t\t\tthis.updateVisibleIf();\n\t\t\tthis.visibleIfListener = property._editorVisibleIfTarget.listen(GameEvent.PROPERTY_VALUE_CHANGE, _ => {\n\t\t\t\tif (!isInDom(this.el)) {\n\t\t\t\t\tthis.visibleIfListener();\n\t\t\t\t\tthis.visibleIfListener = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.updateVisibleIf()\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction isInDom(element) {\n\treturn $.contains(document.documentElement, element);\n}\n\nfunction variableNameToPresentableName(propertyName) {\n\tlet name = propertyName.replace(/[A-Z]/g, c => ' ' + c);\n\treturn name[0].toUpperCase() + name.substring(1);\n}\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport PropertyEditor from '../views/propertyEditor/propertyEditor';\nimport { editor } from '../editor';\nimport { scene } from '../../core/scene';\nimport { listenKeyDown, key } from '../../util/input';\nimport { editorSelection } from '../editorSelection';\n\nclass PrefabModule extends Module {\n\tpropertyEditor: PropertyEditor;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.addElements(this.propertyEditor = new PropertyEditor());\n\t\tthis.id = 'prefab';\n\t\tthis.name = 'Pre<u>f</u>ab';\n\n\t\tlistenKeyDown(k => {\n\t\t\tif (k === key.f && this._enabled) {\n\t\t\t\tModule.activateModule('prefab', true);\n\t\t\t}\n\t\t});\n\t}\n\tupdate() {\n\t\t// return true;\n\t\tif (editorSelection.items.length != 1)\n\t\t\treturn false; // multiedit not supported yet\n\n\t\tif (editorSelection.type === 'pfa') {\n\t\t\tif (!this._selected || this.moduleContainer.isPacked()) {\n\t\t\t\treturn true; // if the tab is not visible, do not waste CPU\n\t\t\t}\n\n\t\t\tthis.propertyEditor.update(editorSelection.items, editorSelection.type);\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tactivate(command, parameter) {\n\t\tif (command === 'focusOnProperty') {\n\t\t\tthis.propertyEditor.el.querySelector(`.property[name='${parameter}'] input`).select();\n\t\t}\n\t}\n}\n\nModule.register(PrefabModule, 'right');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport PropertyEditor from '../views/propertyEditor/propertyEditor';\nimport { editor } from '../editor';\nimport { scene } from '../../core/scene';\nimport { listenKeyDown, key } from '../../util/input';\nimport { editorSelection } from '../editorSelection';\n\nclass ObjectModule extends Module {\n\tpropertyEditor: PropertyEditor;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.addElements(this.propertyEditor = new PropertyEditor());\n\n\t\tthis.id = 'object';\n\t\tthis.name = '<u>O</u>bject';\n\n\t\tlistenKeyDown(k => {\n\t\t\tif (k === key.o && this._enabled) {\n\t\t\t\tModule.activateModule('object', true);\n\t\t\t}\n\t\t});\n\t}\n\tupdate() {\n\t\tif (editorSelection.items.length != 1)\n\t\t\treturn false; // multiedit not supported yet\n\n\t\tif (editorSelection.type === 'ent' || editorSelection.type === 'epr') {\n\t\t\tif (!this._selected || this.moduleContainer.isPacked()) {\n\t\t\t\treturn; // if the tab is not visible, do not waste CPU\n\t\t\t}\n\n\t\t\tthis.propertyEditor.update(editorSelection.items, editorSelection.type);\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tactivate(command, parameter) {\n\t\tif (command === 'focusOnProperty') {\n\t\t\tthis.propertyEditor.el.querySelector(`.property[name='${parameter}'] input`).select();\n\t\t}\n\t}\n}\n\nModule.register(ObjectModule, 'right');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport PropertyEditor from '../views/propertyEditor/propertyEditor';\nimport { setChangeOrigin } from '../../core/change';\nimport Level from '../../core/level';\nimport { selectedLevel } from '../editorSelection';\n\nclass LevelModule extends Module {\n\tpropertyEditor: PropertyEditor;\n\tdeleteButton: HTMLElement;\n\tlevel: Level;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.addElements(\n\t\t\tthis.propertyEditor = new PropertyEditor(),\n\t\t\tthis.deleteButton = el('button.button.dangerButton', 'Delete', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (this.level.isEmpty() || confirm('Are you sure you want to delete level: ' + this.level.name)) {\n\t\t\t\t\t\tsetChangeOrigin(this);\n\t\t\t\t\t\tthis.level.delete();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tthis.id = 'level';\n\t\tthis.name = 'Level';\n\t}\n\tupdate() {\n\t\tthis.level = null;\n\t\tif (selectedLevel) {\n\t\t\tthis.level = selectedLevel;\n\t\t\tthis.propertyEditor.update([selectedLevel], 'lvl');\n\t\t} else\n\t\t\treturn false;\n\t}\n\tactivate(command, parameter) {\n\t\tif (command === 'focusOnProperty') {\n\t\t\tthis.propertyEditor.el.querySelector(`.property[name='${parameter}'] input`).select();\n\t\t}\n\t}\n}\n\nModule.register(LevelModule, 'right');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport PropertyEditor from '../views/propertyEditor/propertyEditor';\nimport { game } from '../../core/game';\nimport PropertyOwner from '../../core/propertyOwner'\nimport { TopButton } from './topBarModule'\n\nclass GameModule extends Module {\n\tpropertyEditor: PropertyEditor;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.addElements(\n\t\t\tthis.propertyEditor = new PropertyEditor(),\n\t\t\tel('button.dangerButton.button', el('i.fas.fa-times'), 'Delete Game', { onclick: () => {\n\t\t\t\tif (confirm(`Delete game '${game.name}'? (Cannot be undone)`)) {\n\t\t\t\t\tgame.delete();\n\t\t\t\t}\n\t\t\t} })\n\t\t);\n\t\tthis.id = 'game';\n\t\tthis.name = 'Game';\n\t}\n\tupdate() {\n\t\tif (game) {\n\t\t\tthis.propertyEditor.update([game], 'gam');\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tactivate(command, parameter) {\n\t\tif (command === 'focusOnProperty') {\n\t\t\tthis.propertyEditor.el.querySelector(`.property[name='${parameter}'] input`).select();\n\t\t}\n\t}\n}\n\nModule.register(GameModule, 'right');\n","import { el, list, mount, RedomComponent, List, text } from 'redom';\nimport Module from './module';\nimport Scene, { scene } from '../../core/scene';\nimport { editorEventDispacher, EditorEvent } from '../editorEventDispatcher';\nimport { editorSelection, unfocus, selectInEditor } from '../editorSelection';\nimport EntityPrototype from '../../core/entityPrototype';\nimport ComponentData from '../../core/componentData';\nimport Property from '../../core/property';\nimport { animation } from '../../features/animation/animation';\nimport { redomDispatch, redomListen } from '../../util/redomEvents';\nimport { isMouseButtonDown, listenKeyDown, key, keyPressed } from '../../util/input';\nimport { editorGlobals, SceneMode } from '../editorGlobals';\nimport { Change, changeType, setChangeOrigin, getChangeOrigin, executeWithOrigin } from '../../core/change';\nimport Entity from '../../core/entity';\nimport { Component } from '../../core/component';\nimport Confirmation from '../views/popup/Confirmation';\nimport { isMultiSelectModifierPressed } from '../util/sceneEditUtil';\nimport Prototype from '../../core/prototype';\n\nclass AnimationModule extends Module {\n\tanimations: animation.Animation[] = [];\n\tanimationComponentId: string = null;\n\teditedEntityPrototype: EntityPrototype = null;\n\tanimationData: animation.AnimationData = null;\n\tanimationSelector: AnimationSelector;\n\tanimationTimelineView: AnimationTimelineView;\n\n\tselectedAnimation: animation.Animation = null;\n\n\tfocusedKeyFrameViews: TrackFrameView[] = [];\n\n\trecordButton: HTMLButtonElement;\n\tframeCountEditor: FrameCountEditor;\n\tframeRateEditor: FrameRateEditor;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.addElements(\n\t\t\tel('div.animationModule',\n\t\t\t\tel('div',\n\t\t\t\t\tel('button.button', 'Add animation', { onclick: () => this.addAnimation() }),\n\t\t\t\t\tthis.animationSelector = new AnimationSelector(),\n\t\t\t\t\t// el('button.button', 'Add keyframe', { onclick: () => this.addKeyframe() }),\n\t\t\t\t\tthis.recordButton = <HTMLButtonElement>el('button.button.recordButton', el('i.fas.fa-circle'), 'Record key frames', {\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tif (editorGlobals.sceneMode === SceneMode.RECORDING) {\n\t\t\t\t\t\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\teditorGlobals.sceneMode = SceneMode.RECORDING;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tdisplay: 'none' // until an animation is selected\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tthis.frameCountEditor = new FrameCountEditor(),\n\t\t\t\t\tthis.frameRateEditor = new FrameRateEditor()\n\t\t\t\t),\n\t\t\t\tthis.animationTimelineView = new AnimationTimelineView()\n\t\t\t)\n\t\t);\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_SCENE_MODE_CHANGED, () => {\n\t\t\tif (editorGlobals.sceneMode === SceneMode.RECORDING) {\n\t\t\t\tthis.recordButton.classList.add('selected');\n\t\t\t\tselectInEditor([], this);\n\t\t\t} else {\n\t\t\t\tthis.recordButton.classList.remove('selected');\n\t\t\t\tif (editorGlobals.sceneMode === SceneMode.NORMAL && this.editedEntityPrototype) {\n\t\t\t\t\texecuteWithOrigin(this, () => {\n\t\t\t\t\t\tthis.editedEntityPrototype.previouslyCreatedEntity.resetComponents();\n\t\t\t\t\t})\n\t\t\t\t\t// selectInEditor([this.editedEntityPrototype], this);\n\t\t\t\t\tthis.editedEntityPrototype = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.name = 'Animation';\n\t\tthis.id = 'animation';\n\n\t\tredomListen(this, 'frameSelected', frameNumber => {\n\t\t\tthis.setFrameInEntity();\n\t\t});\n\t\tredomListen(this, 'animationSelected', animation => {\n\t\t\tthis.selectedAnimation = animation;\n\n\t\t\tthis.updateChildren();\n\n\t\t\t// this.animationTimelineView.update(this.selectedAnimation);\n\t\t\tlet component = this.getEntityComponent();\n\t\t\tsetChangeOrigin(this);\n\t\t\tcomponent.animator.setAnimation(animation && animation.name); // send falsy if initial pose should be selected\n\t\t\tif (!animation && editorGlobals.sceneMode === SceneMode.PREVIEW) {\n\t\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\t}\n\t\t\tthis.animationTimelineView.selectFrame(1);\n\n\t\t\tthis.recordButton.style.display = animation ? 'inline-block' : 'none';\n\n\t\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_DRAW_NEEDED)\n\t\t});\n\t\tredomListen(this, 'frameCountChanged', frameCount => {\n\t\t\tif (!(frameCount > 0 && frameCount <= animation.MAX_FRAME_COUNT)) {\n\t\t\t\tthis.updateChildren();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst setFrameCount = () => {\n\t\t\t\tthis.selectedAnimation.frames = frameCount === animation.DEFAULT_FRAME_COUNT ? undefined : frameCount;\n\t\t\t\tthis.updateAnimationData();\n\t\t\t}\n\t\t\tlet highestKeyframe = this.selectedAnimation.getHighestKeyFrame();\n\t\t\tif (highestKeyframe > frameCount) {\n\t\t\t\tnew Confirmation(`Are you sure you want to remove keyframes?`, null, setFrameCount, () => this.updateChildren());\n\t\t\t} else {\n\t\t\t\tsetFrameCount();\n\t\t\t}\n\t\t});\n\t\tredomListen(this, 'frameRateChanged', fps => {\n\t\t\tif (!(fps > 0 && fps <= animation.MAX_FRAME_RATE)) {\n\t\t\t\tthis.updateChildren();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.selectedAnimation.fps = fps === animation.DEFAULT_FRAME_RATE ? undefined : fps;\n\t\t\tthis.updateAnimationData();\n\t\t});\n\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_CHANGE, (change: Change) => {\n\t\t\tif (change.type === changeType.move) {\n\t\t\t\tif (change.reference instanceof Prototype) {\n\t\t\t\t\tlet movedPrototype = change.reference\n\t\t\t\t\tlet movedSiblingId = movedPrototype.siblingId\n\t\t\t\t\tlet path = this.editedEntityPrototype.getPrototypePath(movedPrototype)\n\t\t\t\t\tif (path === null) {\n\t\t\t\t\t\t// moved out from animated tree. lets do nothing.\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tlet animationPrototypeFinder = movedPrototype\n\n\t\t\t\t\t// No need to do any changes if moved prototype is the animated prototype itself\n\t\t\t\t\tanimationPrototypeFinder = animationPrototypeFinder.getParent() as Prototype\n\n\t\t\t\t\twhile (animationPrototypeFinder instanceof Prototype) {\n\t\t\t\t\t\t// TODO: what if you break entityPrototype animated tree when it using PreFab?\n\n\t\t\t\t\t\tlet animationComponentData = animationPrototypeFinder.findChild('cda', (cda: ComponentData) => cda.name === 'Animation') as ComponentData\n\t\t\t\t\t\tif (animationComponentData) {\n\t\t\t\t\t\t\tlet animationData = animationComponentData.getValue('animationData')\n\t\t\t\t\t\t\tanimationData = replaceAnimationDataPrototypePath(animationData, movedSiblingId, path)\n\t\t\t\t\t\t\tanimationComponentData.setValue('animationData', animationData)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tanimationPrototypeFinder = animationPrototypeFinder._parent as Prototype\n\t\t\t\t\t}\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (editorGlobals.sceneMode !== SceneMode.RECORDING) {\n\t\t\t\tif (change.type === 'editorSelection' && this.editedEntityPrototype) {\n\t\t\t\t\tlet editorSelection = change.reference as any;\n\t\t\t\t\tif (editorSelection.items.length === 1 && editorSelection.items[0] === this.editedEntityPrototype) {\n\t\t\t\t\t\t// Do nothing\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tif (editorGlobals.sceneMode === SceneMode.PREVIEW) {\n\t\t\t\t\t\t\texecuteWithOrigin(this, () => {\n\t\t\t\t\t\t\t\tthis.editedEntityPrototype.previouslyCreatedEntity.resetComponents();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.editedEntityPrototype = null;\n\t\t\t\t\t\t*/\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (change.origin === this) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (change.reference.threeLetterType !== 'prp')\n\t\t\t\treturn;\n\n\t\t\tif (change.type === changeType.setPropertyValue) {\n\t\t\t\tlet property = change.reference as Property;\n\n\t\t\t\tlet component = property.getParent() as Component;\n\t\t\t\tif (!component || component.threeLetterType !== 'com' || component.componentClass.componentName === 'Animation')\n\t\t\t\t\treturn;\n\n\t\t\t\tlet entity = component.getParent() as Entity;\n\t\t\t\tif (!entity || entity.threeLetterType !== 'ent')\n\t\t\t\t\treturn;\n\n\t\t\t\tlet entityPrototype = entity.prototype as EntityPrototype;\n\t\t\t\tif (!entityPrototype)\n\t\t\t\t\treturn;\n\n\t\t\t\tlet isChildOfEdited = !!entityPrototype.findParent('epr', (epr: EntityPrototype) => epr === this.editedEntityPrototype);\n\t\t\t\tif (!isChildOfEdited)\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.saveValue(entityPrototype, component._componentId, property);\n\t\t\t}\n\t\t});\n\n\t\tlistenKeyDown(keyCode => {\n\t\t\tif (keyCode === key.backspace) {\n\t\t\t\tif (this._selected && this._enabled && !editorSelection.focused) {\n\t\t\t\t\tthis.focusedKeyFrameViews.forEach(view => {\n\t\t\t\t\t\tdelete view.trackKeyFrames[view.frame]\n\t\t\t\t\t});\n\t\t\t\t\tthis.updateAnimationData();\n\t\t\t\t\tunfocus();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tredomListen(this, 'selectKeyFrameView', keyFrameView => {\n\t\t\tif (editorSelection.focused) {\n\t\t\t\t// If something else is focused, unfocus. But we don't want to unfocus TrackFrameViews which are focused more hackily.\n\t\t\t\tunfocus();\n\t\t\t}\n\n\t\t\tlet keyFrameList: TrackFrameView[] = Array.isArray(keyFrameView) ? keyFrameView : [keyFrameView];\n\t\t\tkeyFrameList = keyFrameList.filter(frameView => frameView.isKeyFrame());\n\t\t\tlet allAreSelected = !keyFrameList.find(frameView => !this.focusedKeyFrameViews.includes(frameView));\n\n\t\t\tif (isMultiSelectModifierPressed()) {\n\t\t\t\tif (keyFrameList.length > 0) {\n\t\t\t\t\tif (allAreSelected) {\n\t\t\t\t\t\tfor (let frameView of keyFrameList) {\n\t\t\t\t\t\t\tlet indexOfFrame = this.focusedKeyFrameViews.indexOf(frameView);\n\t\t\t\t\t\t\tif (indexOfFrame >= 0) {\n\t\t\t\t\t\t\t\tthis.focusedKeyFrameViews.splice(indexOfFrame, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tframeView.el.classList.remove('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let frameView of keyFrameList) {\n\t\t\t\t\t\t\tif (!this.focusedKeyFrameViews.includes(frameView)) {\n\t\t\t\t\t\t\t\tthis.focusedKeyFrameViews.push(frameView);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tframeView.el.classList.add('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// unfocus();\n\n\t\t\t\tthis.animationTimelineView.el.querySelectorAll('td.trackFrame.selected').forEach(frameView => {\n\t\t\t\t\tframeView.classList.remove('selected');\n\t\t\t\t});\n\n\t\t\t\tthis.focusedKeyFrameViews.length = 0;\n\n\t\t\t\tif (keyFrameList.length > 0) {\n\t\t\t\t\tthis.focusedKeyFrameViews.push(...keyFrameList);\n\t\t\t\t\tfor (let frameView of keyFrameList) {\n\t\t\t\t\t\tframeView.el.classList.add('selected');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\teditorEventDispacher.listen(EditorEvent.EDITOR_UNFOCUS, () => {\n\t\t\tif (this.focusedKeyFrameViews.length > 0) {\n\t\t\t\tthis.animationTimelineView.el.querySelectorAll('td.trackFrame.selected').forEach(frameView => {\n\t\t\t\t\tframeView.classList.remove('selected');\n\t\t\t\t})\n\t\t\t\tthis.focusedKeyFrameViews.length = 0;\n\t\t\t}\n\n\t\t\tif (editorGlobals.sceneMode !== SceneMode.RECORDING) {\n\t\t\t\teditorGlobals.sceneMode = SceneMode.NORMAL;\n\t\t\t}\n\t\t});\n\t}\n\tgetEntityComponent() {\n\t\tif (scene.playing) {\n\t\t\treturn null;\n\t\t}\n\t\tif (!this.editedEntityPrototype) {\n\t\t\treturn null;\n\t\t}\n\t\tlet entity = this.editedEntityPrototype.previouslyCreatedEntity;\n\t\tif (entity) {\n\t\t\treturn entity.getComponents('Animation').find(comp => comp._componentId === this.animationComponentId);\n\t\t}\n\t\treturn null;\n\t}\n\tupdate() {\n\t\tif (editorGlobals.sceneMode === SceneMode.RECORDING && this.editedEntityPrototype && this.editedEntityPrototype._alive) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (editorSelection.type === 'epr' && editorSelection.items.length === 1) {\n\t\t\tlet entityPrototype = editorSelection.items[0] as EntityPrototype;\n\t\t\tif (entityPrototype.hasComponentData('Animation') && entityPrototype.previouslyCreatedEntity) {\n\t\t\t\tlet inheritedComponentDatas = entityPrototype.getInheritedComponentDatas((cda: ComponentData) => cda.name === 'Animation');\n\t\t\t\tif (inheritedComponentDatas.length === 1) {\n\t\t\t\t\tif (this.editedEntityPrototype !== entityPrototype) {\n\t\t\t\t\t\tlet inheritedComponentData = inheritedComponentDatas[0];\n\t\t\t\t\t\tthis.updateRaw(inheritedComponentData);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t/*\n\t\tHow about Prefab?\n\n\t\tEditing must be done in entities.\n\t\tHow do I make sure that entityPrototypes haven't overridden stuff?\n\t\tSounds a little troublesome to edit prefab using entities.\n\t\tWould be cool if this could be done someday.\n\n\t\telse if (editorSelection.type === 'pfa' && editorSelection.items.length === 1) {\n\t\t\tlet prefab = editorSelection.items[0] as Prefab;\n\t\t\tlet animationComponentData = entityPrototype.findChild('cda', (cda: ComponentData) => cda.name === 'Animation') as ComponentData;\n\t\t} */\n\t\treturn false;\n\t}\n\tactivate() {\n\t\tlet component = this.getEntityComponent();\n\t\tif (!component) {\n\t\t\treturn;\n\t\t}\n\t\tcomponent.animator.setAnimation(this.selectedAnimation && this.selectedAnimation.name); // send falsy if initial pose should be selected\n\t\tthis.setFrameInEntity();\n\t}\n\n\tupdateRaw(inheritedComponentData) {\n\t\tthis.editedEntityPrototype = inheritedComponentData.generatedForPrototype;\n\t\teditorGlobals.animationEntityPrototype = inheritedComponentData.generatedForPrototype;\n\t\tthis.animationComponentId = inheritedComponentData.componentId;\n\t\tlet animationDataString = inheritedComponentData.properties.find((prop: Property) => prop.name === 'animationData').value;\n\n\t\tthis.animationData = animation.parseAnimationData(animationDataString);\n\n\t\t// We are sneaky and store Animation objects in jsonable object.\n\t\tthis.animationData.animations = this.animationData.animations.map(animation.Animation.create);\n\t\tthis.animations = this.animationData.animations as animation.Animation[];\n\n\t\tthis.updateChildren();\n\t}\n\n\tupdateChildren() {\n\t\tthis.animationSelector.update(this.animations);\n\t\tthis.selectedAnimation = this.animationSelector.getSelectedAnimation();\n\t\tthis.animationTimelineView.update(this.selectedAnimation);\n\n\t\tthis.frameCountEditor.update(this.selectedAnimation && (this.selectedAnimation.frames || animation.DEFAULT_FRAME_COUNT));\n\t\tthis.frameRateEditor.update(this.selectedAnimation && (this.selectedAnimation.fps || animation.DEFAULT_FRAME_RATE));\n\t}\n\n\taddAnimation() {\n\t\tlet name = prompt('name', 'idle');\n\t\tif (name) {\n\t\t\tlet newAnimation = new animation.Animation(name);\n\t\t\tthis.animations.push(newAnimation);\n\t\t\tthis.updateAnimationData();\n\t\t\tthis.updateChildren();\n\t\t\tthis.animationSelector.select(name);\n\t\t}\n\t}\n\n\tupdateAnimationData() {\n\t\tlet componentData = this.editedEntityPrototype.getOwnComponentDataOrInherit(this.animationComponentId);\n\n\t\t// Delete empty tracks:\n\t\tfor (let anim of this.animations) {\n\t\t\tanim.deleteEmptyTracks();\n\t\t\tanim.deleteOutOfBoundsKeyFrames();\n\t\t}\n\n\t\tsetChangeOrigin(this);\n\t\tcomponentData.setValue('animationData', JSON.stringify(this.animationData));\n\t\tthis.animationTimelineView.update(this.selectedAnimation);\n\n\t\t// Reload entity Animator:\n\t\tlet component = this.getEntityComponent();\n\t\tif (component) {\n\t\t\tcomponent.animationData = componentData.getValue('animationData');\n\t\t}\n\t}\n\n\tsaveValue(entityPrototype: EntityPrototype, componendId: string, property: Property) {\n\t\tlet path = this.editedEntityPrototype.getPrototypePath(entityPrototype)\n\t\t// If this is the first keyframe, make sure there is a keyframe on frame 1.\n\t\tif (this.animationTimelineView.selectedFrame !== 1) {\n\t\t\tlet keyFrames = this.selectedAnimation.getKeyFrames(entityPrototype.id, componendId, property.name);\n\t\t\tif (!keyFrames || Object.keys(keyFrames).length === 0) {\n\t\t\t\tlet frame1Value = entityPrototype.getValue(componendId, property.name);\n\t\t\t\tthis.selectedAnimation.saveValue(path, componendId, property.name, 1, property.propertyType.type.toJSON(frame1Value));\n\t\t\t}\n\t\t}\n\n\t\tthis.selectedAnimation.saveValue(path, componendId, property.name, this.animationTimelineView.selectedFrame, property.propertyType.type.toJSON(property._value));\n\t\tthis.updateAnimationData();\n\t}\n\n\tsetFrameInEntity() {\n\t\tif (scene.playing) {\n\t\t\treturn;\n\t\t}\n\t\tlet component = this.getEntityComponent();\n\t\tif (component) {\n\t\t\tif (component.animator.currentAnimation) {\n\t\t\t\tif (editorGlobals.sceneMode !== SceneMode.RECORDING) {\n\t\t\t\t\teditorGlobals.sceneMode = SceneMode.PREVIEW;\n\t\t\t\t}\n\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tcomponent.animator.currentAnimation.setFrame(this.animationTimelineView.selectedFrame);\n\n\t\t\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_DRAW_NEEDED)\n\t\t\t}\n\t\t}\n\t}\n\n\tfree() {\n\n\t}\n}\nModule.register(AnimationModule, 'bottom');\n\nclass AnimationSelector implements RedomComponent {\n\tel: HTMLSelectElement;\n\tlist: List;\n\tanimations: animation.Animation[];\n\tconstructor() {\n\t\tthis.el = el('select.animationSelector', {\n\t\t\tonchange: () => redomDispatch(this, 'animationSelected', this.getSelectedAnimation())\n\t\t}) as HTMLSelectElement;\n\t\tthis.list = list(this.el, AnimationSelectorOption, (key => key) as any);\n\t}\n\tupdate(animations: animation.Animation[]) {\n\t\tthis.animations = animations;\n\t\tthis.list.update([null, ...animations.map(anim => anim.name)]);\n\t}\n\tselect(name: string) {\n\t\tthis.el.value = name || '';\n\t\tthis.el.onchange(null);\n\t}\n\t/**\n\t * If this returns null, it means the initial pose the entity is without animations\n\t */\n\tgetSelectedAnimation() {\n\t\treturn this.animations.find(anim => anim.name === this.el.value);\n\t}\n}\nclass AnimationSelectorOption implements RedomComponent {\n\tel: HTMLElement;\n\tconstructor() {\n\t\tthis.el = el('option');\n\t}\n\tupdate(name) {\n\t\tthis.el.setAttribute('value', name || '');\n\t\tthis.el.innerText = name || 'Initial pose';\n\t}\n}\n\nclass FrameCountEditor implements RedomComponent {\n\tel: HTMLElement;\n\tinput: HTMLInputElement;\n\tconstructor() {\n\t\tthis.el = el('div.frameCountEditor',\n\t\t\t'Frames',\n\t\t\tthis.input = <HTMLInputElement>el('input.genericInput', {\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '45px'\n\t\t\t\t},\n\t\t\t\ttype: 'number',\n\t\t\t\tmin: 1,\n\t\t\t\tmax: animation.MAX_FRAME_COUNT,\n\t\t\t\tonchange: () => {\n\t\t\t\t\tredomDispatch(this, 'frameCountChanged', +this.input.value);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\tupdate(frameCount) {\n\t\tthis.el.style.display = frameCount ? 'inline-block' : 'none';\n\t\tif (frameCount) {\n\t\t\tthis.input.value = frameCount;\n\t\t}\n\t}\n}\n\nclass FrameRateEditor implements RedomComponent {\n\tel: HTMLElement;\n\tinput: HTMLInputElement;\n\tconstructor() {\n\t\tthis.el = el('div.frameRateEditor',\n\t\t\t'Fps',\n\t\t\tthis.input = <HTMLInputElement>el('input.genericInput', {\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '45px'\n\t\t\t\t},\n\t\t\t\ttype: 'number',\n\t\t\t\tmin: 1,\n\t\t\t\tmax: animation.MAX_FRAME_RATE,\n\t\t\t\tonchange: () => {\n\t\t\t\t\tredomDispatch(this, 'frameRateChanged', +this.input.value);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\tupdate(fps) {\n\t\tthis.el.style.display = fps ? 'inline-block' : 'none';\n\t\tif (fps) {\n\t\t\tthis.input.value = fps;\n\t\t}\n\t}\n}\n\nclass AnimationTimelineView implements RedomComponent {\n\tel: HTMLElement;\n\tframeNumbers: List;\n\ttrackList: List;\n\tselectedFrame: number;\n\tconstructor() {\n\t\tthis.el = el('table.animationTimeline',\n\t\t\tel('thead',\n\t\t\t\tthis.frameNumbers = list('tr', FrameNumberHeader, 'frame')\n\t\t\t),\n\t\t\tthis.trackList = list('tbody', TrackView)\n\t\t);\n\n\t\tredomListen(this, 'selectAllOnFrame', frame => {\n\t\t\tlet views = [];\n\t\t\tthis.trackList.views.forEach((trackView: TrackView) => {\n\t\t\t\ttrackView.list.views.forEach((frameView: TrackFrameView) => {\n\t\t\t\t\tif (frameView.frame === frame) {\n\t\t\t\t\t\tviews.push(frameView);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t\tredomDispatch(this, 'selectKeyFrameView', views);\n\t\t});\n\t\tredomListen(this, 'frameSelected', frame => this.selectedFrame = frame);\n\t}\n\tupdate(currentAnimation: animation.Animation) {\n\t\tif (!currentAnimation) {\n\t\t\tthis.selectedFrame = 0;\n\t\t\tthis.frameNumbers.update([]);\n\t\t\tthis.trackList.update([]);\n\t\t\treturn;\n\t\t}\n\n\t\tlet frameCount = currentAnimation.frames || animation.DEFAULT_FRAME_COUNT;\n\t\tlet frameNumbers = [];\n\t\tlet cellWidth = (80 / frameCount).toFixed(2) + '%';\n\t\tfor (let frame = 0; frame <= frameCount; frame++) {\n\t\t\tframeNumbers.push({\n\t\t\t\tframe,\n\t\t\t\tcellWidth: frame === 0 ? 'auto' : cellWidth\n\t\t\t});\n\t\t}\n\n\t\tthis.frameNumbers.update(frameNumbers);\n\n\t\tlet trackUpdateData = currentAnimation.tracks.map(track => {\n\t\t\tlet entityPrototype = editorGlobals.animationEntityPrototype.getPrototypeByPath(track.path) as EntityPrototype;\n\t\t\tlet name = (entityPrototype ? entityPrototype.makeUpAName() : '?') + ' ' + track.prpName;\n\t\t\treturn {\n\t\t\t\tname,\n\t\t\t\tkeyFrames: track.keyFrames,\n\t\t\t\tframeCount\n\t\t\t};\n\t\t});\n\n\t\ttrackUpdateData.sort((a, b) => a.name.localeCompare(b.name));\n\n\t\tthis.trackList.update(trackUpdateData);\n\t}\n\tselectFrame(frame) {\n\t\tthis.selectedFrame = frame;\n\t\tlet views = (this.frameNumbers as any).views as FrameNumberHeader[];\n\t\tfor (let view of views) {\n\t\t\tif (view.frameNumber === frame) {\n\t\t\t\tview.select();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\nclass FrameNumberHeader implements RedomComponent {\n\tel: HTMLElement;\n\tframeNumber: number;\n\tconstructor() {\n\t\tthis.el = el('th.frameHeader', {\n\t\t\tonmousedown: () => this.select(),\n\t\t\tonmouseover: () => isMouseButtonDown() && this.select(),\n\t\t\tondblclick: () => redomDispatch(this, 'selectAllOnFrame', this.frameNumber)\n\t\t});\n\t}\n\tupdate(data) {\n\t\tthis.el.style.width = data.cellWidth;\n\t\tthis.frameNumber = data.frame;\n\t\tthis.el.textContent = data.frame || '';\n\t}\n\tselect() {\n\t\tif (this.frameNumber === 0) return;\n\n\t\tlet selectedFrameElement = this.el.parentElement.querySelector('.selected');\n\t\tif (selectedFrameElement) {\n\t\t\tselectedFrameElement.classList.remove('selected');\n\t\t}\n\t\tthis.el.classList.add('selected');\n\t\tredomDispatch(this, 'frameSelected', this.frameNumber);\n\t}\n}\nclass TrackView implements RedomComponent {\n\tel: HTMLElement;\n\tlist: List;\n\tconstructor() {\n\t\tthis.el = el('tr.track');\n\t\tthis.list = list(this.el, TrackFrameView)\n\n\t\tredomListen(this, 'selectKeyFramesInTrack', () => {\n\t\t\tlet keyFrameViews = this.list.views.filter((view: TrackFrameView) => view.isKeyFrame());\n\t\t\tredomDispatch(this, 'selectKeyFrameView', keyFrameViews);\n\t\t});\n\t}\n\tupdate(trackData) {\n\t\tlet keyFrames = trackData.keyFrames;\n\t\tlet trackFrameData = [];\n\t\ttrackFrameData.push({\n\t\t\tframe: 0,\n\t\t\tname: trackData.name,\n\t\t\tkeyFrames\n\t\t});\n\t\tfor (let frame = 1; frame <= trackData.frameCount; frame++) {\n\t\t\tlet keyFrame = keyFrames[frame];\n\t\t\ttrackFrameData.push({\n\t\t\t\tframe,\n\t\t\t\tkeyFrames,\n\t\t\t\tkeyFrame\n\t\t\t});\n\n\t\t}\n\n\t\tthis.list.update(trackFrameData);\n\t}\n}\nclass TrackFrameView implements RedomComponent {\n\tel: HTMLElement;\n\ticon: HTMLElement;\n\ttrackKeyFrames: { [frame: number]: any };\n\tframe: number;\n\tconstructor() {\n\t\tthis.el = el('td.trackFrame', {\n\t\t\tonclick: () => {\n\t\t\t\tif (this.frame === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tredomDispatch(this, 'selectKeyFrameView', this);\n\t\t\t},\n\t\t\tondblclick: () => {\n\t\t\t\tif (this.frame === 0) {\n\t\t\t\t\tredomDispatch(this, 'selectKeyFramesInTrack');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tisKeyFrame() {\n\t\treturn this.trackKeyFrames[this.frame] != null;\n\t}\n\tupdate(data) {\n\t\tthis.frame = data.frame;\n\t\tthis.trackKeyFrames = data.keyFrames;\n\n\t\tthis.el.innerHTML = '';\n\t\tif (this.frame === 0) {\n\t\t\tthis.el.textContent = data.name;\n\t\t} else {\n\t\t\tif (this.isKeyFrame()) {\n\t\t\t\tmount(this, el('i.fas.fa-star'));\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n/*\nclass AnimationFrameView implements RedomComponent {\n\tel: HTMLElement;\n\tframeNumber: number;\n\tframeNumberText: Text;\n\tkeyFrameContainer: HTMLElement;\n\tconstructor(public parent?: AnimationTimelineView) {\n\t\tthis.el = el('div.animationFrame',\n\t\t\tthis.frameNumberText = text(''),\n\t\t\tthis.keyFrameContainer = el('div.keyFrameContainer'),\n\t\t\t{\n\t\t\t\tonmousedown: () => this.select(),\n\t\t\t\tonmouseover: () => isMouseButtonDown() && this.select()\n\t\t\t}\n\t\t);\n\t}\n\tselect() {\n\t\tlet selectedFrameElement = this.el.parentElement.querySelector('.selected');\n\t\tif (selectedFrameElement) {\n\t\t\tselectedFrameElement.classList.remove('selected');\n\t\t}\n\t\tthis.el.classList.add('selected');\n\t\tredomDispatch(this, 'frameSelected', this.frameNumber);\n\t}\n\tupdate(data) {\n\t\tthis.frameNumber = data.frame;\n\t\tthis.frameNumberText.textContent = data.frame;\n\t\tif (data.keyFrame) {\n\t\t\tthis.keyFrameContainer.textContent = 'KEY';\n\t\t} else {\n\t\t\tthis.keyFrameContainer.textContent = '';\n\t\t}\n\t}\n}\n*/\n\n/*\nanimationData: 'path: \"aaaaa/bbbbb/ccccc/ddddd\" ...'\nsiblingId: \"ccccc\"\nnewPath: \"aaaaa/ccccc\"\n\noutput: path: \"aaaaa/ccccc/ddddd\"\n*/\nfunction replaceAnimationDataPrototypePath(animationData, siblingId, newPath) {\n\treturn animationData.replace(new RegExp(`\"[^\"]*${siblingId}`, 'g'), `\"${newPath}`)\n}\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport * as performance from '../../util/performance';\nimport { scene } from '../../core/scene';\nimport { editorEventDispacher } from '../editorEventDispatcher';\n\nclass PerformanceModule extends Module {\n\tconstructor() {\n\t\tsuper();\n\n\t\tlet performanceList;\n\t\tlet fpsMeter;\n\t\tthis.addElements(\n\t\t\tel('div.performanceCPU',\n\t\t\t\tnew PerformanceItem({ name: 'Name', value: 'CPU %' }),\n\t\t\t\tperformanceList = list('div.performanceList', PerformanceItem, 'name')\n\t\t\t),\n\t\t\tfpsMeter = new FPSMeter()\n\t\t);\n\n\t\tthis.name = 'Performance';\n\t\tthis.id = 'performance';\n\n\n\t\tperformance.startPerformanceUpdates();\n\t\teditorEventDispacher.listen('performance snapshot', snapshot => {\n\t\t\tif (this.moduleContainer.isPacked())\n\t\t\t\treturn;\n\n\t\t\tperformance.start('Editor: Performance');\n\t\t\tperformanceList.update(snapshot.slice(0, 10).filter(item => item.value > 0.0005));\n\t\t\tperformance.stop('Editor: Performance');\n\t\t});\n\n\t\tsetInterval(() => {\n\t\t\tif (!scene || !scene.playing || this.moduleContainer.isPacked())\n\t\t\t\treturn;\n\n\t\t\tperformance.start('Editor: Performance');\n\t\t\tfpsMeter.update(performance.getFrameTimes());\n\t\t\tperformance.stop('Editor: Performance');\n\t\t}, 50);\n\t}\n}\nModule.register(PerformanceModule, 'bottom');\n\nclass PerformanceItem {\n\tel: HTMLElement;\n\tname: HTMLElement;\n\tvalue: HTMLElement;\n\n\tconstructor(initItem) {\n\t\tthis.el = el('div.performanceItem',\n\t\t\tthis.name = el('span.performanceItemName'),\n\t\t\tthis.value = el('span.performanceItemValue')\n\t\t);\n\n\t\tif (initItem) {\n\t\t\tthis.name.textContent = initItem.name;\n\t\t\tthis.value.textContent = initItem.value;\n\n\t\t\tthis.el.classList.add('performanceHeader');\n\t\t}\n\t}\n\tupdate(snapshotItem) {\n\t\tthis.name.textContent = snapshotItem.name;\n\t\tlet value = snapshotItem.value * 100;\n\t\tthis.value.textContent = value.toFixed(1); // example: 10.0%\n\n\t\tif (value > 40)\n\t\t\tthis.el.style.color = '#ff7075';\n\t\telse if (value > 10)\n\t\t\tthis.el.style.color = '#ffdab7';\n\t\telse if (value > 0.4)\n\t\t\tthis.el.style.color = '';\n\t\telse\n\t\t\tthis.el.style.color = 'rgba(200, 200, 200, 0.5)';\n\t}\n}\n\nclass FPSMeter {\n\tel: HTMLCanvasElement;\n\tcontext: CanvasRenderingContext2D;\n\n\tconstructor() {\n\t\tthis.el = <HTMLCanvasElement> el('canvas.fpsMeterCanvas', { width: performance.FRAME_MEMORY_LENGTH, height: 100 });\n\t\tthis.context = this.el.getContext('2d');\n\t}\n\tupdate(fpsData) {\n\t\tthis.el.width = this.el.width; // clear\n\n\t\tconst c = this.context;\n\t\tlet yPixelsPerSecond = 30 / 16 * 1000;\n\t\tfunction secToY(secs) {\n\t\t\treturn ~~(100 - secs * yPixelsPerSecond) + 0.5;\n\t\t}\n\n\t\tc.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n\t\tc.beginPath();\n\t\tfor (let i = 60.5; i < performance.FRAME_MEMORY_LENGTH; i += 60) {\n\t\t\tc.moveTo(i, 0);\n\t\t\tc.lineTo(i, 100);\n\t\t}\n\t\tc.moveTo(0, secToY(1 / 60));\n\t\tc.lineTo(performance.FRAME_MEMORY_LENGTH, secToY(1 / 60));\n\t\tc.stroke();\n\n\t\tconst normalStrokeStyle = '#aaa';\n\t\tc.strokeStyle = normalStrokeStyle;\n\t\tc.beginPath();\n\t\tc.moveTo(0, secToY(fpsData[0]));\n\n\t\tfor (let i = 1; i < fpsData.length; ++i) {\n\t\t\tlet secs = fpsData[i];\n\t\t\tif (secs > 1 / 30) {\n\t\t\t\tc.stroke();\n\t\t\t\tc.strokeStyle = '#ff7385';\n\t\t\t\tc.beginPath();\n\t\t\t\tc.moveTo(i - 1, secToY(fpsData[i - 1]));\n\t\t\t\tc.lineTo(i, secToY(secs));\n\t\t\t\tc.stroke();\n\t\t\t\tc.strokeStyle = normalStrokeStyle;\n\t\t\t\tc.beginPath();\n\t\t\t} else if (secs > 1 / 40) {\n\t\t\t\tc.stroke();\n\t\t\t\tc.strokeStyle = '#ffc5a4';\n\t\t\t\tc.beginPath();\n\t\t\t\tc.moveTo(i - 1, secToY(fpsData[i - 1]));\n\t\t\t\tc.lineTo(i, secToY(secs));\n\t\t\t\tc.stroke();\n\t\t\t\tc.strokeStyle = normalStrokeStyle;\n\t\t\t\tc.beginPath();\n\t\t\t} else {\n\t\t\t\tc.lineTo(i, secToY(secs));\n\t\t\t}\n\t\t}\n\n\t\tc.stroke();\n\t}\n}\n","import { el, list, mount, RedomComponent } from 'redom';\nimport Module from './module';\nimport * as performance from '../../util/performance';\nimport { scene } from '../../core/scene';\nimport { editorEventDispacher } from '../editorEventDispatcher';\n\nclass PerSecondModule extends Module {\n\tconstructor() {\n\t\tsuper();\n\t\tlet counterList;\n\t\tthis.addElements(\n\t\t\tel('div.perSecond',\n\t\t\t\tnew PerSecondItem({ name: 'Name', count: '/ sec' }),\n\t\t\t\tcounterList = list('div.perSecondList', PerSecondItem)\n\t\t\t)\n\t\t);\n\n\t\tthis.name = 'Per second';\n\t\tthis.id = 'perSecond';\n\n\t\teditorEventDispacher.listen('perSecond snapshot', snapshot => {\n\t\t\tcounterList.update(snapshot);\n\t\t});\n\t}\n}\nModule.register(PerSecondModule, 'bottom');\n\nclass PerSecondItem implements RedomComponent {\n\tname: HTMLElement;\n\tvalue: HTMLElement;\n\tel: HTMLElement;\n\tconstructor(initItem) {\n\t\tthis.el = el('div.perSecondItem',\n\t\t\tthis.name = el('span.perSecondItemName'),\n\t\t\tthis.value = el('span.perSecondItemValue')\n\t\t);\n\n\t\tif (initItem) {\n\t\t\tthis.update(initItem);\n\t\t\tthis.el.classList.add('perSecondHeader');\n\t\t}\n\t}\n\tupdate(perSecondItem) {\n\t\tthis.name.textContent = perSecondItem.name;\n\t\tthis.value.textContent = perSecondItem.count;\n/*\n\t\tif (value > 40)\n\t\t\tthis.el.style.color = '#ff7075';\n\t\telse if (value > 10)\n\t\t\tthis.el.style.color = '#ffdab7';\n\t\telse if (value > 0.4)\n\t\t\tthis.el.style.color = '';\n\t\telse\n\t\t\tthis.el.style.color = 'rgba(200, 200, 200, 0.5)';\n\t\t\t*/\n\t}\n}\n","import { RedomComponent, el, mount } from 'redom';\nimport Serializable from '../../../core/serializable';\n\nexport default class AnimationView implements RedomComponent {\n    el: HTMLElement;\n    constructor(serializable: Serializable) {\n        this.el = el('div.fullView.animationView',\n            el('div.exitButton', 'X', { onclick: () => this.close() })\n        );\n    }\n    close() {\n        let editorLayout = document.querySelector('div.editorLayout');\n        this.el.parentNode.removeChild(this.el);\n        editorLayout.classList.remove('fullViewMode');\n    }\n\n    static open(serializable: Serializable) {\n        let editorLayout = document.querySelector('div.editorLayout');\n        editorLayout.classList.add('fullViewMode');\n        mount(editorLayout, new AnimationView(serializable));\n    }\n}\n","import { game } from '../core/game'\nimport { scene } from '../core/scene'\nimport Vector from '../util/vector'\nimport { serializables } from '../core/serializableManager'\nimport Serializable from '../core/serializable'\nimport AnimationView from './views/animation/animationView';\nimport { selectedLevel } from './editorSelection';\nimport { editorEventDispacher, EditorEvent } from './editorEventDispatcher';\n\nclass Help {\n\tsceneModule = null;\n\teditor: null;\n\teditorSelection: null;\n\n\tget game() {\n\t\treturn game;\n\t}\n\tget level() {\n\t\treturn selectedLevel;\n\t}\n\tget scene() {\n\t\treturn scene;\n\t}\n\tget entities() {\n\t\treturn scene.getChildren('ent');\n\t}\n\tget world() {\n\t\treturn scene['_p2World'];\n\t}\n\tget Vector() {\n\t\treturn Vector;\n\t}\n\tget serializables() {\n\t\treturn serializables;\n\t}\n\tget selection() {\n\t\treturn this.editorSelection;\n\t}\n\tget serializablesArray() {\n\t\treturn Object.keys(serializables).map(k => serializables[k]);\n\t}\n\tget selectedEntity() {\n\t\tif (this.sceneModule && this.sceneModule.selectedEntities.length > 0)\n\t\t\treturn this.sceneModule.selectedEntities[0];\n\t}\n\tcopyGame() {\n\t\tlet prototypes = game.getChildren('prt').map(prt => prt.toJSON());\n\t\tlet levels = game.getChildren('lvl').map(lvl => lvl.toJSON());\n\t\treturn JSON.stringify([].concat(prototypes, levels));\n\t}\n\tpasteGame(data) {\n\t\tgame.getChildren('lvl').forEach(lvl => lvl.delete());\n\t\tgame.getChildren('prt').forEach(prt => prt.delete());\n\n\t\tlet children = JSON.parse(data).map(Serializable.fromJSON);\n\t\tgame.addChildren(children);\n\t}\n\topenAnimationView(s: Serializable) {\n\t\tAnimationView.open(s);\n\t}\n}\n\nlet help = new Help;\nexport { help };\nwindow['help'] = help;\n\neditorEventDispacher.listen(EditorEvent.EDITOR_REGISTER_HELP_VARIABLE, (name: string, value) => {\n\thelp[name] = value;\n});\n","\n\nwindow.test = function() {\n};\n","import Popup, {Button, popupDepth} from './Popup';\nimport {el, mount, list, text} from 'redom';\n\nexport default class OKPopup extends Popup {\n\t/*\n\tbuttonOptions:\n\t- text\n\t- color\n\t- icon (fa-plus)\n\t*/\n\tconstructor(title, textContent, buttonOptions?, callback?) {\n\t\tlet listView;\n\t\tsuper({\n\t\t\ttitle,\n\t\t\twidth: '500px',\n\t\t\tcontent: el('div',\n\t\t\t\tel('div.genericCustomContent', textContent),\n\t\t\t\tlistView = list('div.confirmationButtons', Button)\n\t\t\t),\n\t\t\tcancelCallback: callback\n\t\t});\n\n\t\tlistView.update([Object.assign(\n\t\t\t{\n\t\t\t\ttext: 'OK'\n\t\t\t}, buttonOptions, {\n\t\t\t\tcallback: () => {\n\t\t\t\t\tcallback && callback();\n\t\t\t\t\tthis.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t)]);\n\n\t\tlet okButton = listView.views[0];\n\t\tokButton.el.focus();\n\t}\n\n\tremove() {\n\t\tsuper.remove();\n\t}\n}\n","import Layout from './layout/layout';\n\nimport './module/topBarModule';\nimport './module/sceneModule';\n\nimport './module/objectsModule';\nimport './module/prefabsModule';\nimport './module/levelsModule';\n\nimport './module/prefabModule';\nimport './module/objectModule';\nimport './module/levelModule';\nimport './module/gameModule';\n\nimport './module/animationModule';\nimport './module/performanceModule';\nimport './module/perSecondModule';\n\nimport { el, list, mount } from 'redom';\nimport { default as Game, game } from '../core/game';\nimport Serializable, { filterChildren } from '../core/serializable';\nimport {\n\tchangeType, setChangeOrigin, Change\n} from '../core/change';\nimport { serializables } from '../core/serializableManager';\nimport assert from '../util/assert';\nimport { configureNetSync } from '../core/net';\nimport './help';\nimport './test';\nimport * as performance from '../util/performance'\nimport { limit } from '../util/callLimiter';\nimport OKPopup from \"./views/popup/OKPopup\";\nimport Level from '../core/level';\nimport { GameEvent, globalEventDispatcher } from '../core/eventDispatcher';\nimport { editorEventDispacher, EditorEvent } from './editorEventDispatcher';\nimport { editorSelection, selectInEditor, setLevel, selectedLevel, unfocus } from './editorSelection';\nimport { listenKeyDown, key } from '../util/input';\nimport Prefab from '../core/prefab';\nimport Prototype from '../core/prototype';\nimport Module from './module/module';\nimport { CircularDependencyDetector } from '../util/circularDependencyDetector';\n\nconst DETECT_CHANGE_LOOPS = 1;\n\neditorEventDispacher.getEventPromise('modulesRegistered').then(() => {\n\teditorEventDispacher.dispatch(EditorEvent.EDITOR_LOADED);\n});\nexport let loadedPromise = editorEventDispacher.getEventPromise(EditorEvent.EDITOR_LOADED);\n\nconfigureNetSync({\n\tserverToClientEnabled: false,\n\tclientToServerEnabled: false,\n\tcontext: 'edit'\n});\n\nloadedPromise.then(() => {\n\tsetChangeOrigin('editor');\n\tsetLevel(game.getChildren('lvl')[0] as Level);\n});\n\nlet editorUpdateLimited = limit(200, 'soon', () => {\n\teditor.update();\n});\n\nglobalEventDispatcher.listen(GameEvent.GLOBAL_CHANGE_OCCURED, change => {\n\tperformance.start('Editor: General');\n\teditorEventDispacher.dispatch(EditorEvent.EDITOR_CHANGE, change);\n\tif (change.reference.threeLetterType === 'gam' && change.type === changeType.addSerializableToTree) {\n\t\tlet game = change.reference;\n\t\teditor = new Editor(game);\n\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_REGISTER_HELP_VARIABLE, 'editor', editor);\n\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_REGISTER_MODULES, editor);\n\t\teditor.update();\n\n\t\t// Lets give DOM some time to build itself before we hide the splash screen\n\t\tsetTimeout(() => {\n\t\t\tdocument.getElementById('introLogo').classList.add('hiding');\n\t\t\tsetTimeout(() => {\n\t\t\t\t// we want light DOM.\n\t\t\t\tdocument.getElementById('introLogo').remove();\n\t\t\t}, 1000);\n\t\t}, 300);\n\t} else if (editor) {\n\t\tif (change.reference.threeLetterType === 'lvl' && change.type === changeType.deleteSerializable) {\n\t\t\tif (selectedLevel === change.reference) {\n\t\t\t\tsetLevel(null);\n\t\t\t}\n\t\t}\n\t\teditorUpdateLimited();\n\t}\n\tperformance.stop('Editor: General');\n});\n\neditorEventDispacher.listen(EditorEvent.EDITOR_CHANGE, (change: Change) => {\n\teditor && editorUpdateLimited();\n});\n\neditorEventDispacher.listen(EditorEvent.EDITOR_UNFOCUS, () => {\n\teditor && editorUpdateLimited();\n});\neditorEventDispacher.listen(EditorEvent.EDITOR_FORCE_UPDATE, () => {\n\teditor && editor.update();\n});\neditorEventDispacher.listen(EditorEvent.EDITOR_DELETE, () => {\n\tif (editorSelection.focused && editorSelection.items.length > 0) {\n\t\tif (['ent', 'epr', 'pfa', 'prt'].includes(editorSelection.type)) {\n\t\t\teditorEventDispacher.dispatchWithResults(EditorEvent.EDITOR_DELETE_CONFIRMATION).then(results => {\n\t\t\t\tif (results.filter(res => res !== true).length === 0) {\n\t\t\t\t\t// It is ok for everyone to delete\n\t\t\t\t\teditorEventDispacher.dispatch(EditorEvent.EDITOR_PRE_DELETE_SELECTION);\n\n\t\t\t\t\tlet serializables = filterChildren(editorSelection.items);\n\t\t\t\t\tsetChangeOrigin(editor);\n\t\t\t\t\tserializables.forEach(s => s.delete());\n\t\t\t\t\tselectInEditor([], editor);\n\t\t\t\t\teditorUpdateLimited();\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Not deleting. Results:', results);\n\t\t\t\t}\n\t\t\t}).catch(e => {\n\t\t\t\tconsole.log('Not deleting because:', e);\n\t\t\t});\n\t\t}\n\t}\n});\neditorEventDispacher.listen(EditorEvent.EDITOR_CLONE, () => {\n\tif (editorSelection.focused && editorSelection.items.length > 0) {\n\t\tif (['pfa', 'prt'].includes(editorSelection.type)) {\n\t\t\tlet filteredSerializabled = filterChildren(editorSelection.items) as Prototype[];\n\t\t\tlet clones: Prototype[] = [];\n\t\t\tsetChangeOrigin(editor);\n\t\t\tfilteredSerializabled.forEach((serializable: Prototype) => {\n\t\t\t\tlet parent = serializable.getParent() as Serializable;\n\t\t\t\tlet clone = serializable.cloneWithNewSiblingId() as Prototype;\n\n\t\t\t\tif (parent) {\n\t\t\t\t\tlet { text, number } = parseTextAndNumber(serializable.name);\n\t\t\t\t\tlet nameSuggestion = text + number++;\n\t\t\t\t\twhile (parent.findChild(editorSelection.type, (prt: Prototype) => prt.name === nameSuggestion)) {\n\t\t\t\t\t\tnameSuggestion = text + number++;\n\t\t\t\t\t}\n\t\t\t\t\tclone.name = nameSuggestion;\n\n\t\t\t\t\tparent.addChild(clone);\n\t\t\t\t}\n\n\t\t\t\tclones.push(clone);\n\t\t\t});\n\t\t\tselectInEditor(clones, editor);\n\n\t\t\t// If there wasn't setTimeout, 'c' character that user just pressed would end up being in the name input.\n\t\t\tsetTimeout(() => {\n\t\t\t\tModule.activateModule('prefab', true, 'focusOnProperty', 'name');\n\t\t\t}, 1);\n\t\t}\n\t}\n});\n\nlistenKeyDown(k => {\n\tif (k === key.esc) {\n\t\tunfocus();\n\t}\n});\n\nexport let editor: Editor = null;\n\nclass Editor {\n\tlayout: Layout;\n\n\tconstructor(game) {\n\t\tassert(game);\n\t\tthis.layout = new Layout();\n\t\t// document.body.innerHTML = '';\n\t\tmount(document.body, this.layout);\n\t}\n\n\tupdate() {\n\t\tif (!game) return;\n\n\t\tperformance.eventHappened('editor update');\n\n\t\tthis.layout.update();\n\t}\n}\n\nglobalEventDispatcher.listen('noEditAccess', () => {\n\tloadedPromise.then(() => {\n\t\tdocument.body.classList.add('noEditAccess');\n\t\tnew OKPopup('No edit access',\n\t\t\t`Since you don't have edit access to this game, your changes are not saved. Feel free to play around, though!`\n\t\t);\n\t\t// alert(`No edit access. Your changes won't be saved.`);\n\t});\n\n\tconfigureNetSync({\n\t\tclientToServerEnabled: false,\n\t\tserverToClientEnabled: false\n\t});\n});\n\nfunction parseTextAndNumber(textAndNumber) {\n\tlet endingNumberMatch = textAndNumber.match(/\\d+$/); // ending number\n\tlet num = endingNumberMatch ? parseInt(endingNumberMatch[0]) + 1 : 2;\n\tlet nameWithoutNumber = endingNumberMatch ? textAndNumber.substring(0, textAndNumber.length - endingNumberMatch[0].length) : textAndNumber;\n\n\treturn {\n\t\ttext: nameWithoutNumber,\n\t\tnumber: num\n\t};\n}\n"],"names":["assertChangeGetter","arguments","PIXI","isClient","performance","performanceTool.setFrameTime","performanceTool.start","performanceTool.stop","performanceTool.eventHappened","performance.start","performance.stop","propertyTypes","p2","options","sceneEdit.setEntityPositions","sceneEdit.shouldSyncLevelToScene","sceneEdit.syncAChangeFromLevelToScene","sceneEdit.addEntitiesToLevel","sceneEdit.isMultiSelectModifierPressed","sceneEdit.setEntitiesInSelectionArea","sceneEdit.getEntitiesInSelection","performance.startPerformanceUpdates","performance.getFrameTimes","performance.FRAME_MEMORY_LENGTH","performance.eventHappened"],"mappings":"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"}