!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==this.readyState&&(200===this.status?t(JSON.parse(this.responseText)):n())},i.open("GET",e,!0),i.send()})}function t(e){if(window.navigator.standalone){e.preventDefault();var t=e.target.getAttribute("href");window.location.href=t}}function n(e){e=new Date(e);var t=new Date,n=(t-e)/1e3;if(n<10)return"now";if(n<60)return"less than minute ago";var i=n/60;if(i<2)return"minute ago";if(i<60)return(0|i)+" minutes ago";var o=i/60;if(o<2)return"hour ago";if(o<24)return(0|o)+" hours ago";var r=o/60;if(r<2)return"day ago";if(r<7)return(0|r)+" days ago";var a=r/7;if(a<2)return"week ago";if(a<4)return(0|r)+" weeks ago";var s=r/30;if(s<2)return"month ago";if(s<12)return(0|s)+" months ago";var l=r/365;return l<2?"year ago":(0|l)+" years ago"}function i(e,t,n){var i=e.el||e,o=t.el||t;return b(o)&&(o=o.el),t===o&&o.__redom_view&&(t=o.__redom_view),t!==o&&(o.__redom_view=t),t.isMounted?t.remount&&t.remount():t.mount&&t.mount(),n?i.insertBefore(o,n.el||n):i.appendChild(o),t.isMounted?t.remounted&&t.remounted():(t.isMounted=!0,t.mounted&&t.mounted()),t}function o(e,t){var n=e.el||e,i=t.el||t;return t===i&&i.__redom_view&&(t=i.__redom_view),t.unmount&&t.unmount(),n.removeChild(i),t.isMounted=!1,t.unmounted&&t.unmounted(),t}function r(e,t,n){var i=e.el||e;if(arguments.length>2)i.style[t]=n;else if(g(t))i.setAttribute("style",t);else for(var o in t)r(i,o,t[o])}function a(e,t,n){var i=e.el||e,o=i instanceof window.SVGElement;if(arguments.length>2)"style"===t?r(i,n):o&&w(n)?i[t]=n:!o&&(t in i||w(n))?i[t]=n:i.setAttribute(t,n);else for(var s in t)a(i,s,t[s])}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o&&("function"==typeof o?o(e):g(o)||p(o)?e.appendChild(v(o)):y(o)||y(o.el)||b(o.el)?i(e,o):o.length?s(e,o):"object"==typeof o&&a(e,o))}}function l(e,t){for(var n,i,o,r=0,a=0,s=0;s<=e.length;s++){var l=e.charCodeAt(s);if(l===_||l===E||!l){if(0===r)n=0===s?"div":l?e.substring(a,s):e;else{var d=e.substring(a,s);1===r?i=d:o?o+=" "+d:o=d}a=s+1,r=l===_?1:2}}var u=t?L.createElementNS(t,n):L.createElement(n);return i&&(u.id=i),o&&(t?u.setAttribute("class",o):u.className=o),u}function d(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];var o;if(g(e))o=k(e).cloneNode(!1);else{if(!y(e))throw new Error("At least one argument required");o=e.cloneNode(!1)}return s(o,n),o}function u(e,t){if(void 0===t.length)return u(e,[t]);for(var n=e.el||e,r=n.firstChild,a=0;a<t.length;a++){var s=t[a];if(s){var l=s.el||s;b(l)&&(l=l.el),l!==r?i(e,s,r):r=r.nextSibling}}for(;r;){var d=r.nextSibling;o(e,r),r=d}}function c(e,t,n,i){return new f(e,t,n,i)}function f(e,t,n,i){this.__redom_list=!0,this.View=t,this.key=n,this.initData=i,this.views=[],this.el=m(e),n&&(this.lookup={})}function m(e){return g(e)?d(e):y(e.el)?e.el:e}function h(t){if(M)return console.error("profile.setButtonContainer can only be called once");M=t,N.then(function(){I=new G,A=new P,i(document.body,A),i(M,I),e("/api/profile?userId="+localStorage.openEditPlayUserId+"&userToken="+localStorage.openEditPlayUserToken).then(function(e){delete e.userToken,e.games&&(e.gameIdList=e.games.map(function(e){return e.id})),window.user=e,D&&D(e)&&console.log("resolved"),A.gamesCreated.textContent=e.games})})}var v=function(e){return L.createTextNode(e)},g=function(e){return"string"==typeof e},p=function(e){return"number"==typeof e},w=function(e){return"function"==typeof e},y=function(e){return e&&e.nodeType},b=function(e){return e&&e.__redom_list},L=document,_="#".charCodeAt(0),E=".".charCodeAt(0),C={},k=function(e){return C[e]||l(e)};d.extend=function(e){var t=k(e);return d.bind(this,t)};var S=d;f.extend=function(e,t,n,i){return f.bind(f,e,t,n,i)},c.extend=f.extend,f.prototype.update=function(e){void 0===e&&(e=[]);for(var t=this.View,n=this.key,i=w(n),o=this.initData,r=new Array(e.length),a=this.views,s=n&&{},l=n&&this.lookup,d=0;d<e.length;d++){var c=e[d],f=void 0;if(n){var m=i?n(c):c[n];f=r[d]=l[m]||new t(o,c,d,e),s[m]=f,f.__id=m}else f=r[d]=a[d]||new t(o,c,d,e);var h=f.el;h.__redom_list&&(h=h.el),h.__redom_view=f,f.update&&f.update(c,d,e)}u(this,r),n&&(this.lookup=s),this.views=r},function(e,t,n){this.el=m(e),this.Views=t,this.initData=n}.prototype.update=function(e,t){if(e!==this.route){var n=this.Views,i=n[e];this.view=i&&new i(this.initData,t),this.route=e,u(this.el,[this.view])}this.view&&this.view.update&&this.view.update(t,e)};var x=function(e,t){var n=this,o=e.getBoundingClientRect();this.el=S("div.contextMenu",{style:{top:o.bottom+window.pageYOffset+"px",left:o.left+"px"}}),this.list=c(this.el,B),this.list.update(t),setTimeout(function(){n.eventListener=window.addEventListener("click",function(){n.remove()})},0),i(document.body,this.el)};x.prototype.remove=function(){this.eventListener&&window.removeEventListener("click",this.eventListener),this.el.parentNode&&this.el.parentNode.removeChild(this.el)};var B=function(){var e=this;this.el=S("div.contextMenuItem",{onclick:function(){return e.callback&&e.callback()}}),this.callback=null};B.prototype.update=function(e){this.el.textContent=e.label,this.callback=e.callback};var I=null,A=null,M=null,N=new Promise(function(e,t){return window.addEventListener("load",e)}),D=null,T=new Promise(function(e,t){D=e}),G=function(){this.el=S("img.profileButton",{src:"/img/profile.png",onclick:function(){return A.el.classList.toggle("visible")}})};G.prototype.update=function(e){};var P=function(){this.el=S("div.profileMenu",S("div.profileMenuContent",S("div.gamesCreatedBlock","Welcome to Open Edit Play! Play or Edit a game and profile will be created for you.",S("div"),"Games created: ",this.gamesCreated=S("span.gamesCreated"))),{onclick:function(){return A.el.classList.toggle("visible")}})};P.prototype.update=function(e){};var H="Game size in data units. Every object in scene, type, component, level and property is a data unit.",O=function(){this.el=S("div.gameListContainer",S("table.gameList",S("thead.gameListHeader",S("th.gameListHeaderName","Name"),S("th.gameListHeaderPlay"),S("th.gameListHeaderSize","Size",{title:H}),S("th.gameListHeaderLevels","Levels"),S("th.gameListHeaderCreated","Created"),S("th.gameListHeaderModified","Modified")),this.list=c("tbody.gameListContent",z)))};O.prototype.update=function(e){this.list.update(e)};var z=function(){var e=this;this.el=S("tr.gameElement",this.name=S("td.gameElementName"),this.play=S("td.gameElementPlay",this.primaryButton=S("a.linkButton","Play",{onclick:t}),this.secondaryButton=S("a.linkButton.hideInSmallScreens.gameElementSecondaryButton","...",{href:"#",onclick:function(t){t.preventDefault(),e.isMyGame?window.location.href="/edit/?gameId="+e.gameId:new x(e.secondaryButton,[{label:"Open editor sandbox",callback:function(){return window.location.href="/edit/?gameId="+e.gameId}}])}})),this.size=S("td.gameElementSize",{title:H}),this.levels=S("td.gameElementLevels"),this.created=S("td.gameElementCreated"),this.modified=S("td.gameElementModified"))};z.prototype.update=function(e){var t=this;this.isMyGame=null,this.gameId=e.id,this.name.textContent=e.name,this.size.textContent=e.serializableCount,this.levels.textContent=e.levelCount,this.created.textContent=n(e.createdAt),this.created.setAttribute("title",new Date(e.createdAt).toLocaleString()),this.modified.textContent=n(e.updatedAt),this.modified.setAttribute("title",new Date(e.updatedAt).toLocaleString()),this.primaryButton.setAttribute("href","/play/?gameId="+e.id),T.then(function(n){t.isMyGame=!(!n.gameIdList||!n.gameIdList.includes(e.id)),t.el.classList.toggle("isMyGame",t.isMyGame),t.isMyGame?t.secondaryButton.textContent="Edit":t.secondaryButton.textContent="..."})},window.IS_SMALL_SCREEN=window.screen.width<800,window.IS_MOBILE_STANDALONE=window.navigator.standalone,window.addEventListener("load",function(){IS_SMALL_SCREEN&&document.body.classList.add("isSmallDevice"),h(document.getElementById("profileButtonContainer"));var t=document.getElementById("games");e("/api/gameListSample").then(function(e){var n=new O;n.update(e),i(t,n)}).catch(function(e){i(t,v("Could not load"))}),T.then(function(e){if(e.id&&0!==e.games.length){var t=document.getElementById("myGames");t.style.display="block";var n=new O;n.update(e.games),i(t,n)}});var n=document.getElementById("topBarBackground");IS_MOBILE_STANDALONE?n.style.opacity=1:(window.onscroll=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;n.style.opacity=e<100?0:e<350?(e-100)/250*1:1},window.onscroll())})});
//# sourceMappingURL=openeditplay.homepage.min.js.map
