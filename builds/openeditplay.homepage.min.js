!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==this.readyState&&(200===this.status?t(JSON.parse(this.responseText)):n())},i.open("GET",e,!0),i.send()})}function t(e){if(window.navigator.standalone){e.preventDefault();var t=e.target.getAttribute("href");window.location.href=t}}function n(e){e=new Date(e);var t=new Date,n=(t-e)/1e3;if(n<10)return"now";if(n<60)return"less than minute ago";var i=n/60;if(i<2)return"minute ago";if(i<60)return(0|i)+" minutes ago";var o=i/60;if(o<2)return"hour ago";if(o<24)return(0|o)+" hours ago";var r=o/60;if(r<2)return"day ago";if(r<7)return(0|r)+" days ago";var a=r/7;if(a<2)return"week ago";if(a<4)return(0|r)+" weeks ago";var l=r/30;if(l<2)return"month ago";if(l<12)return(0|l)+" months ago";var u=r/365;return u<2?"year ago":(0|u)+" years ago"}function i(e,t){for(var n in t)e.setAttributeNS(_,n,t[n])}function o(e,t){for(var n in t)e.dataset[n]=t[n]}function r(e,t,n){for(var i=n,o=0;o<t.length;o++){var a=t[o];if(a){var l=C(a);l!==i?A(l)?p(e,a,i):null!=a.length&&(i=r(e,a,i)):i=i.nextSibling}}return i}function a(t){if(q)return console.error("profile.setButtonContainer can only be called once");q=t,U.then(function(){V=new X,j=new Y,p(document.body,j),p(q,V),e("/api/profile?userId="+localStorage.openEditPlayUserId+"&userToken="+localStorage.openEditPlayUserToken).then(function(e){delete e.userToken,e.games&&(e.gameIdList=e.games.map(function(e){return e.id})),window.user=e,J&&J(e)&&console.log("resolved"),j.gamesCreated.textContent=e.games})})}var l="#".charCodeAt(0),u=".".charCodeAt(0),d=function(e){for(var t=null,n=null,i=null,o=0,r=0,a=0;a<=e.length;a++){var d=e.charCodeAt(a),s=d===l,c=d===u,f=!d;(s||c||f)&&(0===o?t=0===a?"div":e.substring(r,a):1===o?n=e.substring(r,a):i?i+=" "+e.substring(r,a):i=e.substring(r,a),s?o=1:c&&(o=2),r=a+1)}return{tag:t,id:n,className:i}},s=function(e,t){var n=d(e),i=n.tag,o=n.id,r=n.className,a=t?document.createElementNS(t,i):document.createElement(i);return o&&(a.id=o),r&&(t?a.setAttribute("class",r):a.className=r),a},c=function(e,t){var n=C(e),i=C(t);return t===i&&i.__redom_view&&(t=i.__redom_view),i.parentNode&&(f(t,i,n),n.removeChild(i)),t},f=function(e,t,n){var i=t.__redom_lifecycle;if(m(i))return void(t.__redom_mounted=!1);var o=n;for(t.__redom_mounted&&w(t,"onunmount");o;){var r=o.__redom_lifecycle||{};for(var a in i)r[a]&&(r[a]-=i[a]);m(r)&&(o.__redom_lifecycle=null),o=o.parentNode}},m=function(e){if(null==e)return!0;for(var t in e)if(e[t])return!1;return!0},h=["onmount","onunmount"],v="undefined"!=typeof window&&"ShadowRoot"in window,p=function(e,t,n){var i=C(e),o=C(t);t===o&&o.__redom_view&&(t=o.__redom_view),t!==o&&(o.__redom_view=t);var r=o.__redom_mounted,a=o.parentNode;return r&&a!==i&&f(t,o,a),null!=n?i.insertBefore(o,C(n)):i.appendChild(o),g(t,o,i,a),t},g=function(e,t,n,i){for(var o=t.__redom_lifecycle||(t.__redom_lifecycle={}),r=n===i,a=!1,l=0;l<h.length;l++){var u=h[l];!r&&e!==t&&u in e&&(o[u]=(o[u]||0)+1),o[u]&&(a=!0)}if(!a)return void(t.__redom_mounted=!0);var d=n,s=!1;if((r||!s&&d&&d.__redom_mounted)&&(w(t,r?"onremount":"onmount"),s=!0),!r)for(;d;){var c=d.parentNode,f=d.__redom_lifecycle||(d.__redom_lifecycle={});for(var m in o)f[m]=(f[m]||0)+o[m];!s&&(d===document||v&&d instanceof window.ShadowRoot||c&&c.__redom_mounted)&&(w(d,r?"onremount":"onmount"),s=!0),d=c}},w=function(e,t){if("onmount"===t?e.__redom_mounted=!0:"onunmount"===t&&(e.__redom_mounted=!1),e.__redom_lifecycle){var n=e.__redom_view;n&&n[t]&&n[t]()}},y=function(e,t,n){var i=C(e);if(void 0!==n)i.style[t]=n;else if(S(t))i.setAttribute("style",t);else for(var o in t)y(i,o,t[o])},_="http://www.w3.org/1999/xlink",b=function(e,t,n){var r=C(e),a=r instanceof SVGElement;if(void 0!==n)if("style"===t)y(r,n);else if(a&&N(n))r[t]=n;else if("dataset"===t)o(r,n);else if(!a&&(t in r||N(n)))r[t]=n;else{if(a&&"xlink"===t)return void i(r,n);r.setAttribute(t,n)}else for(var l in t)b(r,l,t[l])},L=function(e){return document.createTextNode(null!=e?e:"")},k=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];(0===i||i)&&("function"==typeof i?i(e):S(i)||x(i)?e.appendChild(L(i)):A(C(i))?p(e,i):i.length?k(e,i):"object"==typeof i&&b(e,i))}},E=function(e){return S(e)?M(e):C(e)},C=function(e){return e.nodeType&&e||!e.el&&e||C(e.el)},S=function(e){return"string"==typeof e},x=function(e){return"number"==typeof e},N=function(e){return"function"==typeof e},A=function(e){return e&&e.nodeType},B={},I=function(e){return B[e]||(B[e]=s(e))},M=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];var o;if(S(e))o=I(e).cloneNode(!1);else{if(!A(e))throw new Error("At least one argument required");o=e.cloneNode(!1)}return k(o,n),o};M.extend=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];var o=I(e);return M.bind.apply(M,[this,o].concat(n))};var T=M,D=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];for(var o=C(e),a=r(e,n,o.firstChild);a;){var l=a.nextSibling;c(e,a),a=l}},G=function(e){return function(t){return t[e]}},P=function(e,t,n){this.View=e,this.initData=n,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],null!=t&&(this.lookup={},this.key=N(t)?t:G(t))};P.prototype.update=function(e,t){for(var n=this,i=n.View,o=n.key,r=n.initData,a=null!=o,l=this.lookup,u={},d=new Array(e.length),s=this.views,c=0;c<e.length;c++){var f=e[c],m=void 0;if(a){var h=o(f);m=l[h]||new i(r,f,c,e),u[h]=m,m.__redom_id=h}else m=s[c]||new i(r,f,c,e);m.update&&m.update(f,c,e,t);C(m.el).__redom_view=m,d[c]=m}this.oldViews=s,this.views=d,this.oldLookup=l,this.lookup=u};var H=function(e,t,n,i){return new O(e,t,n,i)},O=function(e,t,n,i){this.__redom_list=!0,this.View=t,this.initData=i,this.views=[],this.pool=new P(t,n,i),this.el=E(e),this.keySet=null!=n};O.prototype.update=function(e,t){var n=this;void 0===e&&(e=[]);var i=this,o=i.keySet,r=this.views,a=o&&this.lookup;this.pool.update(e,t);var l=this.pool,u=l.views,d=l.lookup;if(o)for(var s=0;s<r.length;s++){var f=r[s].__redom_id;f in d||c(n,a[f])}D(this,u),o&&(this.lookup=d),this.views=u},O.extend=function(e,t,n,i){return O.bind(O,e,t,n,i)},H.extend=O.extend;var z=function(){function e(e,t){var n=this,i=e.getBoundingClientRect();this.el=T("div.contextMenu",{style:{top:i.bottom+window.pageYOffset+"px",left:i.left+"px"}}),this.list=H(this.el,R),this.list.update(t),setTimeout(function(){n.eventListener=window.addEventListener("click",function(){n.remove()})},0),p(document.body,this.el)}return e.prototype.remove=function(){this.eventListener&&window.removeEventListener("click",this.eventListener),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},e}(),R=function(){function e(){var e=this;this.el=T("div.contextMenuItem",{onclick:function(){return e.callback&&e.callback()}}),this.callback=null}return e.prototype.update=function(e){this.el.textContent=e.label,this.callback=e.callback},e}(),V=null,j=null,q=null,U=new Promise(function(e,t){return window.addEventListener("load",e)}),J=null,W=new Promise(function(e,t){J=e}),X=function(){function e(){this.el=T("img.profileButton",{src:"/img/profile.png",onclick:function(){return j.el.classList.toggle("visible")}})}return e.prototype.update=function(e){},e}(),Y=function(){function e(){this.el=T("div.profileMenu",T("div.profileMenuContent",T("div.gamesCreatedBlock","Welcome to Open Edit Play! Play or Edit a game and profile will be created for you.",T("div"),"Games created: ",this.gamesCreated=T("span.gamesCreated"))),{onclick:function(){return j.el.classList.toggle("visible")}})}return e.prototype.update=function(e){},e}(),F="Game size in data units. Every object in scene, type, component, level and property is a data unit.",K=function(){function e(){this.el=T("div.gameListContainer",T("table.gameList",T("thead.gameListHeader",T("th.gameListHeaderName","Name"),T("th.gameListHeaderPlay"),T("th.gameListHeaderSize","Size",{title:F}),T("th.gameListHeaderLevels","Levels"),T("th.gameListHeaderCreated","Created"),T("th.gameListHeaderModified","Modified")),this.list=H("tbody.gameListContent",Q)))}return e.prototype.update=function(e){this.list.update(e)},e}(),Q=function(){function e(){var e=this;this.el=T("tr.gameElement",this.name=T("td.gameElementName"),this.play=T("td.gameElementPlay",this.primaryButton=T("a.linkButton","Play",{onclick:t}),this.secondaryButton=T("a.linkButton.hideInSmallScreens.gameElementSecondaryButton","...",{href:"#",onclick:function(t){t.preventDefault(),e.isMyGame?window.location.href="/edit/?gameId="+e.gameId:new z(e.secondaryButton,[{label:"Open editor sandbox",callback:function(){return window.location.href="/edit/?gameId="+e.gameId}}])}})),this.size=T("td.gameElementSize",{title:F}),this.levels=T("td.gameElementLevels"),this.created=T("td.gameElementCreated"),this.modified=T("td.gameElementModified"))}return e.prototype.update=function(e){var t=this;this.isMyGame=null,this.gameId=e.id,this.name.textContent=e.name,this.size.textContent=e.serializableCount,this.levels.textContent=e.levelCount,this.created.textContent=n(e.createdAt),this.created.setAttribute("title",new Date(e.createdAt).toLocaleString()),this.modified.textContent=n(e.updatedAt),this.modified.setAttribute("title",new Date(e.updatedAt).toLocaleString()),this.primaryButton.setAttribute("href","/play/?gameId="+e.id),W.then(function(n){t.isMyGame=!(!n.gameIdList||!n.gameIdList.includes(e.id)),t.el.classList.toggle("isMyGame",t.isMyGame),t.isMyGame?t.secondaryButton.textContent="Edit":t.secondaryButton.textContent="..."})},e}();window.IS_SMALL_SCREEN=window.screen.width<800,window.IS_MOBILE_STANDALONE=window.navigator.standalone,window.addEventListener("load",function(){IS_SMALL_SCREEN&&document.body.classList.add("isSmallDevice"),a(document.getElementById("profileButtonContainer"));var t=document.getElementById("games");e("/api/gameListSample").then(function(e){var n=new K;n.update(e),p(t,n)}).catch(function(e){p(t,L("Could not load"))}),W.then(function(e){if(e.id&&0!==e.games.length){var t=document.getElementById("myGames");t.style.display="block";var n=new K;n.update(e.games),p(t,n)}});var n=document.getElementById("topBarBackground");IS_MOBILE_STANDALONE?n.style.opacity=1:(window.onscroll=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;n.style.opacity=e<100?0:e<350?(e-100)/250*1:1},window.onscroll())})});
//# sourceMappingURL=openeditplay.homepage.min.js.map
