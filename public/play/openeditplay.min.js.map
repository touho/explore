{"version":3,"file":null,"sources":["../src/util/events.ts","../src/util/performance.ts","../src/core/serializable.ts","../src/core/serializableManager.ts","../src/util/assert.ts","../src/core/propertyType.ts","../src/util/color.ts","../src/core/dataTypes.ts","../node_modules/redom/dist/redom.es.js","../src/util/popup.ts","../src/features/graphics.ts","../src/modules/backgroundGradient.ts","../src/features/physics.ts","../src/util/input.ts","../src/core/scene.ts","../src/core/prototype.ts","../src/core/entityPrototype.ts","../src/components/Particles.ts","../src/util/algorithm.ts","../src/core/net.ts","../src/player/canvasResize.ts","../src/player/touchControlManager.ts","../src/util/environment.ts","../src/core/property.ts","../src/util/vector.ts","../src/core/propertyOwner.ts","../src/core/game.ts","../src/core/componentData.ts","../src/core/component.ts","../src/core/entity.ts","../src/core/prefab.ts","../src/core/level.ts","../src/components/Transform.ts","../src/components/TransformVariance.ts","../src/components/Shape.ts","../src/components/Sprite.ts","../src/components/Spawner.ts","../src/components/Trigger.ts","../src/components/Physics.ts","../src/components/Lifetime.ts","../src/components/CharacterController.ts","../src/util/callLimiter.ts","../src/player/TouchControl.ts","../src/player/main.ts"],"sourcesContent":["/*\n Global event system\n\n let unlisten = events.listen('event name', function(params, ...) {});\n eventManager.dispatch('event name', paramOrParamArray);\n unlisten();\n */\n\nlet listeners = {};\n\nlet events = {\n\t// priority should be a whole number between -100000 and 100000. a smaller priority number means that it will be executed first.\n\tlisten(event, callback, priority = 0) {\n\t\tcallback.priority = priority + (listenerCounter++ / NUMBER_BIGGER_THAN_LISTENER_COUNT);\n\t\tif (!listeners.hasOwnProperty(event)) {\n\t\t\tlisteners[event] = [];\n\t\t}\n\t\t// listeners[event].push(callback);\n\t\t// if (!this._listeners.hasOwnProperty(event)) {\n\t\t// \tthis._listeners[event] = [];\n\t\t// }\n\t\tlet index = indexOfListener(listeners[event], callback);\n\t\tlisteners[event].splice(index, 0, callback);\n\t\treturn () => {\n\t\t\tvar index = listeners[event].indexOf(callback);\n\t\t\tlisteners[event].splice(index, 1);\n\t\t};\n\t},\n\tdispatch(event, ...args) {\n\t\tif (listeners.hasOwnProperty(event)) {\n\t\t\tlet listener = listeners[event];\n\t\t\tfor (var i = 0; i < listener.length; ++i) {\n\t\t\t\tlistener[i].apply(null, args);\n\t\t\t\t/*\n\t\t\t\ttry {\n\t\t\t\t\tlisteners[event][i].apply(null, args);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (console && console.sendError) {\n\t\t\t\t\t\tconsole.sendError(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t}\n\t\t}\n\t},\n\t// Promise is resolved when next event if this type is sent\n\tgetEventPromise(event) {\n\t\treturn new Promise(function(res) {\n\t\t\tevents.listen(event, res);\n\t\t});\n\t}\n};\nexport default events;\n\n// DOM / ReDom event system\n\nexport function dispatch(view, type, data) {\n\tconst el = view === window ? view : view.el || view;\n\tconst debug = 'Debug info ' + new Error().stack;\n\tel.dispatchEvent(new CustomEvent(type, {\n\t\tdetail: { data, debug, view },\n\t\tbubbles: true\n\t}));\n}\nexport function listen(view, type, handler) {\n\tlet el = view === window ? view : view.el || view;\n\tel.addEventListener(type, event => {\n\t\tif (event instanceof CustomEvent)\n\t\t\thandler(event.detail.data, event.detail.view);\n\t\telse\n\t\t\thandler(event);\n\t});\n}\n\nlet listenerCounter = 0;\nconst NUMBER_BIGGER_THAN_LISTENER_COUNT = 10000000000;\n\nfunction indexOfListener(array, callback) {\n\tlet low = 0,\n\t\thigh = array.length,\n\t\tpriority = callback.priority;\n\n\twhile (low < high) {\n\t\tlet mid = low + high >>> 1;\n\t\tif (array[mid].priority < priority) low = mid + 1;\n\t\telse high = mid;\n\t}\n\treturn low;\n}\n","import events from \"./events\";\n\nconst UPDATE_INTERVAL = 1000; //ms\n\nimport { isClient } from './environment';\n\nlet performance;\nperformance = isClient ? window.performance : { now: Date.now };\n\nlet snapshotPerformance = []; // is static data for UPDATE_INTERVAL. then it changes.\nlet cumulativePerformance = {}; // will be reseted every UPDATE_INTERVAL\nlet currentPerformanceMeters = {}; // very short term\n\nlet perSecondSnapshot = [];\nlet currentPerSecondMeters = {};\nexport function eventHappened(name, count = 1) {\n\t// @ifndef OPTIMIZE\n\tcurrentPerSecondMeters[name] = (currentPerSecondMeters[name] || 0) + count;\n\t// @endif\n}\n\nexport function start(name) {\n\t// @ifndef OPTIMIZE\n\tcurrentPerformanceMeters[name] = performance.now();\n\t// @endif\n}\n\nexport function stop(name) {\n\t// @ifndef OPTIMIZE\n\tlet millis = performance.now() - currentPerformanceMeters[name];\n\tif (cumulativePerformance[name])\n\t\tcumulativePerformance[name] += millis;\n\telse\n\t\tcumulativePerformance[name] = millis;\n\t// @endif\n}\n\nlet performanceInterval = null;\nexport function startPerformanceUpdates() {\n\tperformanceInterval = setInterval(() => {\n\t\tprintPrivatePerformance(cumulativePerformance);\n\t\t\n\t\tsnapshotPerformance = performanceObjectToPublicArray(cumulativePerformance);\n\t\tcumulativePerformance = {};\n\t\tevents.dispatch('performance snapshot', snapshotPerformance);\n\n\t\tperSecondSnapshot = perSecondObjectToPublicArray(currentPerSecondMeters);\n\t\tcurrentPerSecondMeters = {};\n\t\tevents.dispatch('perSecond snapshot', perSecondSnapshot);\n\t}, UPDATE_INTERVAL);\n}\n\nfunction printPrivatePerformance(object) {\n\tlet msg = '';\n\tObject.keys(object).filter(key => key.startsWith('#')).map(key => ({\n\t\tname: key,\n\t\tvalue: object[key] / UPDATE_INTERVAL\n\t})).sort((a, b) => {\n\t\treturn a.value < b.value ? 1 : -1;\n\t}).forEach(perf => {\n\t\tmsg += `\\n   ${perf.name.substring(1)}: ${perf.value * 100}`;\n\t});\n\tif (msg)\n\t\tconsole.log('#Performance:' + msg);\n}\n\nfunction performanceObjectToPublicArray(object) {\n\treturn Object.keys(object).filter(key => !key.startsWith('#')).map(key => ({\n\t\tname: key,\n\t\tvalue: object[key] / UPDATE_INTERVAL\n\t})).sort((a, b) => {\n\t\treturn a.value < b.value ? 1 : -1;\n\t});\n}\nfunction perSecondObjectToPublicArray(object) {\n\treturn Object.keys(object).map(key => ({\n\t\tname: key,\n\t\tcount: object[key]\n\t})).sort((a, b) => a.name.localeCompare(b.name));\n}\n\nexport let FRAME_MEMORY_LENGTH = 60 * 8;\nlet frameTimes = [];\nfor (let i = 0; i < FRAME_MEMORY_LENGTH; ++i) {\n\tframeTimes.push(0);\n}\nexport function setFrameTime(seconds) {\n\t// @ifndef OPTIMIZE\n\tframeTimes.shift();\n\tframeTimes.push(seconds);\n\t// @endif\n}\nexport function getFrameTimes() {\n\treturn frameTimes;\n}\n","import assert from '../util/assert';\nimport { addSerializable, removeSerializable, addChange, changeType } from './serializableManager';\nimport { isClient } from '../util/environment';\nimport * as performanceTool from '../util/performance';\n\nconst CHARACTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; // 62 chars\nconst CHAR_COUNT = CHARACTERS.length;\n\nconst random = Math.random;\nexport function createStringId(threeLetterPrefix = '???', characters = 16) {\n\tlet id = threeLetterPrefix;\n\tfor (let i = characters - 1; i >= 0; --i)\n\t\tid += CHARACTERS[random() * CHAR_COUNT | 0];\n\treturn id;\n}\n\nlet serializableClasses = new Map();\n\n/*\nSerializable lifecycle:\n\nfromJSON()\n\n */\n\nexport default class Serializable {\n\tconstructor(predefinedId = false, skipSerializableRegistering = false) {\n// @ifndef OPTIMIZE\n\t\tassert(this.threeLetterType, 'Forgot to Serializable.registerSerializable your class?');\n// @endif\n\t\tthis._children = new Map(); // threeLetterType -> array\n\t\tthis._listeners = {};\n\t\tthis._rootType = this.isRoot ? this.threeLetterType : null;\n\t\tif (skipSerializableRegistering)\n\t\t\treturn;\n\t\tif (predefinedId) {\n\t\t\tthis.id = predefinedId;\n\t\t} else {\n\t\t\tthis.id = createStringId(this.threeLetterType);\n\t\t}\n\t\t/*\n\t\tif (this.id.startsWith('?'))\n\t\t\tthrow new Error('?');\n\t\t\t*/\n\t\taddSerializable(this);\n\t}\n\tmakeUpAName() {\n\t\treturn 'Serializable';\n\t}\n\tdelete() {\n\t\tif (this._parent) {\n\t\t\tthis._parent.deleteChild(this);\n\t\t\treturn false;\n\t\t}\n\t\tthis.deleteChildren();\n\t\tthis._alive = false;\n\t\tthis._rootType = null;\n\t\tthis._listeners = {};\n\t\tremoveSerializable(this.id);\n\t\tthis._state |= Serializable.STATE_DESTROY;\n\t\treturn true;\n\t}\n\tdeleteChildren() {\n\t\tif (this._children.size) {\n\t\t\tthis._children.forEach(array => {\n\t\t\t\tarray.forEach(child => {\n\t\t\t\t\tchild._parent = null;\n\t\t\t\t\tchild.delete();\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis._children.clear();\n\n\t\t\tif (this._parent) {\n\t\t\t\taddChange(changeType.deleteAllChildren, this);\n\t\t\t}\n\t\t}\n\t}\n\t// this is called right after constructor\n\tinitWithChildren(children = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\t\tif (children.length > 0)\n\t\t\tthis.addChildren(children);\n\t\treturn this;\n\t}\n\taddChildren(children) {\n\t\tfor (let i = 0; i < children.length; i++)\n\t\t\tthis.addChild(children[i]);\n\t\treturn this;\n\t}\n\taddChild(child) {\n\t\tthis._addChild(child);\n\t\t\n\t\tthis._state |= Serializable.STATE_ADDCHILD;\n\t\t\n\t\tif (this._rootType)\n\t\t\taddChange(changeType.addSerializableToTree, child);\n\t\treturn this;\n\t}\n\t_addChild(child) {\n\t\tassert(child._parent === null);\n\t\t\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tif (array === undefined) {\n\t\t\tarray = [];\n\t\t\tthis._children.set(child.threeLetterType, array);\n\t\t}\n\t\tarray.push(child);\n\t\tchild._parent = this;\n\t\tchild._state |= Serializable.STATE_ADDPARENT;\n\t\t\n\t\tif (child._rootType !== this._rootType) // tiny optimization\n\t\t\tchild.setRootType(this._rootType);\n\t\t\n\t\treturn this;\n\t}\n\tfindChild(threeLetterType, filterFunction, deep = false) {\n\t\tlet array = this._children.get(threeLetterType);\n\t\tif (!array) return null;\n\t\tif (filterFunction) {\n\t\t\tlet foundChild = array.find(filterFunction);\n\t\t\tif (foundChild) {\n\t\t\t\treturn foundChild;\n\t\t\t} else if (deep) {\n\t\t\t\tfor (let i = 0; i < array.length; ++i) {\n\t\t\t\t\tlet child = array[i];\n\t\t\t\t\tlet foundChild = child.findChild(threeLetterType, filterFunction, true);\n\t\t\t\t\tif (foundChild)\n\t\t\t\t\t\treturn foundChild;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn array[0];\n\t\t}\n\t}\n\tfindParent(threeLetterType, filterFunction = null) {\n\t\tlet parent = this;\n\t\twhile (parent) {\n\t\t\tif (parent.threeLetterType === threeLetterType && (!filterFunction || filterFunction(parent)))\n\t\t\t\treturn parent;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn null;\n\t}\n\tgetRoot() {\n\t\tlet element = this;\n\t\twhile (element._parent) {\n\t\t\telement = element._parent;\n\t\t}\n\t\treturn element;\n\t}\n\t// idx is optional\n\tdeleteChild(child, idx) {\n\t\taddChange(changeType.deleteSerializable, child);\n\t\tthis._detachChild(child, idx);\n\t\tchild.delete();\n\t\treturn this;\n\t}\n\t// idx is optional\n\t_detachChild(child, idx = 0) {\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tassert(array, 'child not found');\n\t\tif (array[idx] !== child)\n\t\t\tidx = array.indexOf(child);\n\t\tassert(idx >= 0, 'child not found');\n\t\tarray.splice(idx, 1);\n\t\tif (array.length === 0)\n\t\t\tthis._children.delete(child.threeLetterType);\n\t\tchild._parent = null;\n\t\tchild.setRootType(null);\n\t\t\n\t\treturn this;\n\t}\n\tforEachChild(threeLetterType = null, callback, deep = false) {\n\t\tfunction processArray(array) {\n\t\t\tarray.forEach(child => {\n\t\t\t\tcallback(child);\n\t\t\t\tdeep && child.forEachChild(threeLetterType, callback, true);\n\t\t\t});\n\t\t}\n\t\tif (threeLetterType) {\n\t\t\tprocessArray(this._children.get(threeLetterType) || []);\n\t\t} else {\n\t\t\tthis._children.forEach(processArray);\n\t\t}\n\t\treturn this;\n\t}\n\tmove(newParent) {\n\t\t\n\t\tnewParent._addChild(this._detach());\n\t\taddChange(changeType.move, this);\n\t\t\n\t\treturn this;\n\t}\n\t_detach() {\n\t\tthis._parent && this._parent._detachChild(this);\n\t\treturn this;\n\t}\n\tgetParent() {\n\t\treturn this._parent || null;\n\t}\n\tgetChildren(threeLetterType) {\n\t\treturn this._children.get(threeLetterType) || [];\n\t}\n\ttoJSON() {\n\t\tlet json = {\n\t\t\tid: this.id\n\t\t};\n\t\tif (this._children.size > 0) {\n\t\t\tlet arrays = [];\n\t\t\t// prototypes must come before a level\n\t\t\tArray.from(this._children.keys()).sort((a, b) => a === 'prt' ? -1 : 1)\n\t\t\t\t.forEach(key => arrays.push(this._children.get(key)));\n\t\t\tjson.c = [].concat(...arrays).map(child => child.toJSON());\n\t\t}\n\t\treturn json;\n\t}\n\ttoString() {\n\t\treturn JSON.stringify(this.toJSON(), null, 4);\n\t}\n\tclone() {\n\t\tlet obj = new this.constructor();\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\t// priority should be a whole number between -100000 and 100000. a smaller priority number means that it will be executed first.\n\tlisten(event, callback, priority = 0) {\n\t\tcallback.priority = priority + (listenerCounter++ / NUMBER_BIGGER_THAN_LISTENER_COUNT);\n\t\tif (!this._listeners.hasOwnProperty(event)) {\n\t\t\tthis._listeners[event] = [];\n\t\t}\n\t\tlet index = indexOfListener(this._listeners[event], callback);\n\t\tthis._listeners[event].splice(index, 0, callback);\n\t\treturn () => {\n\t\t\tif (!this._alive)\n\t\t\t\treturn; // listeners already deleted\n\t\t\tlet index = this._listeners[event].indexOf(callback);\n\t\t\tif (index >= 0)\n\t\t\t\tthis._listeners[event].splice(index, 1);\n\t\t};\n\t}\n\tdispatch(event, a, b, c) {\n\t\tlet listeners = this._listeners[event];\n\t\tif (!listeners)\n\t\t\treturn;\n\t\t\n\t\tperformanceTool.eventHappened('Event ' + event, listeners.length);\n\t\t\n\t\tfor (let i = 0; i < listeners.length; i++) {\n// @ifndef OPTIMIZE\n\t\t\ttry {\n// @endif\n\n\t\t\t\tlisteners[i](a, b, c);\n\n// @ifndef OPTIMIZE\n\t\t\t} catch(e) {\n\t\t\t\tconsole.error(`Event ${event} listener crashed.`, this._listeners[event][i], e);\n\t\t\t}\n// @endif\n\t\t}\n\t}\n\thasDescendant(child) {\n\t\tif (!child) return false;\n\t\tlet parent = child._parent;\n\t\twhile (parent) {\n\t\t\tif (parent === this) return true;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn false;\n\t}\n\tsetRootType(rootType) {\n\t\tif (this._rootType === rootType)\n\t\t\treturn;\n\t\tthis._rootType = rootType;\n\t\t\n\t\t// Optimized\n\t\tlet i;\n\t\tthis._children.forEach(childArray => {\n\t\t\tfor (i = 0; i < childArray.length; ++i) {\n\t\t\t\tchildArray[i].setRootType(rootType);\n\t\t\t}\n\t\t});\n\t}\n\tisInTree() {\n\t\treturn !!this._rootType;\n\t}\n\tstatic fromJSON(json) {\n\t\tassert(typeof json.id === 'string' && json.id.length > 5, 'Invalid id.');\n\t\tlet fromJSON = serializableClasses.get(json.id.substring(0, 3));\n\t\tassert(fromJSON);\n\t\tlet obj;\n\t\ttry {\n\t\t\tobj = fromJSON(json);\n\t\t} catch(e) {\n\t\t\tif (isClient) {\n\t\t\t\tif (!window.force)\n\t\t\t\t\tdebugger; // Type 'force = true' in console to ignore failed imports.\n\n\t\t\t\tif (!window.force)\n\t\t\t\t\tthrow new Error();\n\t\t\t} else {\n\t\t\t\tconsole.log('Error fromJSON', e);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\tlet children = json.c ? json.c.map(child => Serializable.fromJSON(child)).filter(Boolean) : [];\n\t\tif (obj._state & Serializable.STATE_INIT)\n\t\t\tobj.addChildren(children);\n\t\telse\n\t\t\tobj.initWithChildren(children);\n\t\tobj._state |= Serializable.STATE_FROMJSON;\n\t\treturn obj;\n\t}\n\tstatic registerSerializable(Class, threeLetterType, fromJSON = null) {\n\t\tClass.prototype.threeLetterType = threeLetterType;\n\t\tassert(typeof threeLetterType === 'string' && threeLetterType.length === 3);\n\t\tif (!fromJSON)\n\t\t\tfromJSON = json => new Class(json.id);\n\t\tserializableClasses.set(threeLetterType, fromJSON);\n\t}\n}\n\nSerializable.prototype._parent = null;\nSerializable.prototype._alive = true;\nSerializable.prototype._state = 0;\nSerializable.prototype._rootType = null;\n\nSerializable.STATE_INIT = 2;\nSerializable.STATE_ADDCHILD = 4;\nSerializable.STATE_ADDPARENT = 8;\nSerializable.STATE_CLONE = 16;\nSerializable.STATE_DESTROY = 32;\nSerializable.STATE_FROMJSON = 64;\n\nSerializable.prototype.isRoot = false; // If this should be a root node\nObject.defineProperty(Serializable.prototype, 'debug', {\n\tget() {\n\t\tlet info = this.threeLetterType;\n\n\t\tif (this.threeLetterType === 'cda')\n\t\t\tinfo += '|' + this.name;\n\n\t\tthis._children.forEach((value, key) => {\n\t\t\tinfo += '|';\n\t\t\tif (key === 'prp')\n\t\t\t\tinfo += this.getChildren('prp').map(p => `${p.name}=${p._value}`).join(', ');\n\t\t\telse\n\t\t\t\tinfo += `${key}(${value.length})`;\n\t\t});\n\t\t\n\t\tinfo += '|state: ';\n\t\t\n\t\tlet states = [];\n\t\tlet logState = (state, stateString) => {\n\t\t\tif (this._state & state)\n\t\t\t\tstates.push(stateString);\n\t\t};\n\t\t\n\t\tlogState(Serializable.STATE_INIT, 'init');\n\t\tlogState(Serializable.STATE_ADDCHILD, 'add child');\n\t\tlogState(Serializable.STATE_ADDPARENT, 'add parent');\n\t\tlogState(Serializable.STATE_CLONE, 'clone');\n\t\tlogState(Serializable.STATE_DESTROY, 'destroy');\n\t\tlogState(Serializable.STATE_FROMJSON, 'from json');\n\t\t\n\t\tinfo += states.join(', ');\n\t\t\n\t\treturn info;\n\t}\n});\nObject.defineProperty(Serializable.prototype, 'debugChildren', {\n\tget() {\n\t\tlet c = [];\n\t\tthis._children.forEach((value, key) => {\n\t\t\tc = c.concat(value);\n\t\t});\n\t\t\n\t\tlet children = [];\n\t\t\n\t\tfunction createDebugObject(type) {\n\t\t\tif (type === 'gam') return new function Game(){};\n\t\t\tif (type === 'sce') return new function Scene(){};\n\t\t\tif (type === 'prt') return new function Prototype(){};\n\t\t\tif (type === 'prp') return new function Property(){};\n\t\t\tif (type === 'cda') return new function ComponentData(){};\n\t\t\tif (type === 'com') return new function Component(){};\n\t\t\tif (type === 'epr') return new function EntityPrototype(){};\n\t\t\tif (type === 'ent') return new function Entity(){};\n\t\t\tif (type === 'lvl') return new function Level(){};\n\t\t\tif (type === 'pfa') return new function Prefab(){};\n\t\t\treturn new function Other(){};\n\t\t}\n\n\t\tc.forEach(child => {\n\t\t\tlet obj = createDebugObject(child.threeLetterType);\n\t\t\t\n\t\t\tobj.debug = child.debug;\n\t\t\tobj.ref = child;\n\t\t\tobj.debugChildren = child.debugChildren;\n\t\t\tlet c = child.debugChildArray;\n\t\t\tif (c && c.length > 0)\n\t\t\t\tobj.children = c;\n\t\t\tchildren.push(obj);\n\t\t});\n\n\t\treturn children;\n\t}\n});\n\n// If a serializable is a ancestor of another serializable, it is filtered out from the list\nexport function filterChildren(serializables) {\n\tlet idSet = new Set(serializables.map(s => s.id));\n\treturn serializables.filter(serializable => {\n\t\tlet parent = serializable.getParent();\n\t\twhile (parent) {\n\t\t\tif (idSet.has(parent.id))\n\t\t\t\treturn false;\n\t\t\tparent = parent.getParent();\n\t\t}\n\t\treturn true;\n\t});\n}\n\nlet listenerCounter = 0;\nconst NUMBER_BIGGER_THAN_LISTENER_COUNT = 10000000000;\n\nfunction indexOfListener(array, callback) {\n\tlet low = 0,\n\t\thigh = array.length, \n\t\tpriority = callback.priority;\n\n\twhile (low < high) {\n\t\tlet mid = low + high >>> 1;\n\t\tif (array[mid].priority < priority) low = mid + 1;\n\t\telse high = mid;\n\t}\n\treturn low;\n}\n","import assert from '../util/assert';\nimport Serializable from './serializable';\n\nexport let serializables = {};\n\nlet DEBUG_CHANGES = 0;\nlet CHECK_FOR_INVALID_ORIGINS = 0;\n\nexport function addSerializable(serializable) {\n// @ifndef OPTIMIZE\n\tif (serializables[serializable.id] !== undefined)\n\t\tassert(false, (\"Serializable id clash \" + (serializable.id)));\n// @endif\n\tserializables[serializable.id] = serializable;\n}\n\nexport function getSerializable(id) {\n\treturn serializables[id] || null;\n}\n\nexport function hasSerializable(id) {\n\treturn Boolean(serializables[id]);\n}\n\nexport function removeSerializable(id) {\n\t/* When deleting a scene, this function is called a lot of times\n\tif (!serializables[id])\n\t\tthrow new Error('Serializable not found!');\n\t*/\n\tdelete serializables[id];\n}\n\n// reference parameters are not sent over net. they are helpers in local game instance\nexport let changeType = {\n\taddSerializableToTree: 'a', // parentId, reference\n\tsetPropertyValue: 's', // id, value\n\tdeleteSerializable: 'd', // id\n\tmove: 'm', // id, parentId\n\tdeleteAllChildren: 'c', // id\n};\nlet keyToShortKey = {\n\tid: 'i', // obj.id\n\ttype: 't', // changeType.*\n\tvalue: 'v', // value after toJSON\n\tparentId: 'p' // obj._parent.id\n};\nlet shortKeyToKey = {};\nObject.keys(keyToShortKey).forEach(k => {\n\tshortKeyToKey[keyToShortKey[k]] = k;\n});\n\nlet origin;\n\n// @ifndef OPTIMIZE\nlet previousVisualOrigin;\nfunction resetOrigin() {\n\torigin = null;\n}\nexport function getChangeOrigin() {\n\treturn origin;\n}\n// @endif\nexport function setChangeOrigin(_origin) {\n\t// @ifndef OPTIMIZE\n\tif (_origin !== origin) {\n\t\torigin = _origin;\n\t\tif (DEBUG_CHANGES && _origin && _origin !== previousVisualOrigin) {\n\t\t\tconsole.log('origin', previousVisualOrigin);\n\t\t\tpreviousVisualOrigin = _origin;\n\t\t}\n\t\t\n\t\tif (CHECK_FOR_INVALID_ORIGINS)\n\t\t\tsetTimeout(resetOrigin, 0);\n\t}\n\t// @endif\n}\n\nlet externalChange = false;\n\n// addChange needs to be called if editor, server or net game needs to share changes\nexport function addChange(type, reference) {\n\t// @ifndef OPTIMIZE\n\tassert(origin, 'Change without origin!');\n\t// @endif\n\t\n\tif (!reference.id) return;\n\t\n\tlet change = {\n\t\ttype,\n\t\treference,\n\t\tid: reference.id,\n\t\texternal: externalChange,\n\t\torigin // exists in editor, but not in optimized release\n\t};\n\tif (type === changeType.setPropertyValue) {\n\t\tchange.value = reference._value;\n\t} else if (type === changeType.move) {\n\t\tchange.parent = reference._parent;\n\t} else if (type === changeType.addSerializableToTree) {\n\t\tchange.parent = reference._parent;\n\t\tdelete change.id;\n\t}\n\t\n\t// @ifndef OPTIMIZE\n\tif (DEBUG_CHANGES)\n\t\tconsole.log('change', change);\n\n\tlet previousOrigin = origin;\n\t// @endif\n\n\tfor (let i = 0; i < listeners.length; ++i) {\n\t\tlisteners[i](change);\n\t}\n\n\t// @ifndef OPTIMIZE\n\tif (origin !== previousOrigin) {\n\t\tif (DEBUG_CHANGES)\n\t\t\tconsole.log('origin changed from', previousOrigin, 'to', origin && origin.constructor || origin);\n\t\torigin = previousOrigin;\n\t}\n\t// @endif\n}\n\nexport function executeExternal(callback) {\n\tsetChangeOrigin('external');\n\tif (externalChange) return callback();\n\texternalChange = true;\n\tcallback();\n\texternalChange = false;\n}\n\nlet listeners = [];\n\nexport function addChangeListener(callback) {\n\tassert(typeof callback === 'function');\n\tlisteners.push(callback);\n}\n\nexport function packChange(change) {\n\tif (change.packedChange)\n\t\treturn change.packedChange; // optimization\n\t\n\tlet packed = {};\n\ttry {\n\t\tif (change.parent)\n\t\t\tchange.parentId = change.parent.id;\n\t\t\n\t\tif (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.reference) {\n\t\t\t\tchange.value = change.reference.toJSON();\n\t\t\t} else {\n\t\t\t\tassert(false, 'invalid change of type addSerializableToTree', change);\n\t\t\t}\n\t\t} else if (change.value !== undefined) {\n\t\t\tchange.value = change.reference.propertyType.type.toJSON(change.value);\n\t\t}\n\n\t\tObject.keys(keyToShortKey).forEach(key => {\n\t\t\tif (change[key] !== undefined) {\n\t\t\t\tif (key === 'type' && change[key] === changeType.setPropertyValue) return; // optimize most common type\n\t\t\t\tpacked[keyToShortKey[key]] = change[key];\n\t\t\t}\n\t\t});\n\t} catch(e) {\n\t\tconsole.log('PACK ERROR', e);\n\t}\n\treturn packed;\n}\n\nexport function unpackChange(packedChange) {\n\tlet change = {\n\t\tpackedChange // optimization\n\t};\n\tObject.keys(packedChange).forEach(shortKey => {\n\t\tlet key = shortKeyToKey[shortKey];\n\t\tchange[key] = packedChange[shortKey];\n\t});\n\tif (!change.type)\n\t\tchange.type = changeType.setPropertyValue;\n\t\n\tif (change.type === changeType.addSerializableToTree) {\n\t\t// reference does not exist because it has not been created yet\n\t\tchange.id = change.value.id;\n\t} else {\n\t\tchange.reference = getSerializable(change.id);\n\t\tif (change.reference) {\n\t\t\tchange.id = change.reference.id;\n\t\t} else {\n\t\t\tconsole.error('received a change with unknown id', change, 'packed:', packedChange);\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\tif (change.parentId)\n\t\tchange.parent = getSerializable(change.parentId);\n\treturn change;\n}\n\nexport function executeChange(change) {\n\tlet newScene;\n\t\n\texecuteExternal(() => {\n\t\tif (change.type === changeType.setPropertyValue) {\n\t\t\tchange.reference.value = change.reference.propertyType.type.fromJSON(change.value);\n\t\t} else if (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.parent) {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value);\n\t\t\t\tchange.parent.addChild(obj);\n\t\t\t\tif (obj.threeLetterType === 'ent') {\n\t\t\t\t\tobj.localMaster = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value); // Scene does not need a parent\n\t\t\t\tif (obj.threeLetterType === 'sce')\n\t\t\t\t\tnewScene = obj;\n\t\t\t}\n\t\t} else if (change.type === changeType.deleteAllChildren) {\n\t\t\tchange.reference.deleteChildren();\n\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\tchange.reference.delete();\n\t\t} else if (change.type === changeType.move) {\n\t\t\tchange.reference.move(change.parent);\n\t\t}\n\t});\n\t\n\tif (newScene)\n\t\tnewScene.play();\n}\n","// @ifndef OPTIMIZE\nimport { getChangeOrigin } from '../core/serializableManager';\n// @endif\n\nexport default function assert(condition, message) {\n\t// @ifndef OPTIMIZE\n\tif (!condition) {\n\t\tconsole.log('Assert', message, new Error().stack, '\\norigin', getChangeOrigin());\n\t\tdebugger;\n\t\tif (!window.force)\n\t\t\tthrow new Error(message);\n\t}\n\t// @endif\n}\n","import assert from '../util/assert';\nimport Property from './property';\n\n// info about type, validator, validatorParameters, initialValue\n\n\n\nclass PropertyType {\n\tconstructor(name, type, validator, initialValue, description, flags = [], visibleIf) {\n\t\tassert(typeof name === 'string');\n\t\tassert(name[0] >= 'a' && name[0] <= 'z', 'Name of a property must start with lower case letter.');\n\t\tassert(type && typeof type.name === 'string');\n\t\tassert(validator && typeof validator.validate === 'function');\n\t\t\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.validator = validator;\n\t\tthis.initialValue = initialValue;\n\t\tthis.description = description;\n\t\tthis.visibleIf = visibleIf;\n\t\tthis.flags = {};\n\t\tflags.forEach(f => this.flags[f.type] = f);\n\t}\n\tgetFlag(flag) {\n\t\treturn this.flags[flag.type];\n\t}\n\tcreateProperty({ value, predefinedId, skipSerializableRegistering = false } = {}) {\n\t\treturn new Property({\n\t\t\tpropertyType: this,\n\t\t\tvalue,\n\t\t\tpredefinedId,\n\t\t\tname: this.name,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n}\n\n/*\n\tBeautiful way of creating property types\n\t\n\toptionalParameters:\n\t\tdescription: 'Example',\n\t\tvalidator: PropertyType.\n */\nexport default function createPropertyType(propertyName, defaultValue, type, ...optionalParameters) {\n\ttype = type();\n\tlet validator = type.validators.default();\n\tlet description = '';\n\tlet flags = [];\n\tlet visibleIf = null;\n\toptionalParameters.forEach((p, idx) => {\n\t\tif (typeof p === 'string')\n\t\t\tdescription = p;\n\t\telse if (p && p.validate)\n\t\t\tvalidator = p;\n\t\telse if (p && p.isFlag)\n\t\t\tflags.push(p);\n\t\telse if (p && p.visibleIf)\n\t\t\tvisibleIf = p;\n\t\telse\n\t\t\tassert(false, 'invalid parameter ' + p + ' idx ' + idx);\n\t});\n\treturn new PropertyType(propertyName, type, validator, defaultValue, description, flags, visibleIf);\n};\n\nexport let dataType = createPropertyType;\n\n// if value is string, property must be value\n// if value is an array, property must be one of the values\ndataType.visibleIf = function(propertyName, value) {\n\tassert(typeof propertyName === 'string' && propertyName.length);\n\tassert(typeof value !== 'undefined');\n\treturn {\n\t\tvisibleIf: true,\n\t\tpropertyName,\n\t\tvalues: Array.isArray(value) ? value : [value]\n\t};\n};\n\nfunction createFlag(type, func = {}) {\n\tfunc.isFlag = true;\n\tfunc.type = type;\n\treturn func;\n}\n\ncreatePropertyType.flagDegreesInEditor = createFlag('degreesInEditor');\n\nexport function createDataType({\n\tname = '',\n\tvalidators = { default: x => x }, // default must exist. if value is a reference(object), validator should copy the value.\n\ttoJSON = x => x,\n\tfromJSON = x => x,\n\tclone = x => x\n}) {\n\tassert(name, 'name missing from property type');\n\tassert(typeof validators.default === 'function','default validator missing from property type: ' + name);\n\tassert(typeof toJSON === 'function', 'invalid toJSON for property type: ' + name);\n\tassert(typeof fromJSON === 'function', 'invalid fromJSON for property type: ' + name);\n\n\tlet type = {\n\t\tname,\n\t\tvalidators,\n\t\ttoJSON,\n\t\tfromJSON,\n\t\tclone\n\t};\n\tlet createType = () => type;\n\n\tObject.keys(validators).forEach(validatorName => {\n\t\tcreateType[validatorName] = createValidator(validatorName, validators[validatorName]);\n\t\tvalidators[validatorName] = createType[validatorName];\n\t});\n\treturn createType;\n}\n\nfunction createValidator(name, validatorFunction) {\n\tlet validator = function(...args) {\n\t\tlet parameters = args;\n\t\tlet validatorArgs = [null, ...args];\n\t\treturn {\n\t\t\tvalidatorName: name,\n\t\t\tvalidate: function(x) {\n\t\t\t\tvalidatorArgs[0] = x;\n\t\t\t\treturn validatorFunction.apply(null, validatorArgs);\n\t\t\t},\n\t\t\tparameters\n\t\t};\n\t};\n\tvalidator.validatorName = name;\n\tvalidator.validate = validatorFunction;\n\treturn validator;\n}\n","import assert from './assert'\n\nexport class Color {\n\tconstructor(r, g, b) {\n\t\tif (r && r.constructor === Color) {\n\t\t\tthis.r = r.r;\n\t\t\tthis.g = r.g;\n\t\t\tthis.b = r.b;\n\t\t} else if (typeof r === 'number') {\n\t\t\tthis.r = r;\n\t\t\tthis.g = g;\n\t\t\tthis.b = b;\n\t\t} else if (typeof r === 'string') {\n\t\t\tlet rgb = hexToRgb(r);\n\t\t\tthis.r = rgb.r;\n\t\t\tthis.g = rgb.g;\n\t\t\tthis.b = rgb.b;\n\t\t} else {\n\t\t\tassert(false, 'Invalid Color parameters');\n\t\t}\n\t}\n\ttoHexString() {\n\t\treturn rgbToHex(this.r, this.g, this.b);\n\t}\n\ttoHexNumber() {\n\t\treturn this.r * 256 * 256 + this.g * 256 + this.b;\n\t}\n\ttoString() {\n\t\treturn `[${this.r},${this.g},${this.b}]`;\n\t}\n}\n\nexport function hexToRgb(hex) {\n\tvar result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\treturn result ? {\n\t\tr: parseInt(result[1], 16),\n\t\tg: parseInt(result[2], 16),\n\t\tb: parseInt(result[3], 16)\n\t} : null;\n}\n\nexport function componentToHex(c) {\n\tvar hex = c.toString(16);\n\treturn hex.length == 1 ? \"0\" + hex : hex;\n}\n\nexport function rgbToHex(r, g, b) {\n\treturn \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n}\n\nexport function isHexString(hex) {\n\treturn hex && hex.match(/^#[0-9a-f]{6}$/i) ? true : false;\n}\n","import assert from '../util/assert';\nimport { createDataType, dataType } from './propertyType';\nimport Vector from '../util/vector';\nimport {isHexString, Color} from '../util/color';\n\nfunction validateFloat(val) {\n\tif (isNaN(val) || val === Infinity || val === -Infinity)\n\t\tthrow new Error('Invalid float: ' + val);\n}\n\nconst FLOAT_JSON_PRECISION = 4;\nconst FLOAT_JSON_PRECISION_MULTIPLIER = Math.pow(10, FLOAT_JSON_PRECISION);\nconst FLOAT_DELTA = 0.0000001;\n\ndataType.float = createDataType({\n\tname: 'float',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseFloat(x);\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tvalidateFloat(x);\n\t\t\t// @endif\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t},\n\t\tmodulo(x, min, max) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\t\n\t\t\tlet range = max - min;\n\t\t\t\n\t\t\tif (x < min) {\n\t\t\t\tx += (((min - x) / range | 0) + 1) * range;\n\t\t\t} else if (x > max - FLOAT_DELTA) {\n\t\t\t\tx -= (((x - max) / range | 0) + 1) * range;\n\t\t\t}\n\t\t\t\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => Math.round(x*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER,\n\tfromJSON: x => x\n});\ndataType.int = createDataType({\n\tname: 'int',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseInt(x);\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tvalidateFloat(x);\n\t\t\t// @endif\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseInt(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\ndataType.vector = createDataType({\n\tname: 'vector',\n\tvalidators: {\n\t\tdefault(vec) {\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tif (!(vec instanceof Vector))\n\t\t\t\tthrow new Error();\n\t\t\t// @endif\n\t\t\tvec = vec.clone();\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tvec.x = parseFloat(vec.x);\n\t\t\tvec.y = parseFloat(vec.y);\n\t\t\tvalidateFloat(vec.x);\n\t\t\tvalidateFloat(vec.y);\n\t\t\t// @endif\n\t\t\treturn vec;\n\t\t}\n\t},\n\ttoJSON: vec => ({\n\t\tx: Math.round(vec.x*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER,\n\t\ty: Math.round(vec.y*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER\n\t}),\n\tfromJSON: vec => Vector.fromObject(vec),\n\tclone: vec => vec.clone()\n});\n\ndataType.string = createDataType({\n\tname: 'string',\n\tvalidators: {\n\t\tdefault: x => x ? String(x) : ''\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\ndataType.bool = createDataType({\n\tname: 'bool',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tif (typeof x !== 'boolean')\n\t\t\t\tthrow new Error();\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x ? 1 : 0,\n\tfromJSON: x => !!x\n});\n\ndataType.enum = createDataType({\n\tname: 'enum',\n\tvalidators: {\n\t\tdefault() {\n\t\t\tassert(false, `also specify enum values with Prop.enum.values('value1', 'value2', ...)`);\n\t\t},\n\t\tvalues(x, ...values) {\n\t\t\tif (!Array.isArray(values))\n\t\t\t\tthrow new Error();\n\t\t\tif (typeof x !== 'string')\n\t\t\t\tthrow new Error('val should be string');\n\t\t\tif (values.indexOf(x) < 0)\n\t\t\t\tthrow new Error(`value ${x} not in enum: [${values}]`);\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\ndataType.color = createDataType({\n\tname: 'color',\n\tvalidators: {\n\t\tdefault(color) {\n\t\t\tlet newColor = new Color(color);\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tassert(newColor.r >= 0 && newColor.r < 256);\n\t\t\tassert(newColor.g >= 0 && newColor.g < 256);\n\t\t\tassert(newColor.b >= 0 && newColor.b < 256);\n\t\t\t// @endif\n\t\t\treturn newColor;\n\t\t}\n\t},\n\ttoJSON: x => x.toHexString(),\n\tfromJSON: x => new Color(x)\n});\n","var HASH = '#'.charCodeAt(0);\nvar DOT = '.'.charCodeAt(0);\n\nvar TAG_NAME = 0;\nvar ID = 1;\nvar CLASS_NAME = 2;\n\nvar parseQuery = function (query) {\n  var tag = null;\n  var id = null;\n  var className = null;\n  var mode = TAG_NAME;\n  var offset = 0;\n\n  for (var i = 0; i <= query.length; i++) {\n    var char = query.charCodeAt(i);\n    var isHash = char === HASH;\n    var isDot = char === DOT;\n    var isEnd = !char;\n\n    if (isHash || isDot || isEnd) {\n      if (mode === TAG_NAME) {\n        if (i === 0) {\n          tag = 'div';\n        } else {\n          tag = query.substring(offset, i);\n        }\n      } else if (mode === ID) {\n        id = query.substring(offset, i);\n      } else {\n        if (className) {\n          className += ' ' + query.substring(offset, i);\n        } else {\n          className = query.substring(offset, i);\n        }\n      }\n\n      if (isHash) {\n        mode = ID;\n      } else if (isDot) {\n        mode = CLASS_NAME;\n      }\n\n      offset = i + 1;\n    }\n  }\n\n  return { tag: tag, id: id, className: className };\n};\n\nvar createElement = function (query, ns) {\n  var ref = parseQuery(query);\n  var tag = ref.tag;\n  var id = ref.id;\n  var className = ref.className;\n  var element = ns ? document.createElementNS(ns, tag) : document.createElement(tag);\n\n  if (id) {\n    element.id = id;\n  }\n\n  if (className) {\n    if (ns) {\n      element.setAttribute('class', className);\n    } else {\n      element.className = className;\n    }\n  }\n\n  return element;\n};\n\nvar unmount = function (parent, child) {\n  var parentEl = getEl(parent);\n  var childEl = getEl(child);\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (childEl.parentNode) {\n    doUnmount(child, childEl, parentEl);\n\n    parentEl.removeChild(childEl);\n  }\n\n  return child;\n};\n\nvar doUnmount = function (child, childEl, parentEl) {\n  var hooks = childEl.__redom_lifecycle;\n\n  if (hooksAreEmpty(hooks)) {\n    childEl.__redom_mounted = false;\n    return;\n  }\n\n  var traverse = parentEl;\n\n  if (childEl.__redom_mounted) {\n    trigger(childEl, 'onunmount');\n  }\n\n  while (traverse) {\n    var parentHooks = traverse.__redom_lifecycle || {};\n\n    for (var hook in hooks) {\n      if (parentHooks[hook]) {\n        parentHooks[hook] -= hooks[hook];\n      }\n    }\n\n    if (hooksAreEmpty(parentHooks)) {\n      traverse.__redom_lifecycle = null;\n    }\n\n    traverse = traverse.parentNode;\n  }\n};\n\nvar hooksAreEmpty = function (hooks) {\n  if (hooks == null) {\n    return true;\n  }\n  for (var key in hooks) {\n    if (hooks[key]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nvar hookNames = ['onmount', 'onunmount'];\nvar shadowRootAvailable = typeof window !== 'undefined' && 'ShadowRoot' in window;\n\nvar mount = function (parent, child, before) {\n  var parentEl = getEl(parent);\n  var childEl = getEl(child);\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (child !== childEl) {\n    childEl.__redom_view = child;\n  }\n\n  var wasMounted = childEl.__redom_mounted;\n  var oldParent = childEl.parentNode;\n\n  if (wasMounted && (oldParent !== parentEl)) {\n    doUnmount(child, childEl, oldParent);\n  }\n\n  if (before != null) {\n    parentEl.insertBefore(childEl, getEl(before));\n  } else {\n    parentEl.appendChild(childEl);\n  }\n\n  doMount(child, childEl, parentEl, oldParent);\n\n  return child;\n};\n\nvar doMount = function (child, childEl, parentEl, oldParent) {\n  var hooks = childEl.__redom_lifecycle || (childEl.__redom_lifecycle = {});\n  var remount = (parentEl === oldParent);\n  var hooksFound = false;\n\n  for (var i = 0; i < hookNames.length; i++) {\n    var hookName = hookNames[i];\n\n    if (!remount && (child !== childEl) && (hookName in child)) {\n      hooks[hookName] = (hooks[hookName] || 0) + 1;\n    }\n    if (hooks[hookName]) {\n      hooksFound = true;\n    }\n  }\n\n  if (!hooksFound) {\n    childEl.__redom_mounted = true;\n    return;\n  }\n\n  var traverse = parentEl;\n  var triggered = false;\n\n  if (remount || (!triggered && (traverse && traverse.__redom_mounted))) {\n    trigger(childEl, remount ? 'onremount' : 'onmount');\n    triggered = true;\n  }\n\n  if (remount) {\n    return;\n  }\n\n  while (traverse) {\n    var parent = traverse.parentNode;\n    var parentHooks = traverse.__redom_lifecycle || (traverse.__redom_lifecycle = {});\n\n    for (var hook in hooks) {\n      parentHooks[hook] = (parentHooks[hook] || 0) + hooks[hook];\n    }\n\n    if (!triggered && (traverse === document || (shadowRootAvailable && (traverse instanceof window.ShadowRoot)) || (parent && parent.__redom_mounted))) {\n      trigger(traverse, remount ? 'onremount' : 'onmount');\n      triggered = true;\n    }\n\n    traverse = parent;\n  }\n};\n\nvar trigger = function (el, eventName) {\n  if (eventName === 'onmount') {\n    el.__redom_mounted = true;\n  } else if (eventName === 'onunmount') {\n    el.__redom_mounted = false;\n  }\n\n  var hooks = el.__redom_lifecycle;\n\n  if (!hooks) {\n    return;\n  }\n\n  var view = el.__redom_view;\n  var hookCount = 0;\n\n  view && view[eventName] && view[eventName]();\n\n  for (var hook in hooks) {\n    if (hook) {\n      hookCount++;\n    }\n  }\n\n  if (hookCount) {\n    var traverse = el.firstChild;\n\n    while (traverse) {\n      var next = traverse.nextSibling;\n\n      trigger(traverse, eventName);\n\n      traverse = next;\n    }\n  }\n};\n\nvar setStyle = function (view, arg1, arg2) {\n  var el = getEl(view);\n\n  if (arg2 !== undefined) {\n    el.style[arg1] = arg2;\n  } else if (isString(arg1)) {\n    el.setAttribute('style', arg1);\n  } else {\n    for (var key in arg1) {\n      setStyle(el, key, arg1[key]);\n    }\n  }\n};\n\n/* global SVGElement */\n\nvar xlinkns = 'http://www.w3.org/1999/xlink';\n\nvar setAttr = function (view, arg1, arg2) {\n  var el = getEl(view);\n  var isSVG = el instanceof SVGElement;\n\n  if (arg2 !== undefined) {\n    if (arg1 === 'style') {\n      setStyle(el, arg2);\n    } else if (isSVG && isFunction(arg2)) {\n      el[arg1] = arg2;\n    } else if (arg1 === 'dataset') {\n      setData(el, arg2);\n    } else if (!isSVG && (arg1 in el || isFunction(arg2))) {\n      el[arg1] = arg2;\n    } else {\n      if (isSVG && (arg1 === 'xlink')) {\n        setXlink(el, arg2);\n        return;\n      }\n      el.setAttribute(arg1, arg2);\n    }\n  } else {\n    for (var key in arg1) {\n      setAttr(el, key, arg1[key]);\n    }\n  }\n};\n\nfunction setXlink (el, obj) {\n  for (var key in obj) {\n    el.setAttributeNS(xlinkns, key, obj[key]);\n  }\n}\n\nfunction setData (el, obj) {\n  for (var key in obj) {\n    el.dataset[key] = obj[key];\n  }\n}\n\nvar text = function (str) { return document.createTextNode((str != null) ? str : ''); };\n\nvar parseArguments = function (element, args) {\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n\n    if (arg !== 0 && !arg) {\n      continue;\n    }\n\n    // support middleware\n    if (typeof arg === 'function') {\n      arg(element);\n    } else if (isString(arg) || isNumber(arg)) {\n      element.appendChild(text(arg));\n    } else if (isNode(getEl(arg))) {\n      mount(element, arg);\n    } else if (arg.length) {\n      parseArguments(element, arg);\n    } else if (typeof arg === 'object') {\n      setAttr(element, arg);\n    }\n  }\n};\n\nvar ensureEl = function (parent) { return isString(parent) ? html(parent) : getEl(parent); };\nvar getEl = function (parent) { return (parent.nodeType && parent) || (!parent.el && parent) || getEl(parent.el); };\n\nvar isString = function (a) { return typeof a === 'string'; };\nvar isNumber = function (a) { return typeof a === 'number'; };\nvar isFunction = function (a) { return typeof a === 'function'; };\n\nvar isNode = function (a) { return a && a.nodeType; };\n\nvar htmlCache = {};\n\nvar memoizeHTML = function (query) { return htmlCache[query] || (htmlCache[query] = createElement(query)); };\n\nvar html = function (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  if (isString(query)) {\n    element = memoizeHTML(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArguments(element, args);\n\n  return element;\n};\n\nhtml.extend = function (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var clone = memoizeHTML(query);\n\n  return html.bind.apply(html, [ this, clone ].concat( args ));\n};\n\nvar el = html;\nvar h = html;\n\nvar setChildren = function (parent) {\n  var children = [], len = arguments.length - 1;\n  while ( len-- > 0 ) children[ len ] = arguments[ len + 1 ];\n\n  var parentEl = getEl(parent);\n  var current = traverse(parent, children, parentEl.firstChild);\n\n  while (current) {\n    var next = current.nextSibling;\n\n    unmount(parent, current);\n\n    current = next;\n  }\n};\n\nfunction traverse (parent, children, _current) {\n  var current = _current;\n\n  for (var i = 0; i < children.length; i++) {\n    var child = children[i];\n\n    if (!child) {\n      continue;\n    }\n\n    var childEl = getEl(child);\n\n    if (childEl === current) {\n      current = current.nextSibling;\n      continue;\n    }\n\n    if (isNode(childEl)) {\n      mount(parent, child, current);\n      continue;\n    }\n\n    if (child.length != null) {\n      current = traverse(parent, child, current);\n    }\n  }\n\n  return current;\n}\n\nvar propKey = function (key) { return function (item) { return item[key]; }; };\n\nvar listPool = function (View, key, initData) {\n  return new ListPool(View, key, initData);\n};\n\nvar ListPool = function ListPool (View, key, initData) {\n  this.View = View;\n  this.initData = initData;\n  this.oldLookup = {};\n  this.lookup = {};\n  this.oldViews = [];\n  this.views = [];\n\n  if (key != null) {\n    this.lookup = {};\n    this.key = isFunction(key) ? key : propKey(key);\n  }\n};\nListPool.prototype.update = function update (data, context) {\n  var ref = this;\n    var View = ref.View;\n    var key = ref.key;\n    var initData = ref.initData;\n  var keySet = key != null;\n\n  var oldLookup = this.lookup;\n  var newLookup = {};\n\n  var newViews = new Array(data.length);\n  var oldViews = this.views;\n\n  for (var i = 0; i < data.length; i++) {\n    var item = data[i];\n    var view = (void 0);\n\n    if (keySet) {\n      var id = key(item);\n      view = oldLookup[id] || new View(initData, item, i, data);\n      newLookup[id] = view;\n      view.__redom_id = id;\n    } else {\n      view = oldViews[i] || new View(initData, item, i, data);\n    }\n    view.update && view.update(item, i, data, context);\n\n    var el = getEl(view.el);\n    el.__redom_view = view;\n    newViews[i] = view;\n  }\n\n  this.oldViews = oldViews;\n  this.views = newViews;\n\n  this.oldLookup = oldLookup;\n  this.lookup = newLookup;\n};\n\nvar list = function (parent, View, key, initData) {\n  return new List(parent, View, key, initData);\n};\n\nvar List = function List (parent, View, key, initData) {\n  this.__redom_list = true;\n  this.View = View;\n  this.initData = initData;\n  this.views = [];\n  this.pool = new ListPool(View, key, initData);\n  this.el = ensureEl(parent);\n  this.keySet = key != null;\n};\nList.prototype.update = function update (data, context) {\n    var this$1 = this;\n    if ( data === void 0 ) data = [];\n\n  var ref = this;\n    var keySet = ref.keySet;\n  var oldViews = this.views;\n  var oldLookup = keySet && this.lookup;\n\n  this.pool.update(data, context);\n  var ref$1 = this.pool;\n    var views = ref$1.views;\n    var lookup = ref$1.lookup;\n\n  if (keySet) {\n    for (var i = 0; i < oldViews.length; i++) {\n      var id = oldViews[i].__redom_id;\n      if (!(id in lookup)) {\n        unmount(this$1, oldLookup[id]);\n      }\n    }\n  }\n\n  setChildren(this, views);\n\n  if (keySet) {\n    this.lookup = lookup;\n  }\n  this.views = views;\n};\n\nList.extend = function (parent, View, key, initData) {\n  return List.bind(List, parent, View, key, initData);\n};\n\nlist.extend = List.extend;\n\n/* global Node */\n\nvar place = function (View, initData) {\n  return new Place(View, initData);\n};\n\nvar Place = function Place (View, initData) {\n  this.el = text('');\n  this.visible = false;\n  this.view = null;\n  this._placeholder = this.el;\n  if (View instanceof Node) {\n    this._el = View;\n  } else {\n    this._View = View;\n  }\n  this._initData = initData;\n};\nPlace.prototype.update = function update (visible, data) {\n  var placeholder = this._placeholder;\n  var parentNode = this.el.parentNode;\n\n  if (visible) {\n    if (!this.visible) {\n      if (this._el) {\n        mount(parentNode, this._el, placeholder);\n        unmount(parentNode, placeholder);\n        this.el = this._el;\n        this.visible = visible;\n        return;\n      }\n      var View = this._View;\n      var view = new View(this._initData);\n\n      this.el = getEl(view);\n      this.view = view;\n\n      mount(parentNode, view, placeholder);\n      unmount(parentNode, placeholder);\n    }\n    this.view && this.view.update && this.view.update(data);\n  } else {\n    if (this.visible) {\n      if (this._el) {\n        mount(parentNode, placeholder, this._el);\n        unmount(parentNode, this._el);\n        this.el = placeholder;\n        this.visible = visible;\n        return;\n      }\n      mount(parentNode, placeholder, this.view);\n      unmount(parentNode, this.view);\n\n      this.el = placeholder;\n      this.view = null;\n    }\n  }\n  this.visible = visible;\n};\n\nvar router = function (parent, Views, initData) {\n  return new Router(parent, Views, initData);\n};\n\nvar Router = function Router (parent, Views, initData) {\n  this.el = ensureEl(parent);\n  this.Views = Views;\n  this.initData = initData;\n};\nRouter.prototype.update = function update (route, data) {\n  if (route !== this.route) {\n    var Views = this.Views;\n    var View = Views[route];\n\n    this.route = route;\n    this.view = View && new View(this.initData, data);\n\n    setChildren(this.el, [ this.view ]);\n  }\n  this.view && this.view.update && this.view.update(data, route);\n};\n\nvar ns = 'http://www.w3.org/2000/svg';\n\nvar svgCache = {};\n\nvar memoizeSVG = function (query) { return svgCache[query] || (svgCache[query] = createElement(query, ns)); };\n\nvar svg = function (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  if (isString(query)) {\n    element = memoizeSVG(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArguments(element, args);\n\n  return element;\n};\n\nsvg.extend = function (query) {\n  var clone = memoizeSVG(query);\n\n  return svg.bind(this, clone);\n};\n\nsvg.ns = ns;\n\nvar s = svg;\n\nexport { el, h, html, list, List, listPool, ListPool, mount, unmount, place, Place, router, Router, setAttr, setStyle, setChildren, s, svg, text };\n","import {el, mount} from 'redom';\n\nexport function stickyNonModalErrorPopup(text) {\n\tdocument.body.style.filter = 'contrast(70%) brightness(130%) saturate(200%) sepia(40%) hue-rotate(300deg)';\n\t\n\tlet popup = el('div', text, {\n\t\tstyle: {\n\t\t\t'position': 'fixed',\n\t\t\t'display': 'inline-block',\n\t\t\t'max-width': '600%',\n\t\t\t'top': '20%',\n\t\t\t'width': '100%',\n\t\t\t'padding': '40px 10%',\n\t\t\t'font-size': '20px',\n\t\t\t'z-index': '100000',\n\t\t\t'color': 'white',\n\t\t\t'background': '#0c0c0c',\n\t\t\t'text-align': 'center',\n\t\t\t'user-select': 'auto !important',\n\t\t\t'box-sizing': 'border-box'\n\t\t}\n\t});\n\t\n\tmount(document.body, popup);\n}\n\nwindow.sticky = stickyNonModalErrorPopup;\n","import { isClient } from '../util/environment';\n\nlet PIXI;\n\nif (isClient) {\n\tPIXI = window.PIXI;\n\tPIXI.ticker.shared.stop();\n}\n\nexport default PIXI;\n\nlet renderer = null; // Only one PIXI renderer supported for now\n\nexport function getRenderer(canvas) {\n\t/*\n\treturn {\n\t\trender: () => {},\n\t\tresize: () => {}\n\t};\n\t*/\n\t\n\tif (!renderer) {\n\t\trenderer = PIXI.autoDetectRenderer({\n\t\t\tview: canvas,\n\t\t\tautoResize: true,\n\t\t\tantialias: true\n\t\t});\n\n\t\t// Interaction plugin uses ticker that runs in the background. Destroy it to save CPU.\n\t\tif (renderer.plugins.interaction) // if interaction is left out from pixi build, interaction is no defined\n\t\t\trenderer.plugins.interaction.destroy();\n\t}\n\t\n\treturn renderer;\n}\n\nexport function sortDisplayObjects(container) {\n\tcontainer.children.sort(sortFunc);\n}\nfunction sortFunc(a, b) {\n\tif (a.y < b.y)\n\t\treturn -1;\n\telse if (a.y > b.y)\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}\n\nlet texturesAndAnchors = {};\nexport function resetTexturesAndAnchors() {\n\tfor (let textureAndAnchor in texturesAndAnchors) {\n\t\ttextureAndAnchor.texture.destroy();\n\t}\n\ttexturesAndAnchors = {};\n}\nexport function getHashedTextureAndAnchor(hash) {\n\treturn texturesAndAnchors[hash];\n}\nexport function generateTextureAndAnchor(graphicsObject, hash) {\n\tif (!texturesAndAnchors[hash]) {\n\t\tlet bounds = graphicsObject.getLocalBounds();\n\t\tlet anchor = {\n\t\t\tx: -bounds.x / bounds.width,\n\t\t\ty: -bounds.y / bounds.height\n\t\t};\n\t\ttexturesAndAnchors[hash] = {\n\t\t\ttexture: renderer.generateTexture(graphicsObject, PIXI.SCALE_MODES.LINEAR, 2),\n\t\t\tanchor\n\t\t};\n\t}\n\treturn texturesAndAnchors[hash];\n}\n","import events from '../util/events';\nimport PIXI from '../features/graphics';\n\nfunction createCanvas() {\n\tconst RESOLUTION = 10;\n\tvar canvas = document.createElement('canvas');\n\tcanvas.width  = 1;\n\tcanvas.height = RESOLUTION;\n\tvar ctx = canvas.getContext('2d');\n\tvar gradient = ctx.createLinearGradient(0, 0, 0, RESOLUTION * 0.8);\n\t// gradient.addColorStop(0, \"#5886c8\");\n\t// gradient.addColorStop(1, \"#9eb6d5\");\n\tgradient.addColorStop(0, \"#5c77ff\");\n\tgradient.addColorStop(1, \"#90c9f6\");\n\tctx.fillStyle = gradient;\n\tctx.fillRect(0, 0, 1, RESOLUTION);\n\treturn canvas;\n}\n\nevents.listen('scene load level', scene => {\n\tlet gradientCanvas = createCanvas();\n\tlet sprite = new PIXI.Sprite(PIXI.Texture.fromCanvas(gradientCanvas));\n\tscene.backgroundGradient = sprite;\n\tupdateSceneBackgroundGradient(scene);\n\tscene.layers.static.addChild(sprite);\n});\n\nevents.listen('scene unload level', scene => {\n\tdelete scene.backgroundGradient;\n});\n\nevents.listen('canvas resize', scene => {\n\tupdateSceneBackgroundGradient(scene);\n});\n\nfunction updateSceneBackgroundGradient(scene) {\n\tif (!scene.canvas || !scene.backgroundGradient)\n\t\treturn;\n\t\n\tscene.backgroundGradient.width = scene.canvas.width;\n\tscene.backgroundGradient.height = scene.canvas.height;\n};\n","import assert from '../util/assert';\nimport { isClient } from '../util/environment';\n\nlet p2;\nif (isClient)\n\tp2 = window.p2;\nelse\n\tp2 = require('../src/external/p2');\n\nexport default p2;\n\nexport function createWorld(owner, options) {\n\tassert(!owner._p2World);\n\towner._p2World = new p2.World({\n\t\tgravity: [0, 9.81]\n\t\t// gravity: [0, 0]\n\t});\n\n\t// Stress test says that Body sleeping performs better than Island sleeping when idling.\n\towner._p2World.sleepMode = p2.World.BODY_SLEEPING;\n}\n// const MAX_PHYSICS_DT = 0.2;\nconst PHYSICS_DT = 1 / 60;\nexport function updateWorld(owner, dt) {\n\towner._p2World.step(PHYSICS_DT, dt, 5);\n\t// owner._p2World.step(dt, dt, 10);\n}\nexport function deleteWorld(owner) {\n\tif (owner._p2World)\n\t\towner._p2World.clear()\n\tdelete owner._p2World;\n\tdelete owner._p2Materials;\n}\nexport function getWorld(owner) {\n\treturn owner._p2World;\n}\nexport function addBody(owner, body) {\n\towner._p2World.addBody(body);\n}\nexport function deleteBody(owner, body) {\n\towner._p2World.removeBody(body);\n}\n\n// export function addContactMaterial(owner, A, B, options) {\n// \towner._p2World.addContactMaterial(new p2.ContactMaterial(A, B, options));\n// }\n\nconst defaultMaterialOptions = {\n\tfriction: 0.3,\n\trestitution: 0,\n\tstiffness: 1e6, // Hardness of the contact. Less stiffness will make the objects penetrate more, and will make the contact act more like a spring than a contact force.\n\trelaxation: 4, // Original: 3. Small number makes bounce. Big number makes object stay inside another object.\n\tfrictionStiffness: 1e6, // Stiffness of the resulting friction force. For most cases, the value of this property should be a large number. I cannot think of any case where you would want less frictionStiffness.\n\tfrictionRelaxation: 4, // Relaxation of the resulting friction force. The default value should be good for most simulations.\n\tsurfaceVelocity: 0 // Will add surface velocity to this material. If bodyA rests on top if bodyB, and the surface velocity is positive, bodyA will slide to the right.\n};\n\nexport function createMaterial(owner, options) {\n\tif (!owner._p2Materials)\n\t\towner._p2Materials = {};\n\tlet materials = owner._p2Materials;\n\toptions = Object.assign({}, defaultMaterialOptions, options);\n\tlet hash = [\n\t\toptions.friction,\n\t\toptions.restitution,\n\t\toptions.stiffness,\n\t\toptions.relaxation,\n\t\toptions.frictionStiffness,\n\t\toptions.frictionRelaxation,\n\t\toptions.surfaceVelocity\n\t].join(';');\n\t\n\tif (materials[hash])\n\t\treturn materials[hash];\n\t\n\tlet material = new p2.Material();\n\tmaterial.options = options;\n\tmaterials[hash] = material;\n\t\n\t// TODO: When physics entities are edited, new materials are created.\n\t// Should somehow remove old unused materials and contact materials.\n\t\n\tfor (var h in materials) {\n\t\tlet m = materials[h];\n\t\tlet o1 = material.options;\n\t\tlet o2 = m.options;\n\t\tlet contactMaterial = new p2.ContactMaterial(material, m, {\n\t\t\tfriction:\t\t\t\tMath.min(o1.friction, o2.friction),\n\t\t\trestitution:\t\t\tMath.max(o1.restitution, o2.restitution), // If one is bouncy and other is not, collision is bouncy.\n\t\t\tstiffness:\t\t\t\tMath.min(o1.stiffness, o2.stiffness),\n\t\t\trelaxation:\t\t\t\t(o1.relaxation + o2.relaxation) / 2,\n\t\t\tfrictionStiffness:\t\tMath.min(o1.frictionStiffness, o2.frictionStiffness),\n\t\t\tfrictionRelaxation:\t\t(o1.frictionRelaxation + o2.frictionRelaxation) / 2,\n\t\t\tsurfaceVelocity:\t\tMath.max(o1.surfaceVelocity, o2.surfaceVelocity)\n\t\t});\n\t\towner._p2World.addContactMaterial(contactMaterial);\n\t}\n\t\n\treturn material;\n}\n","import Vector from '../util/vector';\n\nexport function keyPressed(key) {\n\treturn keys[key] || false;\n}\n\nexport function listenKeyDown(handler) {\n\tkeyDownListeners.push(handler);\n\treturn () => keyDownListeners.splice(keyDownListeners.indexOf(handler), 1);\n}\nexport function listenKeyUp(handler) {\n\tkeyUpListeners.push(handler);\n\treturn () => keyUpListeners.splice(keyUpListeners.indexOf(handler), 1);\n}\n\nexport const key = {\n\tleft: 37,\n\tright: 39,\n\tup: 38,\n\tdown: 40,\n\tctrl: 17,\n\tappleLeft: 91,\n\tappleRight: 93,\n\talt: 18,\n\tshift: 16,\n\tspace: 32,\n\ta: 65,\n\tb: 66,\n\tc: 67,\n\td: 68,\n\te: 69,\n\tf: 70,\n\tg: 71,\n\th: 72,\n\ti: 73,\n\tj: 74,\n\tk: 75,\n\tl: 76,\n\tm: 77,\n\tn: 78,\n\to: 79,\n\tp: 80,\n\tq: 81,\n\tr: 82,\n\ts: 83,\n\tt: 84,\n\tu: 85,\n\tv: 86,\n\tw: 87,\n\tx: 88,\n\ty: 89,\n\tz: 90,\n\t'0': 48,\n\t'1': 49,\n\t'2': 50,\n\t'3': 51,\n\t'4': 52,\n\t'5': 53,\n\t'6': 54,\n\t'7': 55,\n\t'8': 56,\n\t'9': 57,\n\tbackspace: 8,\n\tenter: 13,\n\tesc: 27,\n\tplus: 187,\n\tminus: 189,\n\tquestionMark: 191\n};\n\nexport function listenMouseMove(element, handler) {\n\telement.addEventListener('mousemove', event => {\n\t\tlet x = event.pageX;\n\t\tlet y = event.pageY;\n\t\tlet el = element;\n\t\twhile( el != null ) {\n\t\t\tx -= el.offsetLeft;\n\t\t\ty -= el.offsetTop;\n\t\t\tel = el.offsetParent;\n\t\t}\n\t\t\n\t\telement._mx = x;\n\t\telement._my = y;\n\t\thandler && handler(new Vector(x, y));\n\t});\n\treturn () => element.removeEventListener('mousemove', handler);\n}\n// Requires listenMouseMove on the same element to get the mouse position\nexport function listenMouseDown(element, handler) {\n\telement.addEventListener('mousedown', event => {\n\t\tif (typeof element._mx === 'number')\n\t\t\thandler(new Vector(element._mx, element._my));\n\t\telse\n\t\t\thandler();\n\t});\n\treturn () => element.removeEventListener('mousedown', handler);\n}\n// Requires listenMouseMove on the same element to get the mouse position\nexport function listenMouseUp(element, handler) {\n\t// listen document body because many times mouse is accidentally dragged outside of element\n\tdocument.body.addEventListener('mouseup', event => {\n\t\tif (typeof element._mx === 'number')\n\t\t\thandler(new Vector(element._mx, element._my));\n\t\telse\n\t\t\thandler();\n\t});\n\treturn () => element.removeEventListener('mouseup', handler);\n}\n\n////////////////////////////////////\n\n\nlet keys = {};\nlet keyDownListeners = [];\nlet keyUpListeners = [];\n\n\nif (typeof window !== 'undefined') {\n\n\twindow.onkeydown = event => {\n\t\tlet keyCode = event.which || event.keyCode;\n\n\t\tif (document.activeElement.nodeName.toLowerCase() == \"input\" && keyCode !== key.esc)\n\t\t\treturn;\n\t\t\n\t\tif (!keys[keyCode]) {\n\t\t\tkeys[keyCode] = true;\n\t\t\tkeyDownListeners.forEach(l => l(keyCode));\n\t\t}\n\t\t\n\t\t// console.log(keyCode);\n\t};\n\twindow.onkeyup = event => {\n\t\tlet key = event.which || event.keyCode;\n\t\tkeys[key] = false;\n\t\tkeyUpListeners.forEach(l => l(key));\n\t};\n}\n\nexport function simulateKeyEvent(eventName, keyCode) {\n\tif (eventName === 'keydown') {\n\t\twindow.onkeydown({\n\t\t\tkeyCode\n\t\t});\n\t} else if (eventName === 'keyup') {\n\t\twindow.onkeyup({\n\t\t\tkeyCode\n\t\t});\n\t}\n}\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { game } from './game';\nimport { addChange, changeType, setChangeOrigin } from './serializableManager';\nimport { createWorld, deleteWorld, updateWorld } from '../features/physics';\nimport { listenMouseMove, listenMouseDown, listenMouseUp, listenKeyDown, key, keyPressed } from '../util/input';\nimport { default as PIXI, getRenderer, sortDisplayObjects } from '../features/graphics';\nimport * as performanceTool from '../util/performance';\nimport Vector from '../util/vector';\nimport events from \"../util/events\";\n\nlet scene = null;\nexport { scene };\n\nconst physicsOptions = {\n\tenableSleeping: true\n};\n\nexport default class Scene extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\n\t\tif (scene) {\n\t\t\ttry {\n\t\t\t\tscene.delete();\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Deleting old scene failed', e);\n\t\t\t}\n\t\t}\n\t\tscene = this;\n\t\twindow.scene = this;\n\n\t\tthis.canvas = document.querySelector('canvas.openEditPlayCanvas');\n\t\tthis.renderer = getRenderer(this.canvas);\n\n\t\tthis.mouseListeners = [\n\t\t\tlistenMouseMove(this.canvas, mousePosition => this.dispatch('onMouseMove', mousePosition)),\n\t\t\tlistenMouseDown(this.canvas, mousePosition => this.dispatch('onMouseDown', mousePosition)),\n\t\t\tlistenMouseUp(this.canvas, mousePosition => this.dispatch('onMouseUp', mousePosition))\n\t\t];\n\n\t\taddChange(changeType.addSerializableToTree, this);\n\n\t\tsceneCreateListeners.forEach(listener => listener());\n\t}\n\tmakeUpAName() {\n\t\tif (this.level)\n\t\t\treturn this.level.makeUpAName();\n\t\telse\n\t\t\treturn 'Scene';\n\t}\n\n\tloadLevel(level) {\n\t\tthis.level = level;\n\n\t\tthis.stage = new PIXI.Container();\n\t\tthis.cameraPosition = new Vector(0, 0);\n\t\tthis.cameraZoom = 1;\n\n\t\tlet self = this;\n\t\tfunction createLayer(parent = self.stage) {\n\t\t\tlet layer = new PIXI.Container();\n\t\t\tparent.addChild(layer);\n\t\t\treturn layer;\n\t\t}\n\t\tthis.layers = {\n\t\t\tstatic: createLayer(), // doesn't move when camera does\n\t\t\tbackground: createLayer(), // moves a little when camera does\n\t\t\tmove: createLayer(), // moves with camera\n\t\t\tui: createLayer() // doesn't move, is on front\n\t\t};\n\t\tthis.layers.behind = createLayer(this.layers.move);\n\t\tthis.layers.main = createLayer(this.layers.move);\n\t\tthis.layers.front = createLayer(this.layers.move);\n\n\t\t// this.bloom = new PIXI.filters.AdvancedBloomFilter();\n\t\t// this.layers.move.filters = [this.bloom];\n\n\t\t// To make component based entity search fast:\n\t\tthis.components = new Map(); // componentName -> Set of components\n\n\t\tthis.animationFrameId = null;\n\t\tthis.playing = false;\n\t\tthis.time = 0;\n\t\tthis.won = false;\n\n\t\tcreateWorld(this, physicsOptions);\n\n\t\tevents.dispatch('scene load level before entities', scene, level);\n\n\t\tthis.level.getChildren('epr').map(epr => epr.createEntity(this));\n\n\t\tevents.dispatch('scene load level', scene, level);\n\n\t\t// this.draw();\n\t}\n\tunloadLevel() {\n\t\tlet level = this.level;\n\t\tthis.level = null;\n\n\t\tthis.pause();\n\n\t\tthis.deleteChildren();\n\n\t\tif (this.stage)\n\t\t\tthis.stage.destroy();\n\t\tthis.stage = null;\n\n\t\tthis.layers = null;\n\n\t\tthis.components.clear();\n\n\t\tdeleteWorld(this);\n\n\t\tevents.dispatch('scene unload level', scene, level);\n\t}\n\n\tsetCameraPositionToPlayer() {\n\t\tlet pos = new Vector(0, 0);\n\t\tlet count = 0;\n\t\tthis.getComponents('CharacterController').forEach(characterController => {\n\t\t\tif (characterController._rootType) {\n\t\t\t\tpos.add(characterController.Transform.position);\n\t\t\t\tcount++;\n\t\t\t}\n\t\t});\n\t\tif (count > 0) {\n\t\t\tthis.cameraPosition.set(pos.divideScalar(count));\n\t\t}\n\t}\n\n\tupdateCamera() {\n\t\tif (this.playing) {\n\t\t\tthis.setCameraPositionToPlayer();\n\t\t}\n\t\t// pivot is camera top left corner position\n\t\tthis.layers.move.pivot.set(this.cameraPosition.x - this.canvas.width / 2 / this.cameraZoom, this.cameraPosition.y - this.canvas.height / 2 / this.cameraZoom);\n\t\tthis.layers.move.scale.set(this.cameraZoom, this.cameraZoom);\n\t}\n\n\twin() {\n\t\tthis.won = true;\n\t}\n\n\tanimFrame() {\n\t\tthis.animationFrameId = null;\n\t\tif (!this._alive || !this.playing) return;\n\n\t\tlet timeInMilliseconds = performance.now();\n\t\tlet t = 0.001 * timeInMilliseconds;\n\t\tlet dt = t - this._prevUpdate;\n\n\t\tperformanceTool.setFrameTime(dt);\n\n\t\tif (dt > 0.05)\n\t\t\tdt = 0.05;\n\t\tthis._prevUpdate = t;\n\t\tthis.time += dt;\n\n\t\tsetChangeOrigin(this);\n\n\t\t// Update logic\n\t\tperformanceTool.start('Component updates');\n\t\tthis.dispatch('onUpdate', dt, this.time);\n\t\tperformanceTool.stop('Component updates');\n\n\t\t// Update physics\n\t\tperformanceTool.start('Physics');\n\t\tupdateWorld(this, dt, timeInMilliseconds);\n\t\tperformanceTool.stop('Physics');\n\n\t\t// Update graphics\n\t\tperformanceTool.start('Draw');\n\t\tthis.draw();\n\t\tperformanceTool.stop('Draw');\n\n\t\tif (this.won) {\n\t\t\tthis.pause();\n\t\t\tthis.time = 0;\n\t\t\tgame.dispatch('levelCompleted');\n\t\t\tthis.reset();\n\t\t}\n\n\t\tthis.requestAnimFrame();\n\t}\n\n\trequestAnimFrame() {\n\t\tlet callback = () => this.animFrame();\n\t\tif (window.requestAnimationFrame)\n\t\t\tthis.animationFrameId = window.requestAnimationFrame(callback);\n\t\telse\n\t\t\tthis.animationFrameId = setTimeout(callback, 16);\n\t}\n\n\tdraw() {\n\t\tthis.updateCamera();\n\n\t\t[this.layers.behind, this.layers.main, this.layers.front].forEach(sortDisplayObjects);\n\n\t\tthis.renderer.render(this.stage, null, false);\n\n\t\tevents.dispatch('scene draw', scene);\n\t\tperformanceTool.eventHappened('Draws');\n\t}\n\n\tisInInitialState() {\n\t\treturn !this.playing && this.time === 0;\n\t}\n\n\treset() {\n\t\tif (!this._alive)\n\t\t\treturn; // scene has been replaced by another one\n\n\t\tthis.resetting = true;\n\n\t\tlet level = this.level;\n\t\tthis.unloadLevel();\n\n\t\tif (level)\n\t\t\tthis.loadLevel(level);\n\n\t\t// this.draw(); // we might be doing ok even without draw.\n\t\t// player mode starts mainloop and editor may want to control the drawing more.\n\n\t\tdelete this.resetting;\n\n\t\tthis.dispatch('reset');\n\t}\n\n\tpause() {\n\t\tif (!this.playing) return;\n\n\t\tthis.playing = false;\n\t\tif (this.animationFrameId) {\n\t\t\tif (window.requestAnimationFrame)\n\t\t\t\twindow.cancelAnimationFrame(this.animationFrameId);\n\t\t\telse\n\t\t\t\tclearTimeout(this.animationFrameId);\n\t\t}\n\t\tthis.animationFrameId = null;\n\n\t\tthis.dispatch('pause');\n\t}\n\n\tplay() {\n\t\tif (this.playing) return;\n\n\t\tthis._prevUpdate = 0.001 * performance.now();\n\t\tthis.playing = true;\n\n\t\tthis.requestAnimFrame();\n\n\t\tif (this.time === 0)\n\t\t\tthis.dispatch('onStart');\n\n\t\tthis.dispatch('play');\n\t}\n\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\n\t\tthis.unloadLevel();\n\n\t\tif (scene === this)\n\t\t\tscene = null;\n\n\t\tif (this.mouseListeners) {\n\t\t\tthis.mouseListeners.forEach(listener => listener());\n\t\t\tthis.mouseListeners = null;\n\t\t}\n\n\t\tthis.renderer = null; // Do not call renderer.destroy(). Same renderer is used by all scenes for now.\n\n\t\treturn true;\n\t}\n\n\t// To make component based entity search fast:\n\taddComponent(component) {\n\t\tlet set = this.components.get(component.constructor.componentName);\n\t\tif (!set) {\n\t\t\tset = new Set();\n\t\t\tthis.components.set(component.constructor.componentName, set);\n\t\t}\n\t\tset.add(component);\n\t}\n\n\tremoveComponent(component) {\n\t\tlet set = this.components.get(component.constructor.componentName);\n\t\tassert(set);\n\t\tassert(set.delete(component));\n\t}\n\n\tgetComponents(componentName) {\n\t\treturn this.components.get(componentName) || new Set;\n\t}\n\n\tmouseToWorld(mousePosition) {\n\t\treturn new Vector(\n\t\t\tthis.layers.move.pivot.x + mousePosition.x / this.cameraZoom,\n\t\t\tthis.layers.move.pivot.y + mousePosition.y / this.cameraZoom\n\t\t);\n\t}\n\n\tsetZoom(zoomLevel) {\n\t\tif (zoomLevel)\n\t\t\tthis.cameraZoom = zoomLevel;\n\t\tthis.dispatch('zoomChange', this.cameraZoom);\n\t}\n}\nScene.prototype.isRoot = true;\n\nSerializable.registerSerializable(Scene, 'sce');\n\nlet sceneCreateListeners = [];\nexport function listenSceneCreation(listener) {\n\tsceneCreateListeners.push(listener);\n\n\tif (scene)\n\t\tlistener();\n}\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nimport Prop from './propertyType';\nimport PropertyOwner from './propertyOwner';\nimport ComponentData from './componentData';\nimport Entity from './entity';\nimport { game } from './game';\nimport { Component } from './component';\nimport events from \"../util/events\";\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Prototype extends PropertyOwner {\n\tconstructor() {\n\t\tsuper(...arguments);\n\t\t\n\t\tthis.previouslyCreatedEntity = null;\n\t}\n\t\n\tmakeUpAName() {\n\t\treturn this.name || 'Prototype';\n\t}\n\t\n\taddChild(child) {\n\t\tif (child.threeLetterType === 'cda' && !child.componentClass.allowMultiple)\n\t\t\tassert(this.findChild('cda', cda => cda.componentId === child.componentId) === null, `Can't have multiple ${child.name} components. See Component.allowMultiple`);\n\t\tsuper.addChild(child);\n\t}\n\tgetParentPrototype() {\n\t\treturn this._parent && this._parent.threeLetterType === 'prt' ? this._parent : null;\n\t}\n\t\n\t/*\n\tfilter filters component datas\n\t\n\tReturns JSON:\n\t[\n\t\t{\n\t\t\townComponent: false, // component of a parent prototype\n\t\t\tcomponentClass: [object Object],\n\t\t\tcomponentId: <componentId>,\n\t\t\tthreeLetterType: 'icd',\n\t \t\tgeneratedForPrototype: <this>,\n\t\t\tproperties: [\n\t\t\t\t{ id missing }\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t ownComponentData: <ComponentData> || null, // null if this prototype has 0 properties defined\n\t\t\t componentClass: [object Object],\n\t\t\t componentId: <componentId>,\n\t\t\t threeLetterType: 'icd',\n\t\t\t generatedForPrototype: <this>,\n\t\t\t properties: [\n\t\t\t \t{ id found if own property } // some properties might be from parent prototypes and thus missing id\n\t\t\t ]\n\t\t }\n\t]\n\t */\n\tgetInheritedComponentDatas(filter = null) {\n\t\tlet data = getDataFromPrototype(this, this, filter);\n\t\tlet array = Object.keys(data).map(key => data[key]);\n\t\tlet inheritedComponentData;\n\t\tfor (let i = 0; i < array.length; ++i) {\n\t\t\tinheritedComponentData = array[i];\n\t\t\tinheritedComponentData.properties = inheritedComponentData.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\treturn inheritedComponentData.propertyHash[propertyType.name]\n\t\t\t\t\t|| propertyType.createProperty({ skipSerializableRegistering: true });\n\t\t\t});\n\t\t\tdelete inheritedComponentData.propertyHash;\n\t\t}\n\n\t\treturn array.sort(sortInheritedComponentDatas);\n\t}\n\t\n\tcreateAndAddPropertyForComponentData(inheritedComponentData, propertyName, propertyValue) {\n\t\tlet propertyType = inheritedComponentData.componentClass._propertyTypesByName[propertyName];\n\t\tassert(propertyType, 'Invalid propertyName', propertyName, inheritedComponentData);\n\t\tlet componentData = this.findChild('cda', componentData => componentData.componentId === inheritedComponentData.componentId);\n\t\tlet componentDataIsNew = false;\n\t\tif (!componentData) {\n\t\t\tconsole.log('no component data. create one', this, inheritedComponentData);\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.componentClass.componentName, false, inheritedComponentData.componentId);\n\t\t\tcomponentDataIsNew = true;\n\t\t}\n\t\tlet property = componentData.findChild('prp', property => property.name === propertyName);\n\t\tif (property) {\n\t\t\tproperty.value = propertyValue;\n\t\t\treturn property;\n\t\t}\n\n\t\tproperty = propertyType.createProperty({\n\t\t\tvalue: propertyValue,\n\t\t});\n\t\tcomponentData.addChild(property);\n\t\t\n\t\tif (componentDataIsNew)\n\t\t\tthis.addChild(componentData);\n\t\t\n\t\treturn property;\n\t}\n\t\n\tfindComponentDataByComponentId(componentId, alsoFindFromParents = false) {\n\t\tlet child = this.findChild('cda', componentData => componentData.componentId === componentId);\n\t\tif (child)\n\t\t\treturn child;\n\t\tif (alsoFindFromParents) {\n\t\t\tlet parent = this.getParentPrototype();\n\t\t\tif (parent)\n\t\t\t\treturn parent.findComponentDataByComponentId(componentId, alsoFindFromParents);\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tgetOwnComponentDataOrInherit(componentId) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, false);\n\t\tif (!componentData) {\n\t\t\tlet inheritedComponentData = this.findComponentDataByComponentId(componentId, true);\n\t\t\tif (!inheritedComponentData)\n\t\t\t\treturn null;\n\t\t\t\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.name, false, componentId);\n\t\t\tthis.addChild(componentData);\n\t\t}\n\t\treturn componentData\n\t}\n\t\n\tfindOwnProperty(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId);\n\t\tif (componentData) {\n\t\t\treturn componentData.getProperty(propertyName);\n\t\t}\n\t\treturn null;\n\t}\n\t\n\t// Parent is needed so that we can init children knowing who is the parent\n\tcreateEntity(parent, _skipNewEntityEvent = false) {\n\t\tlet entity = new Entity();\n\t\t\n\t\tlet inheritedComponentDatas = this.getInheritedComponentDatas();\n\t\tlet components = inheritedComponentDatas.map(Component.createWithInheritedComponentData);\n\t\tentity.addComponents(components, { fullInit: false }); // Only do preInit\n\t\t\n\t\tentity.prototype = this;\n\t\t\n\t\tif (parent)\n\t\t\tparent.addChild(entity);\n\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('create entity', this.makeUpAName());\n\t\t\n\t\tthis.forEachChild('epr', epr => epr.createEntity(entity, true));\n\t\t// let childEntityPrototypes = this.getChildren('epr');\n\t\t// childEntityPrototypes.forEach(epr => epr.createEntity(entity));\n\t\t\n\t\t// Components have only been preinited. Lets call the init now.\n\t\tEntity.initComponents(components);\n\t\t\n\t\tthis.previouslyCreatedEntity = entity;\n\t\t\n\t\tif (!_skipNewEntityEvent)\n\t\t\tevents.dispatch('new entity created', entity);\n\t\t\n\t\treturn entity;\n\t}\n\t\n\tgetValue(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, true);\n\t\tif (componentData)\n\t\t\treturn componentData.getValue(propertyName);\n\t\telse\n\t\t\treturn undefined;\n\t}\n\t\n\tcountEntityPrototypes(findParents = false) {\n\t\tif (this.threeLetterType !== 'prt')\n\t\t\treturn 0;\n\t\t\n\t\tlet count = 0;\n\t\tlet levels = game.getChildren('lvl');\n\t\tfor (let i = levels.length-1; i >= 0; i--) {\n\t\t\tlet entityPrototypes = levels[i].getChildren('epr');\n\t\t\tfor (let j = entityPrototypes.length-1; j >= 0; j--) {\n\t\t\t\tif (entityPrototypes[j].prototype === this)\n\t\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (findParents)\n\t\t\tthis.forEachChild('prt', prt => count += prt.countEntityPrototypes(true));\n\t\t\n\t\treturn count;\n\t}\n\t\n\tdelete() {\n\t\tthis._gameRoot = this._gameRoot || this.getRoot();\n\t\tif (!super.delete()) return false;\n\t\tif (this.threeLetterType === 'prt' && this._gameRoot.threeLetterType === 'gam') {\n\t\t\tthis._gameRoot.forEachChild('lvl', lvl => {\n\t\t\t\tlet items = lvl.getChildren('epr');\n\t\t\t\tfor (let i = items.length-1; i >= 0; i--) {\n\t\t\t\t\tif (items[i].prototype === this) {\n\t\t\t\t\t\tlvl.deleteChild(items[i], i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.previouslyCreatedEntity = null;\n\t\treturn true;\n\t}\n}\nPropertyOwner.defineProperties(Prototype, propertyTypes);\n\nPrototype.create = function(name) {\n\treturn new Prototype().initWithPropertyValues({ name: name });\n};\n\nSerializable.registerSerializable(Prototype, 'prt');\n\nfunction getDataFromPrototype(prototype, originalPrototype, filter, _depth = 0) {\n\tlet data;\n\n\tlet parentPrototype = prototype.getParentPrototype();\n\tif (parentPrototype)\n\t\tdata = getDataFromPrototype(parentPrototype, originalPrototype, filter, _depth + 1);\n\telse\n\t\tdata = {}; // Top level\n\t\n\tlet componentDatas = prototype.getChildren('cda');\n\tif (filter)\n\t\tcomponentDatas = componentDatas.filter(filter);\n\tlet componentData;\n\tfor (let i = 0; i < componentDatas.length; ++i) {\n\t\tcomponentData = componentDatas[i];\n\n\t\tif (!data[componentData.componentId]) {\n\t\t\t// Most parent version of this componentId\n\t\t\tdata[componentData.componentId] = {\n\t\t\t\t// ownComponent = true if the original prototype is the first one introducing this componentId\n\t\t\t\townComponentData: null, // will be given value if the original prototype has this componentId\n\t\t\t\tcomponentClass: componentData.componentClass,\n\t\t\t\tcomponentId: componentData.componentId,\n\t\t\t\tpropertyHash: {},\n\t\t\t\tthreeLetterType: 'icd',\n\t\t\t\tgeneratedForPrototype: originalPrototype,\n\t\t\t};\n\t\t}\n\t\t\n\t\tif (_depth === 0) {\n\t\t\tdata[componentData.componentId].ownComponentData = componentData;\n\t\t}\n\t\t\n\t\tlet propertyHash = data[componentData.componentId].propertyHash;\n\t\t\n\t\tlet properties = componentData.getChildren('prp');\n\t\tlet property;\n\t\tfor (let j = 0; j < properties.length; ++j) {\n\t\t\tproperty = properties[j];\n\t\t\t// Newest version of a property always overrides old property\n\t\t\tpropertyHash[property.name] = _depth === 0 ? property : property.clone(true);\n\t\t}\n\t};\n\n\treturn data;\n}\n\nfunction sortInheritedComponentDatas(a, b) {\n\treturn a.componentClass.componentName.localeCompare(b.componentClass.componentName);\n}\n","import Prototype from './prototype';\nimport Property from './property';\nimport Serializable from './serializable';\nimport { getSerializable } from './serializableManager';\nimport { Prop, componentClasses } from './component';\nimport ComponentData from './componentData';\nimport assert from '../util/assert';\nimport Vector from '../util/vector';\n\n// EntityPrototype is a prototype that always has one Transform ComponentData and optionally other ComponentDatas also.\n// Entities are created based on EntityPrototypes\nexport default class EntityPrototype extends Prototype {\n\tconstructor(predefinedId = false) {\n\t\tsuper(...arguments);\n\t\t// this._parent is level, not prototype. We need a link to parent-prototype.\n\t\tthis.prototype = null;\n\t}\n\n\tmakeUpAName() {\n\t\tlet nameProperty = this.findChild('prp', property => property.name === 'name');\n\t\tif (nameProperty && nameProperty.value)\n\t\t\treturn nameProperty.value;\n\t\telse if (this.prototype)\n\t\t\treturn this.prototype.makeUpAName();\n\t\telse\n\t\t\treturn 'EntityPrototype';\n\t}\n\n\tgetTransform() {\n\t\treturn this.findChild('cda', cda => cda.name === 'Transform');\n\t}\n\tgetParentPrototype() {\n\t\treturn this.prototype || null;\n\t}\n\tclone() {\n\t\tlet obj = new EntityPrototype();\n\t\tobj.prototype = this.prototype;\n\t\tlet id = obj.id;\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tif (child.threeLetterType === 'prp' && child.name === 'name') {\n\t\t\t\tlet property = new Property({\n\t\t\t\t\tvalue: child.propertyType.type.clone(child.value),\n\t\t\t\t\tname: child.name,\n\t\t\t\t\tpropertyType: this.propertyType,\n\t\t\t\t\tpredefinedId: id + '_n'\n\t\t\t\t});\n\t\t\t\tchildren.push(property);\n\t\t\t} else if (child.threeLetterType === 'cda' && child.name === 'Transform') {\n\t\t\t\tlet transform = new ComponentData('Transform', id + '_t');\n\n\t\t\t\t// Transform component data always has a position\n\t\t\t\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', prp => prp.name === 'position').value,\n\t\t\t\t\tpredefinedId: id + '_p'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(position);\n\n\t\t\t\tlet oldScaleProperty = child.findChild('prp', prp => prp.name === 'scale');\n\t\t\t\tif (oldScaleProperty) {\n\t\t\t\t\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\t\t\t\t\tvalue: oldScaleProperty.value,\n\t\t\t\t\t\tpredefinedId: id + '_s'\n\t\t\t\t\t});\n\t\t\t\t\ttransform.addChild(scale);\n\t\t\t\t}\n\n\t\t\t\tlet oldAngleProperty = child.findChild('prp', prp => prp.name === 'angle');\n\t\t\t\tif (oldAngleProperty) {\n\t\t\t\t\tlet angle = transform.componentClass._propertyTypesByName.angle.createProperty({\n\t\t\t\t\t\tvalue: oldAngleProperty.value,\n\t\t\t\t\t\tpredefinedId: id + '_a'\n\t\t\t\t\t});\n\t\t\t\t\ttransform.addChild(angle);\n\t\t\t\t}\n\n\t\t\t\tchildren.push(transform);\n\t\t\t} else if (child.threeLetterType === 'cda') {\n\t\t\t\tchildren.push(child.clone({ cloneComponentId: true }));\n\t\t\t} else {\n\t\t\t\tchildren.push(child.clone());\n\t\t\t}\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\n\ttoJSON() {\n\t\t/*\n\t\tlet json = super.toJSON();\n\t\tjson.t = this.prototype.id;\n\t\treturn json;\n\t\t*/\n\n\t\t// Below optimization reduces size 88%. child id's have to be generated based on this.id\n\n\t\tlet Transform = this.getTransform();\n\t\tlet json = {\n\t\t\tid: this.id\n\t\t};\n\t\tif (this.prototype)\n\t\t\tjson.t = this.prototype.id; // might be prototype or prefab or may not exist. .t as in type\n\n\t\tlet childArrays = [];\n\t\tthis._children.forEach(child => {\n\t\t\tchildArrays.push(child);\n\t\t});\n\t\tlet children = [].concat(...childArrays).filter(child => {\n\t\t\treturn child !== Transform && child !== this._properties.name;\n\t\t});\n\t\tif (children.length > 0)\n\t\t\tjson.c = children.map(child => child.toJSON());\n\n\t\tlet floatToJSON = Prop.float().toJSON;\n\t\tlet handleProperty = prp => {\n\t\t\tif (prp.name === 'name') {\n\t\t\t\tif (prp.value)\n\t\t\t\t\tjson.n = prp.value;\n\t\t\t} else if (prp.name === 'position') {\n\t\t\t\tjson.p = prp.type.toJSON(prp.value);\n\t\t\t} else if (prp.name === 'scale') {\n\t\t\t\tif (!prp.value.isEqualTo(new Vector(1, 1))) {\n\t\t\t\t\tjson.s = prp.type.toJSON(prp.value);\n\t\t\t\t}\n\t\t\t} else if (prp.name === 'angle') {\n\t\t\t\tif (prp.value !== 0)\n\t\t\t\t\tjson.a = floatToJSON(prp.value);\n\t\t\t}\n\t\t};\n\t\thandleProperty(this._properties.name);\n\n\t\tTransform.getChildren('prp').forEach(handleProperty);\n\t\treturn json;\n\t}\n\tspawnEntityToScene(scene, position) {\n\t\tif (!scene)\n\t\t\treturn;\n\n\t\tif (position) {\n\t\t\tthis.getTransform().getPropertyOrCreate('position').value = position;\n\t\t}\n\n\t\tthis.createEntity(scene);\n\t}\n\n\t// Optimize this away\n\tsetRootType(rootType) {\n\t\tif (this._rootType === rootType)\n\t\t\treturn;\n\t\tassert(this.getTransform(), 'EntityPrototype must have a Transform');\n\t\tsuper.setRootType(rootType);\n\t}\n}\nObject.defineProperty(EntityPrototype.prototype, 'position', {\n\tget() {\n\t\treturn this.getTransform().findChild('prp', prp => prp.name === 'position').value;\n\t},\n\tset(position) {\n\t\treturn this.getTransform().findChild('prp', prp => prp.name === 'position').value = position;\n\t}\n});\n\n// If Transform or Transform.position is missing, they are added.\nEntityPrototype.createFromPrototype = function (prototype) {\n\tlet entityPrototype = new EntityPrototype();\n\tentityPrototype.prototype = prototype;\n\tlet id = entityPrototype.id;\n\n\tlet prototypeTransform = prototype.findChild('cda', cda => cda.name === 'Transform');\n\tlet fromPrefab = prototype.threeLetterType === 'pfa';\n\n\tif (!fromPrefab && prototypeTransform)\n\t\tassert(false, 'Prototype (prt) can not have a Transform component');\n\n\tif (fromPrefab && !prototypeTransform)\n\t\tassert(false, 'Prefab (pfa) must have a Transform component');\n\n\tlet name = createEntityPrototypeNameProperty(id);\n\tlet transform = createEntityPrototypeTransform(id);\n\n\tif (fromPrefab && prototypeTransform) {\n\t\t// No point to copy the position\n\t\t// transform.setValue('position', prototypeTransform.getValue('position'));\n\t\ttransform.setValue('scale', prototypeTransform.getValue('scale'));\n\t\ttransform.setValue('angle', prototypeTransform.getValue('angle'));\n\t}\n\n\tentityPrototype.initWithChildren([name, transform]);\n\n\t// @ifndef OPTIMIZE\n\tassert(entityPrototype.getTransform(), 'EntityPrototype must have a Transform');\n\t// @endif\n\n\treturn entityPrototype;\n};\n\nfunction createEntityPrototypeNameProperty(entityPrototypeId, name = '') {\n\treturn EntityPrototype._propertyTypesByName.name.createProperty({\n\t\tvalue: name,\n\t\tpredefinedId: entityPrototypeId + '_n'\n\t});\n}\n\nfunction createEntityPrototypeTransform(entityPrototypeId) {\n\tlet transform = new ComponentData('Transform', entityPrototypeId + '_t');\n\n\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\tvalue: new Vector(0, 0),\n\t\tpredefinedId: entityPrototypeId + '_p'\n\t});\n\ttransform.addChild(position);\n\n\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: new Vector(1, 1),\n\t\tpredefinedId: entityPrototypeId + '_s'\n\t});\n\ttransform.addChild(scale);\n\n\tlet angle = transform.componentClass._propertyTypesByName.angle.createProperty({\n\t\tvalue: 0,\n\t\tpredefinedId: entityPrototypeId + '_a'\n\t});\n\ttransform.addChild(angle);\n\n\treturn transform;\n}\n\nEntityPrototype.create = function (name = 'Empty', position = new Vector(0, 0)) {\n\tlet entityPrototype = new EntityPrototype();\n\tlet transform = createEntityPrototypeTransform(entityPrototype.id);\n\ttransform.setValue('position', position);\n\n\tlet nameProperty = createEntityPrototypeNameProperty(entityPrototype.id, name);\n\n\tentityPrototype.initWithChildren([nameProperty, transform]);\n\treturn entityPrototype;\n}\n\nSerializable.registerSerializable(EntityPrototype, 'epr', json => {\n\tlet entityPrototype = new EntityPrototype(json.id);\n\tentityPrototype.prototype = json.t ? getSerializable(json.t) : null;\n\n\t// assert(!json.t || entityPrototype.prototype, `Prototype or Prefab ${json.t} not found`); // .t as in type\n\tif (json.t && !entityPrototype.prototype)\n\t\tconsole.warn(`EntityPrototype thougt it had a prototype or prefab ${json.t} but it was not found.`);\n\n\tlet nameId = json.id + '_n';\n\tlet transformId = json.id + '_t';\n\tlet positionId = json.id + '_p';\n\tlet scaleId = json.id + '_s';\n\tlet angleId = json.id + '_a';\n\n\tlet name = Prototype._propertyTypesByName.name.createProperty({\n\t\tvalue: json.n === undefined ? '' : json.n,\n\t\tpredefinedId: nameId\n\t});\n\n\tlet transformData = new ComponentData('Transform', transformId);\n\tlet transformClass = componentClasses.get('Transform');\n\n\tlet position = transformClass._propertyTypesByName.position.createProperty({\n\t\tvalue: Vector.fromObject(json.p), // in the future, everything will be using p instead of x and y.\n\t\tpredefinedId: positionId\n\t});\n\ttransformData.addChild(position);\n\n\tlet scale = transformClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: json.s && Vector.fromObject(json.s) || new Vector(1, 1),\n\t\tpredefinedId: scaleId\n\t});\n\ttransformData.addChild(scale);\n\n\tlet angle = transformClass._propertyTypesByName.angle.createProperty({\n\t\tvalue: json.a || 0,\n\t\tpredefinedId: angleId\n\t});\n\ttransformData.addChild(angle);\n\n\tentityPrototype.initWithChildren([name, transformData]);\n\n\treturn entityPrototype;\n});\n","import {Component, Prop} from '../core/component';\nimport Vector from '../util/vector';\nimport {Color} from '../util/color';\nimport {default as PIXI, generateTextureAndAnchor, getHashedTextureAndAnchor} from '../features/graphics';\nimport { isClient } from '../util/environment';\n\nimport { PHYSICS_SCALE } from './Physics';\n\nComponent.register({\n\tname: 'Particles',\n\tcategory: 'Graphics',\n\tdescription: 'Particle engine gives eye candy.',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('startColor', new Color('#68c07f'), Prop.color),\n\t\tProp('endColor', new Color('#59abc0'), Prop.color),\n\t\tProp('alpha', 1, Prop.float, Prop.float.range(0, 1)),\n\t\tProp('particleSize', 10, Prop.float, Prop.float.range(1, 100)),\n\t\tProp('particleCount', 30, Prop.int, Prop.int.range(0, 10000)),\n\t\tProp('particleLifetime', 1, Prop.float, Prop.float.range(0.1, 10), 'in seconds'),\n\t\tProp('particleHardness', 0.2, Prop.float, Prop.float.range(0, 1)),\n\t\tProp('blendMode', 'add', Prop.enum, Prop.enum.values('add', 'normal')),\n\t\tProp('spawnType', 'circle', Prop.enum, Prop.enum.values('circle', 'rectangle')),\n\t\tProp('spawnRadius', 20, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('spawnType', 'circle')),\n\t\tProp('spawnRandom', 0.5, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('spawnType', 'circle')),\n\t\tProp('spawnRect', new Vector(50, 50), Prop.vector, Prop.visibleIf('spawnType', 'rectangle')),\n\t\tProp('speedToOutside', 50, Prop.float, Prop.float.range(-1000, 1000), Prop.visibleIf('spawnType', 'circle')),\n\t\tProp('speed', new Vector(0, 0), Prop.vector),\n\t\tProp('speedRandom', 0, Prop.float, Prop.float.range(0, 1000), 'Max random velocity to random direction'),\n\t\tProp('acceleration', new Vector(0, 0), Prop.vector),\n\t\tProp('globalCoordinates', true, Prop.bool),\n\t\tProp('followObject', 0.4, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('globalCoordinates', true))\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\t//ParticleContainer does not work properly!\n\t\t\t\n\t\t\t// maxSize < 40 will crash\n\t\t\t// With many Particle-components with few particles, this is deadly-expensive.\n\t\t\t// And also crashes now and then with low maxValue.\n\t\t\t// this.container = new PIXI.particles.ParticleContainer(5000, {\n\t\t\t// \tposition: true,\n\t\t\t// \talpha: true,\n\t\t\t// \tscale: false,\n\t\t\t// \trotation: false,\n\t\t\t// \tuvs: false\n\t\t\t// });\n\t\t\t\n\n\t\t\t// Use normal container instead\n\t\t\tthis.container = new PIXI.Container();\n\t\t\t\n\t\t\t// Texture\n\t\t\tthis.updateTexture();\n\t\t\t['particleSize', 'particleHardness', 'alpha'].forEach(propertyName => {\n\t\t\t\tthis.listenProperty(this, propertyName, () => {\n\t\t\t\t\tthis.updateTexture();\n\t\t\t\t});\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t\t// Blend mode\n\t\t\tthis.listenProperty(this, 'blendMode', blendMode => {\n\t\t\t\tif (!this.particles)\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite)\n\t\t\t\t\t\tp.sprite.blendMode = blendModes[blendMode];\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\tthis.scene.layers.main.addChild(this.container);\n\t\t\t\n\t\t\tthis.initParticles();\n\t\t\t['particleLifetime', 'particleCount'].forEach(propertyName => {\n\t\t\t\tthis.listenProperty(this, propertyName, () => {\n\t\t\t\t\tthis.initParticles();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.updateGlobalCoordinatesProperty();\n\t\t\tthis.listenProperty(this, 'globalCoordinates', () => {\n\t\t\t\tthis.updateGlobalCoordinatesProperty();\n\t\t\t});\n\t\t\t\n\t\t\tthis.Physics = this.entity.getComponent('Physics');\n\t\t},\n\t\t\n\t\tupdateGlobalCoordinatesProperty() {\n\t\t\tif (this.positionListener) {\n\t\t\t\tthis.positionListener();\n\t\t\t\tthis.positionListener = null;\n\t\t\t}\n\t\t\tif (this.globalCoordinates) {\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite) {\n\t\t\t\t\t\tp.sprite.x += this.container.position.x;\n\t\t\t\t\t\tp.sprite.y += this.container.position.y;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.container.position.set(0, 0);\n\t\t\t} else {\n\t\t\t\tthis.positionListener = this.Transform._properties.position.listen('change', position => {\n\t\t\t\t\tthis.container.position.set(position.x, position.y);\n\t\t\t\t});\n\t\t\t\tthis.container.position.set(this.Transform.position.x, this.Transform.position.y);\n\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite) {\n\t\t\t\t\t\tp.sprite.x -= this.container.position.x;\n\t\t\t\t\t\tp.sprite.y -= this.container.position.y;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\n\t\tupdateTexture() {\n\t\t\tthis.texture = getParticleTexture(this.particleSize, this.particleHardness * 0.9, {r: 255, g: 255, b: 255, a: this.alpha});\n\t\t\t// this.container.baseTexture = this.texture;\n\t\t\tif (this.particles) {\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite)\n\t\t\t\t\t\tp.sprite.texture = this.texture;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\n\t\tinitParticles() {\n\t\t\tif (this.particles) {\n\t\t\t\tthis.particles.forEach(p => {\n\t\t\t\t\tif (p.sprite)\n\t\t\t\t\t\tp.sprite.destroy();\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.particles = [];\n\t\t\tlet interval = this.particleLifetime / this.particleCount;\n\t\t\tlet firstBirth = this.scene.time + Math.random() * interval;\n\t\t\tfor (let i = 0; i < this.particleCount; ++i) {\n\t\t\t\tthis.particles.push({\n\t\t\t\t\talive: false,\n\t\t\t\t\tnextBirth: firstBirth + i * interval\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\n\t\tresetParticle(p) {\n\t\t\t\n\t\t\tp.vx = this.speed.x;\n\t\t\tp.vy = this.speed.y;\n\t\t\tif (this.speedRandom > 0) {\n\t\t\t\tlet randomSpeed = this.speedRandom * Math.random();\n\t\t\t\tlet randomAngle = Math.random() * Math.PI * 2;\n\t\t\t\tp.vx += Math.sin(randomAngle) * randomSpeed;\n\t\t\t\tp.vy += Math.cos(randomAngle) * randomSpeed;\n\t\t\t}\n\n\t\t\t// Calculate starting position\n\t\t\tif (this.spawnType === 'circle') {\n\t\t\t\tlet r = this.spawnRadius;\n\t\t\t\tif (this.spawnRandom > 0) {\n\t\t\t\t\tr = this.spawnRandom * Math.random() * r + (1 - this.spawnRandom) * r;\n\t\t\t\t}\n\t\t\t\tlet angle = Math.random() * Math.PI * 2;\n\t\t\t\tp.sprite.x = Math.cos(angle) * r;\n\t\t\t\tp.sprite.y = Math.sin(angle) * r;\n\t\t\t\tif (this.speedToOutside !== 0) {\n\t\t\t\t\tp.vx += Math.cos(angle) * this.speedToOutside;\n\t\t\t\t\tp.vy += Math.sin(angle) * this.speedToOutside;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Rectangle\n\t\t\t\tp.sprite.x = -this.spawnRect.x / 2 + Math.random() * this.spawnRect.x;\n\t\t\t\tp.sprite.y = -this.spawnRect.y / 2 + Math.random() * this.spawnRect.y;\n\t\t\t}\n\t\t\t\n\t\t\tp.age = this.scene.time - p.nextBirth;\n\t\t\tp.nextBirth += this.particleLifetime;\n\n\t\t\tif (this.globalCoordinates) {\n\t\t\t\tp.sprite.x += this.Transform.position.x;\n\t\t\t\tp.sprite.y += this.Transform.position.y;\n\t\t\t\t\n\t\t\t\tif (this.Physics && this.Physics.body) {\n\t\t\t\t\tlet vel = this.Physics.body.velocity;\n\t\t\t\t\tp.vx = p.vx + this.followObject * vel[0] / PHYSICS_SCALE;\n\t\t\t\t\tp.vy = p.vy + this.followObject * vel[1] / PHYSICS_SCALE;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\tonUpdate(dt, t) {\n\t\t\tconst particleLifetime = this.particleLifetime;\n\t\t\tconst invParticleLifetime = 1 / particleLifetime;\n\t\t\tconst particles = this.particles;\n\t\t\tconst accelerationX = this.acceleration.x * dt;\n\t\t\tconst accelerationY = this.acceleration.y * dt;\n\t\t\t\n\t\t\t// Fast color interpolation\n\t\t\tconst startColor = this.startColor;\n\t\t\tconst endColor = this.endColor;\n\t\t\tfunction colorLerp(lerp) {\n\t\t\t\tlet startMultiplier = 1 - lerp;\n\t\t\t\tlet r = (startColor.r * startMultiplier + endColor.r * lerp) | 0; // to int\n\t\t\t\tlet g = (startColor.g * startMultiplier + endColor.g * lerp) | 0;\n\t\t\t\tlet b = (startColor.b * startMultiplier + endColor.b * lerp) | 0;\n\t\t\t\treturn 65536 * r + 256 * g + b;\n\t\t\t}\n\t\t\t\n\t\t\tlet sprite, \n\t\t\t\tspritePos,\n\t\t\t\tscale,\n\t\t\t\tlerp,\n\t\t\t\tp\n\t\t\t;\n\t\t\t\n\t\t\tfor (let i = 0; i < this.particleCount; i++) {\n\t\t\t\tp = particles[i];\n\t\t\t\t\n\t\t\t\tif (!p.alive) {\n\t\t\t\t\t// Not alive\n\t\t\t\t\tif (t >= p.nextBirth) {\n\t\t\t\t\t\t// The birth!\n\t\t\t\t\t\tp.sprite = new PIXI.Sprite(this.texture);\n\t\t\t\t\t\tp.sprite.blendMode = blendModes[this.blendMode];\n\t\t\t\t\t\tp.sprite.anchor.set(0.5, 0.5);\n\t\t\t\t\t\tp.alive = true;\n\t\t\t\t\t\tthis.resetParticle(p);\n\t\t\t\t\t\tthis.container.addChild(p.sprite);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Is alive\n\n\t\t\t\tsprite = p.sprite;\n\t\t\t\tspritePos = sprite.transform.position;\n\t\t\t\t\n\t\t\t\tp.age += dt;\n\t\t\t\tlerp = p.age * invParticleLifetime;\n\t\t\t\tif (lerp >= 1) {\n\t\t\t\t\tthis.resetParticle(p);\n\t\t\t\t\tlerp = p.age * invParticleLifetime;\n\t\t\t\t} else {\n\t\t\t\t\tp.vx += accelerationX;\n\t\t\t\t\tp.vy += accelerationY;\n\t\t\t\t\tspritePos.x += p.vx * dt;\n\t\t\t\t\tspritePos.y += p.vy * dt;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tsprite.tint = colorLerp(lerp);\n\t\t\t\t\n\t\t\t\tsprite.alpha = alphaLerp(lerp);\n\t\t\t\t\n\t\t\t\tscale = scaleLerp(lerp);\n\t\t\t\tsprite.scale.set(scale, scale);\n\n\t\t\t}\n\t\t},\n\t\t\n\t\tsleep() {\n\t\t\tthis.particles = null;\n\t\t\t\n\t\t\tthis.container.destroy();\n\t\t\tthis.container = null;\n\n\t\t\tif (this.positionListener) {\n\t\t\t\tthis.positionListener();\n\t\t\t\tthis.positionListener = null;\n\t\t\t}\n\t\t\t\n\t\t\t// do not destroy textures. we can reuse them.\n\t\t}\n\t}\n});\n\nfunction alphaLerp(lerp) {\n\tif (lerp > 0.5) {\n\t\treturn (1 - lerp) / 0.5;\n\t} else if (lerp > 0.2) {\n\t\treturn 1;\n\t} else {\n\t\treturn lerp * 5;\n\t}\n}\n\nfunction scaleLerp(lerp) {\n\tif (lerp > 0.5) {\n\t\treturn 1;\n\t} else {\n\t\treturn 0.5 + lerp;\n\t}\n}\n\nconst blendModes = {\n\tadd: isClient ? PIXI.BLEND_MODES.ADD : 0,\n\tnormal: isClient ? PIXI.BLEND_MODES.NORMAL: 0\n};\n\nlet textureCache = {};\n\n// size: pixels\n// gradientHardness: 0..1\nfunction getParticleTexture(size, gradientHardness = 0, rgb = {r: 255, g: 255, b: 255, a: 1}) {\n\tlet hash = `${size}-${gradientHardness}-${rgb.r}-${rgb.g}-${rgb.b}-${rgb.a}`;\n\tif (!textureCache[hash]) {\n\t\tlet canvas = document.createElement('canvas');\n\t\tcanvas.width = size;\n\t\tcanvas.height = size;\n\t\tlet context = canvas.getContext('2d');\n\t\tvar gradient = context.createRadialGradient(\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5 * (gradientHardness), // inner r\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5,\n\t\t\tsize * 0.5 // outer r\n\t\t);\n\t\tgradient.addColorStop(0, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${rgb.a})`);\n\t\tgradient.addColorStop(1, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0)`);\n\t\tcontext.fillStyle = gradient;\n\t\tcontext.fillRect(0, 0, size, size);\n\t\ttextureCache[hash] = PIXI.Texture.fromCanvas(canvas);\n\t}\n\treturn textureCache[hash];\n}\n","export function removeTheDeadFromArray(array) {\n\tfor (let i = array.length - 1; i >= 0; --i) {\n\t\tif (array[i]._alive === false)\n\t\t\tarray.splice(i, 1);\n\t}\n}\n\nexport function absLimit(value, absMax) {\n\tif (value > absMax)\n\t\treturn absMax;\n\telse if (value < -absMax)\n\t\treturn -absMax;\n\telse\n\t\treturn value;\n}\n","import {\n\taddChangeListener,\n\tpackChange,\n\tunpackChange,\n\texecuteChange,\n\texecuteExternal,\n\tchangeType\n} from './serializableManager'\nimport Serializable from './serializable';\nimport {game} from './game';\nimport {limit} from '../util/callLimiter';\nimport {stickyNonModalErrorPopup} from \"../util/popup\";\nimport events from '../util/events';\n\nlet options = {\n\tcontext: null, // 'play' or 'edit'. This is communicated to server. Doesn't affect client.\n\tserverToClientEnabled: true,\n\tclientToServerEnabled: false \n};\n\nexport function configureNetSync(_options) {\n\toptions = Object.assign(options, _options);\n}\n\nlet changes = [];\nlet valueChanges = {}; // id => change\n\nfunction isInSceneTree(change) {\n\treturn change.reference._rootType === 'sce';\n}\n\nfunction getQueryVariable(variable) {\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split('=');\n\t\tif (decodeURIComponent(pair[0]) == variable) {\n\t\t\treturn decodeURIComponent(pair[1]);\n\t\t}\n\t}\n\tconsole.log('Query variable %s not found', variable);\n}\n\nfunction changeReceivedOverNet(packedChanges) {\n\tif (!options.serverToClientEnabled)\n\t\treturn;\n\tpackedChanges.forEach(change => {\n\t\tchange = unpackChange(change);\n\t\tif (change) {\n\t\t\texecuteChange(change);\n\t\t}\n\t});\n}\nfunction gameReceivedOverNet(gameData) {\n\tconsole.log('receive gameData', gameData);\n\tif (!gameData)\n\t\treturn console.error('Game data was not received');\n\ttry {\n\t\texecuteExternal(() => {\n\t\t\tSerializable.fromJSON(gameData);\n\t\t});\n\t\tlocalStorage.openEditPlayGameId = gameData.id;\n\t\t// location.replace(`${location.origin}${location.pathname}?gameId=${gameData.id}`);\n\t\thistory.replaceState({}, null, `?gameId=${gameData.id}`);\n\t} catch(e) {\n\t\tconsole.error('Game is corrupt.', e);\n\t\tstickyNonModalErrorPopup('Game is corrupt.');\n\t}\n}\n\naddChangeListener(change => {\n\tif (change.external || !options.clientToServerEnabled)\n\t\treturn; // Don't send a change that you have received.\n\n\tif (isInSceneTree(change)) // Don't sync scene\n\t\treturn;\n\n\tif (change.type === changeType.setPropertyValue) {\n\t\tlet duplicateChange = valueChanges[change.id];\n\t\tif (duplicateChange) {\n\t\t\tchanges.splice(changes.indexOf(duplicateChange), 1);\n\t\t}\n\t\tvalueChanges[change.id] = change;\n\t}\n\tchanges.push(change);\n\t\n\tif (sendChanges)\n\t\tsendChanges();\n});\n\nfunction parseSocketMessage(message) {\n\tlet type = message.split(' ')[0];\n\tlet body = message.substring(type.length + 1);\n\tif (body.length > 0)\n\t\tbody = JSON.parse(body);\n\n\tconsole.log('parseSocketMessage', type, body);\n\t\n\treturn {\n\t\ttype,\n\t\tbody\n\t};\n}\n\nfunction sendSocketMessage(eventName, data) {\n\tif (!socket)\n\t\treturn console.log('Could not send', eventName);\n\t\n\tif (eventName)\n\t\tsocket.emit(eventName, data);\n\telse\n\t\tsocket.emit(data);\n}\n\nlet listeners = {\n\tdata(result) {\n\t\tlet {profile, gameData, editAccess} = result;\n\t\tlocalStorage.openEditPlayUserId = profile.id;\n\t\tlocalStorage.openEditPlayUserToken = profile.userToken;\n\t\t\n\t\tif (!editAccess) {\n\t\t\tevents.dispatch('noEditAccess');\n\t\t}\n\t\t\n\t\tdelete profile.userToken;\n\t\twindow.user = profile;\n\t\t\n\t\tgameReceivedOverNet(gameData);\n\t},\n\tidentifyYourself() {\n\t\tif (game) \n\t\t\treturn location.reload();\n\n\t\tlet gameId = getQueryVariable('gameId') || localStorage.openEditPlayGameId;\n\t\tlet userId = localStorage.openEditPlayUserId; // if doesn't exist, server will create one\n\t\tlet userToken = localStorage.openEditPlayUserToken; // if doesn't exist, server will create one\n\t\tlet context = options.context;\n\t\tsendSocketMessage('identify', {userId, userToken, gameId, context});\n\t},\n\terrorMessage(result) {\n\t\tlet {message, isFatal, data} = result;\n\t\tconsole.error(`Server sent ${isFatal ? 'FATAL ERROR' : 'error'}:`, message, data);\n\t\tif (isFatal) {\n\t\t\tstickyNonModalErrorPopup(message);\n\t\t\t// document.body.textContent = message;\n\t\t}\n\t}\n};\n\nlet sendChanges = limit(200, 'soon', () => {\n\tif (!socket || changes.length === 0 || !options.clientToServerEnabled)\n\t\treturn;\n\t\n\tlet packedChanges = changes.map(packChange);\n\tchanges.length = 0;\n\tvalueChanges = {};\n\tconsole.log('send change', packedChanges);\n\tsendSocketMessage('', packedChanges);\n});\n\nlet socket;\nfunction connect() {\n\tif (!window.io) {\n\t\treturn console.error('socket.io not defined after window load.');\n\t}\n\t\n\tsocket = new io();\n\twindow.s = socket;\n\tsocket.on('connect', () => {\n\t\tsocket.onevent = packet => {\n\t\t\tlet param1 = packet.data[0];\n\t\t\tif (typeof param1 === 'string') {\n\t\t\t\tlisteners[param1](packet.data[1]);\n\t\t\t} else {\n\t\t\t\t// Optimized change-event\n\t\t\t\tchangeReceivedOverNet(param1);\n\t\t\t}\n\t\t};\n\t\tsocket.on('disconnect', () => {\n\t\t\tconsole.warn('Disconnected!');\n\t\t\tstickyNonModalErrorPopup('Disconnected!');\n\t\t\toptions.serverToClientEnabled = false;\n\t\t\toptions.clientToServerEnabled = false;\n\t\t});\n\t});\n}\nwindow.addEventListener('load', connect);\n","import { scene, listenSceneCreation } from '../core/scene';\nimport debug from './debug'\nimport events from \"../util/events\";\n\nlet previousWidth = null;\nlet previousHeight = null;\nfunction resizeCanvas() {\n\tif (!scene)\n\t\treturn;\n\n\tlet screen = document.getElementById('screen');\n\t\n\tfunction setSize(force) {\n\t\tif (!screen)\n\t\t\treturn;\n\t\t\n\t\tlet width = window.innerWidth;\n\t\tlet height = window.innerHeight;\n\t\t\n\t\tif (!force && width === previousWidth && height === previousHeight)\n\t\t\treturn;\n\n\t\tscreen.style.width = width + 'px';\n\t\tscreen.style.height = height + 'px';\n\t\t\n\t\t// Here you can change the resolution of the canvas\n\t\tlet pixels = width * height;\n\t\tlet quality = 1;\n\t\tif (pixels > MAX_PIXELS) {\n\t\t\tquality = Math.sqrt(MAX_PIXELS / pixels);\n\t\t}\n\t\t\n\t\tscene.renderer.resize(width * quality, height * quality);\n\n\t\twindow.scrollTo(0, 0);\n\t\t\n\t\tpreviousWidth = width;\n\t\tpreviousHeight = height;\n\t\t\n\t\tevents.dispatch('canvas resize', scene);\n\t}\n\t\n\tsetSize(true);\n\t\n\tsetTimeout(setSize, 50);\n\tsetTimeout(setSize, 400);\n\tsetTimeout(setSize, 1000);\n}\n\nwindow.addEventListener('resize', resizeCanvas);\nlistenSceneCreation(resizeCanvas);\n\nconst MAX_PIXELS = 1000 * 600;\n","import {keyPressed, key, listenKeyDown, simulateKeyEvent} from '../util/input'\nimport {listenSceneCreation, scene} from '../core/scene';\nimport Vector from '../util/vector';\nimport { default as TouchControl, CONTROL_SIZE } from './TouchControl';\nimport debug from './debug'\n\nconst ARROW_HITBOX_RADIUS = 110;\n\nconst controls = {\n\ttouchUp:\tnew TouchControl('touchUp',\t\tkey.up),\n\ttouchDown:\tnew TouchControl('touchDown',\tkey.down),\n\ttouchLeft:\tnew TouchControl('touchLeft',\tkey.left),\n\ttouchRight:\tnew TouchControl('touchRight',\tkey.right),\n\ttouchJump:\tnew TouchControl('touchJump',\tkey.up, true),\n\ttouchA:\t\tnew TouchControl('touchA',\t\tkey.space, true),\n\ttouchB:\t\tnew TouchControl('touchB',\t\tkey.b, true)\n};\nconst rightHandControlArray = [controls.touchJump, controls.touchA, controls.touchB];\nconst controlArray = Object.keys(controls).map(key => controls[key]);\n\nwindow.addEventListener('load', () => {\n\tdocument.addEventListener(\"touchmove\", touchChange, {passive: false});\n\tdocument.addEventListener(\"touchstart\", touchChange, {passive: false});\n\tdocument.addEventListener(\"touchend\", touchChange, {passive: false});\n\tdocument.addEventListener(\"scroll\", event => event.preventDefault(), {passive: false});\n\n\twindow.IS_TOUCH_DEVICE = 'ontouchstart' in window || navigator.maxTouchPoints;\n\tif (window.IS_TOUCH_DEVICE)\n\t\tdocument.body.classList.add('touch');\n\n\tif (window.navigator.standalone)\n\t\tdocument.body.classList.add('nativeFullscreen');\n\n\tcontrolArray.forEach(control => control.initElement());\n});\n\nfunction touchChange(event) {\n\tevent.preventDefault();\n\t\n\tlet touchCoordinates = getTouchCoordinates(event);\n\tcontrolArray.forEach(control => {\n\t\tlet isPressed = !!touchCoordinates.find(coord => control.contains(coord));\n\t\tcontrol.setState(isPressed, event.type === 'touchstart');\n\t});\n}\n\nfunction getTouchCoordinates(touchEvent) {\n\tlet touchCoordinates = [];\n\tfor (let i = 0; i < touchEvent.targetTouches.length; ++i) {\n\t\tlet touch = touchEvent.targetTouches[i];\n\t\ttouchCoordinates.push(new Vector(touch.clientX,touch.clientY));\n\t}\n\treturn touchCoordinates;\n}\n\nlistenSceneCreation(() => {\n\tscene.listen('onStart', () => positionControls());\n});\n\nfunction positionControls() {\n\tif (!scene)\n\t\treturn;\n\t\n\tlet\n\t\tplayerFound = false,\n\t\tjumperFound = false,\n\t\tjumpSpeedFound = false,\n\t\ttopDownFound = false,\n\t\tnextLevelButton = true // Press A to reset. Temp solution.\n\t;\n\n\tlet characterControllers = scene.getComponents('CharacterController');\n\tcharacterControllers.forEach(characterController => {\n\t\tif (characterController.type === 'player') {\n\t\t\tplayerFound = true;\n\t\t\tif (characterController.controlType === 'jumper') {\n\t\t\t\tjumperFound = true;\n\t\t\t\tif (characterController.jumpSpeed !== 0) {\n\t\t\t\t\tjumpSpeedFound = true;\n\t\t\t\t}\n\t\t\t} else if (characterController.controlType === 'top down') {\n\t\t\t\ttopDownFound = true;\n\t\t\t}\n\t\t}\n\t});\n\n\tcontrols.touchUp.setVisible(topDownFound);\n\tcontrols.touchLeft.setVisible(playerFound);\n\tcontrols.touchRight.setVisible(playerFound);\n\tcontrols.touchDown.setVisible(topDownFound);\n\tcontrols.touchJump.setVisible(jumpSpeedFound);\n\tcontrols.touchA.setVisible(nextLevelButton); // Temp solution.\n\tcontrols.touchB.setVisible(false);\n\t\n\tif (controls.touchUp.visible && controls.touchDown.visible) {\n\t\tcontrols.touchLeft.setPosition(10, null, 60);\n\t\tcontrols.touchRight.setPosition(110, null, 60);\n\t\tcontrols.touchUp.setPosition(60, null, 110);\n\t\tcontrols.touchDown.setPosition(60, null, 10);\n\t\t\n\t\tcontrols.touchLeft.setContainsFunction(point => {\n\t\t\tlet rel = getRelativePositionToArrowCenter(point);\n\t\t\treturn rel.x < 0 && Math.abs(rel.x) > Math.abs(rel.y) && rel.length() <= ARROW_HITBOX_RADIUS;\n\t\t});\n\n\t\tcontrols.touchUp.setContainsFunction(point => {\n\t\t\tlet rel = getRelativePositionToArrowCenter(point);\n\t\t\treturn rel.y < 0 && Math.abs(rel.y) > Math.abs(rel.x) && rel.length() <= ARROW_HITBOX_RADIUS;\n\t\t});\n\n\t\tcontrols.touchRight.setContainsFunction(point => {\n\t\t\tlet rel = getRelativePositionToArrowCenter(point);\n\t\t\treturn rel.x > 0 && Math.abs(rel.x) > Math.abs(rel.y) && rel.length() <= ARROW_HITBOX_RADIUS;\n\t\t});\n\n\t\tcontrols.touchDown.setContainsFunction(point => {\n\t\t\tlet rel = getRelativePositionToArrowCenter(point);\n\t\t\treturn rel.y > 0 && Math.abs(rel.y) > Math.abs(rel.x) && rel.length() <= ARROW_HITBOX_RADIUS;\n\t\t});\n\t} else {\n\t\tcontrols.touchLeft.setPosition(10, null, 20);\n\t\tcontrols.touchRight.setPosition(90, null, 20);\n\n\t\tcontrols.touchLeft.setContainsFunction(point => {\n\t\t\tlet rel = getRelativePositionToArrowCenter(point);\n\t\t\treturn rel.x <= 0 && rel.y > -ARROW_HITBOX_RADIUS;\n\t\t});\n\t\tcontrols.touchRight.setContainsFunction(point => {\n\t\t\tlet rel = getRelativePositionToArrowCenter(point);\n\t\t\treturn rel.x > 0 && rel.y > -ARROW_HITBOX_RADIUS && rel.x < ARROW_HITBOX_RADIUS;\n\t\t});\n\t}\n\n\tconst SIDE_BUTTON_EXTRA_LEFT_HITBOX = 15; // pixels\n\tlet visibleRightHandControls = rightHandControlArray.filter(control => control.visible);\n\tvisibleRightHandControls.forEach((control, idx) => {\n\t\tlet idxFromRightWall = visibleRightHandControls.length - 1 - idx;\n\t\tcontrol.setPosition(null, 10 + idxFromRightWall * 20, 20 + idx * 70);\n\t\t\n\t\tif (idx === 0) {\n\t\t\t// Bottom right corner control\n\t\t\tcontrol.setContainsFunction(point => {\n\t\t\t\tlet pos = control.getPosition();\n\t\t\t\treturn point.x >= pos.x - CONTROL_SIZE / 2 - SIDE_BUTTON_EXTRA_LEFT_HITBOX && point.y >= pos.y - CONTROL_SIZE / 2;\n\t\t\t});\n\t\t} else {\n\t\t\tcontrol.setContainsFunction(point => {\n\t\t\t\tlet pos = control.getPosition();\n\t\t\t\treturn point.y >= pos.y - CONTROL_SIZE / 2 && point.y <= pos.y + CONTROL_SIZE / 2 && point.x >= pos.x - CONTROL_SIZE / 2 - SIDE_BUTTON_EXTRA_LEFT_HITBOX;\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getArrowCenter() {\n\tlet leftPos = controls.touchLeft.getPosition();\n\tlet rightPos = controls.touchRight.getPosition();\n\tlet center = leftPos.add(rightPos).divideScalar(2);\n\treturn center;\n}\nfunction getRelativePositionToArrowCenter(point) {\n\tlet center = getArrowCenter();\n\treturn point.clone().subtract(center);\n}\n","let isClient = typeof window !== 'undefined';\nlet isServer = typeof module !== 'undefined';\n\nif (isClient && isServer)\n\tthrow new Error('Can not be client and server at the same time.');\n\nexport { isClient, isServer };\n","import Serializable from './serializable';\nimport { addChange, changeType, setChangeOrigin } from './serializableManager'; \nimport assert from '../util/assert';\nimport * as performanceTool from '../util/performance';\n\nlet changesEnabled = true;\nlet scenePropertyFilter = null;\n// true / false to enable / disable property value change sharing.\n// if object is passed, changes are only sent \nexport function filterSceneChanges(_scenePropertyFilter) {\n\tscenePropertyFilter = _scenePropertyFilter;\n\tchangesEnabled = true;\n}\n\nexport function disableAllChanges() {\n\tchangesEnabled = false;\n}\n\nexport function enableAllChanges() {\n\tchangesEnabled = true;\n}\n\n// Object of a property\nexport default class Property extends Serializable {\n\t// set skipSerializableRegistering=true if you are not planning to add this property to the hierarchy\n\t// if you give propertyType, value in real value form\n\t// if you don't give propertyType (give it later), value as JSON form\n\tconstructor({ value, predefinedId, name, propertyType, skipSerializableRegistering = false }) {\n\t\tassert(name, 'Property without a name can not exist');\n\t\tsuper(predefinedId, skipSerializableRegistering);\n\t\tthis._initialValue = value;\n\t\tif (propertyType)\n\t\t\tthis.setPropertyType(propertyType);\n\t\telse {\n\t\t\tthis.name = name;\n\t\t\tthis._initialValueIsJSON = true;\n\t\t}\n\t}\n\tmakeUpAName() {\n\t\treturn this.name;\n\t}\n\tsetPropertyType(propertyType) {\n\t\tthis.propertyType = propertyType;\n\t\ttry {\n\t\t\tif (this._initialValue !== undefined)\n\t\t\t\tthis.value = this._initialValueIsJSON ? propertyType.type.fromJSON(this._initialValue) : this._initialValue;\n\t\t\telse\n\t\t\t\tthis.value = propertyType.initialValue;\n\t\t} catch(e) {\n\t\t\tconsole.log('Invalid value', e, propertyType, this);\n\t\t\tthis.value = propertyType.initialValue;\n\t\t}\n\t\tthis.name = propertyType.name;\n\t}\n\tclone(skipSerializableRegistering = false) {\n\t\treturn new Property({\n\t\t\tvalue: this.propertyType.type.clone(this.value),\n\t\t\tname: this.name,\n\t\t\tpropertyType: this.propertyType,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tv: this.type.toJSON(this.value),\n\t\t\tn: this.propertyType.name\n\t\t});\n\t}\n}\nProperty.prototype.propertyType = null;\nObject.defineProperty(Property.prototype, 'type', {\n\tget() {\n\t\treturn this.propertyType.type;\n\t}\n});\nObject.defineProperty(Property.prototype, 'value', {\n\tset(newValue) {\n\t\tthis._value = this.propertyType.validator.validate(newValue);\n\t\t\n\t\tthis.dispatch('change', this._value);\n\t\tif (changesEnabled && this._rootType) { // not scene or empty\n\t\t\tif (scenePropertyFilter === null\n\t\t\t\t|| this._rootType !== 'sce'\n\t\t\t\t|| scenePropertyFilter(this)\n\t\t\t) {\n\t\t\t\taddChange(changeType.setPropertyValue, this);\n\t\t\t}\n\t\t}\n\t},\n\tget() {\n\t\treturn this._value;\n\t}\n});\n\nSerializable.registerSerializable(Property, 'prp', json => {\n\treturn new Property({\n\t\tvalue: json.v,\n\t\tpredefinedId: json.id,\n\t\tname: json.n\n\t});\n});\n\nObject.defineProperty(Property.prototype, 'debug', {\n\tget() {\n\t\treturn `prp ${this.name}=${this.value}`;\n\t}\n});\n","export default class Vector {\n\tconstructor(x, y) {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t}\n\tadd(vec) {\n\t\tthis.x += vec.x;\n\t\tthis.y += vec.y;\n\t\treturn this;\n\t}\n\taddScalars(x, y) {\n\t\tthis.x += x;\n\t\tthis.y += y;\n\t\treturn this;\n\t}\n\tsubtract(vec) {\n\t\tthis.x -= vec.x;\n\t\tthis.y -= vec.y;\n\t\treturn this;\n\t}\n\tsubtractScalars(x, y) {\n\t\tthis.x -= x;\n\t\tthis.y -= y;\n\t\treturn this;\n\t}\n\tmultiply(vec) {\n\t\tthis.x *= vec.x;\n\t\tthis.y *= vec.y;\n\t\treturn this;\n\t}\n\tmultiplyScalar(scalar) {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\treturn this;\n\t}\n\tdivide(vec) {\n\t\tthis.x /= vec.x;\n\t\tthis.y /= vec.y;\n\t\treturn this;\n\t}\n\tdivideScalar(scalar) {\n\t\tthis.x /= scalar;\n\t\tthis.y /= scalar;\n\t\treturn this;\n\t}\n\tdot(vec) {\n\t\treturn this.x * vec.x + this.y * vec.y;\n\t}\n\tlength() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n\tsetLength(newLength) {\n\t\tlet oldLength = this.length();\n\n\t\tif (oldLength === 0) {\n\t\t\tthis.x = newLength;\n\t\t\tthis.y = 0;\n\t\t} else {\n\t\t\tthis.multiplyScalar(newLength / oldLength);\n\t\t}\n\t\treturn this;\n\t}\n\tgetProjectionOn(vec) {\n\t\tlet length = vec.length();\n\t\tif (length === 0)\n\t\t\treturn this.clone();\n\t\telse\n\t\t\treturn vec.clone().multiplyScalar(this.dot(vec) / (length * length));\n\t}\n\tdistance(vec) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t}\n\tdistanceSq(vec) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn dx * dx + dy * dy;\n\t}\n\tnormalize() {\n\t\treturn this.setLength(1);\n\t}\n\thorizontalAngle() {\n\t\treturn Math.atan2(this.y, this.x);\n\t}\n\tverticalAngle() {\n\t\treturn Math.atan2(this.x, this.y);\n\t}\n\trotate(angle) {\n\t\tlet x = this.x * Math.cos(angle) - this.y * Math.sin(angle);\n\t\tthis.y = this.x * Math.sin(angle) + this.y * Math.cos(angle);\n\t\tthis.x = x;\n\n\t\treturn this;\n\t}\n\trotateTo(angle) {\n\t\treturn this.rotate(angle-this.verticalAngle());\n\t}\n\tisEqualTo(vec) {\n\t\treturn this.x === vec.x && this.y === vec.y;\n\t}\n\tisZero() {\n\t\treturn !this.x && !this.y;\n\t}\n\tclone() {\n\t\treturn new Vector(this.x, this.y);\n\t}\n\tset(vec) {\n\t\tthis.x = vec.x;\n\t\tthis.y = vec.y;\n\t\treturn this;\n\t}\n\tsetScalars(x, y) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\treturn this;\n\t}\n\ttoString() {\n\t\treturn `[${this.x}, ${this.y}]`;\n\t}\n\ttoArray() {\n\t\treturn [this.x, this.y];\n\t}\n}\nVector.fromObject = function(obj) {\n\treturn new Vector(obj.x, obj.y);\n};\nVector.fromArray = function(obj) {\n\treturn new Vector(obj[0], obj[1]);\n};\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nexport { default as Prop } from './propertyType';\n\nexport default class PropertyOwner extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\t\tassert(Array.isArray(this.constructor._propertyTypes), 'call PropertyOwner.defineProperties after class definition');\n\t\tthis._properties = {};\n\t}\n\tmakeUpAName() {\n\t\treturn this.name || 'PropertyOwner';\n\t}\n\t// Just a helper\n\tinitWithPropertyValues(values = {}) {\n\t\tlet children = [];\n\t\t\n\t\tObject.keys(values).forEach(propName => {\n\t\t\tlet propertyType = this.constructor._propertyTypesByName[propName];\n\t\t\tassert(propertyType, 'Invalid property ' + propName);\n\t\t\tchildren.push(propertyType.createProperty({\n\t\t\t\tvalue: values[propName]\n\t\t\t}));\n\t\t});\n\t\tthis.initWithChildren(children);\n\t\treturn this;\n\t}\n\tinitWithChildren(children = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\t\t\n\t\tlet propChildren = [];\n\t\tlet otherChildren = [];\n\t\t// Separate Property children and other children\n\t\tchildren.forEach(child => {\n\t\t\tif (child.threeLetterType === 'prp') {\n\t\t\t\tpropChildren.push(child);\n\t\t\t} else {\n\t\t\t\totherChildren.push(child);\n\t\t\t}\n\t\t});\n\t\tsuper.addChildren(otherChildren);\n\t\t\n\t\tlet invalidPropertiesCount = 0;\n\t\t\n\t\t// Make sure Properties have a PropertyType. They don't work without it.\n\t\tpropChildren.filter(prop => !prop.propertyType).forEach(prop => {\n\t\t\tlet propertyType = this.constructor._propertyTypesByName[prop.name];\n\t\t\tif (!propertyType) {\n\t\t\t\tconsole.log('Property of that name not defined', this.id, prop.name, this);\n\t\t\t\tinvalidPropertiesCount++;\n\t\t\t\tprop.isInvalid = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprop.setPropertyType(propertyType);\n\t\t});\n\t\tif (invalidPropertiesCount)\n\t\t\tpropChildren = propChildren.filter(p => !p.isInvalid);\n\t\t\n\t\t// Make sure all PropertyTypes have a matching Property\n\t\tlet nameToProp = {};\n\t\tpropChildren.forEach(c => nameToProp[c.name] = c);\n\t\tthis.constructor._propertyTypes.forEach(propertyType => {\n\t\t\tif (!nameToProp[propertyType.name])\n\t\t\t\tpropChildren.push(propertyType.createProperty());\n\t\t});\n\t\t\n\t\tsuper.addChildren(propChildren);\n\t\treturn this;\n\t}\n\taddChild(child) {\n\t\tassert(this._state & Serializable.STATE_INIT, this.constructor.componentName || this.constructor + ' requires that initWithChildren will be called before addChild');\n\t\tsuper.addChild(child);\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!child.propertyType) {\n\t\t\t\tif (!this.constructor._propertyTypesByName[child.name]) {\n\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tchild.setPropertyType(this.constructor._propertyTypesByName[child.name]);\n\t\t\t}\n\t\t\tassert(this._properties[child.propertyType.name] === undefined, 'Property already added');\n\t\t\tthis._properties[child.propertyType.name] = child;\n\t\t}\n\t\treturn this;\n\t}\n\tcreatePropertyHash() {\n\t\treturn this.getChildren('prp').map(property => '' + property._value).join(',');\n\t}\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\t\tthis._properties = {};\n\t\treturn true;\n\t}\n\t// idx is optional\n\tdeleteChild(child, idx) {\n\t\tassert(child.threeLetterType !== 'prp', 'Can not delete just one Property child.');\n\t\tsuper.deleteChild(child, idx);\n\t\treturn this;\n\t}\n}\n\nPropertyOwner.defineProperties = function(Class, propertyTypes) {\n\tClass._propertyTypes = propertyTypes;\n\tClass._propertyTypesByName = {};\n\tpropertyTypes.forEach(propertyType => {\n\t\tconst propertyTypeName = propertyType.name;\n\t\tassert(Class.prototype[propertyTypeName] === undefined, 'Property name ' + propertyTypeName + ' clashes');\n\t\tClass._propertyTypesByName[propertyTypeName] = propertyType;\n\t\tObject.defineProperty(Class.prototype, propertyTypeName, {\n\t\t\tget() {\n\t\t\t\treturn this._properties[propertyTypeName].value;\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis._properties[propertyTypeName].value = value;\n\t\t\t}\n\t\t});\n\t});\n};\n","// @flow\n\nimport Serializable from './serializable'\nimport { addChange, changeType, setChangeOrigin } from './serializableManager';\nimport Prototype from './prototype'\nimport assert from '../util/assert'\nimport PropertyOwner, { Prop } from './propertyOwner';\nimport {stickyNonModalErrorPopup} from '../util/popup'\nimport '../modules';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nlet game = null; // only one game at the time\nexport { game };\n\nlet isClient = typeof window !== 'undefined';\n\nexport default class Game extends PropertyOwner {\n\tconstructor(predefinedId) {\n\t\tif (game)\n\t\t\tconsole.error('Only one game allowed.');\n\t\t\n\t\t/*\n\t\tif (isClient) {\n\t\t\tif (game) {\n\t\t\t\ttry {\n\t\t\t\t\tgame.delete();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Deleting old game failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t*/\n\t\t\n\t\tsuper(...arguments);\n\t\t\n\t\tif (isClient) {\n\t\t\tgame = this;\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tgameCreateListeners.forEach(listener => listener(game));\n\t\t}, 1);\n\t}\n\tinitWithChildren() {\n\t\tsuper.initWithChildren(...arguments);\n\t\taddChange(changeType.addSerializableToTree, this);\n\t}\n\tdelete() {\n\t\taddChange(changeType.deleteSerializable, this);\n\t\tif (!super.delete()) return false;\n\t\t\n\t\tif (game === this)\n\t\t\tgame = null;\n\n\t\tstickyNonModalErrorPopup('Game deleted');\n\t\t\n\t\treturn true;\n\t}\n}\nPropertyOwner.defineProperties(Game, propertyTypes);\n\nGame.prototype.isRoot = true;\n\n\n\nSerializable.registerSerializable(Game, 'gam', json => {\n\tif (json.c) {\n\t\tjson.c.sort((a, b) => {\n\t\t\tif (a.id.startsWith('prt') || a.id.startsWith('pfa'))\n\t\t\t\treturn -1;\n\t\t\telse\n\t\t\t\treturn 1;\n\t\t});\n\t}\n\treturn new Game(json.id);\n});\n\nlet gameCreateListeners = [];\nexport function listenGameCreation(listener: (object) => void) {\n\tgameCreateListeners.push(listener);\n\t\n\tconsole.log('real ts');\n\n\tif (game)\n\t\tlistener(game);\n}\n\n\n// jee\n\n\n","import Serializable, { createStringId } from './serializable';\nimport assert from '../util/assert';\nimport { componentClasses, Component } from './component';\nimport { isClient } from '../util/environment';\n\nexport default class ComponentData extends Serializable {\n\tconstructor(componentClassName, predefinedId = false, predefinedComponentId = false) {\n\t\tsuper(predefinedId);\n\t\tthis.name = componentClassName;\n\t\tthis.componentClass = componentClasses.get(this.name);\n\t\tassert(this.componentClass, 'Component class not defined: ' + componentClassName);\n\t\tif (!this.componentClass.allowMultiple)\n\t\t\tpredefinedComponentId = '_' + componentClassName;\n\t\tthis.componentId = predefinedComponentId || createStringId('cid', 10); // what will be the id of component created from this componentData\n\t}\n\tmakeUpAName() {\n\t\treturn this.name;\n\t}\n\taddChild(child) {\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!child.propertyType) {\n\t\t\t\tif (!this.componentClass._propertyTypesByName[child.name]) {\n\t\t\t\t\tif (isClient)\n\t\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\telse\n\t\t\t\t\t\tconsole.log('Property of that name not defined', this.id, this.name, child.name);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tchild.setPropertyType(this.componentClass._propertyTypesByName[child.name]);\n\t\t\t}\n\t\t}\n\t\tsuper.addChild(child);\n\t\treturn this;\n\t};\n\tclone(options) {\n\t\tlet newComponentId = (options && options.cloneComponentId) ? this.componentId : false;\n\t\tlet obj = new ComponentData(this.name, false, newComponentId);\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tcid: this.componentId,\n\t\t\tn: this.name\n\t\t});\n\t}\n\t/*\n\tReturns a list of Properties.\n\tThose which don't have an id are temporary properties generated from parents.\n\tDon't set _depth.\n\t */\n\tgetInheritedProperties(_depth = 0) {\n\t\tlet properties = {};\n\n\t\t// properties from parent\n\t\tlet parentComponentData = this.getParentComponentData();\n\t\tif (parentComponentData)\n\t\t\tparentComponentData.getInheritedProperties(_depth + 1).forEach(prop => properties[prop.name] = prop);\n\t\t\n\t\t// properties from this. override properties of parents\n\t\tthis.getChildren('prp').forEach(prop => {\n\t\t\tif (_depth === 0)\n\t\t\t\tproperties[prop.name] = prop;\n\t\t\telse\n\t\t\t\tproperties[prop.name] = prop.clone(true);\n\t\t});\n\t\t\n\t\t// fill from propertyType\n\t\tif (_depth === 0) {\n\t\t\treturn this.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\treturn properties[propertyType.name] || propertyType.createProperty({\n\t\t\t\t\tskipSerializableRegistering: true\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn Object.keys(properties).map(key => properties[key]);\n\t\t}\n\t}\n\tgetParentComponentData() {\n\t\tif (!this._parent) return null;\n\t\tlet parentPrototype = this._parent.getParentPrototype();\n\t\twhile (parentPrototype) {\n\t\t\tlet parentComponentData = parentPrototype.findChild('cda', componentData => componentData.componentId === this.componentId);\n\t\t\tif (parentComponentData)\n\t\t\t\treturn parentComponentData;\n\t\t\telse\n\t\t\t\tparentPrototype = parentPrototype.getParentPrototype();\n\t\t}\n\t\treturn null;\n\t}\n\tgetPropertyOrCreate(name) {\n\t\tlet property = this.findChild('prp', prp => prp.name === name);\n\t\tif (!property) {\n\t\t\tproperty = this.componentClass._propertyTypesByName[name].createProperty();\n\t\t\tthis.addChild(property);\n\t\t}\n\t\treturn property;\n\t}\n\tgetProperty(name) {\n\t\treturn this.findChild('prp', prp => prp.name === name);\n\t}\n\tsetValue(propertyName, value) {\n\t\tthis.getPropertyOrCreate(propertyName).value = value;\n\t\treturn this;\n\t}\n\tgetValue(name) {\n\t\tlet property = this.getProperty(name);\n\t\tif (property)\n\t\t\treturn property.value;\n\t\tlet parent = this.getParentComponentData();\n\t\t\n\t\tif (parent)\n\t\t\treturn parent.getValue(name);\n\t\t\n\t\treturn this.componentClass._propertyTypesByName[name].initialValue;\n\t}\n\tcreateComponent() {\n\t\tlet properties = this.getInheritedProperties();\n\t\tlet values = {};\n\t\tproperties.forEach(prop => {\n\t\t\tvalues[prop.name] = prop.value;\n\t\t});\n\t\tlet component = Component.create(this.name, values);\n\t\tcomponent._componentId = this.componentId;\n\t\treturn component;\n\t}\n}\nSerializable.registerSerializable(ComponentData, 'cda', json => {\n\treturn new ComponentData(json.n, json.id, json.cid);\n});\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport Property from './property';\nimport PropertyOwner from './propertyOwner';\nimport { scene } from './scene';\nimport { game } from './game';\nexport { default as Prop } from './propertyType';\nexport let componentClasses = new Map();\nimport ComponentData from './componentData';\nimport * as performance from '../util/performance';\n\nconst eventListeners = [\n\t'onUpdate'\n\t,'onStart'\n];\n\n// Object of a component, see _componentExample.js\nexport class Component extends PropertyOwner {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\t\tthis._componentId = null; // Creator will fill this\n\t\tthis.scene = scene;\n\t\tthis.game = game;\n\t\tthis._listenRemoveFunctions = [];\n\t\tthis.entity = null;\n\t}\n\tmakeUpAName() {\n\t\treturn self.constructor.componentName;\n\t}\n\tdelete() {\n\t\t// Component.delete never returns false because entity doesn't have components as children\n\t\tthis._parent = null;\n\t\tthis.entity = null;\n\t\tsuper.delete();\n\t\treturn true;\n\t}\n\t_addEventListener(functionName) {\n\t\tlet func = this[functionName];\n\t\tlet self = this;\n\t\tlet performanceName = 'Component: ' + self.constructor.componentName;\n\t\tthis._listenRemoveFunctions.push(this.scene.listen(functionName, function() {\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tperformance.start(performanceName);\n\t\t\t// @endif\n\t\t\t\n\t\t\tfunc.apply(self, arguments);\n\t\t\t\n\t\t\t// @ifndef OPTIMIZE\n\t\t\tperformance.stop(performanceName);\n\t\t\t// @endif\n\t\t}));\n\t}\n\t// In preInit you can init the component with stuff that other components might want to use in init function\n\t// In preInit you can not trust that other components have been inited in any way\n\t_preInit() {\n\t\tthis.constructor.requirements.forEach(r => {\n\t\t\tthis[r] = this.entity.getComponent(r);\n\t\t\tassert(this[r], `${this.constructor.componentName} requires component ${r} but it is not found`);\n\t\t});\n\n\t\tthis.forEachChild('com', c => c._preInit());\n\n\t\tfor (let i = 0; i < eventListeners.length; ++i) {\n\t\t\tif (typeof this[eventListeners[i]] === 'function')\n\t\t\t\tthis._addEventListener(eventListeners[i]);\n\t\t}\n\t\t\n\t\tif (this.constructor.componentName !== 'Transform' && this.scene)\n\t\t\tthis.scene.addComponent(this);\n\t\t\n\t\ttry {\n\t\t\tif (typeof this.preInit === 'function')\n\t\t\t\tthis.preInit();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'preInit', e);\n\t\t}\n\t}\n\t// In preInit you can access other components and know that their preInit is done.\n\t_init() {\n\t\tthis.forEachChild('com', c => c._init());\n\t\ttry {\n\t\t\tif (typeof this.init === 'function')\n\t\t\t\tthis.init();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'init', e);\n\t\t}\n\t}\n\t_sleep() {\n\t\ttry {\n\t\t\tif (typeof this.sleep === 'function')\n\t\t\t\tthis.sleep();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'sleep', e);\n\t\t}\n\n\t\tif (this.constructor.componentName !== 'Transform' && this.scene)\n\t\t\tthis.scene.removeComponent(this);\n\t\t\n\t\tthis.forEachChild('com', c => c._sleep());\n\t\t\n\t\tthis._listenRemoveFunctions.forEach(f => f());\n\t\tthis._listenRemoveFunctions.length = 0;\n\t}\n\tlistenProperty(component, propertyName, callback) {\n\t\tthis._listenRemoveFunctions.push(component._properties[propertyName].listen('change', callback));\n\t}\n\tcreateComponentData() {\n\t\tlet componentName = this.constructor.componentName;\n\t\tlet propertyTypes = this.constructor._propertyTypes;\n\t\tlet componentData = new ComponentData(componentName);\n\t\tlet children = [];\n\t\tpropertyTypes.forEach(pt => {\n\t\t\tchildren.push(pt.createProperty({\n\t\t\t\tvalue: this[pt.name]\n\t\t\t}));\n\t\t});\n\t\tcomponentData.initWithChildren(children);\n\t\treturn componentData;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tn: this.constructor.componentName,\n\t\t\tcid: this._componentId\n\t\t});\n\t}\n}\nComponent.create = function(name, values = {}) {\n\tlet componentClass = componentClasses.get(name);\n\tassert(componentClass);\n\tlet component = new componentClass();\n\tcomponent.initWithPropertyValues(values);\n\treturn component;\n};\nComponent.createWithInheritedComponentData = function(inheritedComponentData) {\n\tlet component = new inheritedComponentData.componentClass;\n\tcomponent._componentId = inheritedComponentData.componentId;\n\tlet properties = inheritedComponentData.properties.map(p => p.clone());\n\tcomponent.initWithChildren(properties);\n\treturn component;\n};\n\nComponent.reservedPropertyNames = new Set(['id', 'constructor', 'delete', 'children', 'entity', 'env', 'init', 'preInit', 'sleep', 'toJSON', 'fromJSON']);\nComponent.reservedPrototypeMembers = new Set(['id', 'children', 'entity', 'env', '_preInit', '_init', '_sleep', '_forEachChildComponent', '_properties', '_componentData', 'toJSON', 'fromJSON']);\nComponent.register = function({\n\tname = '', // required\n\tdescription = '',\n\tcategory = 'Other',\n\ticon = 'fa-puzzle-piece', // in editor\n\tcolor = '', // in editor\n\tproperties = [],\n\trequirements = ['Transform'],\n\tchildren = [],\n\tparentClass = Component,\n\tprototype = {},\n\tallowMultiple = true,\n\trequiesInitWhenEntityIsEdited = false\n}) {\n\tassert(name, 'Component must have a name.');\n\tassert(name[0] >= 'A' && name[0] <= 'Z', 'Component name must start with capital letter.');\n\tassert(!componentClasses.has(name), 'Duplicate component class ' + name);\n\tObject.keys(prototype).forEach(k => {\n\t\tif (Component.reservedPrototypeMembers.has(k))\n\t\t\tassert(false, 'Component prototype can not have a reserved member: ' + k);\n\t});\n\t\n\tlet constructorFunction = prototype.constructor;\n\tlet deleteFunction = prototype.delete;\n\tdelete prototype.constructor;\n\tdelete prototype.delete;\n\tclass Com extends parentClass {\n\t\tconstructor() {\n\t\t\tsuper(...arguments);\n\t\t\tif (constructorFunction)\n\t\t\t\tconstructorFunction.call(this);\n\t\t}\n\t\tdelete() {\n\t\t\tif (!super.delete()) return false;\n\t\t\t\n\t\t\tif (deleteFunction)\n\t\t\t\tdeleteFunction.call(this);\n\t\t\t\n\t\t\treturn true;\n\t\t}\n\t}\n\tproperties.forEach(p => {\n\t\tassert(!Component.reservedPropertyNames.has(p.name), 'Can not have property called ' + p.name);\n\t});\n\tPropertyOwner.defineProperties(Com, properties); // properties means propertyTypes here\n\tCom.componentName = name;\n\tCom.category = category;\n\tif (requirements.indexOf('Transform') < 0) requirements.push('Transform');\n\tCom.requirements = requirements;\n\tCom.children = children;\n\tCom.description = description;\n\tCom.allowMultiple = allowMultiple;\n\tCom.icon = icon;\n\t\n\tlet num = name.split('').reduce((prev, curr) => prev + curr.charCodeAt(0), 0);\n\tCom.color = color || `hsla(${ num % 360 }, 40%, 60%, 1)`;\n\n\tprototype._name = name;\n\tObject.assign(Com.prototype, prototype);\n\tcomponentClasses.set(Com.componentName, Com);\n\treturn Com;\n};\n\nSerializable.registerSerializable(Component, 'com', json => {\n\tlet component = new (componentClasses.get(json.n))(json.id);\n\tcomponent._componentId = json.cid || null;\n\treturn component;\n});\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport * as performanceTool from '../util/performance';\n\nconst ALIVE_ERROR = 'entity is already dead';\n\nexport default class Entity extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\t\tthis.components = new Map(); // name -> array\n\t\tthis.sleeping = false;\n\t\tthis.prototype = null; // should be set immediately after constructor\n\t\tthis.localMaster = true; // set false if entity is controlled over the net\n\n\t\tperformanceTool.eventHappened('Create object');\n\t}\n\n\tmakeUpAName() {\n\t\tif (this.prototype) {\n\t\t\treturn this.prototype.makeUpAName();\n\t\t} else {\n\t\t\treturn 'Entity';\n\t\t}\n\t}\n\n\t// Get the first component of given name\n\tgetComponent(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tlet components = this.components.get(name);\n\t\tif (components !== undefined)\n\t\t\treturn components[0];\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// Get all components with given name\n\tgetComponents(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\treturn this.components.get(name) || [];\n\t}\n\n\tgetListOfAllComponents() {\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value);\n\t\t});\n\t\treturn components;\n\t}\n\n\tclone() {\n\t\tlet entity = new Entity();\n\t\tentity.prototype = this.prototype.clone();\n\t\tentity.sleeping = this.sleeping;\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value.map(c => c.clone()));\n\t\t});\n\t\tentity.addComponents(components);\n\t\treturn entity;\n\t}\n\n\t/*\n\tAdds multiple components as an array to this Entity.\n\tInitializes components after all components are added.\n\t*/\n\taddComponents(components, { fullInit = true } = {}) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tassert(Array.isArray(components), 'Parameter is not an array.');\n\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('add components for', this.makeUpAName());\n\n\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\tlet component = components[i];\n\t\t\tlet componentList = this.components.get(component._name) || this.components.set(component._name, []).get(component._name);\n\t\t\tcomponentList.push(component);\n\t\t\tcomponent.entity = this;\n\t\t\tcomponent._parent = this;\n\t\t\tcomponent.setRootType(this._rootType);\n\t\t}\n\n\t\tif (!this.sleeping) {\n\t\t\tEntity.preInitComponents(components);\n\t\t\tif (fullInit)\n\t\t\t\tEntity.initComponents(components);\n\t\t}\n\t\treturn this;\n\t}\n\n\tstatic preInitComponents(components) {\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING)  console.log('preInit components for', components[0].entity.makeUpAName());\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._preInit();\n\t}\n\t\n\tstatic initComponents(components) {\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING)  console.log(`init ${components.length} components for`, components[0].entity.makeUpAName());\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._init();\n\t}\n\n\tstatic makeComponentsSleep(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._sleep();\n\t}\n\n\tstatic deleteComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i].delete();\n\t}\n\n\tsleep() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (this.sleeping) return false;\n\n\t\tthis.components.forEach((value, key) => Entity.makeComponentsSleep(value));\n\n\t\tthis.sleeping = true;\n\t\treturn true;\n\t}\n\n\twakeUp() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (!this.sleeping) return false;\n\t\t\n\t\tthis.components.forEach((value, key) => Entity.preInitComponents(value));\n\t\tthis.components.forEach((value, key) => Entity.initComponents(value));\n\n\t\tthis.sleeping = false;\n\t\treturn true;\n\t}\n\n\tdelete() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tthis.sleep();\n\t\tif (!super.delete()) return false;\n\n\t\tthis.components.forEach((value, key) => Entity.deleteComponents(value));\n\t\tthis.components.clear();\n\n\t\tperformanceTool.eventHappened('Destroy object');\n\n\t\treturn true;\n\t}\n\n\tdeleteComponent(component) {\n\t\tlet array = this.getComponents(component.constructor.componentName);\n\t\tlet idx = array.indexOf(component);\n\t\tassert(idx >= 0);\n\t\tif (!this.sleeping)\n\t\t\tcomponent._sleep();\n\t\tcomponent.delete();\n\t\tarray.splice(idx, 1);\n\t\treturn this;\n\t}\n\n\tsetRootType(rootType) {\n\t\tif (this._rootType === rootType)\n\t\t\treturn;\n\n\t\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('entity added to tree', this.makeUpAName());\n\t\t\n\t\tsuper.setRootType(rootType);\n\t\t\n\t\tlet i;\n\t\tthis.components.forEach((value, key) => {\n\t\t\tfor (i = 0; i < value.length; ++i) {\n\t\t\t\tvalue[i].setRootType(rootType);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoJSON() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\n\t\tlet components = [];\n\t\tthis.components.forEach(compArray => {\n\t\t\tcompArray.forEach(comp => {\n\t\t\t\tcomponents.push(comp.toJSON());\n\t\t\t});\n\t\t});\n\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tc: components, // overwrite children. earlier this was named 'comp'\n\t\t\tproto: this.prototype.id\n\t\t});\n\t}\n}\nObject.defineProperty(Entity.prototype, 'position', {\n\tget() {\n\t\treturn this.getComponent('Transform').position;\n\t},\n\tset(position) {\n\t\tthis.getComponent('Transform').position = position;\n\t}\n});\n\nSerializable.registerSerializable(Entity, 'ent', json => {\n\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('creating entity from json', json);\n\tlet entity = new Entity(json.id);\n\tentity.prototype = getSerializable(json.proto);\n\tif (Entity.ENTITY_CREATION_DEBUGGING) console.log('created entity from json', entity);\n\tif (json.comp) {\n\t\tentity.addComponents((json.c || json.comp).map(Serializable.fromJSON));\n\t}\n\treturn entity;\n});\n\nEntity.ENTITY_CREATION_DEBUGGING = false;\n","import Prototype from './prototype';\nimport Property from './property';\nimport Serializable from './serializable';\nimport { getSerializable } from './serializableManager';\nimport { Prop, componentClasses } from './component';\nimport ComponentData from './componentData';\nimport assert from '../util/assert';\nimport Vector from '../util/vector';\nimport EntityPrototype from \"./entityPrototype\";\n\n// Prefab is an EntityPrototype that has been saved to a prefab.\nexport default class Prefab extends Prototype {\n\tconstructor(predefinedId = false) {\n\t\tsuper(...arguments);\n\t}\n\n\tmakeUpAName() {\n\t\tlet nameProperty = this.findChild('prp', property => property.name === 'name');\n\t\treturn nameProperty && nameProperty.value || 'Prefab';\n\t}\n\n\tcreateEntity() {\n\t\treturn EntityPrototype.createFromPrototype(this).createEntity();\n\t}\n\n\tgetParentPrototype() {\n\t\treturn null;\n\t}\n\n\t// Do not use EntityPrototype optimization\n\t// This is only needed if Prefab would extend EntityPrototype instead of Prototype\n\t// toJSON() {\n\t// \treturn Serializable.prototype.toJSON.apply(this, arguments);\n\t// }\n\n\t// This is only needed if Prefab would extend EntityPrototype instead of Prototype\n\t// clone() {\n\t// \treturn Serializable.prototype.clone.apply(this, arguments);\n\t// }\n}\n\n/*\nfilter filters component datas\n\nReturns JSON:\n[\n\t{\n\t\townComponent: false, // component of a parent prototype\n\t\tcomponentClass: [object Object],\n\t\tcomponentId: <componentId>,\n\t\tthreeLetterType: 'icd',\n\t\t generatedForPrototype: <this>,\n\t\tproperties: [\n\t\t\t{ id missing }\n\t\t]\n\t},\n\t{\n\t\t ownComponentData: <ComponentData> || null, // null if this prototype has 0 properties defined\n\t\t componentClass: [object Object],\n\t\t componentId: <componentId>,\n\t\t threeLetterType: 'icd',\n\t\t generatedForPrototype: <this>,\n\t\t properties: [\n\t\t\t { id found if own property } // some properties might be from parent prototypes and thus missing id\n\t\t ]\n\t }\n]\n */\n\n\n\n\n// Meant for entityPrototypes, but works theoretically for prototypes\nPrefab.createFromPrototype = function(prototype) {\n\tlet inheritedComponentDatas = prototype.getInheritedComponentDatas();\n\tlet children = inheritedComponentDatas.map(icd => {\n\t\treturn new ComponentData(icd.componentClass.componentName, null, icd.componentId)\n\t\t\t.initWithChildren(icd.properties.map(prp => prp.clone()));\n\t});\n\t\n\tchildren.push(prototype._properties.name.clone());\n\t\n\tlet prefab = new Prefab().initWithChildren(children);\n\t\n\t// Don't just prototype.makeUpAName() because it might give you \"Prototype\" or \"EntityPrototype\". Checking them would be a hack.\n\tprefab.name = prototype.name || prototype.prototype && prototype.prototype.makeUpAName() || 'Prefab';\n\treturn prefab;\n};\n\nSerializable.registerSerializable(Prefab, 'pfa');\n","import Serializable from './serializable';\nimport PropertyOwner, { Prop } from '../core/propertyOwner';\nimport Scene, { scene } from './scene';\nimport events from \"../util/events\";\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Level extends PropertyOwner {\n\tconstructor(predefinedId) {\n\t\tsuper(...arguments);\n\t}\n\tcreateScene(predefinedSceneObject = false) {\n\t\tif (!predefinedSceneObject)\n\t\t\tnew Scene();\n\t\t\n\t\tscene.loadLevel(this);\n\t\t\n\t\treturn scene;\n\t}\n\tisEmpty() {\n\t\treturn this.getChildren('epr').length === 0;\n\t}\n\t\n\t/*\n\tOPTIMIZATION DOES NOT WORK, YET\n\ttoJSON() {\n\t\tlet json = super.toJSON();\n\t\tconsole.log('before', json);\n\t\tif (json.c) {\n\t\t\tlet prototypeIds = new Set();\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tconsole.log('child', child);\n\t\t\t\tprototypeIds.add(child.p);\n\t\t\t});\n\t\t\t\n\t\t\tlet prototypeIdToNum = {};\n\t\t\tlet prototypeIdArray = [];\n\t\t\tlet num = 0;\n\t\t\tprototypeIds.forEach(key => {\n\t\t\t\tprototypeIdArray[num] = key;\n\t\t\t\tprototypeIdToNum[key] = num++;\n\t\t\t});\n\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tchild.p = prototypeIdToNum[child.p] || child.p;\n\t\t\t});\n\t\t\t\n\t\t\tjson.p = prototypeIdArray;\n\n\t\t\tconsole.log(json, prototypeIds, prototypeIdToNum, prototypeIdArray);\n\t\t}\n\t\treturn json;\n\t}\n\t*/\n}\nPropertyOwner.defineProperties(Level, propertyTypes);\n\nSerializable.registerSerializable(Level, 'lvl');\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport {default as PIXI} from '../features/graphics';\n\nComponent.register({\n\tname: 'Transform',\n\ticon: 'fa-dot-circle-o',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('position', new Vector(0, 0), Prop.vector),\n\t\tProp('scale', new Vector(1, 1), Prop.vector),\n\t\tProp('angle', 0, Prop.float, Prop.float.modulo(0, Math.PI * 2), Prop.flagDegreesInEditor)\n\t],\n\tprototype: {\n\t\tconstructor() {\n\t\t\tthis.layer = this.scene.layers.main;\n\t\t},\n\t\tpreInit() {\n\t\t\tthis.container = new PIXI.Container();\n\t\t\tthis.container._debug = this.entity.makeUpAName() + ' ' + this.name;\n\t\t\tthis.container.position.set(this.position.x, this.position.y);\n\t\t\tthis.container.scale.set(this.scale.x, this.scale.y);\n\t\t\tthis.container.rotation = this.angle;\n\t\t},\n\t\tinit() {\n\t\t\tlet parentTransform = this.getParentTransform();\n\t\t\tif (parentTransform) {\n\t\t\t\tparentTransform.container.addChild(this.container);\n\t\t\t\tparentTransform.listen('globalTransformChanged', () => {\n\t\t\t\t\tthis.dispatch('globalTransformChanged', this);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.layer.addChild(this.container);\n\t\t\t}\n\t\t\t\n\t\t\t// Optimize this. Shouldn't be called multiple times per frame.\n\t\t\tlet change = () => {\n\t\t\t\tthis.dispatch('globalTransformChanged', this);\n\t\t\t};\n\n\t\t\tthis.listenProperty(this, 'position', position => {\n\t\t\t\tthis.container.position.set(position.x, position.y);\n\t\t\t\tchange();\n\t\t\t});\n\t\t\tthis.listenProperty(this, 'angle', angle => {\n\t\t\t\tthis.container.rotation = angle;\n\t\t\t\tchange();\n\t\t\t});\n\t\t\tthis.listenProperty(this, 'scale', scale => {\n\t\t\t\tthis.container.scale.set(scale.x, scale.y);\n\t\t\t\tchange();\n\t\t\t});\n\t\t\t// change();\n\t\t},\n\t\tgetParentTransform() {\n\t\t\tif (this.parentTransform !== undefined)\n\t\t\t\treturn this.parentTransform;\n\t\t\t\n\t\t\tlet parentEntity = this.entity.getParent();\n\t\t\tif (parentEntity && parentEntity.threeLetterType === 'ent')\n\t\t\t\tthis.parentTransform = parentEntity.getComponent('Transform');\n\t\t\telse\n\t\t\t\tthis.parentTransform = null;\n\t\t\t\n\t\t\treturn this.parentTransform;\n\t\t},\n\t\tgetGlobalPosition() {\n\t\t\treturn Vector.fromObject(this.layer.toLocal(zeroPoint, this.container, tempPoint));\n\t\t},\n\t\tgetGlobalAngle() {\n\t\t\tlet angle = this.angle;\n\t\t\tlet parent = this.getParentTransform();\n\t\t\twhile (parent) {\n\t\t\t\tangle += parent.angle;\n\t\t\t\tparent = parent.getParentTransform();\n\t\t\t}\n\t\t\treturn angle;\n\t\t},\n\t\tsetGlobalPosition(position) {\n\t\t\tthis.position = position.set(this.container.parent.toLocal(position, this.layer, tempPoint));\n\t\t},\n\t\tsleep() {\n\t\t\tthis.container.destroy();\n\t\t\tthis.container = null;\n\t\t\t\n\t\t\tdelete this.parentTransform;\n\t\t}\n\t\t\n\t}\n});\n\nlet zeroPoint = new PIXI.Point();\nlet tempPoint = new PIXI.Point();\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'TransformVariance',\n\tcategory: 'Logic',\n\tdescription: `Adds random factor to object's transform/orientation.`,\n\ticon: 'fa-dot-circle-o',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('positionVariance', new Vector(0, 0), Prop.vector),\n\t\tProp('scaleVariance', new Vector(0, 0), Prop.vector),\n\t\tProp('angleVariance', 0, Prop.float, Prop.float.range(0, Math.PI), Prop.flagDegreesInEditor)\n\t],\n\tprototype: {\n\t\tonStart() {\n\t\t\tif (!this.positionVariance.isZero())\n\t\t\t\tthis.Transform.position = this.Transform.position.add(this.positionVariance.clone().multiplyScalar(-1 + 2 * Math.random()));\n\n\t\t\tif (!this.scaleVariance.isZero())\n\t\t\t\tthis.Transform.scale = this.Transform.scale.add(this.scaleVariance.clone().multiplyScalar(Math.random()));\n\t\t\t\n\t\t\tif (this.angleVariance)\n\t\t\t\tthis.Transform.angle += this.angleVariance * (-1 + 2 * Math.random());\n\t\t}\n\t}\n});\n","import {Component, Prop} from '../core/component';\nimport Vector from '../util/vector';\nimport {Color} from '../util/color';\nimport {default as PIXI, generateTextureAndAnchor, getHashedTextureAndAnchor} from '../features/graphics';\n\nComponent.register({\n\tname: 'Shape',\n\tcategory: 'Graphics',\n\ticon: 'fa-stop',\n\tallowMultiple: true,\n\tdescription: 'Draws shape on the screen.',\n\tproperties: [\n\t\tProp('type', 'rectangle', Prop.enum, Prop.enum.values('rectangle', 'circle', 'convex')),\n\t\tProp('radius', 20, Prop.float, Prop.visibleIf('type', ['circle', 'convex'])),\n\t\tProp('size', new Vector(20, 20), Prop.vector, Prop.visibleIf('type', 'rectangle')),\n\t\tProp('points', 3, Prop.int, Prop.int.range(3, 16), Prop.visibleIf('type', 'convex')),\n\t\tProp('topPointDistance', 0.5, Prop.float, Prop.float.range(0.001, 1), Prop.visibleIf('type', 'convex'), 'Only works with at most 8 points'), // Value 0\n\t\tProp('fillColor', new Color(222, 222, 222), Prop.color),\n\t\tProp('borderColor', new Color(255, 255, 255), Prop.color),\n\t\tProp('borderWidth', 1, Prop.float, Prop.float.range(0, 30))\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\tthis.initSprite();\n\n\t\t\tthis.Transform.listen('globalTransformChanged', transform => {\n\t\t\t\t/*\n\t\t\t\tthis.sprite.x = transform.globalPosition.x;\n\t\t\t\tthis.sprite.y = transform.globalPosition.y;\n\t\t\t\t\n\t\t\t\t// rotation setter function has a function call. lets optimize.\n\t\t\t\tif (this.sprite.rotation !== transform.globalAngle)\n\t\t\t\t\tthis.sprite.rotation = transform.globalAngle;\n\t\t\t\t\n\t\t\t\tthis.sprite.scale.set(transform.globalScale.x, transform.globalScale.y);\n\t\t\t\t*/\n\t\t\t});\n\t\t\t\n\t\t\t/*\n\t\t\tthis.listenProperty(this.Transform, 'position', position => {\n\t\t\t\tthis.sprite.x = position.x;\n\t\t\t\tthis.sprite.y = position.y;\n\t\t\t});\n\n\t\t\tthis.listenProperty(this.Transform, 'angle', angle => {\n\t\t\t\tthis.sprite.rotation = angle;\n\t\t\t});\n\t\t\t*/\n\n\t\t\tlet redrawGraphics = () => {\n\t\t\t\tthis.updateTexture();\n\t\t\t};\n\t\t\t\n\t\t\t// this.listenProperty(this.Transform, 'scale', redrawGraphics);\n\t\t\t\n\t\t\tlet propertiesThatRequireRedraw = [\n\t\t\t\t'type',\n\t\t\t\t'radius',\n\t\t\t\t'size',\n\t\t\t\t'fillColor',\n\t\t\t\t'borderColor',\n\t\t\t\t'borderWidth',\n\t\t\t\t'points',\n\t\t\t\t'topPointDistance'\n\t\t\t];\n\n\t\t\tpropertiesThatRequireRedraw.forEach(propName => {\n\t\t\t\tthis.listenProperty(this, propName, redrawGraphics);\n\t\t\t});\n\t\t},\n\t\tinitSprite() {\n\t\t\tlet textureAndAnchor = this.getTextureAndAnchor();\n\t\t\tthis.sprite = new PIXI.Sprite(textureAndAnchor.texture);\n\t\t\tthis.sprite.anchor.set(textureAndAnchor.anchor.x, textureAndAnchor.anchor.y);\n\n\t\t\tthis.Transform.container.addChild(this.sprite);\n\t\t},\n\t\tupdateTexture() {\n\t\t\tlet textureAndAnchor = this.getTextureAndAnchor();\n\t\t\tthis.sprite.texture = textureAndAnchor.texture;\n\t\t\tthis.sprite.anchor.set(textureAndAnchor.anchor.x, textureAndAnchor.anchor.y);\n\t\t},\n\t\tgetTextureAndAnchor() {\n\t\t\tlet hash = this.createPropertyHash();// + this.Transform.scale;\n\t\t\tlet textureAndAnchor = getHashedTextureAndAnchor(hash);\n\t\t\t\n\t\t\tif (!textureAndAnchor) {\n\t\t\t\tlet graphics = this.createGraphics();\n\t\t\t\ttextureAndAnchor = generateTextureAndAnchor(graphics, hash);\n\t\t\t\tgraphics.destroy();\n\t\t\t}\n\t\t\treturn textureAndAnchor;\n\t\t},\n\t\tcreateGraphics() {\n\t\t\tlet scale = new Vector(1, 1);// this.Transform.scale;\n\t\t\tlet graphics = new PIXI.Graphics();\n\t\t\t\n\t\t\tif (this.type === 'rectangle') {\n\t\t\t\tlet\n\t\t\t\t\tx = -this.size.x / 2 * scale.x,\n\t\t\t\t\ty = -this.size.y / 2 * scale.y,\n\t\t\t\t\tw = this.size.x * scale.x,\n\t\t\t\t\th = this.size.y * scale.y;\n\n\t\t\t\tgraphics.lineStyle(this.borderWidth, this.borderColor.toHexNumber(), 1);\n\t\t\t\tgraphics.beginFill(this.fillColor.toHexNumber());\n\t\t\t\tgraphics.drawRect(x, y, w, h);\n\t\t\t\tgraphics.endFill();\n\t\t\t} else if (this.type === 'circle') {\n\t\t\t\tlet averageScale = (scale.x + scale.y) / 2;\n\t\t\t\t\n\t\t\t\tgraphics.lineStyle(this.borderWidth, this.borderColor.toHexNumber(), 1);\n\t\t\t\tgraphics.beginFill(this.fillColor.toHexNumber());\n\t\t\t\tgraphics.drawCircle(0, 0, this.radius * averageScale);\n\t\t\t\tgraphics.endFill();\n\t\t\t} else if (this.type === 'convex') {\n\t\t\t\tlet path = this.getConvexPoints(PIXI.Point, false);\n\t\t\t\tpath.push(path[0]); // Close the path\n\t\t\t\t\n\t\t\t\tgraphics.lineStyle(this.borderWidth, this.borderColor.toHexNumber(), 1);\n\t\t\t\tgraphics.beginFill(this.fillColor.toHexNumber());\n\t\t\t\tgraphics.drawPolygon(path);\n\t\t\t\tgraphics.endFill();\n\t\t\t}\n\t\t\t\n\t\t\treturn graphics;\n\t\t},\n\t\tgetConvexPoints(vectorClass = Vector, takeScaleIntoAccount = true) {\n\t\t\tconst centerAngle = Math.PI * 2 / this.points;\n\t\t\tconst isNotEventPolygon = this.topPointDistance !== 0.5 && this.points <= 8;\n\t\t\t\n\t\t\tlet minDistanceMultiplier;\n\t\t\tlet maxDistanceMultiplier;\n\t\t\tif (isNotEventPolygon) {\n\t\t\t\tconst segmentAngle = Math.PI - centerAngle;\n\t\t\t\tconst unitSegmentLength = 2 * Math.sin(centerAngle / 2);\n\t\t\t\tconst defaultMinDistanceMultiplier = 1 - unitSegmentLength * Math.cos(segmentAngle / 2);\n\n\t\t\t\tif (this.points === 3) {\n\t\t\t\t\tminDistanceMultiplier = 0.2;\n\t\t\t\t\tmaxDistanceMultiplier = 5;\n\t\t\t\t} else if (this.points === 8) {\n\t\t\t\t\tminDistanceMultiplier = defaultMinDistanceMultiplier;\n\t\t\t\t\tmaxDistanceMultiplier = 3;\n\t\t\t\t} else {\n\t\t\t\t\tminDistanceMultiplier = defaultMinDistanceMultiplier;\n\t\t\t\t\tmaxDistanceMultiplier = 5;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet path = [];\n\n\t\t\tlet currentAngle = 0;\n\t\t\tfor (let i = 0; i < this.points; ++i) {\n\t\t\t\tlet x = Math.sin(currentAngle) * this.radius;\n\t\t\t\tlet y = Math.cos(currentAngle) * this.radius;\n\n\t\t\t\tif (isNotEventPolygon && i === 0) {\n\t\t\t\t\tif (this.topPointDistance > 0.5) {\n\t\t\t\t\t\ty *= 1 + (this.topPointDistance - 0.5) * (maxDistanceMultiplier - 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ty *= 2 * this.topPointDistance * (1 - minDistanceMultiplier) + minDistanceMultiplier;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tpath.push(new vectorClass(x, -y));\n\t\t\t\tcurrentAngle += centerAngle;\n\t\t\t}\n\t\t\tif (isNotEventPolygon) {\n\t\t\t\t// put weight to center\n\t\t\t\tlet averageY = path.reduce((prev, curr) => prev + curr.y, 0) / this.points;\n\t\t\t\tpath.forEach(p => p.y -= averageY);\n\t\t\t}\n\n\t\t\tif (takeScaleIntoAccount) {\n\t\t\t\tconst scale = this.Transform.scale;\n\t\t\t\tif (scale.x !== 1 || scale.y !== 1) {\n\t\t\t\t\tpath.forEach(p => {\n\t\t\t\t\t\tp.x *= scale.x;\n\t\t\t\t\t\tp.y *= scale.y;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn path;\n\t\t},\n\t\tsleep() {\n\t\t\tthis.sprite.destroy();\n\t\t\tthis.sprite = null;\n\t\t}\n\t}\n});\n","import {Component, Prop} from '../core/component';\nimport Vector from '../util/vector';\nimport {Color} from '../util/color';\nimport {default as PIXI, generateTextureAndAnchor, getHashedTextureAndAnchor} from '../features/graphics';\n\nComponent.register({\n\tname: 'Sprite',\n\tcategory: 'Graphics',\n\ticon: 'fa-stop',\n\tallowMultiple: true,\n\tdescription: 'Draws a sprite on the screen.',\n\tproperties: [\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\tthis.initSprite();\n\n\t\t\tthis.listenProperty(this.Transform, 'position', position => {\n\t\t\t\t// this.sprite.x = position.x;\n\t\t\t\t// this.sprite.y = position.y;\n\t\t\t});\n\n\t\t\tthis.listenProperty(this.Transform, 'angle', angle => {\n\t\t\t\t// this.sprite.rotation = angle;\n\t\t\t});\n\n\t\t\tthis.listenProperty(this.Transform, 'scale', scale => {\n\t\t\t\t// this.sprite.scale.x = scale.x;\n\t\t\t\t// this.sprite.scale.y = scale.y;\n\t\t\t});\n\t\t},\n\t\tinitSprite() {\n\t\t\tthis.sprite = PIXI.Sprite.fromImage('/img/sprite.png');\n\t\t\tthis.sprite.anchor.set(0.5, 0.5);\n\t\t\t\n\t\t\tlet T = this.Transform;\n\n\t\t\t// this.sprite.x = T.position.x;\n\t\t\t// this.sprite.y = T.position.y;\n\t\t\t// this.sprite.rotation = T.angle;\n\t\t\t// this.sprite.scale.x = T.scale.x;\n\t\t\t// this.sprite.scale.y = T.scale.y;\n\n\t\t\tthis.scene.layers.main.addChild(this.sprite);\n\t\t},\n\t\tsleep() {\n\t\t\tthis.sprite.destroy();\n\t\t\tthis.sprite = null;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport EntityPrototype from '../core/entityPrototype';\n\nComponent.register({\n\tname: 'Spawner',\n\tcategory: 'Logic',\n\tdescription: 'Spawns types to world.',\n\tproperties: [\n\t\tProp('typeName', '', Prop.string),\n\t\tProp('trigger', 'start', Prop.enum, Prop.enum.values('start', 'interval')),\n\t\tProp('interval', 10, Prop.float, Prop.float.range(0.1, 1000000), Prop.visibleIf('trigger', 'interval'), 'Interval in seconds')\n\t],\n\tprototype: {\n\t\tconstructor() {\n\t\t\tthis.lastSpawn = 0;\n\t\t},\n\t\tinit() {\n\t\t\tthis.lastSpawn = this.scene.time;\n\t\t},\n\t\tonStart() {\n\t\t\tif (this.trigger === 'start')\n\t\t\t\tthis.spawn();\n\t\t},\n\t\tonUpdate() {\n\t\t\tif (this.scene.time > this.lastSpawn + this.interval)\n\t\t\t\tthis.spawn();\n\t\t},\n\t\tonDrawHelper(context) {\n\t\t\tlet size = 30;\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - size * this.Transform.scale.x/2,\n\t\t\t\ty = this.Transform.position.y - size * this.Transform.scale.y/2,\n\t\t\t\tw = size * this.Transform.scale.x,\n\t\t\t\th = size * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = 'blue';\n\t\t\tcontext.strokeStyle = 'white';\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.font = '40px FontAwesome';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.fillText('\\uF21D', this.Transform.position.x + 2, this.Transform.position.y);\n\t\t\tcontext.strokeText('\\uf21d', this.Transform.position.x + 2, this.Transform.position.y);\n\t\t\t\n\t\t\tcontext.restore();\n\t\t},\n\t\tspawn() {\n\t\t\tlet prototype = this.game.findChild('prt', prt => prt.name === this.typeName, true);\n\t\t\tif (!prototype)\n\t\t\t\treturn;\n\n\t\t\tlet entityPrototype = EntityPrototype.createFromPrototype(prototype);\n\t\t\tentityPrototype.spawnEntityToScene(this.scene, this.Transform.position);\n\t\t\tentityPrototype.delete();\n\t\t\tthis.lastSpawn = this.scene.time;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Trigger',\n\tdescription: 'When _ then _.',\n\tcategory: 'Logic',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('trigger', 'playerComesNear', Prop.enum, Prop.enum.values('playerComesNear')),\n\t\tProp('radius', 40, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('trigger', 'playerComesNear')),\n\t\tProp('action', 'win', Prop.enum, Prop.enum.values('win'))\n\t],\n\tprototype: {\n\t\tpreInit() {\n\t\t\tthis.storeProp = `__Trigger_${this._componentId}`;\n\t\t},\n\t\tonUpdate() {\n\t\t\tif (this.trigger === 'playerComesNear') {\n\t\t\t\tlet componentSet = this.scene.getComponents('CharacterController');\n\t\t\t\tlet entities = [];\n\t\t\t\tcomponentSet.forEach(c => entities.push(c.entity));\t\n\t\t\t\tlet distSq = this.radius * this.radius;\n\t\t\t\tlet pos = this.Transform.position;\n\t\t\t\tfor (let i = 0; i < entities.length; ++i) {\n\t\t\t\t\tif (entities[i].position.distanceSq(pos) < distSq) {\n\t\t\t\t\t\tif (!entities[i][this.storeProp] && this.launchTrigger(entities[i]) !== false)\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tentities[i][this.storeProp] = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentities[i][this.storeProp] = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Return false if other triggers should not be checked\n\t\t// Note: check this return false logic. Looks weird.\n\t\tlaunchTrigger(entity) {\n\t\t\tif (this.action === 'win') {\n\t\t\t\tthis.scene.win();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport p2, { addBody, deleteBody, createMaterial, getWorld } from '../features/physics';\nimport assert from '../util/assert';\n\nconst PHYSICS_SCALE = 1/50;\nexport { PHYSICS_SCALE };\nconst PHYSICS_SCALE_INV = 1/PHYSICS_SCALE;\n\nconst DENSITY_SCALE = 3/10;\n\nconst type = {\n\tdynamic: p2.Body.DYNAMIC,\n\tkinematic: p2.Body.KINEMATIC,\n\tstatic: p2.Body.STATIC\n};\n\nconst SLEEPING = p2.Body.SLEEPING;\nconst STATIC = p2.Body.STATIC;\n\nComponent.register({\n\tname: 'Physics',\n\tcategory: 'Dynamics',\n\tdescription: 'Forms physical rules for <span style=\"color: #84ce84;\">Shapes</span>.',\n\ticon: 'fa-stop',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('type', 'dynamic', Prop.enum, Prop.enum.values('dynamic', 'static')),\n\t\tProp('density', 1, Prop.float, Prop.float.range(0, 100), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('drag', 0.1, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('rotationalDrag', 0.1, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('bounciness', 0, Prop.float, Prop.float.range(0, 1)),\n\t\tProp('friction', 0.1, Prop.float, Prop.float.range(0, 1))\n\t],\n\trequirements: [\n\t\t'Shape'\n\t],\n\trequiesInitWhenEntityIsEdited: true,\n\tprototype: {\n\t\tinited: false,\n\t\tinit() {\n\t\t\tthis.inited = true;\n\t\t\tlet update = callback => {\n\t\t\t\treturn value => {\n\t\t\t\t\tif (!this.updatingOthers && this.body) {\n\t\t\t\t\t\tcallback(value);\n\t\t\t\t\t\tif (this.type === 'dynamic')\n\t\t\t\t\t\t\tthis.body.wakeUp();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlet Shapes = this.entity.getComponents('Shape');\n\t\t\tconst shapePropertiesThatShouldUpdateShape = [\n\t\t\t\t'type',\n\t\t\t\t'size',\n\t\t\t\t'radius',\n\t\t\t\t'points',\n\t\t\t\t'topPointDistance'\n\t\t\t];\n\t\t\tfor (let i = 0; i < Shapes.length; ++i) {\n\t\t\t\tshapePropertiesThatShouldUpdateShape.forEach(property => {\n\t\t\t\t\tthis.listenProperty(Shapes[i], property, update(() => this.updateShape()));\t\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.listenProperty(this.Transform, 'position', update(position => {\n\t\t\t\tthis.body.position = position.toArray().map(x => x * PHYSICS_SCALE);\n\t\t\t\tthis.body.updateAABB();\n\t\t\t}));\n\t\t\tthis.listenProperty(this.Transform, 'angle', update(angle => {\n\t\t\t\tthis.body.angle = angle;\n\t\t\t\tthis.body.updateAABB();\n\t\t\t}));\n\t\t\tthis.listenProperty(this.Transform, 'scale', update(scale => this.updateShape()));\n\t\t\tthis.listenProperty(this, 'density', update(density => {\n\t\t\t\tthis.body.setDensity(density * DENSITY_SCALE);\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'friction', update(friction => this.updateMaterial()));\n\t\t\tthis.listenProperty(this, 'drag', update(drag => this.body.damping = drag));\n\t\t\tthis.listenProperty(this, 'rotationalDrag', update(rotationalDrag => {\n\t\t\t\tthis.body.angularDamping = rotationalDrag > 0.98 ? 1 : rotationalDrag;\n\t\t\t\tthis.body.fixedRotation = rotationalDrag === 1;\n\t\t\t\tthis.body.updateMassProperties();\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'type', update(type => {\n\t\t\t\tthis.body.type = type[this.type];\n\t\t\t\tthis.entity.sleep();\n\t\t\t\tthis.entity.wakeUp();\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'bounciness', update(bounciness => this.updateMaterial()));\n\n\t\t\tif (this._rootType)\n\t\t\t\tthis.createBody();\n\t\t},\n\t\tcreateBody() {\n\t\t\tassert(!this.body);\n\t\t\t\n\t\t\tthis.body = new p2.Body({\n\t\t\t\ttype: type[this.type],\n\t\t\t\tposition: [this.Transform.position.x * PHYSICS_SCALE, this.Transform.position.y * PHYSICS_SCALE],\n\t\t\t\tangle: this.Transform.angle,\n\t\t\t\tvelocity: [0, 0],\n\t\t\t\tangularVelocity: 0,\n\t\t\t\tsleepTimeLimit: 0.6,\n\t\t\t\tsleepSpeedLimit: 0.3,\n\t\t\t\tdamping: this.drag,\n\t\t\t\tangularDamping: this.rotationalDrag > 0.98 ? 1 : this.rotationalDrag,\n\t\t\t\tfixedRotation: this.rotationalDrag === 1\n\t\t\t});\n\t\t\tthis.updateShape();\n\n\t\t\tthis.body.entity = this.entity;\n\t\t\t\n\t\t\taddBody(this.scene, this.body);\n\t\t},\n\t\tupdateShape() {\n\t\t\tif (this.body.shapes.length > 0) {\n\t\t\t\t// We update instead of create.\n\t\t\t\t// Should remove existing shapes\n\t\t\t\t\n\t\t\t\t// The library does not support updating shapes during the step.\n\t\t\t\tlet world = getWorld(this.scene);\n\t\t\t\tassert(!world.stepping);\n\t\t\t\t\n\t\t\t\tlet shapes = this.body.shapes;\n\t\t\t\tfor (let i = 0; i < shapes.length; ++i) {\n\t\t\t\t\tshapes[i].body = null;\n\t\t\t\t}\n\t\t\t\tshapes.length = 0;\n\t\t\t}\n\n\t\t\tlet Shapes = this.entity.getComponents('Shape');\n\t\t\tlet scale = this.Transform.scale;\n\n\t\t\tShapes.forEach(Shape => {\n\t\t\t\tlet shape;\n\t\t\t\t\n\t\t\t\tif (Shape.type === 'rectangle') {\n\t\t\t\t\tshape = new p2.Box({\n\t\t\t\t\t\twidth: Shape.size.x * PHYSICS_SCALE * scale.x,\n\t\t\t\t\t\theight: Shape.size.y * PHYSICS_SCALE * scale.y\n\t\t\t\t\t});\n\t\t\t\t} else if (Shape.type === 'circle') {\n\t\t\t\t\tlet averageScale = (scale.x + scale.y) / 2;\n\t\t\t\t\t\n\t\t\t\t\tshape = new p2.Circle({\n\t\t\t\t\t\tradius: Shape.radius * PHYSICS_SCALE * averageScale\n\t\t\t\t\t});\n\t\t\t\t} else if (Shape.type === 'convex') {\n\t\t\t\t\tshape = new p2.Convex({\n\t\t\t\t\t\tvertices: Shape.getConvexPoints().map(p => ([p.x * PHYSICS_SCALE, p.y * PHYSICS_SCALE]))\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (shape)\n\t\t\t\t\tthis.body.addShape(shape);\n\t\t\t});\n\t\t\t\n\t\t\tthis.updateMass();\n\t\t\tthis.updateMaterial();\n\t\t},\n\t\tupdateMaterial() {\n\t\t\tlet material = createMaterial(this.scene, {\n\t\t\t\tfriction: this.friction,\n\t\t\t\trestitution: this.bounciness,\n\t\t\t\t// stiffness: 1e6,\n\t\t\t\t// relaxation: 4,\n\t\t\t\t// frictionStiffness: 1e6,\n\t\t\t\t// frictionRelaxation: 4,\n\t\t\t\t// surfaceVelocity: 0\n\t\t\t});\n\t\t\tthis.body.shapes.forEach(s => s.material = material);\n\t\t},\n\t\tupdateMass() {\n\t\t\tif (this.type === 'dynamic')\n\t\t\t\tthis.body.setDensity(this.density * DENSITY_SCALE);\n\t\t},\n\t\tsetRootType(rootType) {\n\t\t\tif (rootType) {\n\t\t\t\tif (this.inited)\n\t\t\t\t\tthis.createBody();\n\t\t\t}\n\t\t\treturn Component.prototype.setRootType.call(this, rootType);\n\t\t},\n\t\tonUpdate() {\n\t\t\tlet b = this.body;\n\t\t\tif (!b || b.sleepState === SLEEPING || b.type === STATIC)\n\t\t\t\treturn;\n\t\t\t\n\t\t\tthis.updatingOthers = true;\n\t\t\t\n\t\t\tlet newPos = new Vector(b.position[0] * PHYSICS_SCALE_INV, b.position[1] * PHYSICS_SCALE_INV);\n\t\t\tif (!this.Transform.position.isEqualTo(newPos))\n\t\t\t\tthis.Transform.position = newPos;\n\t\t\t\n\t\t\tif (this.Transform.angle !== b.angle)\n\t\t\t\tthis.Transform.angle = b.angle;\n\t\t\t\n\t\t\tthis.updatingOthers = false;\n\t\t},\n\t\tsleep() {\n\t\t\tif (this.body) {\n\t\t\t\tdeleteBody(this.scene, this.body);\n\t\t\t\tthis.body = null;\n\t\t\t}\n\t\t\tthis.inited = false;\n\t\t},\n\t\tgetMass() {\n\t\t\treturn this.body.mass;\n\t\t},\n\t\tapplyForce(forceVector) {\n\t\t\tthis.body.applyForce(forceVector.toArray());\n\t\t\tthis.body.wakeUp();\n\t\t},\n\t\tsetAngularForce(force) {\n\t\t\tthis.body.angularForce = force;\n\t\t\tthis.body.wakeUp();\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\n\n// Export so that other components can have this component as parent\nexport default Component.register({\n\tname: 'Lifetime',\n\tdescription: 'Set the object to be destroyed after a time period',\n\tcategory: 'Logic', // You can also make up new categories.\n\ticon: 'fa-bars', // Font Awesome id\n\trequirements: ['Transform'], // These shared components are autofilled. Error if component is not found.\n\tproperties: [\n\t\tProp('lifetime', 3, Prop.float, Prop.float.range(0.01, 1000), 'Life time seconds')\n\t],\n\tparentClass: Component,\n\tprototype: {\n\t\tonUpdate() {\n\t\t\tlet lifetime = this.scene.time - this.startTime;\n\t\t\tif (lifetime >= this.lifetime) {\n\t\t\t\tif (this.entity)\n\t\t\t\t\tthis.entity.delete();\n\t\t\t}\n\t\t},\n\t\tinit() {\n\t\t\tthis.startTime = this.scene.time;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport { key, keyPressed, listenKeyDown } from '../util/input';\nimport assert from '../util/assert'\nimport Vector from '../util/vector';\nimport { getWorld, default as p2 } from '../features/physics';\nimport {PHYSICS_SCALE} from './Physics'\nimport { absLimit } from '../util/algorithm';\n\nconst JUMP_SAFE_DELAY = 0.1; // seconds\n\nComponent.register({\n\tname: 'CharacterController',\n\tdescription: 'Lets user control the object.',\n\tcategory: 'Dynamics',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('type', 'player', Prop.enum, Prop.enum.values('player', 'AI')),\n\t\tProp('keyboardControls', 'arrows or WASD', Prop.enum, Prop.enum.values('arrows', 'WASD', 'arrows or WASD')),\n\t\tProp('controlType', 'jumper', Prop.enum, Prop.enum.values('jumper', 'top down'/*, 'space ship'*/)),\n\t\tProp('jumpSpeed', 300, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('controlType', 'jumper')),\n\t\tProp('jumpAddedToVelocity', 0.4, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('controlType', 'jumper'), '1 means that jump speed is added to y velocity when object has y velocity.'),\n\t\tProp('breakInTheAir', true, Prop.bool, Prop.visibleIf('controlType', 'jumper')),\n\t\tProp('speed', 200, Prop.float, Prop.float.range(0, 1000)),\n\t\tProp('acceleration', 2000, Prop.float, Prop.float.range(0, 10000)),\n\t\tProp('breaking', 2000, Prop.float, Prop.float.range(0, 10000))\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\tthis.Physics = this.entity.getComponent('Physics');\n\n\t\t\tthis.lastJumpTime = 0;\n\n\t\t\tthis.keyListener = listenKeyDown(keyCode => {\n\t\t\t\tif (this.controlType !== 'jumper' || !this.scene.playing)\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\tif (this.keyboardControls === 'arrows') {\n\t\t\t\t\tif (keyCode === key.up)\n\t\t\t\t\t\tthis.jump();\n\t\t\t\t} else if (this.keyboardControls === 'WASD') {\n\t\t\t\t\tif (keyCode === key.w)\n\t\t\t\t\t\tthis.jump();\n\t\t\t\t} else if (this.keyboardControls === 'arrows or WASD') {\n\t\t\t\t\tif (keyCode === key.up || keyCode === key.w)\n\t\t\t\t\t\tthis.jump();\n\t\t\t\t} else {\n\t\t\t\t\tassert(false, 'Invalid CharacterController.keyboardControls');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsleep() {\n\t\t\tif (this.keyListener) {\n\t\t\t\tthis.keyListener();\n\t\t\t\tthis.keyListener = null;\n\t\t\t}\n\t\t},\n\t\tgetInput() {\n\t\t\tif (this.keyboardControls === 'arrows') {\n\t\t\t\treturn {\n\t\t\t\t\tup: keyPressed(key.up),\n\t\t\t\t\tdown: keyPressed(key.down),\n\t\t\t\t\tleft: keyPressed(key.left),\n\t\t\t\t\tright: keyPressed(key.right)\n\t\t\t\t};\n\t\t\t} else if (this.keyboardControls === 'WASD') {\n\t\t\t\treturn {\n\t\t\t\t\tup: keyPressed(key.w),\n\t\t\t\t\tdown: keyPressed(key.s),\n\t\t\t\t\tleft: keyPressed(key.a),\n\t\t\t\t\tright: keyPressed(key.d)\n\t\t\t\t};\n\t\t\t} else if (this.keyboardControls === 'arrows or WASD') {\n\t\t\t\treturn {\n\t\t\t\t\tup: keyPressed(key.up) || keyPressed(key.w),\n\t\t\t\t\tdown: keyPressed(key.down) || keyPressed(key.s),\n\t\t\t\t\tleft: keyPressed(key.left) || keyPressed(key.a),\n\t\t\t\t\tright: keyPressed(key.right) || keyPressed(key.d)\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tassert(false, 'Invalid CharacterController.keyboardControls');\n\t\t\t}\n\t\t},\n\t\tonUpdate(dt, t) {\n\t\t\tlet { up, down, left, right } = this.getInput();\n\t\t\t\n\t\t\tlet dx = 0,\n\t\t\t\tdy = 0;\n\t\t\t\n\t\t\tif (right) dx++;\n\t\t\tif (left) dx--;\n\t\t\tif (up) dy--;\n\t\t\tif (down) dy++;\n\t\t\t\n\t\t\tif (this.controlType === 'top down') {\n\t\t\t\tthis.moveTopDown(dx, dy, dt);\n\t\t\t} else if (this.controlType === 'jumper') {\n\t\t\t\tthis.moveJumper(dx, dy, dt);\n\t\t\t}\n\t\t},\n\t\t// dx and dy between [-1, 1]\n\t\tmoveTopDown(dx, dy, dt) {\n\t\t\tif (!this.Physics) {\n\t\t\t\tif (dx !== 0 || dy !== 0) {\n\t\t\t\t\tlet Transform = this.Transform;\n\t\t\t\t\tlet p = Transform.position;\n\t\t\t\t\tlet delta = this.speed * dt;\n\t\t\t\t\tTransform.position = new Vector(p.x + dx * delta, p.y + dy * delta);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.Physics.body)\n\t\t\t\treturn;\n\t\t\t\n\t\t\t// Physics based\n\t\t\t// #############\n\n\t\t\tlet bodyVelocity = this.Physics.body.velocity;\n\n\t\t\tbodyVelocity[0] = absLimit(this.calculateNewVelocity(bodyVelocity[0] / PHYSICS_SCALE, dx, dt), this.speed) * PHYSICS_SCALE;\n\t\t\tbodyVelocity[1] = absLimit(this.calculateNewVelocity(bodyVelocity[1] / PHYSICS_SCALE, dy, dt), this.speed) * PHYSICS_SCALE;\n\t\t},\n\t\tmoveJumper(dx, dy, dt) {\n\t\t\tif (!this.Physics || !this.Physics.body)\n\t\t\t\treturn false;\n\t\t\t\n\t\t\tlet bodyVelocity = this.Physics.body.velocity;\n\n\t\t\tbodyVelocity[0] = this.calculateNewVelocity(bodyVelocity[0] / PHYSICS_SCALE, dx, dt) * PHYSICS_SCALE;\n\t\t},\n\t\tjump() {\n\t\t\tif (this.scene.time > this.lastJumpTime + JUMP_SAFE_DELAY && this.checkIfCanJump()) {\n\t\t\t\tthis.lastJumpTime = this.scene.time;\n\t\t\t\t\n\t\t\t\tlet bodyVelocity = this.Physics.body.velocity;\n\t\t\t\tif (bodyVelocity[1] > 0) {\n\t\t\t\t\t// going down\n\t\t\t\t\tbodyVelocity[1] = -this.jumpSpeed * PHYSICS_SCALE;\n\t\t\t\t} else {\n\t\t\t\t\t// going up\n\t\t\t\t\tlet velocityVector = Vector.fromArray(bodyVelocity);\n\n\t\t\t\t\tlet contactEquations = getWorld(this.scene).narrowphase.contactEquations;\n\t\t\t\t\tlet body = this.Physics.body;\n\t\t\t\t\t\n\t\t\t\t\tfor (let i = contactEquations.length - 1; i >= 0; --i) {\n\t\t\t\t\t\tlet contact = contactEquations[i];\n\t\t\t\t\t\tif (contact.bodyA === body || contact.bodyB === body) {\n\t\t\t\t\t\t\tlet normal = Vector.fromArray(contact.normalA);\n\t\t\t\t\t\t\tif (contact.bodyB === body)\n\t\t\t\t\t\t\t\tnormal.multiplyScalar(-1);\n\t\t\t\t\t\t\tlet dotProduct = velocityVector.dot(normal);\n\t\t\t\t\t\t\tif (dotProduct < 0) {\n\t\t\t\t\t\t\t\t// character is moving away from the contact. could be caused by physics engine.\n\t\t\t\t\t\t\t\tvelocityVector.subtract(normal.multiplyScalar(dotProduct));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbodyVelocity[1] = velocityVector.y * this.jumpAddedToVelocity - this.jumpSpeed * PHYSICS_SCALE;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcheckIfCanJump() {\n\t\t\tif (!this.Physics || this.controlType !== 'jumper')\n\t\t\t\treturn false;\n\t\t\t\n\t\t\tlet contactEquations = getWorld(this.scene).narrowphase.contactEquations;\n\t\t\tlet body = this.Physics.body;\n\t\t\t\n\t\t\tif (!body)\n\t\t\t\treturn false;\n\t\t\t\n\t\t\tif (body.sleepState === p2.Body.SLEEPING)\n\t\t\t\treturn true;\n\t\t\t\n\t\t\tfor (let i = contactEquations.length - 1; i >= 0; --i) {\n\t\t\t\tlet contact = contactEquations[i];\n\t\t\t\tif (contact.bodyA === body || contact.bodyB === body) {\n\t\t\t\t\tlet normalY = contact.normalA[1];\n\t\t\t\t\tif (contact.bodyB === body)\n\t\t\t\t\t\tnormalY *= -1;\n\t\t\t\t\tif (normalY > 0.5)\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn false;\n\t\t},\n\t\tcalculateNewVelocity(velocity, input, dt) {\n\t\t\tif (input !== 0) {\n\t\t\t\tif (velocity >= this.speed && input > 0) {\n\t\t\t\t\t// don't do anything\n\t\t\t\t} else if (velocity <= -this.speed && input < 0) {\n\t\t\t\t\t// don't do anything\n\t\t\t\t} else {\n\t\t\t\t\t// do something\n\t\t\t\t\tvelocity += input * this.acceleration * dt;\n\n\t\t\t\t\tif (input < 0 && velocity < -this.speed)\n\t\t\t\t\t\tvelocity = -this.speed;\n\n\t\t\t\t\tif (input > 0 && velocity > this.speed)\n\t\t\t\t\t\tvelocity = this.speed;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (velocity !== 0 && (this.controlType !== 'jumper' || this.breakInTheAir || this.checkIfCanJump())) {\n\t\t\t\t\tlet absVel = Math.abs(velocity);\n\t\t\t\t\tabsVel -= this.breaking * dt;\n\t\t\t\t\tif (absVel < 0)\n\t\t\t\t\t\tabsVel = 0;\n\n\t\t\t\t\tif (velocity > 0)\n\t\t\t\t\t\tvelocity = absVel;\n\t\t\t\t\telse\n\t\t\t\t\t\tvelocity = -absVel;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn velocity;\n\t\t}\n\t}\n});\n","/*\n milliseconds: how often callback can be called\n callbackLimitMode:\n \t- instant: if it has been quiet, call callback() instantly\n \t- soon: if it has been quiet, call callback() instantly after current code loop\n \t- next: if it has been quiet, call callback() after waiting milliseconds.\n \t\n When calling the callback, limitMode can be overridden: func(callLimitMode);\n */\nexport function limit(milliseconds, callbackLimitMode = 'soon', callback) {\n\tif (!['instant', 'soon', 'next'].includes(callbackLimitMode))\n\t\tthrow new Error('Invalid callbackLimitMode');\n\t\n\tlet queueTimeout = null; // non-null when call is in queue\n\tlet lastCall = 0; // last time when callback was called\n\t\n\tfunction callCallback() {\n\t\tlastCall = Date.now();\n\t\tqueueTimeout = null;\n\t\tcallback();\n\t}\n\tfunction callCallbackWithDelay(delayMilliseconds) {\n\t\tqueueTimeout = setTimeout(callCallback, delayMilliseconds);\n\t}\n\t\n\treturn function(callLimitMode) {\n\t\tif (queueTimeout)\n\t\t\treturn;\n\t\t\n\t\tlet timeToNextPossibleCall = lastCall + milliseconds - Date.now();\n\t\tif (timeToNextPossibleCall > 0) {\n\t\t\tcallCallbackWithDelay(timeToNextPossibleCall);\n\t\t} else {\n\t\t\tlet mode = callLimitMode || callbackLimitMode;\n\t\t\tif (mode === 'instant')\n\t\t\t\tcallCallback();\n\t\t\telse if (mode === 'soon')\n\t\t\t\tcallCallbackWithDelay(0)\n\t\t\telse if (mode === 'next')\n\t\t\t\tcallCallbackWithDelay(milliseconds)\n\t\t}\n\t}\n}\n","import {keyPressed, key, listenKeyDown, simulateKeyEvent} from '../util/input'\nimport Vector from '../util/vector';\nimport debug from './debug'\n\nexport const CONTROL_SIZE = 70; // pixels\n\nexport default class TouchControl {\n\tconstructor(elementId, keyBinding, requireTouchStart) {\n\t\tthis.elementId = elementId;\n\t\tthis.element = null; // document not loaded yet.\n\t\tthis.keyBinding = keyBinding;\n\t\tthis.state = false; // is key binding simulated?\n\t\tthis.visible = false;\n\t\tthis.requireTouchStart = requireTouchStart;\n\t\tthis.containsFunc = null;\n\t}\n\n\tinitElement() {\n\t\tif (!this.element)\n\t\t\tthis.element = document.getElementById(this.elementId);\n\t}\n\n\tsetPosition(left, right, bottom) {\n\t\tif (left)\n\t\t\tthis.element.style.left = left + 'px';\n\t\telse\n\t\t\tthis.element.style.right = right + 'px';\n\t\tthis.element.style.bottom = bottom + 'px';\n\t}\n\n\tgetPosition() {\n\t\tlet screen = document.getElementById('screen');\n\t\tlet screenWidth = parseInt(screen.style.width);\n\t\tlet screenHeight = parseInt(screen.style.height);\n\t\t\n\t\tlet left = parseInt(this.element.style.left);\n\t\tlet right = parseInt(this.element.style.right);\n\t\tlet bottom = parseInt(this.element.style.bottom);\n\t\t\n\t\tlet x = !isNaN(left) ? (left + this.element.offsetWidth / 2) : (screenWidth - right - this.element.offsetWidth / 2);\n\t\tlet y = screenHeight - bottom - this.element.offsetHeight / 2;\n\n\t\treturn new Vector(x, y);\n\t}\n\n\tcontains(point) {\n\t\tif (!this.visible)\n\t\t\treturn false;\n\t\t\n\t\tif (this.containsFunc)\n\t\t\treturn this.containsFunc.call(this, point);\n\n\t\tlet position = this.getPosition();\n\t\treturn position.distance(point) <= CONTROL_SIZE / 2;\n\t}\n\t// function(point) {...}\n\tsetContainsFunction(func) {\n\t\tthis.containsFunc = func;\n\t}\n\n\tsetVisible(visible) {\n\t\tif (this.visible === visible)\n\t\t\treturn;\n\n\t\tthis.visible = visible;\n\t\tif (visible)\n\t\t\tthis.element.style.display = 'inline-block';\n\t\telse\n\t\t\tthis.element.style.display = 'none';\n\t}\n\n\tsetState(controlContainsATouch, isTouchStartEvent) {\n\t\tlet oldState = this.state;\n\t\t\n\t\tif (this.requireTouchStart && !this.state && !isTouchStartEvent)\n\t\t\tthis.state = false;\n\t\telse\n\t\t\tthis.state = !!controlContainsATouch;\n\t\t\n\t\tif (this.state === oldState)\n\t\t\treturn;\n\t\t\n\t\tif (this.state) {\n\t\t\tthis.element.classList.add('pressed');\n\t\t\tsimulateKeyEvent('keydown', this.keyBinding);\n\t\t} else {\n\t\t\tthis.element.classList.remove('pressed');\n\t\t\tsimulateKeyEvent('keyup', this.keyBinding);\n\t\t}\n\t}\n}\n","import '../core/index'\nimport '../components'\nimport { keyPressed, key, listenKeyDown, simulateKeyEvent } from '../util/input'\nimport { scene, listenSceneCreation } from '../core/scene';\nimport { listenGameCreation } from '../core/game';\nimport { configureNetSync } from '../core/net'\nimport { disableAllChanges } from '../core/property';\n\nimport './canvasResize'\nimport './touchControlManager'\n\n\nimport * as fullscreen from '../util/fullscreen';\n\ndisableAllChanges();\n\nconfigureNetSync({\n\tserverToClientEnabled: true,\n\tclientToServerEnabled: false,\n\tcontext: 'play'\n});\n\nlistenGameCreation(game => {\n\tlet levelIndex = 0;\n\n\tfunction play() {\n\t\tlet levels = game.getChildren('lvl');\n\t\tif (levelIndex >= levels.length)\n\t\t\tlevelIndex = 0;\n\t\tlevels[levelIndex].createScene().play();\n\t}\n\n\tplay();\n\n\tgame.listen('levelCompleted', () => {\n\t\tlevelIndex++;\n\t\tplay();\n\t});\n});\n\nlistenKeyDown(keyValue => {\n\tif (keyValue === key.space && scene)\n\t\tscene.win();\n});\n\n\n\n// Fullscreen\n/*\nif (fullscreen.fullscreenSupport()) {\n\twindow.addEventListener('click', () => fullscreen.toggleFullscreen(window.document.body));\n}\nsetTimeout(() => {\n\tdocument.getElementById('fullscreenInfo').classList.add('showSlowly');\n}, 1000);\nsetTimeout(() => {\n\tdocument.getElementById('fullscreenInfo').classList.remove('showSlowly');\n}, 3000);\n*/\n"],"names":["array","callback","low","high","length","priority","mid","name","count","currentPerSecondMeters","currentPerformanceMeters","performance","now","millis","cumulativePerformance","seconds","frameTimes","shift","push","threeLetterPrefix","characters","id","i","CHARACTERS","random","CHAR_COUNT","serializable","undefined","serializables","assert","origin","_origin","DEBUG_CHANGES","previousVisualOrigin","console","log","CHECK_FOR_INVALID_ORIGINS","setTimeout","resetOrigin","type","reference","change","external","externalChange","changeType","setPropertyValue","value","_value","move","parent","_parent","addSerializableToTree","previousOrigin","listeners","constructor","setChangeOrigin","packedChange","packed","parentId","toJSON","propertyType","Object","keys","keyToShortKey","forEach","key","e","shortKey","shortKeyToKey","getSerializable","error","newScene","executeExternal","fromJSON","obj","Serializable","addChild","threeLetterType","localMaster","deleteAllChildren","deleteChildren","deleteSerializable","delete","play","condition","message","Error","stack","getChangeOrigin","window","force","propertyName","defaultValue","_i","optionalParameters","validator","validators","default","description","flags","visibleIf","p","idx","validate","isFlag","PropertyType","_a","_b","_c","_d","_e","_f","clone","createType","validatorName","createValidator","validatorFunction","args","parameters","validatorArgs","x","apply","hex","result","exec","r","parseInt","g","b","c","toString","componentToHex","val","isNaN","Infinity","setXlink","el","setAttributeNS","xlinkns","setData","dataset","traverse","children","_current","current","child","childEl","getEl","isNode","mount","nextSibling","text","document","body","style","filter","popup","position","display","max-width","top","width","padding","font-size","z-index","color","background","text-align","user-select","box-sizing","canvas","renderer","PIXI","autoDetectRenderer","view","autoResize","antialias","plugins","interaction","destroy","container","sort","sortFunc","a","y","hash","texturesAndAnchors","graphicsObject","bounds","getLocalBounds","anchor","height","texture","generateTexture","SCALE_MODES","LINEAR","createElement","ctx","getContext","gradient","createLinearGradient","RESOLUTION","addColorStop","fillStyle","fillRect","scene","backgroundGradient","owner","options","_p2World","p2","World","gravity","sleepMode","BODY_SLEEPING","dt","step","PHYSICS_DT","clear","_p2Materials","addBody","removeBody","materials","assign","defaultMaterialOptions","friction","restitution","stiffness","relaxation","frictionStiffness","frictionRelaxation","surfaceVelocity","join","material","Material","h","m","o1","o2","contactMaterial","ContactMaterial","Math","min","max","addContactMaterial","handler","keyDownListeners","splice","indexOf","element","addEventListener","event","pageX","pageY","offsetLeft","offsetTop","offsetParent","_mx","_my","Vector","removeEventListener","eventName","keyCode","onkeydown","onkeyup","listener","sceneCreateListeners","prototype","originalPrototype","_depth","data","parentPrototype","getParentPrototype","getDataFromPrototype","componentDatas","getChildren","componentData","componentId","ownComponentData","componentClass","propertyHash","generatedForPrototype","properties","property","j","componentName","localeCompare","entityPrototypeId","EntityPrototype","_propertyTypesByName","createProperty","predefinedId","transform","ComponentData","scale","angle","lerp","size","gradientHardness","rgb","textureCache","context","createRadialGradient","Texture","fromCanvas","absMax","_rootType","variable","query","location","search","substring","vars","split","pair","decodeURIComponent","packedChanges","serverToClientEnabled","unpackChange","executeChange","gameData","localStorage","openEditPlayGameId","history","replaceState","stickyNonModalErrorPopup","socket","emit","io","s","on","onevent","packet","param1","changeReceivedOverNet","warn","clientToServerEnabled","screen","innerWidth","innerHeight","previousWidth","previousHeight","pixels","quality","MAX_PIXELS","sqrt","resize","scrollTo","events","dispatch","getElementById","setSize","preventDefault","touchCoordinates","getTouchCoordinates","controlArray","control","isPressed","find","coord","contains","setState","touchEvent","targetTouches","touch","clientX","clientY","playerFound","jumperFound","jumpSpeedFound","topDownFound","getComponents","characterController","controlType","jumpSpeed","controls","touchUp","setVisible","touchLeft","touchRight","touchDown","touchJump","touchA","touchB","visible","setPosition","setContainsFunction","point","rel","getRelativePositionToArrowCenter","abs","ARROW_HITBOX_RADIUS","visibleRightHandControls","rightHandControlArray","idxFromRightWall","pos","getPosition","CONTROL_SIZE","leftPos","rightPos","add","divideScalar","center","getArrowCenter","subtract","isClient","isServer","module","listen","listenerCounter","NUMBER_BIGGER_THAN_LISTENER_COUNT","hasOwnProperty","index","indexOfListener","getEventPromise","Promise","res","Date","serializableClasses","Map","skipSerializableRegistering","this","_children","_listeners","isRoot","createStringId","addSerializable","deleteChild","_alive","removeSerializable","_state","STATE_DESTROY","addChange","STATE_INIT","addChildren","_addChild","STATE_ADDCHILD","get","set","STATE_ADDPARENT","setRootType","filterFunction","deep","foundChild","foundChild_1","findChild","_detachChild","forEachChild","processArray","newParent","_detach","json","arrays_1","Array","from","_this","concat","map","JSON","stringify","initWithChildren","STATE_CLONE","performanceTool.eventHappened","rootType","childArray","Boolean","STATE_FROMJSON","Class","defineProperty","info","states","logState","state","stateString","createDebugObject","debug","ref","debugChildren","debugChildArray","k","changesEnabled","scenePropertyFilter","_super","_initialValue","setPropertyType","_initialValueIsJSON","__extends","Property","initialValue","v","n","newValue","registerSerializable","f","flag","dataType","createPropertyType","values","isArray","flagDegreesInEditor","func","vec","scalar","newLength","oldLength","multiplyScalar","dot","dx","dy","setLength","atan2","cos","sin","rotate","verticalAngle","fromObject","fromArray","Color","hexToRgb","rgbToHex","FLOAT_JSON_PRECISION_MULTIPLIER","pow","float","createDataType","parseFloat","validateFloat","range","modulo","round","int","vector","string","String","bool","enum","newColor","toHexString","_propertyTypes","_properties","PropertyOwner","propName","propChildren","otherChildren","invalidPropertiesCount","prop","isInvalid","nameToProp","defineProperties","propertyTypes","propertyTypeName","HASH","charCodeAt","DOT","parseQuery","tag","className","mode","offset","char","isHash","isDot","isEnd","ns","createElementNS","setAttribute","unmount","parentEl","__redom_view","parentNode","doUnmount","removeChild","hooks","__redom_lifecycle","hooksAreEmpty","__redom_mounted","trigger","parentHooks","hook","hookNames","shadowRootAvailable","before","wasMounted","oldParent","insertBefore","appendChild","doMount","remount","hooksFound","hookName","triggered","ShadowRoot","hookCount","firstChild","next","setStyle","arg1","arg2","isString","setAttr","isSVG","SVGElement","isFunction","str","createTextNode","parseArguments","arg","isNumber","ensureEl","html","nodeType","htmlCache","memoizeHTML","len","arguments","cloneNode","extend","bind","setChildren","propKey","item","ListPool","View","initData","oldLookup","lookup","oldViews","views","update","keySet","newLookup","newViews","__redom_id","list","List","__redom_list","pool","this$1","ref$1","_placeholder","Node","_el","_View","_initData","placeholder","Views","route","svgCache","memoizeSVG","svg","sticky","ticker","shared","stop","gradientCanvas","createCanvas","sprite","Sprite","updateSceneBackgroundGradient","layers","static","Prop","game","gameCreateListeners","Game","startsWith","require","left","right","up","down","ctrl","appleLeft","appleRight","alt","space","d","l","o","q","t","u","w","z","0","1","2","3","4","5","6","7","8","9","backspace","enter","esc","plus","minus","questionMark","keyUpListeners","which","activeElement","nodeName","toLowerCase","physicsOptions","enableSleeping","querySelector","getRenderer","mouseListeners","listenMouseMove","mousePosition","listenMouseDown","listenMouseUp","Scene","level","makeUpAName","self","stage","layer","Container","cameraPosition","cameraZoom","createLayer","ui","behind","main","front","components","animationFrameId","playing","time","won","createWorld","epr","createEntity","pause","deleteWorld","Transform","setCameraPositionToPlayer","pivot","timeInMilliseconds","_prevUpdate","performanceTool.setFrameTime","performanceTool.start","performanceTool.stop","updateWorld","draw","reset","requestAnimFrame","animFrame","requestAnimationFrame","updateCamera","sortDisplayObjects","render","resetting","unloadLevel","loadLevel","cancelAnimationFrame","clearTimeout","component","Set","zoomLevel","componentClassName","predefinedComponentId","componentClasses","allowMultiple","newComponentId","cloneComponentId","cid","parentComponentData","getParentComponentData","getInheritedProperties","prp","getPropertyOrCreate","getProperty","getValue","Component","create","_componentId","eventListeners","_listenRemoveFunctions","entity","functionName","performanceName","performance.start","performance.stop","requirements","getComponent","_preInit","_addEventListener","addComponent","preInit","_init","init","sleep","removeComponent","_sleep","pt","initWithPropertyValues","createWithInheritedComponentData","inheritedComponentData","reservedPropertyNames","reservedPrototypeMembers","register","category","icon","_g","_h","_j","_k","parentClass","_l","_m","has","constructorFunction","deleteFunction","call","Com","num","reduce","prev","curr","_name","ALIVE_ERROR","sleeping","Entity","addComponents","fullInit","ENTITY_CREATION_DEBUGGING","preInitComponents","initComponents","makeComponentsSleep","deleteComponents","compArray","comp","proto","previouslyCreatedEntity","Prototype","cda","sortInheritedComponentDatas","propertyValue","componentDataIsNew","alsoFindFromParents","findComponentDataByComponentId","_skipNewEntityEvent","inheritedComponentDatas","getInheritedComponentDatas","findParents","levels","entityPrototypes","prt","countEntityPrototypes","_gameRoot","getRoot","lvl","items","nameProperty","oldScaleProperty","oldAngleProperty","getTransform","childArrays","floatToJSON","handleProperty","isEqualTo","createFromPrototype","entityPrototype","prototypeTransform","fromPrefab","createEntityPrototypeNameProperty","createEntityPrototypeTransform","setValue","nameId","transformId","positionId","scaleId","angleId","transformData","transformClass","Prefab","icd","prefab","Level","predefinedSceneObject","PI","_debug","rotation","parentTransform","getParentTransform","listenProperty","parentEntity","getParent","getGlobalPosition","toLocal","zeroPoint","tempPoint","getGlobalAngle","setGlobalPosition","Point","onStart","positionVariance","isZero","scaleVariance","angleVariance","initSprite","redrawGraphics","updateTexture","textureAndAnchor","getTextureAndAnchor","createPropertyHash","getHashedTextureAndAnchor","graphics","createGraphics","generateTextureAndAnchor","Graphics","lineStyle","borderWidth","borderColor","toHexNumber","beginFill","fillColor","drawRect","endFill","averageScale","drawCircle","radius","path","getConvexPoints","drawPolygon","vectorClass","takeScaleIntoAccount","minDistanceMultiplier","maxDistanceMultiplier","centerAngle","points","isNotEventPolygon","topPointDistance","segmentAngle","unitSegmentLength","defaultMinDistanceMultiplier","currentAngle","averageY_1","scale_1","fromImage","lastSpawn","spawn","onUpdate","interval","onDrawHelper","save","strokeStyle","lineWidth","font","textAlign","fillText","strokeText","restore","typeName","spawnEntityToScene","storeProp","componentSet","entities_1","distSq","distanceSq","launchTrigger","action","win","dynamic","Body","DYNAMIC","kinematic","KINEMATIC","STATIC","SLEEPING","requiesInitWhenEntityIsEdited","inited","updatingOthers","wakeUp","Shapes","shapePropertiesThatShouldUpdateShape","updateShape","toArray","updateAABB","density","setDensity","updateMaterial","drag","damping","rotationalDrag","angularDamping","fixedRotation","updateMassProperties","bounciness","createBody","velocity","angularVelocity","sleepTimeLimit","sleepSpeedLimit","shapes","getWorld","stepping","Shape","shape","Box","Circle","Convex","vertices","addShape","updateMass","createMaterial","sleepState","newPos","deleteBody","getMass","mass","applyForce","forceVector","setAngularForce","angularForce","startTime","lifetime","blendMode","particles","blendModes","initParticles","updateGlobalCoordinatesProperty","Physics","positionListener","globalCoordinates","getParticleTexture","particleSize","particleHardness","alpha","particleLifetime","particleCount","firstBirth","alive","nextBirth","resetParticle","vx","speed","vy","speedRandom","randomSpeed","randomAngle","spawnType","spawnRadius","spawnRandom","speedToOutside","spawnRect","age","vel","followObject","spritePos","invParticleLifetime","accelerationX","acceleration","accelerationY","startColor","endColor","tint","startMultiplier","alphaLerp","scaleLerp","BLEND_MODES","ADD","normal","NORMAL","lastJumpTime","keyListener","listenKeyDown","keyboardControls","jump","getInput","keyPressed","moveTopDown","moveJumper","bodyVelocity","absLimit","calculateNewVelocity","delta","checkIfCanJump","velocityVector","contactEquations","narrowphase","contact","bodyA","bodyB","normalA","dotProduct","jumpAddedToVelocity","normalY","input","breakInTheAir","absVel","breaking","changes","valueChanges","isInSceneTree","duplicateChange","sendChanges","editAccess","openEditPlayUserId","profile","openEditPlayUserToken","userToken","user","gameReceivedOverNet","identifyYourself","reload","gameId","getQueryVariable","sendSocketMessage","userId","errorMessage","isFatal","milliseconds","callbackLimitMode","lastCall","queueTimeout","delayMilliseconds","callCallback","includes","callLimitMode","timeToNextPossibleCall","callCallbackWithDelay","packChange","connect","resizeCanvas","listenSceneCreation","elementId","keyBinding","requireTouchStart","containsFunc","TouchControl","bottom","screenWidth","screenHeight","offsetWidth","offsetHeight","distance","controlContainsATouch","isTouchStartEvent","oldState","classList","simulateKeyEvent","remove","touchChange","passive","IS_TOUCH_DEVICE","navigator","maxTouchPoints","standalone","initElement","positionControls","_options","levelIndex","createScene","keyValue"],"mappings":"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"}