!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==this.readyState&&(200===this.status?t(JSON.parse(this.responseText)):n())},i.open("GET",e,!0),i.send()})}function t(e){if(window.navigator.standalone){e.preventDefault();var t=e.target.getAttribute("href");window.location.href=t}}function n(e){e=new Date(e);var t=new Date,n=(t-e)/1e3;if(n<10)return"now";if(n<60)return"less than minute ago";var i=n/60;if(i<2)return"minute ago";if(i<60)return(0|i)+" minutes ago";var o=i/60;if(o<2)return"hour ago";if(o<24)return(0|o)+" hours ago";var r=o/60;if(r<2)return"day ago";if(r<7)return(0|r)+" days ago";var a=r/7;if(a<2)return"week ago";if(a<4)return(0|r)+" weeks ago";var s=r/30;if(s<2)return"month ago";if(s<12)return(0|s)+" months ago";var l=r/365;return l<2?"year ago":(0|l)+" years ago"}function i(e,t){for(var n in t)e.setAttributeNS(y,n,t[n])}function o(e,t){for(var n in t)e.dataset[n]=t[n]}function r(e,t,n){for(var i=n,o=0;o<t.length;o++){var a=t[o];if(a){var s=C(a);s!==i?A(s)?p(e,a,i):null!=a.length&&(i=r(e,a,i)):i=i.nextSibling}}return i}function a(t){if(X)return console.error("profile.setButtonContainer can only be called once");X=t,Y.then(function(){J=new Q,W=new Z,p(document.body,W),p(X,J),e("/api/profile?userId="+localStorage.openEditPlayUserId+"&userToken="+localStorage.openEditPlayUserToken).then(function(e){delete e.userToken,e.games&&(e.gameIdList=e.games.map(function(e){return e.id})),window.user=e,F&&F(e)&&console.log("resolved"),W.gamesCreated.textContent=e.games})})}var s="#".charCodeAt(0),l=".".charCodeAt(0),u=function(e){for(var t=null,n=null,i=null,o=0,r=0,a=0;a<=e.length;a++){var u=e.charCodeAt(a),d=u===s,c=u===l,f=!u;(d||c||f)&&(0===o?t=0===a?"div":e.substring(r,a):1===o?n=e.substring(r,a):i?i+=" "+e.substring(r,a):i=e.substring(r,a),d?o=1:c&&(o=2),r=a+1)}return{tag:t,id:n,className:i}},d=function(e,t){var n=u(e),i=n.tag,o=n.id,r=n.className,a=t?document.createElementNS(t,i):document.createElement(i);return o&&(a.id=o),r&&(t?a.setAttribute("class",r):a.className=r),a},c=function(e,t){var n=C(e),i=C(t);return t===i&&i.__redom_view&&(t=i.__redom_view),i.parentNode&&(f(t,i,n),n.removeChild(i)),t},f=function(e,t,n){var i=t.__redom_lifecycle;if(h(i))return void(t.__redom_mounted=!1);var o=n;for(t.__redom_mounted&&g(t,"onunmount");o;){var r=o.__redom_lifecycle||{};for(var a in i)r[a]&&(r[a]-=i[a]);h(r)&&(o.__redom_lifecycle=null),o=o.parentNode}},h=function(e){if(null==e)return!0;for(var t in e)if(e[t])return!1;return!0},m=["onmount","onunmount"],v="undefined"!=typeof window&&"ShadowRoot"in window,p=function(e,t,n){var i=C(e),o=C(t);t===o&&o.__redom_view&&(t=o.__redom_view),t!==o&&(o.__redom_view=t);var r=o.__redom_mounted,a=o.parentNode;return r&&a!==i&&f(t,o,a),null!=n?i.insertBefore(o,C(n)):i.appendChild(o),w(t,o,i,a),t},w=function(e,t,n,i){for(var o=t.__redom_lifecycle||(t.__redom_lifecycle={}),r=n===i,a=!1,s=0;s<m.length;s++){var l=m[s];!r&&e!==t&&l in e&&(o[l]=(o[l]||0)+1),o[l]&&(a=!0)}if(!a)return void(t.__redom_mounted=!0);var u=n,d=!1;if((r||!d&&u&&u.__redom_mounted)&&(g(t,r?"onremount":"onmount"),d=!0),!r)for(;u;){var c=u.parentNode,f=u.__redom_lifecycle||(u.__redom_lifecycle={});for(var h in o)f[h]=(f[h]||0)+o[h];!d&&(u===document||v&&u instanceof window.ShadowRoot||c&&c.__redom_mounted)&&(g(u,r?"onremount":"onmount"),d=!0),u=c}},g=function(e,t){"onmount"===t?e.__redom_mounted=!0:"onunmount"===t&&(e.__redom_mounted=!1);var n=e.__redom_lifecycle;if(n){var i=e.__redom_view,o=0;i&&i[t]&&i[t]();for(var r in n)r&&o++;if(o)for(var a=e.firstChild;a;){var s=a.nextSibling;g(a,t),a=s}}},_=function(e,t,n){var i=C(e);if(void 0!==n)i.style[t]=n;else if(S(t))i.setAttribute("style",t);else for(var o in t)_(i,o,t[o])},y="http://www.w3.org/1999/xlink",b=function(e,t,n){var r=C(e),a=r instanceof SVGElement;if(void 0!==n)if("style"===t)_(r,n);else if(a&&x(n))r[t]=n;else if("dataset"===t)o(r,n);else if(!a&&(t in r||x(n)))r[t]=n;else{if(a&&"xlink"===t)return void i(r,n);r.setAttribute(t,n)}else for(var s in t)b(r,s,t[s])},L=function(e){return document.createTextNode(null!=e?e:"")},k=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];(0===i||i)&&("function"==typeof i?i(e):S(i)||N(i)?e.appendChild(L(i)):A(C(i))?p(e,i):i.length?k(e,i):"object"==typeof i&&b(e,i))}},E=function(e){return S(e)?M(e):C(e)},C=function(e){return e.nodeType&&e||!e.el&&e||C(e.el)},S=function(e){return"string"==typeof e},N=function(e){return"number"==typeof e},x=function(e){return"function"==typeof e},A=function(e){return e&&e.nodeType},B={},I=function(e){return B[e]||(B[e]=d(e))},M=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];var o;if(S(e))o=I(e).cloneNode(!1);else{if(!A(e))throw new Error("At least one argument required");o=e.cloneNode(!1)}return k(o,n),o};M.extend=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];var o=I(e);return M.bind.apply(M,[this,o].concat(n))};var D=M,T=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];for(var o=C(e),a=r(e,n,o.firstChild);a;){var s=a.nextSibling;c(e,a),a=s}},G=function(e){return function(t){return t[e]}},P=function(e,t,n){this.View=e,this.initData=n,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],null!=t&&(this.lookup={},this.key=x(t)?t:G(t))};P.prototype.update=function(e,t){for(var n=this,i=n.View,o=n.key,r=n.initData,a=null!=o,s=this.lookup,l={},u=new Array(e.length),d=this.views,c=0;c<e.length;c++){var f=e[c],h=void 0;if(a){var m=o(f);h=s[m]||new i(r,f,c,e),l[m]=h,h.__redom_id=m}else h=d[c]||new i(r,f,c,e);h.update&&h.update(f,c,e,t);C(h.el).__redom_view=h,u[c]=h}this.oldViews=d,this.views=u,this.oldLookup=s,this.lookup=l};var V=function(e,t,n,i){return new H(e,t,n,i)},H=function(e,t,n,i){this.__redom_list=!0,this.View=t,this.initData=i,this.views=[],this.pool=new P(t,n,i),this.el=E(e),this.keySet=null!=n};H.prototype.update=function(e,t){var n=this;void 0===e&&(e=[]);var i=this,o=i.keySet,r=this.views,a=o&&this.lookup;this.pool.update(e,t);var s=this.pool,l=s.views,u=s.lookup;if(o)for(var d=0;d<r.length;d++){var f=r[d].__redom_id;f in u||c(n,a[f])}T(this,l),o&&(this.lookup=u),this.views=l},H.extend=function(e,t,n,i){return H.bind(H,e,t,n,i)},V.extend=H.extend,function(e,t){this.el=L(""),this.visible=!1,this.view=null,this._placeholder=this.el,e instanceof Node?this._el=e:this._View=e,this._initData=t}.prototype.update=function(e,t){var n=this._placeholder,i=this.el.parentNode;if(e){if(!this.visible){if(this._el)return p(i,this._el,n),c(i,n),this.el=this._el,void(this.visible=e);var o=this._View,r=new o(this._initData);this.el=C(r),this.view=r,p(i,r,n),c(i,n)}this.view&&this.view.update&&this.view.update(t)}else if(this.visible){if(this._el)return p(i,n,this._el),c(i,this._el),this.el=n,void(this.visible=e);p(i,n,this.view),c(i,this.view),this.el=n,this.view=null}this.visible=e},function(e,t,n){this.el=E(e),this.Views=t,this.initData=n}.prototype.update=function(e,t){if(e!==this.route){var n=this.Views,i=n[e];this.route=e,this.view=i&&new i(this.initData,t),T(this.el,[this.view])}this.view&&this.view.update&&this.view.update(t,e)};var O="http://www.w3.org/2000/svg",z={},R=function(e){return z[e]||(z[e]=d(e,O))},j=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];var o;if(S(e))o=R(e).cloneNode(!1);else{if(!A(e))throw new Error("At least one argument required");o=e.cloneNode(!1)}return k(o,n),o};j.extend=function(e){var t=R(e);return j.bind(this,t)},j.ns=O;var q=function(){function e(e,t){var n=this,i=e.getBoundingClientRect();this.el=D("div.contextMenu",{style:{top:i.bottom+window.pageYOffset+"px",left:i.left+"px"}}),this.list=V(this.el,U),this.list.update(t),setTimeout(function(){n.eventListener=window.addEventListener("click",function(){n.remove()})},0),p(document.body,this.el)}return e.prototype.remove=function(){this.eventListener&&window.removeEventListener("click",this.eventListener),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},e}(),U=function(){function e(){var e=this;this.el=D("div.contextMenuItem",{onclick:function(){return e.callback&&e.callback()}}),this.callback=null}return e.prototype.update=function(e){this.el.textContent=e.label,this.callback=e.callback},e}(),J=null,W=null,X=null,Y=new Promise(function(e,t){return window.addEventListener("load",e)}),F=null,K=new Promise(function(e,t){F=e}),Q=function(){function e(){this.el=D("img.profileButton",{src:"/img/profile.png",onclick:function(){return W.el.classList.toggle("visible")}})}return e.prototype.update=function(e){},e}(),Z=function(){function e(){this.el=D("div.profileMenu",D("div.profileMenuContent",D("div.gamesCreatedBlock","Welcome to Open Edit Play! Play or Edit a game and profile will be created for you.",D("div"),"Games created: ",this.gamesCreated=D("span.gamesCreated"))),{onclick:function(){return W.el.classList.toggle("visible")}})}return e.prototype.update=function(e){},e}(),$="Game size in data units. Every object in scene, type, component, level and property is a data unit.",ee=function(){function e(){this.el=D("div.gameListContainer",D("table.gameList",D("thead.gameListHeader",D("th.gameListHeaderName","Name"),D("th.gameListHeaderPlay"),D("th.gameListHeaderSize","Size",{title:$}),D("th.gameListHeaderLevels","Levels"),D("th.gameListHeaderCreated","Created"),D("th.gameListHeaderModified","Modified")),this.list=V("tbody.gameListContent",te)))}return e.prototype.update=function(e){this.list.update(e)},e}(),te=function(){function e(){var e=this;this.el=D("tr.gameElement",this.name=D("td.gameElementName"),this.play=D("td.gameElementPlay",this.primaryButton=D("a.linkButton","Play",{onclick:t}),this.secondaryButton=D("a.linkButton.hideInSmallScreens.gameElementSecondaryButton","...",{href:"#",onclick:function(t){t.preventDefault(),e.isMyGame?window.location.href="/edit/?gameId="+e.gameId:new q(e.secondaryButton,[{label:"Open editor sandbox",callback:function(){return window.location.href="/edit/?gameId="+e.gameId}}])}})),this.size=D("td.gameElementSize",{title:$}),this.levels=D("td.gameElementLevels"),this.created=D("td.gameElementCreated"),this.modified=D("td.gameElementModified"))}return e.prototype.update=function(e){var t=this;this.isMyGame=null,this.gameId=e.id,this.name.textContent=e.name,this.size.textContent=e.serializableCount,this.levels.textContent=e.levelCount,this.created.textContent=n(e.createdAt),this.created.setAttribute("title",new Date(e.createdAt).toLocaleString()),this.modified.textContent=n(e.updatedAt),this.modified.setAttribute("title",new Date(e.updatedAt).toLocaleString()),this.primaryButton.setAttribute("href","/play/?gameId="+e.id),K.then(function(n){t.isMyGame=!(!n.gameIdList||!n.gameIdList.includes(e.id)),t.el.classList.toggle("isMyGame",t.isMyGame),t.isMyGame?t.secondaryButton.textContent="Edit":t.secondaryButton.textContent="..."})},e}();window.IS_SMALL_SCREEN=window.screen.width<800,window.IS_MOBILE_STANDALONE=window.navigator.standalone,window.addEventListener("load",function(){IS_SMALL_SCREEN&&document.body.classList.add("isSmallDevice"),a(document.getElementById("profileButtonContainer"));var t=document.getElementById("games");e("/api/gameListSample").then(function(e){var n=new ee;n.update(e),p(t,n)}).catch(function(e){p(t,L("Could not load"))}),K.then(function(e){if(e.id&&0!==e.games.length){var t=document.getElementById("myGames");t.style.display="block";var n=new ee;n.update(e.games),p(t,n)}});var n=document.getElementById("topBarBackground");IS_MOBILE_STANDALONE?n.style.opacity=1:(window.onscroll=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;n.style.opacity=e<100?0:e<350?(e-100)/250*1:1},window.onscroll())})});
//# sourceMappingURL=openeditplay.homepage.min.js.map
