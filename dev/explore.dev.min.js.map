{"version":3,"file":null,"sources":["../src/assert.js","../src/core/serializableManager.js","../src/core/serializable.js","../src/core/propertyType.js","../node_modules/redom/dist/redom.es.js","../src/core/property.js","../src/core/dataTypes.js","../src/core/component.js","../src/game/components/Position.js","../src/game/components/Test.js","../src/core/prototype.js","../src/game/game.js","../src/core/entity.js","../src/core/test.js","../src/core/componentExample.js","../src/editor/events.js","../src/editor/layout/moduleContainer.js","../src/editor/layout/layout.js","../src/editor/module/module.js","../src/editor/module/topBar.js","../src/editor/module/type.js","../src/editor/module/instance.js","../src/editor/module/scene.js","../src/editor/module/types.js","../src/editor/module/instances.js","../src/editor/module/test3.js","../src/editor/editor.js","../src/mainDev.js"],"sourcesContent":["export default function assert(condition, message) {\n\tif (!condition)\n\t\tthrow new Error(message);\n}\n","let serializables = {};\n\nexport function addSerializable(serializable) {\n\tif (serializables[serializable.id]) throw new Error('Serializable id clash!');\n\tserializables[serializable.id] = serializable;\n}\n\nexport function getSerializable(id) {\n\treturn serializables[id] || null;\n}\n\nexport function hasSerializable(id) {\n\treturn Boolean(serializables[id]);\n}\n\nexport function removeSerializable(id) {\n\tif (serializables[id])\n\t\tdelete serializables[id];\n\telse\n\t\tthrow new Error('Serializable not found!');\n}\n","import assert from '../assert';\nimport * as serializableManager from './serializableManager';\n\nconst CHARACTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; // 62 chars\nconst CHAR_COUNT = CHARACTERS.length;\nfunction char() {\n\treturn CHARACTERS[Math.random() * CHAR_COUNT | 0];\n}\nexport function createStringId(threeLetterPrefix = '???', characters = 16) {\n\tlet id = threeLetterPrefix;\n\tfor (let i = characters - 1; i !== 0; --i)\n\t\tid += char();\n\treturn id;\n}\n\nlet serializableClasses = new Map();\n\nexport default class Serializable {\n\tconstructor(threeLetterType, predefinedId = false) {\n\t\tthis.id = predefinedId || createStringId(threeLetterType);\n\t\tserializableManager.addSerializable(this);\n\t}\n\tdelete() {\n\t\tserializableManager.removeSerializable(this.id);\n\t}\n\ttoJSON() {\n\t\treturn {\n\t\t\tid: this.id\n\t\t};\n\t}\n\ttoString() {\n\t\treturn JSON.stringify(this.toJSON(), null, 4);\n\t}\n\tstatic fromJSON(json) {\n\t\tassert(typeof json.id === 'string' && json.id.length > 3);\n\t\tlet fromJSON = serializableClasses.get(json.id.substring(0, 3));\n\t\tassert(fromJSON);\n\t\treturn fromJSON(json);\n\t}\n\tstatic registerSerializable(threeLetterPrefix, fromJSON) {\n\t\tassert(typeof threeLetterPrefix === 'string' && threeLetterPrefix.length === 3);\n\t\tassert(typeof fromJSON === 'function');\n\t\tserializableClasses.set(threeLetterPrefix, fromJSON);\n\t}\n}\n","import assert from '../assert';\nimport Property from './property';\n\n// info about type, validator, validatorParameters, initialValue\n\n\n\nclass PropertyType {\n\tconstructor(name, type, validator, initialValue) {\n\t\tassert(typeof name === 'string');\n\t\tassert(type && typeof type.name === 'string');\n\t\tassert(validator && typeof validator.validate === 'function');\n\t\t\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.validator = validator;\n\t\tthis.initialValue = initialValue;\n\t}\n\tcreateProperty({ value, predefinedId } = {}) {\n\t\treturn new Property(this, {\n\t\t\tvalue,\n\t\t\tpredefinedId\n\t\t});\n\t}\n}\n\n/*\n\tBeautiful way of creating property types\n\t\n\toptionalParameters:\n\t\tdescription: 'Example',\n\t\tvalidator: PropertyType.\n */\nexport default function createPropertyType(propertyName, defaultValue, type, ...optionalParameters) {\n\ttype = type();\n\tlet validator = type.validators.default();\n\tlet description = '';\n\toptionalParameters.forEach(p => {\n\t\tif (typeof p === 'string')\n\t\t\tdescription = p;\n\t\telse if (p && p.validate)\n\t\t\tvalidator = p;\n\t\telse\n\t\t\tassert(false, 'invalid parameter ' + p);\n\t});\n\treturn new PropertyType(propertyName, type, validator, defaultValue);\n};\n\nexport let classProperties = {\n\t// call after class declaration\n\tdefine(Class, propertyTypes) {\n\t\tClass._propertyTypes = propertyTypes;\n\t\tpropertyTypes.forEach(propertyType => {\n\t\t\tassert(Class.prototype[propertyType.name] === undefined, 'Property name ' + propertyType.name + ' clashes');\n\t\t\tObject.defineProperty(Class.prototype, propertyType.name, {\n\t\t\t\tget() {\n\t\t\t\t\treturn this._properties[propertyType.name].value;\n\t\t\t\t},\n\t\t\t\tset(value) {\n\t\t\t\t\tthis._properties[propertyType.name].value = value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\t// call in constructor\n\tset(classInstance, properties) {\n\t\tassert(Array.isArray(classInstance.constructor._propertyTypes), 'call defineClassProperties before setClassProperties');\n\t\tclassInstance._properties = {};\n\n\t\tlet propertyMap = {};\n\t\tfor (let i = 0; i < properties.length; i++)\n\t\t\tpropertyMap[properties[i].propertyType.name] = properties[i];\n\t\t\n\t\tclassInstance.constructor._propertyTypes.forEach(propertyType => {\n\t\t\tclassInstance._properties[propertyType.name] = propertyMap[propertyType.name] || propertyType.createProperty();\n\t\t});\n\t},\n\ttoJSON(classInstance) {\n\t\tlet props = {};\n\t\tObject.keys(classInstance._properties).map(name => classInstance._properties[name].toJSON()).forEach(p => {\n\t\t\tlet name = p.name;\n\t\t\tdelete p.name;\n\t\t\tprops[name] = p;\n\t\t});\n\t\treturn props;\n\t},\n\tfromJSON(Class, json) {\n\t\treturn Class._propertyTypes.map(pt => pt.createProperty(Property.fromJSON(json[pt.name])));\n\t}\n};\n\nexport function addDataType({\n\tname = '',\n\tvalidators = { default: x => x }, // default must exist\n\ttoJSON = x => x,\n\tfromJSON = x => x\n}) {\n\tassert(name, 'name missing from property type');\n\tassert(typeof validators.default === 'function','default validator missing from property type: ' + name);\n\tassert(typeof toJSON === 'function', 'invalid toJSON for property type: ' + name);\n\tassert(typeof fromJSON === 'function', 'invalid fromJSON for property type: ' + name);\n\n\tlet type = {\n\t\tname,\n\t\tvalidators,\n\t\ttoJSON,\n\t\tfromJSON\n\t};\n\tlet createType = () => type;\n\n\tObject.keys(validators).forEach(validatorName => {\n\t\tcreateType[validatorName] = createValidator(validatorName, validators[validatorName]);\n\t\tvalidators[validatorName] = createType[validatorName];\n\t});\n\tcreatePropertyType[name] = createType;\n}\n\nfunction createValidator(name, validatorFunction) {\n\tlet validator = function() {\n\t\tlet parameters = [...arguments];\n\t\treturn {\n\t\t\tvalidatorName: name,\n\t\t\tvalidatorParameters: parameters,\n\t\t\tvalidate: x => validatorFunction(x, ...parameters)\n\t\t};\n\t};\n\tvalidator.validatorName = name;\n\tvalidator.validate = validatorFunction;\n\treturn validator;\n}\n","var HASH = '#'.charCodeAt(0);\nvar DOT = '.'.charCodeAt(0);\n\nfunction createElement (query, ns) {\n  var tag;\n  var id;\n  var className;\n\n  var mode = 0;\n  var start = 0;\n\n  for (var i = 0; i <= query.length; i++) {\n    var char = query.charCodeAt(i);\n\n    if (char === HASH || char === DOT || !char) {\n      if (mode === 0) {\n        if (i === 0) {\n          tag = 'div';\n        } else if (!char) {\n          tag = query;\n        } else {\n          tag = query.substring(start, i);\n        }\n      } else {\n        var slice = query.substring(start, i);\n\n        if (mode === 1) {\n          id = slice;\n        } else if (className) {\n          className += ' ' + slice;\n        } else {\n          className = slice;\n        }\n      }\n\n      start = i + 1;\n\n      if (char === HASH) {\n        mode = 1;\n      } else {\n        mode = 2;\n      }\n    }\n  }\n\n  var element = ns ? document.createElementNS(ns, tag) : document.createElement(tag);\n\n  if (id) {\n    element.id = id;\n  }\n\n  if (className) {\n    element.className = className;\n  }\n\n  return element;\n}\n\nfunction text (content) {\n  return document.createTextNode(content);\n}\n\nfunction mount (parent, child, before) {\n  var parentEl = parent.el || parent;\n  var childEl = child.el || child;\n\n  if (childEl.__redom_list) {\n    childEl = childEl.el;\n  }\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (child !== childEl) {\n    childEl.__redom_view = child;\n  }\n  if (child.isMounted) {\n    child.remount && child.remount();\n  } else {\n    child.mount && child.mount();\n  }\n  if (before) {\n    parentEl.insertBefore(childEl, before.el || before);\n  } else {\n    parentEl.appendChild(childEl);\n  }\n  if (child.isMounted) {\n    child.remounted && child.remounted();\n  } else {\n    child.isMounted = true;\n    child.mounted && child.mounted();\n  }\n}\n\nfunction unmount (parent, child) {\n  var parentEl = parent.el || parent;\n  var childEl = child.el || child;\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  child.unmount && child.unmount();\n\n  parentEl.removeChild(childEl);\n\n  child.isMounted = false;\n  child.unmounted && child.unmounted();\n}\n\nvar elcache = {};\n\nfunction el (query) {\n  var arguments$1 = arguments;\n\n  var element;\n\n  if (typeof query === 'string') {\n    element = (elcache[query] || (elcache[query] = createElement(query))).cloneNode(false);\n  } else if (query && query.nodeType) {\n    element = query.cloneNode(false);\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  var empty = true;\n\n  for (var i = 1; i < arguments.length; i++) {\n    var arg = arguments$1[i];\n\n    if (!arg) {\n      continue;\n    }\n\n    // support middleware\n    if (typeof arg === 'function') {\n      arg(element);\n    } else if (typeof arg === 'string' || typeof arg === 'number') {\n      if (empty) {\n        empty = false;\n        element.textContent = arg;\n      } else {\n        element.appendChild(text(arg));\n      }\n    } else if (arg.nodeType || (arg.el && arg.el.nodeType)) {\n      empty = false;\n      mount(element, arg);\n    } else if (arg.length) {\n      empty = false;\n      for (var j = 0; j < arg.length; j++) {\n        mount(element, arg[j]);\n      }\n    } else if (typeof arg === 'object') {\n      for (var key in arg) {\n        var value = arg[key];\n\n        if (key === 'style') {\n          if (typeof value === 'string') {\n            element.setAttribute(key, value);\n          } else {\n            for (var cssKey in value) {\n              element.style[cssKey] = value[cssKey];\n            }\n          }\n        } else if (key in element || typeof value === 'function') {\n          element[key] = value;\n        } else {\n          element.setAttribute(key, value);\n        }\n      }\n    }\n  }\n\n  return element;\n}\n\nel.extend = function (query) {\n  var clone = (elcache[query] || (elcache[query] = createElement(query)));\n\n  return el.bind(this, clone);\n};\n\nfunction setChildren (parent, children) {\n  var parentEl = parent.el || parent;\n  var traverse = parentEl.firstChild;\n\n  for (var i = 0; i < children.length; i++) {\n    var child = children[i];\n\n    if (!child) {\n      continue;\n    }\n\n    var childEl = child.el || child;\n\n    if (childEl === traverse) {\n      traverse = traverse.nextSibling;\n      continue;\n    }\n\n    mount(parent, child, traverse);\n  }\n\n  while (traverse) {\n    var next = traverse.nextSibling;\n\n    unmount(parent, traverse);\n\n    traverse = next;\n  }\n}\n\nfunction list (parent, View, key, initData) {\n  return new List(parent, View, key, initData);\n}\n\nfunction List (parent, View, key, initData) {\n  this.__redom_list = true;\n  this.View = View;\n  this.key = key;\n  this.initData = initData;\n  this.views = [];\n  this.el = typeof parent === 'string' ? el(parent) : parent;\n\n  if (key) {\n    this.lookup = {};\n  }\n}\n\nList.extend = function (parent, View, key, initData) {\n  return List.bind(List, parent, View, key, initData);\n};\n\nlist.extend = List.extend;\n\nList.prototype.update = function (data) {\n  if ( data === void 0 ) data = [];\n\n  var View = this.View;\n  var key = this.key;\n  var functionKey = typeof key === 'function';\n  var initData = this.initData;\n  var newViews = new Array(data.length);\n  var oldViews = this.views;\n  var newLookup = key && {};\n  var oldLookup = key && this.lookup;\n\n  for (var i = 0; i < data.length; i++) {\n    var item = data[i];\n    var view = (void 0);\n\n    if (key) {\n      var id = functionKey ? key(item) : item[key];\n      view = newViews[i] = oldLookup[id] || new View(initData, item, i, data);\n      newLookup[id] = view;\n      view.__id = id;\n    } else {\n      view = newViews[i] = oldViews[i] || new View(initData, item, i, data);\n    }\n    var el$$1 = view.el;\n    if (el$$1.__redom_list) {\n      el$$1 = el$$1.el;\n    }\n    el$$1.__redom_view = view;\n    view.update && view.update(item, i, data);\n  }\n\n  setChildren(this, newViews);\n\n  if (key) {\n    this.lookup = newLookup;\n  }\n  this.views = newViews;\n};\n\nfunction router (parent, Views) {\n  return new Router(parent, Views);\n}\n\nvar Router = function Router (parent, Views) {\n  this.el = typeof parent === 'string' ? el(parent) : parent;\n  this.Views = Views;\n};\nRouter.prototype.update = function update (route, data) {\n  if (route !== this.route) {\n    var Views = this.Views;\n    var View = Views[route];\n\n    this.view = View && new View();\n    this.route = route;\n\n    setChildren(this.el, [ this.view ]);\n  }\n  this.view && this.view.update && this.view.update(data);\n};\n\nvar SVG = 'http://www.w3.org/2000/svg';\n\nvar svgcache = {};\n\nfunction svg (query, a) {\n  var arguments$1 = arguments;\n\n  var element;\n\n  if (typeof query === 'string') {\n    element = (svgcache[query] || (svgcache[query] = createElement(query, SVG))).cloneNode(false);\n  } else if (query && query.nodeType) {\n    element = query.cloneNode(false);\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  var empty = true;\n\n  for (var i = 1; i < arguments.length; i++) {\n    var arg = arguments$1[i];\n\n    if (!arg) {\n      continue;\n    } else if (typeof arg === 'function') {\n      arg = arg(element);\n    } else if (typeof arg === 'string' || typeof arg === 'number') {\n      if (empty) {\n        empty = false;\n        element.textContent = arg;\n      } else {\n        element.appendChild(text(arg));\n      }\n    } else if (arg.nodeType || (arg.el && arg.el.nodeType)) {\n      empty = false;\n      mount(element, arg);\n    } else if (typeof arg === 'object') {\n      for (var key in arg) {\n        var value = arg[key];\n\n        if (key === 'style' && typeof value !== 'string') {\n          for (var cssKey in value) {\n            element.style[cssKey] = value[cssKey];\n          }\n        } else if (typeof value === 'function') {\n          element[key] = value;\n        } else {\n          element.setAttribute(key, value);\n        }\n      }\n    }\n  }\n\n  return element;\n}\n\nsvg.extend = function (query) {\n  var clone = (svgcache[query] || (svgcache[query] = createElement(query, SVG)));\n\n  return svg.bind(this, clone);\n};\n\nexport { el, list, List, mount, unmount, router, Router, setChildren, svg, text };\n","import Serializable from './serializable';\nimport assert from '../assert';\n\n// Instance of a property\nexport default class Property extends Serializable {\n\tconstructor(propertyType, { value, predefinedId }) {\n\t\tsuper('prp', predefinedId);\n\t\tthis.propertyType = propertyType;\n\t\tthis.value = value !== undefined ? value : propertyType.initialValue;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tv: this.type.toJSON(this.value),\n\t\t\tname: this.propertyType.name\n\t\t});\n\t}\n\tdelete() {\n\t\tsuper.delete();\n\t\tthis.model = null;\n\t}\n}\nObject.defineProperty(Property.prototype, 'type', {\n\tget() {\n\t\treturn this.propertyType.type;\n\t}\n});\nObject.defineProperty(Property.prototype, 'value', {\n\tset(newValue) {\n\t\tthis._value = this.propertyType.validator.validate(newValue);\n\t},\n\tget() {\n\t\treturn this._value;\n\t}\n});\n\nProperty.fromJSON = function(json) {\n\treturn {\n\t\tvalue: json.v,\n\t\tpredefinedId: json.id\n\t};\n};\n","import assert from '../assert';\nimport { addDataType } from './propertyType';\n\naddDataType({\n\tname: 'float',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseFloat(x);\n\t\t\tassert(!isNaN(x), 'invalid float: ' + x);\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseFloat(x);\n\t\t\tassert(!isNaN(x), 'invalid float: ' + x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\naddDataType({\n\tname: 'string',\n\tvalidators: {\n\t\tdefault: x => x ? String(x) : ''\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n","import Serializable from './serializable';\nimport assert from '../assert';\nimport Property from './property';\nimport { classProperties } from './propertyType';\nexport { default as Prop } from './propertyType';\nexport let componentClasses = new Map();\n\n// Instance of a component, see componentExample.js\nexport class Component extends Serializable {\n\tconstructor(componentData, entity, env) {\n\t\tsuper('com');\n\t\tthis.entity = entity;\n\t\tthis.env = env;\n\t\tthis.children = {}; // TODO: create children\n\t\tthis._componentData = componentData;\n\n\t\tclassProperties.set(this, []); // TODO: set properties\n\t}\n\tdelete() {\n\t\tassert(!this.env.entity.alive, 'Do not call Component.delete!');\n\t\tsuper.delete();\n\t}\n\t_preInit() {\n\t\tthis.constructor.requirements.forEach(r => {\n\t\t\tthis[r] = this.entity.getComponent(r);\n\t\t\tassert(this[r], 'required component not found');\n\t\t});\n\n\t\tthis._forEachChildComponent(c => c._preInit());\n\t\n\t\ttry {\n\t\t\tif (typeof this.preInit === 'function')\n\t\t\t\tthis.preInit();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.name, 'preInit', e);\n\t\t}\n\t}\n\t_init() {\n\t\tthis._forEachChildComponent(c => c._init());\n\t\ttry {\n\t\t\tif (typeof this.init === 'function')\n\t\t\t\tthis.init();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.name, 'init', e);\n\t\t}\n\t}\n\t_sleep() {\n\t\ttry {\n\t\t\tif (typeof this.sleep === 'function')\n\t\t\t\tthis.sleep();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.name, 'sleep', e);\n\t\t}\n\t\tthis._forEachChildComponent(c => c._sleep());\n\t}\n\t_forEachChildComponent(func) {\n\t\tObject.keys(this.children).forEach(key => {\n\t\t\tlet child = this.children[key];\n\t\t\tif (Array.isArray(child)) {\n\t\t\t\tchild.forEach(func);\n\t\t\t} else {\n\t\t\t\tfunc(child);\n\t\t\t}\n\t\t});\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tprp: classProperties.toJSON(this),\n\t\t\tname: this.constructor.name\n\t\t});\n\t}\n}\n\nComponent.reservedPropertyNames = new Set(['id', 'constructor', 'delete', 'children', 'entity', 'env', 'init', 'preInit', 'sleep', '_preInit', '_init', '_sleep', '_forEachChildComponent', '_properties', '_componentData', 'toJSON', 'fromJSON']);\nComponent.reservedPrototypeMembers = new Set(['id', 'children', 'entity', 'env', '_preInit', '_init', '_sleep', '_forEachChildComponent', '_properties', '_componentData', 'toJSON', 'fromJSON']);\nComponent.register = function({\n\tname = '', // required\n\tdescription = '',\n\tcategory = 'Other',\n\ticon = 'fa-bars',\n\tproperties = [],\n\trequirements = [],\n\tchildren = [],\n\tparentClass = Component,\n\tprototype = {}\n}) {\n\tassert(name, 'Component must have a name.');\n\tassert(!componentClasses.has(name), 'Duplicate component class ' + name);\n\tObject.keys(prototype).forEach(k => {\n\t\tif (Component.reservedPrototypeMembers.has(k))\n\t\t\tassert(false, 'Component prototype can not have a reserved member: ' + k);\n\t});\n\t\n\tlet constructorFunction = prototype.constructor;\n\tlet deleteFunction = prototype.delete;\n\tdelete prototype.constructor;\n\tdelete prototype.delete;\n\tclass Class extends parentClass {\n\t\tconstructor() {\n\t\t\tsuper(...arguments);\n\t\t\tif (constructorFunction)\n\t\t\t\tconstructorFunction();\n\t\t}\n\t\tdelete() {\n\t\t\tsuper.delete(...arguments);\n\t\t\tif (deleteFunction)\n\t\t\t\tdeleteFunction();\n\t\t}\n\t}\n\tproperties.forEach(p => {\n\t\tassert(!Component.reservedPropertyNames.has(p.name), 'Can not have property called ' + p.name);\n\t});\n\tclassProperties.define(Class, properties); // properties means propertyTypes here\n\tObject.defineProperty(Class, 'name', { get: () => name });\n\t// Class.propertyTypeMap = new Map();\n\tClass.category = category;\n\tClass.requirements = requirements;\n\tClass.children = children;\n\tClass.description = description;\n\tClass.icon = icon;\n\tObject.assign(Class.prototype, prototype);\n\tcomponentClasses.set(Class.name, Class);\n\treturn Class;\n};\n","import { Component, Prop } from '../../core/component';\n\nComponent.register({\n\tname: 'Position',\n\tcategory: 'Core',\n\ticon: 'fa-circle',\n\tproperties: [\n\t\tProp('x', 0.1, Prop.float),\n\t\tProp('y', 0.2, Prop.float)\n\t]\n});\n","import { Component, Prop } from '../../core/component';\n\nComponent.register({\n\tname: 'Test',\n\tcategory: 'Core',\n\ticon: 'fa-circle',\n\tproperties: [\n\t\tProp('name', 'Oh right', Prop.string),\n\t\tProp('number', 666, Prop.float)\n\t]\n});\n","import Serializable from './serializable';\nimport assert from '../assert';\nimport { getSerializable } from './serializableManager';\nimport Prop, { classProperties } from './propertyType';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string),\n\tProp('parent', '', Prop.string)\n];\n\nexport default class Prototype extends Serializable {\n\tconstructor({ properties = null, componentDatas = new Map(), predefinedId = false }) {\n\t\tsuper('prt', predefinedId);\n\t\tthis.componentDatas = componentDatas; // componentId -> ComponentData\n\t\tif (!Array.isArray(properties))\n\t\t\tproperties = propertyTypes.map(pt => pt.createProperty());\n\t\tclassProperties.set(this, properties);\n\t}\n\tgetParent() {\n\t\treturn this.parentId && getSerializable(this.parentId);\n\t}\n\tcopy(constructorParameters = {}) {\n\t\tthrow new Error('broken');\n\t\treturn new Prototype(Object.assign({\n\t\t\tname: this.name + ' copy',\n\t\t\tparentId: this.parentId\n\t\t}, constructorParameters));\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tprp: classProperties.toJSON(this)\n\t\t});\n\t}\n}\nclassProperties.define(Prototype, propertyTypes);\n\nPrototype.createHelper = function(name) {\n\tlet nameProperty = propertyTypes.filter(pt => pt.name === 'name')[0].createProperty({ value: name });\n\treturn new Prototype({ properties: [nameProperty] });\n};\n\nSerializable.registerSerializable('prt', json => {\n\treturn new Prototype({\n\t\tproperties: classProperties.fromJSON(Prototype, json.prp),\n\t\tpredefinedId: json.id\n\t});\n});\n","import Serializable from '../core/serializable'\nimport './components/import'\nimport Prototype from '../core/prototype'\nimport assert from '../assert'\n\nexport default class Game extends Serializable {\n\tconstructor({ name = 'Game', prototypes = [], predefinedId = false } = {}) {\n\t\tsuper('gam', predefinedId);\n\t\tthis.prototypes = prototypes;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tnm: this.name,\n\t\t\tprt: this.prototypes.map(p => p.toJSON())\n\t\t});\n\t}\n}\n\nSerializable.registerSerializable('gam', json => {\n\treturn new Game({\n\t\tname: json.nm || undefined,\n\t\tprototypes: json.prt ? json.prt.map(Serializable.fromJSON) : undefined,\n\t\tpredefinedId: json.id\n\t});\n});\n","import Serializable from './serializable';\nimport assert from '../assert';\n\nconst ALIVE_ERROR = 'entity is already dead';\n\nexport default class Entity extends Serializable {\n\tconstructor() {\n\t\tsuper('ent');\n\t\tthis.components = new Map(); // name -> array\n\t\tthis.alive = true;\n\t\tthis.sleeping = false;\n\t\tthis.prototype = null;\n\t}\n\n\t// Get the first component of given name\n\tgetComponent(name) {\n\t\tassert(this.alive, ALIVE_ERROR);\n\t\tlet components = this.components.get(name);\n\t\tif (components !== undefined)\n\t\t\treturn components[0];\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// Get all components with given name\n\tgetComponents(name) {\n\t\tassert(this.alive, ALIVE_ERROR);\n\t\treturn this.components.get(name) || [];\n\t}\n\n\t/*\n\tAdds multiple components as an array to this Entity.\n\tUses addComponent internally.\n\tInitializes components after all components are added.\n\t*/\n\taddComponents(components) {\n\t\tassert(this.alive, ALIVE_ERROR);\n\t\tassert(Array.isArray(components), 'Parameter is not an array.');\n\n\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\tlet componentList = this.components.get(components[i].name) || this.components.set(components[i].name, []).get(components[i].name);\n\t\t\tcomponentList.push(components[i]);\n\t\t}\n\t\t\n\t\tif (!this.sleeping)\n\t\t\tEntity.initComponents(components);\n\t\treturn this;\n\t}\n\tstatic initComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._preInit();\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._init();\n\t}\n\tstatic makeComponentsSleep(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._sleep();\n\t}\n\tstatic deleteComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i].delete();\n\t}\n\tsleep() {\n\t\tassert(this.alive, ALIVE_ERROR);\n\t\tif (this.sleeping) return false;\n\t\t\n\t\tfor (let componentArray of this.components)\n\t\t\tEntity.makeComponentsSleep(componentArray);\n\t\t\n\t\tthis.sleeping = true;\n\t\treturn true;\n\t}\n\twakeUp() {\n\t\tassert(this.alive, ALIVE_ERROR);\n\t\tif (!this.sleeping) return false;\n\n\t\tfor (let componentArray of this.components)\n\t\t\tEntity.initComponents(componentArray);\n\n\t\tthis.sleeping = false;\n\t\treturn true;\n\t}\n\tdelete() {\n\t\tassert(this.alive, ALIVE_ERROR);\n\t\tthis.sleep();\n\t\tsuper.delete();\n\t\tthis.alive = false;\n\t\tfor (let componentArray of this.components)\n\t\t\tEntity.deleteComponents(componentArray);\n\t\tthis.components.clear();\n\t}\n\ttoJSON() {\n\t\tassert(this.alive, ALIVE_ERROR);\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tcomponents: []\n\t\t});\n\t}\n}\n","import assert from '../assert';\n\nimport Serializable from './serializable';\n(() => {\n\tlet s = new Serializable('tes');\n\tSerializable.registerSerializable('tes', json => {\n\t\treturn new Serializable(null, json.id);\n\t});\n\tlet id = s.id;\n\tassert(typeof id === 'string' && id.length > 10);\n\tlet json = s.toJSON();\n\tassert(json && typeof json === 'object' && typeof json.id === 'string');\n\ts.delete();\n\ts = Serializable.fromJSON(json);\n\tassert(typeof s.id === 'string' && s.id.length > 10 && s.id === id);\n\tconsole.log('Serializable tests OK');\n})();\n\nimport Entity from './entity';\n(() => {\n\tlet i = new Entity();\n\tassert(i.components.size === 0);\n\tassert(i.getComponent('moi') === null);\n\tassert(i.getComponents('moi').length === 0);\n\tconsole.log('Entity tests OK');\n})();\n\nimport PropertyType from './propertyType';\n(() => {\n\tassert(PropertyType.float.default().validate('4') === 4);\n\tassert(PropertyType.float.range(0, 1).validate(3) === 1);\n\tconsole.log('PropertyType tests OK');\n})();\n","import { Component, Prop } from '../core/component';\n\n// Export so that other components can have this component as parent\nexport default Component.register({\n\tname: 'Example',\n\tdescription: 'Description of what this component does',\n\tcategory: 'Core', // You can also make up new categories.\n\ticon: 'fa-circle', // Font Awesome id\n\trequirements: ['Position'], // These shared components are autofilled. Error if component is not found.\n\tchildren: ['Image', 'Image', 'Sound'], // These private components are also autofilled. Error if component is not found.\n\tproperties: [\n\t\tProp('variable', 0.5, Prop.float, Prop.float.range(0, 1), 'Description of the property'),\n\t\tProp('otherVar_iaerfperfjoierj', 'Hello', Prop.string, 'Description of the property')\n\t],\n\tparentClass: Component,\n\tprototype: {\n\t\tstaticVariable: 'Example class info',\n\t\tconstructor() {\n\t\t\t// This will be called once, when creating the component\n\t\t\tthis.hiddenVariable = 3;\n\t\t},\n\t\tpreInit() {\n\t\t\t// preInit is called for every component before any component is inited with init(). Children are already preInited here.\n\t\t\tthis.data = {\n\t\t\t\tlotsOfData: 123 + this.variable + this.hiddenVariable\n\t\t\t};\n\t\t},\n\t\tinit() {\n\t\t\t// All the components of this entity has been preInited. You can use them. Children are already inited here.\n\t\t\tthis.Position.x = this.Position.y + 1;\n\n\t\t\tthis.howToAccessChildren = [\n\t\t\t\tthis.children.Image[0].property,\n\t\t\t\tthis.children.Sound.property\n\t\t\t];\n\n\t\t\tthis.SomeComponent = this.entity.getComponent('SomeComponent');\n\t\t},\n\t\tsleep() {\n\t\t\t// Release all the data created in preInit and init\n\t\t\tthis.data = null;\n\t\t\tthis.SomeComponent = null;\n\t\t\tthis.howToAccessChildren = null;\n\t\t\t// Position component is automatically released because it is a requirement.\n\t\t},\n\t\tdelete() {\n\t\t\t// This will be called once, when component stops existing\n\t\t}\n\t}\n});\n","/*\n Global event system\n\n let unlisten = events.listen('event name', function(params, ...) {});\n eventManager.dispatch('event name', paramOrParamArray);\n unlisten();\n */\n\nlet listeners = {};\n\nexport default {\n\tlisten(event, callback) {\n\t\tif (!listeners.hasOwnProperty(event)) {\n\t\t\tlisteners[event] = [];\n\t\t}\n\t\tlisteners[event].push(callback);\n\t\treturn () => {\n\t\t\tvar index = listeners[event].indexOf(callback);\n\t\t\tlisteners[event].splice(index, 1);\n\t\t};\n\t},\n\tdispatch(event, ...args) {\n\t\tif (listeners.hasOwnProperty(event)) {\n\t\t\tfor (var i = 0; i < listeners[event].length; ++i) {\n\t\t\t\tlisteners[event][i].apply(null, args);\n\t\t\t\t/*\n\t\t\t\ttry {\n\t\t\t\t\tlisteners[event][i].apply(null, args);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (console && console.error) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t}\n\t\t}\n\t}\n};\n","import { el, list, mount } from 'redom';\nimport events from '../events';\n\nexport default class ModuleContainer {\n\tconstructor(moduleContainerName = 'unknownClass.anotherClass', packButtonIcon = 'fa-chevron-left') {\n\t\t\n\t\tthis.modules = [];\n\t\tthis.packButtonEnabled = !!packButtonIcon;\n\t\tthis.el = el(`div.moduleContainer.packable.${moduleContainerName}`,\n\t\t\tthis.packButton = packButtonIcon && el(`i.packButton.button.iconButton.fa.${packButtonIcon}`),\n\t\t\tthis.tabs = list('div.tabs', ModuleTab),\n\t\t\tthis.moduleElements = el('div.moduleElements')\n\t\t);\n\t\tif (packButtonIcon) {\n\t\t\tthis.el.onclick = () => this.el.classList.contains('packed') && this.el.classList.remove('packed');\n\t\t\tthis.packButton.onclick = e => {\n\t\t\t\tthis.el.classList.add('packed');\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\tevents.listen('registerModule_' + moduleContainerName.split('.')[0], (moduleClass, editor) => {\n\t\t\tlet module = new moduleClass();\n\t\t\tmodule.editor = editor;\n\t\t\tmodule.state = editor.state;\n\t\t\tmodule.el.classList.add('module-' + module.id);\n\t\t\tthis.modules.push(module);\n\t\t\tif (this.modules.length !== 1) {\n\t\t\t\tmodule._hide();\n\t\t\t}\n\t\t\tmount(this.moduleElements, module.el);\n\t\t\tthis._updateTabs();\n\t\t\t\n\t\t\tevents.listen('activateModule_' + module.id, (unpackModuleView = true, ...args) => {\n\t\t\t\tif (unpackModuleView)\n\t\t\t\t\tthis.el.classList.remove('packed');\n\t\t\t\tthis._activateModule(module, args);\n\t\t\t});\n\t\t});\n\t\tthis._updateTabs();\n\t}\n\tupdate() {\n\t\tthis.modules.forEach(m => m.update());\n\t}\n\t_updateTabs() {\n\t\tif (!this.tabs) return;\n\t\t\n\t\tthis.tabs.update(this.modules);\n\t\t\n\t\tif (!this.packButtonEnabled && this.modules.length <= 1)\n\t\t\tthis.tabs.el.style.display = 'none';\n\t\telse\n\t\t\tthis.tabs.el.style.display = 'block';\n\t}\n\t_activateModule(module, args) {\n\t\tlet idx = this.modules.indexOf(module);\n\t\tthis.modules.forEach(m => {\n\t\t\tif (m !== module) {\n\t\t\t\tm._hide();\n\t\t\t}\n\t\t});\n\t\tmodule.activate(...args);\n\t\tmodule._show();\n\t\tthis._updateTabs();\n\t\t\n\t\t/*\n\t\tthis.modules.splice(idx, 1);\n\t\tthis.modules.unshift(module);\n\t\tthis._updateTabs();\n\t\tfor (let i = 1; i < this.modules.length; i++) {\n\t\t\tthis.modules[i].el.style.display = 'none';\n\t\t}\n\t\tmodule.activate(...args);\n\t\tmodule.el.style.display = 'block';\n\t\t*/\n\t}\n}\n\nclass ModuleTab {\n\tconstructor() {\n\t\tthis.el = el('span.moduleTab.button');\n\t\tthis.module = null;\n\t\tthis.el.onclick = () => {\n\t\t\tevents.dispatch('activateModule_' + this.module.id);\n\t\t};\n\t}\n\tupdate(module) {\n\t\tthis.module = module;\n\t\tthis.el.textContent = module.name;\n\t\tthis.el.classList.toggle('active', module._visible);\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport ModuleContainer from './moduleContainer';\n\nexport default class Layout {\n\tconstructor() {\n\t\tthis.moduleContainers = [];\n\t\tlet addContainer = (...args) => {\n\t\t\tlet container = new ModuleContainer(...args);\n\t\t\tthis.moduleContainers.push(container);\n\t\t\treturn container;\n\t\t}\n\t\tthis.el = el('div.editorLayout',\n\t\t\tel('div.nonRight',\n\t\t\t\taddContainer('top', null),\n\t\t\t\tel('div.bottomLeft',\n\t\t\t\t\taddContainer('left', 'fa-chevron-left'),\n\t\t\t\t\tel('div.middle',\n\t\t\t\t\t\taddContainer('center', null),\n\t\t\t\t\t\taddContainer('bottom', 'fa-chevron-down')\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t),\n\t\t\taddContainer('right', 'fa-chevron-right')\n\t\t);\n\t}\n\tupdate(state) {\n\t\tthis.moduleContainers.forEach(mc => mc.update(state));\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport events from '../events';\n\nexport default class Module {\n\tconstructor() {\n\t\tthis.name = this.name || 'Module';\n\t\tthis.id = this.id || 'module';\n\t\tthis.el = el('div.module', ...arguments);\n\t\tthis._visible = true;\n\t}\n\t// Called when this module is opened. Other modules can call Module.activateModule('Module', ...args);\n\tactivate() {\n\t}\n\t// Called when state of editor changes\n\tupdate() {\n\t}\n\t_show() {\n\t\tthis.el.classList.remove('hidden');\n\t\tthis._visible = true;\n\t}\n\t_hide() {\n\t\tthis.el.classList.add('hidden');\n\t\tthis._visible = false;\n\t}\n}\n//arguments: moduleName, unpackModuleView=true, ...args \nModule.activateModule = function(moduleName, unpackModuleView=true, ...args) {\n\tevents.dispatch('activateModule_' + moduleName, unpackModuleView, ...args);\n};\nModule.packModuleContainer = function(moduleContainerName) {\n\tdocument.querySelectorAll(`.moduleContainer.${moduleContainerName}`)[0].classList.add('packed');\n};\nModule.unpackModuleContainer = function(moduleContainerName) {\n\tdocument.querySelectorAll(`.moduleContainer.${moduleContainerName}`)[0].classList.remove('packed');\n};\n\n// moduleContainerName = left | middle | right | bottom\nModule.register = function(moduleClass, moduleContainerName) {\n\tregisterPromise = registerPromise.then(editor => {\n\t\tevents.dispatch('registerModule_' + moduleContainerName, moduleClass, editor);\n\t\treturn editor;\n\t});\n};\n\nlet nextTopBarPriorityNumber = 1;\nModule.registerTopButton = function(text, icon, func, priority = nextTopBarPriorityNumber++) {\n\tregisterPromise = registerPromise.then(editor => {\n\t\tevents.dispatch('registerTopButton', text, icon, func, priority);\n\t\treturn editor;\n\t});\n};\n\n\nlet registerPromise = new Promise(function(resolve) {\n\tevents.listen('registerModules', function(editor) {\n\t\tregisterPromise.then(editor => {\n\t\t\tevents.dispatch('modulesRegistered');\n\t\t\treturn editor;\n\t\t});\n\t\tresolve(editor);\n\t});\n});\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nexport class TopBarModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.logo = el('img.logo.button.iconButton', { src: '../img/logo_reflection_medium.png' }),\n\t\t\tthis.list = list('div.buttonContainer', TopButton)\n\t\t);\n\t\tthis.id = 'topbar';\n\t\tthis.name = 'TopBar'; // not visible\n\t}\n\tupdate() {\n\t\tthis.list.update(this.state.topButtons);\n\t}\n}\nModule.register(TopBarModule, 'top');\n\nModule.registerTopButton('Bell Types', 'fa fa-bell-o', () => { \n\tModule.unpackModuleContainer('bottom');\n\tModule.activateModule('types');\n\tModule.activateModule('type');\n}, 1);\nModule.registerTopButton('Cube Instances', 'fa fa-cubes', () => {\n\tModule.activateModule('instances');\n\tModule.activateModule('instance');\n}, 2);\n\nexport class TopButton {\n\tconstructor() {\n\t\tthis.el = el('div.button.topIconTextButton',\n\t\t\tel('div.topIconTextButtonContent',\n\t\t\t\tthis.icon = el('i.fa'),\n\t\t\t\tthis.text = el('span')\n\t\t\t)\n\t\t)\n\t\tthis.el.onclick = () => {\n\t\t\tthis.callback && this.callback();\n\t\t}\n\t\tthis.callback = null;\n\t}\n\tupdate(state) {\n\t\tthis.icon.className = state.icon;\n\t\tthis.text.textContent = state.text;\n\t\tthis.callback = state.func;\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nlet propertyTypeToEditorType = {\n\t'float': 'number',\n\t'string': 'text'\n};\n\nclass PropertyModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.propertyEditor = el('div.propertyEditor', 'hei')\n\t\t);\n\t\tthis.id = 'type';\n\t\tthis.name = 'Type';\n\t}\n\tupdate() {\n\t\tthis.componentClasses = this.state.componentClasses; \n\n\t\tlet schema = {\n\t\t\teditors: [\n\t\t\t\t{\n\t\t\t\t\tfield: 'yks',\n\t\t\t\t\ttitle: 'YKS',\n\t\t\t\t\ttype: 'text'\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tlet data = {};\n\n\t\tlet componentArray = Array.from(this.componentClasses.values());\n\t\tcomponentArray.forEach(c => {\n\t\t\tlet componentSchema = {\n\t\t\t\ttype: 'group',\n\t\t\t\tfield: c.name,\n\t\t\t\ttitle: c.name,\n\t\t\t\teditors: c._propertyTypes.map(pm => ({\n\t\t\t\t\tfield: c.name + '.' + pm.name,\n\t\t\t\t\ttitle: pm.name.length > 30 ? (pm.name.substring(0, 28) + '..') : pm.name,\n\t\t\t\t\ttype: propertyTypeToEditorType[pm.type.name] || 'text'\n\t\t\t\t}))\n\t\t\t};\n\t\t\tschema.editors.push(componentSchema);\n\n\t\t\tlet componentData = {};\n\t\t\tc._propertyTypes.forEach(pm => {\n\t\t\t\tcomponentData[pm.name] = pm.initialValue;\n\t\t\t});\n\t\t\tdata[c.name] = componentData;\n\t\t});\n\t\t\n\t\tnew PJS($(this.propertyEditor), schema, data);\n\t}\n}\n\nModule.register(PropertyModule, 'right');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nlet propertyTypeToEditorType = {\n\t'float': 'number',\n\t'string': 'text'\n};\n\nclass PropertyModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.propertyEditor = el('div.propertyEditor', 'hei')\n\t\t);\n\t\tthis.id = 'instance';\n\t\tthis.name = 'Instance';\n\t}\n\tupdate() {\n\t\tthis.componentClasses = this.state.componentClasses;\n\n\t\tlet schema = {\n\t\t\teditors: [\n\t\t\t\t{\n\t\t\t\t\tfield: 'yks',\n\t\t\t\t\ttitle: 'YKS',\n\t\t\t\t\ttype: 'text'\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tlet data = {};\n\n\t\tlet componentArray = Array.from(this.componentClasses.values());\n\t\tcomponentArray.forEach(c => {\n\t\t\tlet componentSchema = {\n\t\t\t\ttype: 'group',\n\t\t\t\tfield: c.name,\n\t\t\t\ttitle: c.name,\n\t\t\t\teditors: c._propertyTypes.map(pm => ({\n\t\t\t\t\tfield: c.name + '.' + pm.name,\n\t\t\t\t\ttitle: pm.name.length > 30 ? (pm.name.substring(0, 28) + '..') : pm.name,\n\t\t\t\t\ttype: propertyTypeToEditorType[pm.type.name] || 'text'\n\t\t\t\t}))\n\t\t\t};\n\t\t\tschema.editors.push(componentSchema);\n\n\t\t\tlet componentData = {};\n\t\t\tc._propertyTypes.forEach(pm => {\n\t\t\t\tcomponentData[pm.name] = pm.initialValue;\n\t\t\t});\n\t\t\tdata[c.name] = componentData;\n\t\t});\n\n\t\tnew PJS($(this.propertyEditor), schema, data);\n\t}\n}\n\nModule.register(PropertyModule, 'right');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nclass SceneModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.content = el('span', 'moi test')\n\t\t);\n\t\tthis.id = 'scene';\n\t\tthis.name = 'Scene';\n\t}\n\tupdate() {\n\t}\n}\n\nModule.register(SceneModule, 'center');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport events from '../events';\nimport Prototype from '../../core/prototype';\nimport { getSerializable } from '../../core/serializableManager';\nimport assert from '../../assert';\n\nclass Types extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.addButton = el('span.addTypeButton.button.fa.fa-plus'),\n\t\t\tthis.search = el('input'),\n\t\t\tthis.searchIcon = el('i.fa.fa-search.searchIcon'),\n\t\t\tthis.jstree = el('div')\n\t\t);\n\t\tthis.id = 'types';\n\t\tthis.name = 'Types';\n\n\t\tthis.addButton.onclick = () => {\n\t\t\tthis.state.game.prototypes.push(Prototype.createHelper('' + Math.random()));\n\t\t\tthis.editor.update();\n\t\t};\n\t\t\n\t\tlet searchTimeout = false;\n\t\tthis.search.addEventListener('keyup', () => {\n\t\t\tif (searchTimeout)\n\t\t\t\tclearTimeout(searchTimeout);\n\n\t\t\tsearchTimeout = setTimeout(() => {\n\t\t\t\t$(this.jstree).jstree().search(this.search.value.trim());\n\t\t\t}, 200);\n\t\t});\n\t}\n\tupdate() {\n\t\tif (this.skipUpdate) return;\n\t\t\n\t\tlet data = this.state.game.prototypes.map(p => ({\n\t\t\ttext: p.name,\n\t\t\tid: p.id,\n\t\t\tparent: p.parent || '#'\n\t\t}));\n\t\t\n\t\tif (!this.jstreeInited) {\n\t\t\t$(this.jstree).attr('id', 'types-jstree').on('changed.jstree', (e, data) => {\n\t\t\t\t// selection changed\n\t\t\t\tthis.skipUpdate = true;\n\t\t\t\tthis.editor.select(data.selected.map(getSerializable));\n\t\t\t\tthis.skipUpdate = false;\n\t\t\t}).on('loaded.jstree refresh.jstree', () => {\n\t\t\t\tlet jstree = $(this.jstree).jstree(true);\n\t\t\t\t// let selNode = jstree.get_node('prtF21ZLL0vsLdQI5z');\n\t\t\t\t// console.log(jstree, selNode);\n\t\t\t\tif (this.state.selection.type === 'none') {\n\t\t\t\t\tjstree.select_node();\n\t\t\t\t}\n\t\t\t\tif (this.state.selection.type === 'prt') {\n\t\t\t\t\t// jstree.select_node(this.state.selection.items.map(i => i.id));\n\t\t\t\t}\n\t\t\t}).jstree({\n\t\t\t\tcore: {\n\t\t\t\t\tcheck_callback: true,\n\t\t\t\t\tdata,\n\t\t\t\t\tforce_text: true\n\t\t\t\t},\n\t\t\t\tplugins: ['types', 'dnd', 'sort', 'search'],\n\t\t\t\ttypes: {\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\ticon: 'fa fa-book'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdnd: {\n\t\t\t\t\tcopy: false // jstree makes it way too hard to copy multiple prototypes\n\t\t\t\t},\n\t\t\t\tsearch: {\n\t\t\t\t\tfuzzy: true,\n\t\t\t\t\tshow_only_matches: true,\n\t\t\t\t\tshow_only_matches_children: true,\n\t\t\t\t\tclose_opened_onclear: false\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.jstreeInited = true;\n\t\t} else {\n\t\t\t$(this.jstree).jstree(true).settings.core.data = data;\n\t\t\t$(this.jstree).jstree('refresh');\n\t\t}\n\t\t$(this.jstree).data('typesModule', this);\n\t\t\n\t\t// $(this.jstree).jstree(true).select_node($('#prtF21ZLL0vsLdQI5z')[0]);//this.state.selection.items.map(i => i.id));\n\t\tif (this.state.selection.type === 'none') {\n\t\t}\n\t}\n}\n\n$(document).on('dnd_stop.vakata', function (e, data) {\n\tconsole.log('dnd_stop start', e, data);\n\tlet jstree = $('#types-jstree').jstree(true);\n\tlet typesModule = $('#types-jstree').data('typesModule');\n\t\n\tsetTimeout(function () {\n\t\t// Now the nodes have moved in the DOM.\n\n\t\tlet node = jstree.get_node(data.data.obj);\n\t\tlet nodes = data.data.nodes; // these prototypes will move\n\t\t\n\t\tlet newParent = node.parent;\n\t\tif (newParent === '#')\n\t\t\tnewParent = null;\n\t\t\n\t\tlet nodeObjects = nodes.map(getSerializable);\n\t\tnodeObjects.forEach(assert);\n\t\tnodeObjects.forEach(prototype => prototype.parent = newParent);\n\t\t\n\t\tconsole.log('dnd stopped from', nodes, 'to', newParent);\n\t\t\n\t\ttypesModule.editor.save();\n\t});\n});\n\nModule.register(Types, 'left');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nclass TestModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.content = el('span', 'List of instances on the scene')\n\t\t);\n\t\tthis.name = 'Instances';\n\t\tthis.id = 'instances';\n\t}\n\tupdate() {\n\t}\n}\n\nModule.register(TestModule, 'left');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nclass TestModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.content = el('span', 'This is test 3')\n\t\t);\n\t\tthis.id = 'test';\n\t\tthis.name = 'Test3';\n\t}\n\tupdate() {\n\t}\n}\n\nModule.register(TestModule, 'bottom');\n","import events from './events';\nimport Layout from './layout/layout';\nimport './module/topBar';\nimport './module/type';\nimport './module/instance';\nimport './module/scene';\nimport './module/types';\nimport './module/instances';\nimport './module/test3';\nimport { el, list, mount } from 'redom';\nimport Game from '../game/game';\nimport Serializable from '../core/serializable';\n\nimport { componentClasses } from '../core/component';\n\nwindow.addEventListener('load', () => {\n\tlet anotherGame;\n\ttry {\n\t\tanotherGame = Serializable.fromJSON(JSON.parse(localStorage.anotherGameJSON));\n\t} catch(e) {}\n\teditor = new Editor(anotherGame);\n\tevents.dispatch('registerModules', editor);\n});\nevents.listen('modulesRegistered', () => {\n\teditor.update();\n\tevents.dispatch('loaded');\n});\n\nlet editor = null;\nclass Editor {\n\tconstructor(game = new Game()) {\n\t\tthis.layout = new Layout();\n\t\t\n\t\tthis.state = {\n\t\t\ttopButtons: [],\n\t\t\tselection: {\n\t\t\t\ttype: 'none',\n\t\t\t\titems: []\n\t\t\t},\n\t\t\tgame,\n\t\t\tcomponentClasses\n\t\t};\n\n\t\tmount(document.body, this.layout);\n\t\t\n\t\tevents.listen('registerTopButton', (text, icon, func, priority) => {\n\t\t\tlet button = { icon, text, func, priority };\n\t\t\tlet i = 0;\n\t\t\tlet topButtons = this.state.topButtons;\n\t\t\twhile (i < topButtons.length) {\n\t\t\t\tlet b = topButtons[i];\n\t\t\t\tif (b.priority > priority) {\n\t\t\t\t\ttopButtons.splice(i, 0, button);\n\t\t\t\t\ti = -1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tif (i >= 0) topButtons.push(button);\n\t\t});\n\t\t\n\t\tevents.listen('requestUpdate', () => {\n\t\t\tconsole.log('requested');\n\t\t\tthis.update();\n\t\t});\n\t}\n\tselect(items) {\n\t\tthis.state.selection.items = items;\n\t\t\n\t\tlet types = Array.from(new Set(items.map(i => i.id.substring(0, 3))));\n\t\tif (types.length === 0)\n\t\t\tthis.state.selection.type = 'none';\n\t\telse if (types.length === 1)\n\t\t\tthis.state.selection.type = types[0];\n\t\telse\n\t\t\tthis.state.selection.type = 'mixed';\n\t\t\n\t\tthis.update();\n\t}\n\tupdate() {\n\t\tthis.layout.update(this.state);\n\t}\n\tsave() {\n\t\ttry {\n\t\t\tlocalStorage.anotherGameJSON = JSON.stringify(this.state.game.toJSON());\n\t\t\tconsole.log('saved');\n\t\t} catch(e) {}\n\t}\n}\n","import './main';\n\nimport './core/test';\nimport './core/componentExample'; // temp\n\nimport './editor/editor';\n\n\nimport Property from './core/property';\nwindow.Property = Property;\n\nimport PropertyModel from './core/propertyType';\nwindow.PropertyModel = PropertyModel;\n\nimport { Component } from './core/component';\nwindow.Component = Component;\n"],"names":["assert","condition","message","Error","addSerializable","serializable","serializables","id","getSerializable","removeSerializable","char","CHARACTERS","Math","random","CHAR_COUNT","createStringId","threeLetterPrefix","characters","let","i","createPropertyType","propertyName","defaultValue","type","validator","validators","default","description","optionalParameters","forEach","p","validate","PropertyType","addDataType","ref","x","name","toJSON","fromJSON","createType","Object","keys","validatorName","createValidator","validatorFunction","parameters","validatorParameters","createElement","query","ns","tag","className","mode","start","length","charCodeAt","HASH","DOT","substring","slice","element","document","createElementNS","text","content","createTextNode","mount","parent","child","before","parentEl","el","childEl","__redom_list","__redom_view","isMounted","remount","insertBefore","appendChild","remounted","mounted","unmount","removeChild","unmounted","arguments$1","arguments","elcache","cloneNode","nodeType","empty","arg","textContent","j","key","value","setAttribute","cssKey","style","setChildren","children","traverse","firstChild","nextSibling","next","list","View","initData","List","this","views","lookup","serializableClasses","Map","Serializable","threeLetterType","predefinedId","serializableManager.addSerializable","delete","serializableManager.removeSerializable","toString","JSON","stringify","json","get","registerSerializable","set","Property","propertyType","super","undefined","initialValue","assign","v","model","defineProperty","prototype","newValue","_value","createProperty","classProperties","define","Class","propertyTypes","_propertyTypes","_properties","classInstance","properties","Array","isArray","constructor","propertyMap","props","map","pt","parseFloat","isNaN","range","min","max","String","componentClasses","Component","componentData","entity","env","_componentData","alive","_preInit","requirements","r","getComponent","_forEachChildComponent","c","preInit","e","console","error","_init","init","_sleep","sleep","func","prp","reservedPropertyNames","Set","reservedPrototypeMembers","register","has","k","constructorFunction","deleteFunction","parentClass","category","icon","Prop","float","string","Prototype","componentDatas","getParent","parentId","copy","constructorParameters","createHelper","nameProperty","filter","Game","prototypes","nm","prt","const","ALIVE_ERROR","Entity","components","sleeping","getComponents","addComponents","componentList","push","initComponents","makeComponentsSleep","deleteComponents","componentArray","wakeUp","clear","s","log","size","staticVariable","hiddenVariable","data","lotsOfData","variable","Position","y","howToAccessChildren","Image","property","Sound","SomeComponent","listeners","listen","event","callback","hasOwnProperty","index","indexOf","splice","dispatch","apply","args","extend","clone","bind","update","functionKey","newViews","oldViews","newLookup","oldLookup","item","view","__id","el$$1","Router","Views","route","ModuleContainer","moduleContainerName","packButtonIcon","modules","packButtonEnabled","packButton","tabs","ModuleTab","moduleElements","onclick","classList","contains","remove","this$1","add","stopPropagation","events","split","moduleClass","editor","module","state","_hide","_updateTabs","unpackModuleView","_activateModule","m","display","activate","_show","toggle","_visible","Layout","moduleContainers","addContainer","container","mc","Module","argsArray","activateModule","moduleName","packModuleContainer","querySelectorAll","unpackModuleContainer","registerPromise","then","nextTopBarPriorityNumber","registerTopButton","priority","Promise","resolve","TopBarModule","logo","src","TopButton","topButtons","propertyTypeToEditorType","PropertyModule","propertyEditor","schema","editors","field","title","from","values","componentSchema","pm","PJS","$","SceneModule","Types","addButton","search","searchIcon","jstree","game","searchTimeout","addEventListener","clearTimeout","setTimeout","trim","skipUpdate","jstreeInited","settings","core","attr","on","select","selected","selection","select_node","check_callback","force_text","plugins","types","dnd","fuzzy","show_only_matches","show_only_matches_children","close_opened_onclear","typesModule","node","get_node","obj","nodes","newParent","nodeObjects","save","TestModule","window","anotherGame","parse","localStorage","anotherGameJSON","Editor","layout","items","body","button","b","PropertyModel"],"mappings":"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"}