function assert(e,t){if(!e)throw new Error(t)}function addSerializable(e){if(serializables[e.id])throw new Error("Serializable id clash!");serializables[e.id]=e}function getSerializable(e){return serializables[e]||null}function removeSerializable(e){if(!serializables[e])throw new Error("Serializable not found!");delete serializables[e]}function char(){return CHARACTERS[Math.random()*CHAR_COUNT|0]}function createStringId(e,t){void 0===e&&(e="???"),void 0===t&&(t=16);for(var o=e,r=t-1;0!==r;--r)o+=char();return o}function createPropertyType(e,t,o){for(var r=[],n=arguments.length-3;n-- >0;)r[n]=arguments[n+3];o=o();var i=o.validators.default(),s="";return r.forEach(function(e){"string"==typeof e?s=e:e&&e.validate?i=e:assert(!1,"invalid parameter "+e)}),new PropertyType(e,o,i,t)}function addDataType(e){var t=e.name;void 0===t&&(t="");var o=e.validators;void 0===o&&(o={default:function(e){return e}});var r=e.toJSON;void 0===r&&(r=function(e){return e});var n=e.fromJSON;void 0===n&&(n=function(e){return e}),assert(t,"name missing from property type"),assert("function"==typeof o.default,"default validator missing from property type: "+t),assert("function"==typeof r,"invalid toJSON for property type: "+t),assert("function"==typeof n,"invalid fromJSON for property type: "+t);var i={name:t,validators:o,toJSON:r,fromJSON:n},s=function(){return i};Object.keys(o).forEach(function(e){s[e]=createValidator(e,o[e]),o[e]=s[e]}),createPropertyType[t]=s}function createValidator(e,t){var o=function(){for(var o=arguments.length,r=Array(o);o--;)r[o]=arguments[o];var n=[].concat(r);return{validatorName:e,validatorParameters:n,validate:function(e){return t.apply(void 0,[e].concat(n))}}};return o.validatorName=e,o.validate=t,o}function createElement(e,t){for(var o,r,n,i=0,s=0,a=0;a<=e.length;a++){var p=e.charCodeAt(a);if(p===HASH||p===DOT||!p){if(0===i)o=0===a?"div":p?e.substring(s,a):e;else{var l=e.substring(s,a);1===i?r=l:n?n+=" "+l:n=l}s=a+1,i=p===HASH?1:2}}var c=t?document.createElementNS(t,o):document.createElement(o);return r&&(c.id=r),n&&(c.className=n),c}function text(e){return document.createTextNode(e)}function mount(e,t,o){var r=e.el||e,n=t.el||t;n.__redom_list&&(n=n.el),t===n&&n.__redom_view&&(t=n.__redom_view),t!==n&&(n.__redom_view=t),t.isMounted?t.remount&&t.remount():t.mount&&t.mount(),o?r.insertBefore(n,o.el||o):r.appendChild(n),t.isMounted?t.remounted&&t.remounted():(t.isMounted=!0,t.mounted&&t.mounted())}function unmount(e,t){var o=e.el||e,r=t.el||t;t===r&&r.__redom_view&&(t=r.__redom_view),t.unmount&&t.unmount(),o.removeChild(r),t.isMounted=!1,t.unmounted&&t.unmounted()}function el(e){var t,o=arguments;if("string"==typeof e)t=(elcache[e]||(elcache[e]=createElement(e))).cloneNode(!1);else{if(!e||!e.nodeType)throw new Error("At least one argument required");t=e.cloneNode(!1)}for(var r=!0,n=1;n<arguments.length;n++){var i=o[n];if(i)if("function"==typeof i)i(t);else if("string"==typeof i||"number"==typeof i)r?(r=!1,t.textContent=i):t.appendChild(text(i));else if(i.nodeType||i.el&&i.el.nodeType)r=!1,mount(t,i);else if(i.length){r=!1;for(var s=0;s<i.length;s++)mount(t,i[s])}else if("object"==typeof i)for(var a in i){var p=i[a];if("style"===a)if("string"==typeof p)t.setAttribute(a,p);else for(var l in p)t.style[l]=p[l];else a in t||"function"==typeof p?t[a]=p:t.setAttribute(a,p)}}return t}function setChildren(e,t){for(var o=e.el||e,r=o.firstChild,n=0;n<t.length;n++){var i=t[n];if(i){var s=i.el||i;s!==r?mount(e,i,r):r=r.nextSibling}}for(;r;){var a=r.nextSibling;unmount(e,r),r=a}}function list(e,t,o,r){return new List(e,t,o,r)}function List(e,t,o,r){this.__redom_list=!0,this.View=t,this.key=o,this.initData=r,this.views=[],this.el="string"==typeof e?el(e):e,o&&(this.lookup={})}var serializables={},CHARACTERS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",CHAR_COUNT=CHARACTERS.length,serializableClasses=new Map,Serializable=function(e,t){void 0===t&&(t=!1),this.id=t||createStringId(e),addSerializable(this)};Serializable.prototype.delete=function(){removeSerializable(this.id)},Serializable.prototype.toJSON=function(){return{id:this.id}},Serializable.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,4)},Serializable.fromJSON=function e(t){assert("string"==typeof t.id&&t.id.length>3);var e=serializableClasses.get(t.id.substring(0,3));return assert(e),e(t)},Serializable.registerSerializable=function(e,t){assert("string"==typeof e&&3===e.length),assert("function"==typeof t),serializableClasses.set(e,t)};var Property=function(e){function t(t,o){var r=o.value,n=o.predefinedId;e.call(this,"prp",n),this.propertyType=t,this.value=void 0!==r?r:t.initialValue}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){return Object.assign(e.prototype.toJSON.call(this),{v:this.type.toJSON(this.value),name:this.propertyType.name})},t.prototype.delete=function(){e.prototype.delete.call(this),this.model=null},t}(Serializable);Object.defineProperty(Property.prototype,"type",{get:function(){return this.propertyType.type}}),Object.defineProperty(Property.prototype,"value",{set:function(e){this._value=this.propertyType.validator.validate(e)},get:function(){return this._value}}),Property.fromJSON=function(e){return{value:e.v,predefinedId:e.id}};var PropertyType=function(e,t,o,r){assert("string"==typeof e),assert(t&&"string"==typeof t.name),assert(o&&"function"==typeof o.validate),this.name=e,this.type=t,this.validator=o,this.initialValue=r};PropertyType.prototype.createProperty=function(e){void 0===e&&(e={});var t=e.value,o=e.predefinedId;return new Property(this,{value:t,predefinedId:o})};var classProperties={define:function(e,t){e._propertyTypes=t,t.forEach(function(t){assert(void 0===e.prototype[t.name],"Property name "+t.name+" clashes"),Object.defineProperty(e.prototype,t.name,{get:function(){return this._properties[t.name].value},set:function(e){this._properties[t.name].value=e}})})},set:function(e,t){assert(Array.isArray(e.constructor._propertyTypes),"call defineClassProperties before setClassProperties"),e._properties={};for(var o={},r=0;r<t.length;r++)o[t[r].propertyType.name]=t[r];e.constructor._propertyTypes.forEach(function(t){e._properties[t.name]=o[t.name]||t.createProperty()})},toJSON:function(e){var t={};return Object.keys(e._properties).map(function(t){return e._properties[t].toJSON()}).forEach(function(e){var o=e.name;delete e.name,t[o]=e}),t},fromJSON:function(e,t){return e._propertyTypes.map(function(e){return e.createProperty(Property.fromJSON(t[e.name]))})}};addDataType({name:"float",validators:{default:function(e){return e=parseFloat(e),assert(!isNaN(e),"invalid float: "+e),e},range:function(e,t,o){return e=parseFloat(e),assert(!isNaN(e),"invalid float: "+e),Math.min(o,Math.max(t,e))}},toJSON:function(e){return e},fromJSON:function(e){return e}}),addDataType({name:"string",validators:{default:function(e){return e?String(e):""}},toJSON:function(e){return e},fromJSON:function(e){return e}});var componentClasses=new Map,Component=function(e){function t(t,o,r){e.call(this,"com"),this.entity=o,this.env=r,this.children={},this._componentData=t,classProperties.set(this,[])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.delete=function(){assert(!this.env.entity.alive,"Do not call Component.delete!"),e.prototype.delete.call(this)},t.prototype._preInit=function(){var e=this;this.constructor.requirements.forEach(function(t){e[t]=e.entity.getComponent(t),assert(e[t],"required component not found")}),this._forEachChildComponent(function(e){return e._preInit()});try{"function"==typeof this.preInit&&this.preInit()}catch(e){console.error(this.entity,this.constructor.name,"preInit",e)}},t.prototype._init=function(){this._forEachChildComponent(function(e){return e._init()});try{"function"==typeof this.init&&this.init()}catch(e){console.error(this.entity,this.constructor.name,"init",e)}},t.prototype._sleep=function(){try{"function"==typeof this.sleep&&this.sleep()}catch(e){console.error(this.entity,this.constructor.name,"sleep",e)}this._forEachChildComponent(function(e){return e._sleep()})},t.prototype._forEachChildComponent=function(e){var t=this;Object.keys(this.children).forEach(function(o){var r=t.children[o];Array.isArray(r)?r.forEach(e):e(r)})},t.prototype.toJSON=function(){return Object.assign(e.prototype.toJSON.call(this),{prp:classProperties.toJSON(this),name:this.constructor.name})},t}(Serializable);Component.reservedPropertyNames=new Set(["id","constructor","delete","children","entity","env","init","preInit","sleep","_preInit","_init","_sleep","_forEachChildComponent","_properties","_componentData","toJSON","fromJSON"]),Component.reservedPrototypeMembers=new Set(["id","children","entity","env","_preInit","_init","_sleep","_forEachChildComponent","_properties","_componentData","toJSON","fromJSON"]),Component.register=function(e){var t=e.name;void 0===t&&(t="");var o=e.description;void 0===o&&(o="");var r=e.category;void 0===r&&(r="Other");var n=e.icon;void 0===n&&(n="fa-bars");var i=e.properties;void 0===i&&(i=[]);var s=e.requirements;void 0===s&&(s=[]);var a=e.children;void 0===a&&(a=[]);var p=e.parentClass;void 0===p&&(p=Component);var l=e.prototype;void 0===l&&(l={}),assert(t,"Component must have a name."),assert(!componentClasses.has(t),"Duplicate component class "+t),Object.keys(l).forEach(function(e){Component.reservedPrototypeMembers.has(e)&&assert(!1,"Component prototype can not have a reserved member: "+e)});var c=l.constructor,u=l.delete;delete l.constructor,delete l.delete;var d=function(e){function t(){e.apply(this,arguments),c&&c()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.delete=function(){e.prototype.delete.apply(this,arguments),u&&u()},t}(p);return i.forEach(function(e){assert(!Component.reservedPropertyNames.has(e.name),"Can not have property called "+e.name)}),classProperties.define(d,i),Object.defineProperty(d,"name",{get:function(){return t}}),d.category=r,d.requirements=s,d.children=a,d.description=o,d.icon=n,Object.assign(d.prototype,l),componentClasses.set(d.name,d),d},Component.register({name:"Position",category:"Core",icon:"fa-circle",properties:[createPropertyType("x",.1,createPropertyType.float),createPropertyType("y",.2,createPropertyType.float)]}),Component.register({name:"Test",category:"Core",icon:"fa-circle",properties:[createPropertyType("name","Oh right",createPropertyType.string),createPropertyType("number",666,createPropertyType.float)]});var propertyTypes=[createPropertyType("name","No name",createPropertyType.string),createPropertyType("parent","",createPropertyType.string)],Prototype=function(e){function t(t){var o=t.properties;void 0===o&&(o=null);var r=t.componentDatas;void 0===r&&(r=new Map);var n=t.predefinedId;void 0===n&&(n=!1),e.call(this,"prt",n),this.componentDatas=r,Array.isArray(o)||(o=propertyTypes.map(function(e){return e.createProperty()})),classProperties.set(this,o)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getParent=function(){return this.parentId&&getSerializable(this.parentId)},t.prototype.copy=function(e){throw void 0===e&&(e={}),new Error("broken")},t.prototype.toJSON=function(){return Object.assign(e.prototype.toJSON.call(this),{prp:classProperties.toJSON(this)})},t}(Serializable);classProperties.define(Prototype,propertyTypes),Prototype.createHelper=function(e){var t=propertyTypes.filter(function(e){return"name"===e.name})[0].createProperty({value:e});return new Prototype({properties:[t]})},Serializable.registerSerializable("prt",function(e){return new Prototype({properties:classProperties.fromJSON(Prototype,e.prp),predefinedId:e.id})});var Game=function(e){function t(t){void 0===t&&(t={});var o=t.name;void 0===o&&(o="Game");var r=t.prototypes;void 0===r&&(r=[]);var n=t.predefinedId;void 0===n&&(n=!1),e.call(this,"gam",n),this.prototypes=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){return Object.assign(e.prototype.toJSON.call(this),{nm:this.name,prt:this.prototypes.map(function(e){return e.toJSON()})})},t}(Serializable);Serializable.registerSerializable("gam",function(e){return new Game({name:e.nm||void 0,prototypes:e.prt?e.prt.map(Serializable.fromJSON):void 0,predefinedId:e.id})});var ALIVE_ERROR="entity is already dead",Entity=function(e){function t(){e.call(this,"ent"),this.components=new Map,this.alive=!0,this.sleeping=!1,this.prototype=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getComponent=function(e){assert(this.alive,ALIVE_ERROR);var t=this.components.get(e);return void 0!==t?t[0]:null},t.prototype.getComponents=function(e){return assert(this.alive,ALIVE_ERROR),this.components.get(e)||[]},t.prototype.addComponents=function(e){var o=this;assert(this.alive,ALIVE_ERROR),assert(Array.isArray(e),"Parameter is not an array.");for(var r=0;r<e.length;r++){var n=o.components.get(e[r].name)||o.components.set(e[r].name,[]).get(e[r].name);n.push(e[r])}return this.sleeping||t.initComponents(e),this},t.initComponents=function(e){for(var t=0;t<e.length;t++)e[t]._preInit();for(var o=0;o<e.length;o++)e[o]._init()},t.makeComponentsSleep=function(e){for(var t=0;t<e.length;t++)e[t]._sleep()},t.deleteComponents=function(e){for(var t=0;t<e.length;t++)e[t].delete()},t.prototype.sleep=function(){var e=this;if(assert(this.alive,ALIVE_ERROR),this.sleeping)return!1;for(var o=0,r=e.components;o<r.length;o+=1){var n=r[o];t.makeComponentsSleep(n)}return this.sleeping=!0,!0},t.prototype.wakeUp=function(){var e=this;if(assert(this.alive,ALIVE_ERROR),!this.sleeping)return!1;for(var o=0,r=e.components;o<r.length;o+=1){var n=r[o];t.initComponents(n)}return this.sleeping=!1,!0},t.prototype.delete=function(){var o=this;assert(this.alive,ALIVE_ERROR),this.sleep(),e.prototype.delete.call(this),this.alive=!1;for(var r=0,n=o.components;r<n.length;r+=1){var i=n[r];t.deleteComponents(i)}this.components.clear()},t.prototype.toJSON=function(){return assert(this.alive,ALIVE_ERROR),Object.assign(e.prototype.toJSON.call(this),{components:[]})},t}(Serializable);!function(){var e=new Serializable("tes");Serializable.registerSerializable("tes",function(e){return new Serializable(null,e.id)});var t=e.id;assert("string"==typeof t&&t.length>10);var o=e.toJSON();assert(o&&"object"==typeof o&&"string"==typeof o.id),e.delete(),e=Serializable.fromJSON(o),assert("string"==typeof e.id&&e.id.length>10&&e.id===t),console.log("Serializable tests OK")}(),function(){var e=new Entity;assert(0===e.components.size),assert(null===e.getComponent("moi")),assert(0===e.getComponents("moi").length),console.log("Entity tests OK")}(),function(){assert(4===createPropertyType.float.default().validate("4")),assert(1===createPropertyType.float.range(0,1).validate(3)),console.log("PropertyType tests OK")}(),Component.register({name:"Example",description:"Description of what this component does",category:"Core",icon:"fa-circle",requirements:["Position"],children:["Image","Image","Sound"],properties:[createPropertyType("variable",.5,createPropertyType.float,createPropertyType.float.range(0,1),"Description of the property"),createPropertyType("otherVar_iaerfperfjoierj","Hello",createPropertyType.string,"Description of the property")],parentClass:Component,prototype:{staticVariable:"Example class info",constructor:function(){this.hiddenVariable=3},preInit:function(){this.data={lotsOfData:123+this.variable+this.hiddenVariable}},init:function(){this.Position.x=this.Position.y+1,this.howToAccessChildren=[this.children.Image[0].property,this.children.Sound.property],this.SomeComponent=this.entity.getComponent("SomeComponent")},sleep:function(){this.data=null,this.SomeComponent=null,this.howToAccessChildren=null},delete:function(){}}});var listeners={},events={listen:function(e,t){return listeners.hasOwnProperty(e)||(listeners[e]=[]),listeners[e].push(t),function(){var o=listeners[e].indexOf(t);listeners[e].splice(o,1)}},dispatch:function(e){for(var t=[],o=arguments.length-1;o-- >0;)t[o]=arguments[o+1];if(listeners.hasOwnProperty(e))for(var r=0;r<listeners[e].length;++r)listeners[e][r].apply(null,t)}},HASH="#".charCodeAt(0),DOT=".".charCodeAt(0),elcache={};el.extend=function(e){var t=elcache[e]||(elcache[e]=createElement(e));return el.bind(this,t)},List.extend=function(e,t,o,r){return List.bind(List,e,t,o,r)},list.extend=List.extend,List.prototype.update=function(e){void 0===e&&(e=[]);for(var t=this.View,o=this.key,r="function"==typeof o,n=this.initData,i=new Array(e.length),s=this.views,a=o&&{},p=o&&this.lookup,l=0;l<e.length;l++){var c=e[l],u=void 0;if(o){var d=r?o(c):c[o];u=i[l]=p[d]||new t(n,c,l,e),a[d]=u,u.__id=d}else u=i[l]=s[l]||new t(n,c,l,e);var h=u.el;h.__redom_list&&(h=h.el),h.__redom_view=u,u.update&&u.update(c,l,e)}setChildren(this,i),o&&(this.lookup=a),this.views=i};var Router=function(e,t){this.el="string"==typeof e?el(e):e,this.Views=t};Router.prototype.update=function(e,t){if(e!==this.route){var o=this.Views,r=o[e];this.view=r&&new r,this.route=e,setChildren(this.el,[this.view])}this.view&&this.view.update&&this.view.update(t)};var ModuleContainer=function(e,t){var o=this;void 0===e&&(e="unknownClass.anotherClass"),void 0===t&&(t="fa-chevron-left"),this.modules=[],this.packButtonEnabled=!!t,this.el=el("div.moduleContainer.packable."+e,this.packButton=t&&el("i.packButton.button.iconButton.fa."+t),this.tabs=list("div.tabs",ModuleTab),this.moduleElements=el("div.moduleElements")),t&&(this.el.onclick=function(){return o.el.classList.contains("packed")&&o.el.classList.remove("packed")},this.packButton.onclick=function(e){o.el.classList.add("packed"),e.stopPropagation()}),events.listen("registerModule_"+e.split(".")[0],function(e,t){var r=new e;r.editor=t,r.state=t.state,r.el.classList.add("module-"+r.id),o.modules.push(r),1!==o.modules.length&&r._hide(),mount(o.moduleElements,r.el),o._updateTabs(),events.listen("activateModule_"+r.id,function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];void 0===e&&(e=!0),e&&o.el.classList.remove("packed"),o._activateModule(r,t)})}),this._updateTabs()};ModuleContainer.prototype.update=function(){this.modules.forEach(function(e){return e.update()})},ModuleContainer.prototype._updateTabs=function(){this.tabs&&(this.tabs.update(this.modules),!this.packButtonEnabled&&this.modules.length<=1?this.tabs.el.style.display="none":this.tabs.el.style.display="block")},ModuleContainer.prototype._activateModule=function(e,t){this.modules.indexOf(e);this.modules.forEach(function(t){t!==e&&t._hide()}),e.activate.apply(e,t),e._show(),this._updateTabs()};var ModuleTab=function(){var e=this;this.el=el("span.moduleTab.button"),this.module=null,this.el.onclick=function(){events.dispatch("activateModule_"+e.module.id)}};ModuleTab.prototype.update=function(e){this.module=e,this.el.textContent=e.name,this.el.classList.toggle("active",e._visible)};var Layout=function(){var e=this;this.moduleContainers=[];var t=function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];var r=new(Function.prototype.bind.apply(ModuleContainer,[null].concat(t)));return e.moduleContainers.push(r),r};this.el=el("div.editorLayout",el("div.nonRight",t("top",null),el("div.bottomLeft",t("left","fa-chevron-left"),el("div.middle",t("center",null),t("bottom","fa-chevron-down")))),t("right","fa-chevron-right"))};Layout.prototype.update=function(e){this.moduleContainers.forEach(function(t){return t.update(e)})};var Module=function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];this.name=this.name||"Module",this.id=this.id||"module",this.el=el.apply(void 0,["div.module"].concat(t)),this._visible=!0};Module.prototype.activate=function(){},Module.prototype.update=function(){},Module.prototype._show=function(){this.el.classList.remove("hidden"),this._visible=!0},Module.prototype._hide=function(){this.el.classList.add("hidden"),this._visible=!1},Module.activateModule=function(e,t){for(var o=[],r=arguments.length-2;r-- >0;)o[r]=arguments[r+2];void 0===t&&(t=!0),events.dispatch.apply(events,["activateModule_"+e,t].concat(o))},Module.packModuleContainer=function(e){document.querySelectorAll(".moduleContainer."+e)[0].classList.add("packed")},Module.unpackModuleContainer=function(e){document.querySelectorAll(".moduleContainer."+e)[0].classList.remove("packed")},Module.register=function(e,t){registerPromise=registerPromise.then(function(o){return events.dispatch("registerModule_"+t,e,o),o})};var nextTopBarPriorityNumber=1;Module.registerTopButton=function(e,t,o,r){void 0===r&&(r=nextTopBarPriorityNumber++),registerPromise=registerPromise.then(function(n){return events.dispatch("registerTopButton",e,t,o,r),n})};var registerPromise=new Promise(function(e){events.listen("registerModules",function(t){registerPromise.then(function(e){return events.dispatch("modulesRegistered"),e}),e(t)})}),TopBarModule=function(e){function t(){e.call(this,this.logo=el("img.logo.button.iconButton",{src:"../img/logo_reflection_medium.png"}),this.list=list("div.buttonContainer",TopButton)),this.id="topbar",this.name="TopBar"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){this.list.update(this.state.topButtons)},t}(Module);Module.register(TopBarModule,"top"),Module.registerTopButton("Bell Types","fa fa-bell-o",function(){Module.unpackModuleContainer("bottom"),Module.activateModule("types"),Module.activateModule("type")},1),Module.registerTopButton("Cube Instances","fa fa-cubes",function(){Module.activateModule("instances"),Module.activateModule("instance")},2);var TopButton=function(){var e=this;this.el=el("div.button.topIconTextButton",el("div.topIconTextButtonContent",this.icon=el("i.fa"),this.text=el("span"))),this.el.onclick=function(){e.callback&&e.callback()},this.callback=null};TopButton.prototype.update=function(e){this.icon.className=e.icon,this.text.textContent=e.text,this.callback=e.func};var propertyTypeToEditorType={float:"number",string:"text"},PropertyModule=function(e){function t(){e.call(this,this.propertyEditor=el("div.propertyEditor","hei")),this.id="type",this.name="Type"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){this.componentClasses=this.state.componentClasses;var e={editors:[{field:"yks",title:"YKS",type:"text"}]},t={},o=Array.from(this.componentClasses.values());o.forEach(function(o){var r={type:"group",field:o.name,title:o.name,editors:o._propertyTypes.map(function(e){return{field:o.name+"."+e.name,title:e.name.length>30?e.name.substring(0,28)+"..":e.name,type:propertyTypeToEditorType[e.type.name]||"text"}})};e.editors.push(r);var n={};o._propertyTypes.forEach(function(e){n[e.name]=e.initialValue}),t[o.name]=n}),new PJS($(this.propertyEditor),e,t)},t}(Module);Module.register(PropertyModule,"right");var propertyTypeToEditorType$1={float:"number",string:"text"},PropertyModule$1=function(e){function t(){e.call(this,this.propertyEditor=el("div.propertyEditor","hei")),this.id="instance",this.name="Instance"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){this.componentClasses=this.state.componentClasses;var e={editors:[{field:"yks",title:"YKS",type:"text"}]},t={},o=Array.from(this.componentClasses.values());o.forEach(function(o){var r={type:"group",field:o.name,title:o.name,editors:o._propertyTypes.map(function(e){return{field:o.name+"."+e.name,title:e.name.length>30?e.name.substring(0,28)+"..":e.name,type:propertyTypeToEditorType$1[e.type.name]||"text"}})};e.editors.push(r);var n={};o._propertyTypes.forEach(function(e){n[e.name]=e.initialValue}),t[o.name]=n}),new PJS($(this.propertyEditor),e,t)},t}(Module);Module.register(PropertyModule$1,"right");var SceneModule=function(e){function t(){e.call(this,this.content=el("span","moi test")),this.id="scene",this.name="Scene"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){},t}(Module);Module.register(SceneModule,"center");var Types=function(e){function t(){var t=this;e.call(this,this.addButton=el("span.addTypeButton.button.fa.fa-plus"),this.search=el("input"),this.searchIcon=el("i.fa.fa-search.searchIcon"),this.jstree=el("div")),this.id="types",this.name="Types",this.addButton.onclick=function(){t.state.game.prototypes.push(Prototype.createHelper(""+Math.random())),t.editor.update()};var o=!1;this.search.addEventListener("keyup",function(){o&&clearTimeout(o),o=setTimeout(function(){$(t.jstree).jstree().search(t.search.value.trim())},200)})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){var e=this;if(!this.skipUpdate){var t=this.state.game.prototypes.map(function(e){return{text:e.name,id:e.id,parent:e.parent||"#"}});this.jstreeInited?($(this.jstree).jstree(!0).settings.core.data=t,$(this.jstree).jstree("refresh")):($(this.jstree).attr("id","types-jstree").on("changed.jstree",function(t,o){e.skipUpdate=!0,e.editor.select(o.selected.map(getSerializable)),e.skipUpdate=!1}).on("loaded.jstree refresh.jstree",function(){var t=$(e.jstree).jstree(!0);"none"===e.state.selection.type&&t.select_node(),"prt"===e.state.selection.type}).jstree({core:{check_callback:!0,data:t,force_text:!0},plugins:["types","dnd","sort","search"],types:{default:{icon:"fa fa-book"}},dnd:{copy:!1},search:{fuzzy:!0,show_only_matches:!0,show_only_matches_children:!0,close_opened_onclear:!1}}),this.jstreeInited=!0),$(this.jstree).data("typesModule",this),"none"===this.state.selection.type}},t}(Module);$(document).on("dnd_stop.vakata",function(e,t){console.log("dnd_stop start",e,t);var o=$("#types-jstree").jstree(!0),r=$("#types-jstree").data("typesModule");setTimeout(function(){var e=o.get_node(t.data.obj),n=t.data.nodes,i=e.parent;"#"===i&&(i=null);var s=n.map(getSerializable);s.forEach(assert),s.forEach(function(e){return e.parent=i}),console.log("dnd stopped from",n,"to",i),r.editor.save()})}),Module.register(Types,"left");var TestModule=function(e){function t(){e.call(this,this.content=el("span","List of instances on the scene")),this.name="Instances",this.id="instances"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){},t}(Module);Module.register(TestModule,"left");var TestModule$1=function(e){function t(){e.call(this,this.content=el("span","This is test 3")),this.id="test",this.name="Test3"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){},t}(Module);Module.register(TestModule$1,"bottom"),window.addEventListener("load",function(){var e;try{e=Serializable.fromJSON(JSON.parse(localStorage.anotherGameJSON))}catch(e){}editor=new Editor(e),events.dispatch("registerModules",editor)}),events.listen("modulesRegistered",function(){editor.update(),events.dispatch("loaded")});var editor=null,Editor=function(e){var t=this;void 0===e&&(e=new Game),this.layout=new Layout,this.state={topButtons:[],selection:{type:"none",items:[]},game:e,componentClasses:componentClasses},mount(document.body,this.layout),events.listen("registerTopButton",function(e,o,r,n){for(var i={icon:o,text:e,func:r,priority:n},s=0,a=t.state.topButtons;s<a.length;){var p=a[s];if(p.priority>n){a.splice(s,0,i),s=-1;break}s++}s>=0&&a.push(i)}),events.listen("requestUpdate",function(){console.log("requested"),t.update()})};Editor.prototype.select=function(e){this.state.selection.items=e;var t=Array.from(new Set(e.map(function(e){return e.id.substring(0,3)})));0===t.length?this.state.selection.type="none":1===t.length?this.state.selection.type=t[0]:this.state.selection.type="mixed",this.update()},Editor.prototype.update=function(){this.layout.update(this.state)},Editor.prototype.save=function(){try{localStorage.anotherGameJSON=JSON.stringify(this.state.game.toJSON()),console.log("saved")}catch(e){}},window.Property=Property,window.PropertyModel=createPropertyType,window.Component=Component;
//# sourceMappingURL=explore.dev.min.js.map
