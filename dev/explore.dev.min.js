function assert(t,e){if(!t)throw new Error(e)}function addSerializable(t){if(serializables[t.id])throw new Error("Serializable id clash!");serializables[t.id]=t}function getSerializable(t){return serializables[t]||null}function removeSerializable(t){if(!serializables[t])throw new Error("Serializable not found!");delete serializables[t]}function char(){return CHARACTERS[Math.random()*CHAR_COUNT|0]}function createStringId(t,e){void 0===t&&(t="???"),void 0===e&&(e=16);for(var o=t,n=e-1;0!==n;--n)o+=char();return o}function createPropertyType(t,e,o){for(var n=[],r=arguments.length-3;r-- >0;)n[r]=arguments[r+3];o=o();var i=o.validators.default(),a="";return n.forEach(function(t){"string"==typeof t?a=t:t&&t.validate?i=t:assert(!1,"invalid parameter "+t)}),new PropertyType(t,o,i,e)}function addDataType(t){var e=t.name;void 0===e&&(e="");var o=t.validators;void 0===o&&(o={default:function(t){return t}});var n=t.toJSON;void 0===n&&(n=function(t){return t});var r=t.fromJSON;void 0===r&&(r=function(t){return t}),assert(e,"name missing from property type"),assert("function"==typeof o.default,"default validator missing from property type: "+e),assert("function"==typeof n,"invalid toJSON for property type: "+e),assert("function"==typeof r,"invalid fromJSON for property type: "+e);var i={name:e,validators:o,toJSON:n,fromJSON:r},a=function(){return i};Object.keys(o).forEach(function(t){a[t]=createValidator(t,o[t]),o[t]=a[t]}),createPropertyType[e]=a}function createValidator(t,e){var o=function(){for(var o=arguments.length,n=Array(o);o--;)n[o]=arguments[o];var r=[].concat(n);return{validatorName:t,validatorParameters:r,validate:function(t){return e.apply(void 0,[t].concat(r))}}};return o.validatorName=t,o.validate=e,o}function createElement(t,e){for(var o,n,r,i=0,a=0,s=0;s<=t.length;s++){var l=t.charCodeAt(s);if(l===HASH||l===DOT||!l){if(0===i)o=0===s?"div":l?t.substring(a,s):t;else{var p=t.substring(a,s);1===i?n=p:r?r+=" "+p:r=p}a=s+1,i=l===HASH?1:2}}var c=e?document.createElementNS(e,o):document.createElement(o);return n&&(c.id=n),r&&(c.className=r),c}function text(t){return document.createTextNode(t)}function mount(t,e,o){var n=t.el||t,r=e.el||e;r.__redom_list&&(r=r.el),e===r&&r.__redom_view&&(e=r.__redom_view),e!==r&&(r.__redom_view=e),e.isMounted?e.remount&&e.remount():e.mount&&e.mount(),o?n.insertBefore(r,o.el||o):n.appendChild(r),e.isMounted?e.remounted&&e.remounted():(e.isMounted=!0,e.mounted&&e.mounted())}function unmount(t,e){var o=t.el||t,n=e.el||e;e===n&&n.__redom_view&&(e=n.__redom_view),e.unmount&&e.unmount(),o.removeChild(n),e.isMounted=!1,e.unmounted&&e.unmounted()}function el(t){var e,o=arguments;if("string"==typeof t)e=(elcache[t]||(elcache[t]=createElement(t))).cloneNode(!1);else{if(!t||!t.nodeType)throw new Error("At least one argument required");e=t.cloneNode(!1)}for(var n=!0,r=1;r<arguments.length;r++){var i=o[r];if(i)if("function"==typeof i)i(e);else if("string"==typeof i||"number"==typeof i)n?(n=!1,e.textContent=i):e.appendChild(text(i));else if(i.nodeType||i.el&&i.el.nodeType)n=!1,mount(e,i);else if(i.length){n=!1;for(var a=0;a<i.length;a++)mount(e,i[a])}else if("object"==typeof i)for(var s in i){var l=i[s];if("style"===s)if("string"==typeof l)e.setAttribute(s,l);else for(var p in l)e.style[p]=l[p];else s in e||"function"==typeof l?e[s]=l:e.setAttribute(s,l)}}return e}function setChildren(t,e){for(var o=t.el||t,n=o.firstChild,r=0;r<e.length;r++){var i=e[r];if(i){var a=i.el||i;a!==n?mount(t,i,n):n=n.nextSibling}}for(;n;){var s=n.nextSibling;unmount(t,n),n=s}}function list(t,e,o,n){return new List(t,e,o,n)}function List(t,e,o,n){this.__redom_list=!0,this.View=e,this.key=o,this.initData=n,this.views=[],this.el="string"==typeof t?el(t):t,o&&(this.lookup={})}var serializables={},CHARACTERS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",CHAR_COUNT=CHARACTERS.length,serializableClasses=new Map,Serializable=function(t,e){void 0===e&&(e=!1),this.id=e||createStringId(t),addSerializable(this)};Serializable.prototype.delete=function(){removeSerializable(this.id)},Serializable.prototype.toJSON=function(){return{id:this.id}},Serializable.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,4)},Serializable.fromJSON=function t(e){assert("string"==typeof e.id&&e.id.length>3);var t=serializableClasses.get(e.id.substring(0,3));return assert(t),t(e)},Serializable.registerSerializable=function(t,e){assert("string"==typeof t&&3===t.length),assert("function"==typeof e),serializableClasses.set(t,e)};var PropertyType=function(t){function e(e,o,n,r){assert("string"==typeof e),assert("string"==typeof o.name),assert("function"==typeof n.validate),t.call(this,"pmo"),this.name=e,this.type=o,this.validator=n,this.initialValue=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return Object.assign(t.prototype.toJSON.call(this),{name:this.name,type:this.type.name,validatorName:this.validator.validatorName,validatorParameters:this.validator.validatorParameters,initialValue:this.type.toJSON(this.initialValue)})},e.prototype.delete=function(){t.prototype.delete.call(this),this.type=null,this.validator=null},e}(Serializable);addDataType({name:"float",validators:{default:function(t){return t=parseFloat(t),assert(!isNaN(t),"invalid float: "+t),t},range:function(t,e,o){return t=parseFloat(t),assert(!isNaN(t),"invalid float: "+t),Math.min(o,Math.max(e,t))}},toJSON:function(t){return t},fromJSON:function(t){return t}}),addDataType({name:"string",validators:{default:function(t){return String(t)}},toJSON:function(t){return t},fromJSON:function(t){return t}});var Property=function(t){function e(e){t.call(this,"pro"),this.model=e,this.value=e.initialValue}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return Object.assign(t.prototype.toJSON.call(this),{value:this.type.toJSON(this.value),modelId:this.model.id})},e.prototype.delete=function(){t.prototype.delete.call(this),this.model=null},e}(Serializable);Object.defineProperty(Property.prototype,"type",{get:function(){return this.model.type}}),Object.defineProperty(Property.prototype,"value",{set:function(t){this._value=this.model.validator.validate(t)},get:function(){return this._value}}),Object.defineProperty(Property.prototype,"initialValue",{get:function(){return this.model.initialValue}});var componentClasses=new Map,Component=function(t){function e(e,o,n){var r=this;t.call(this,"com"),this.entity=o,this.env=n,this.children={},this._properties={},this._componentData=e,this.constructor.propertyTypes.forEach(function(t){r._properties[t.name]=new Property(t)})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.delete=function(){assert(!this.env.entity.alive,"Do not call Component.delete!"),t.prototype.delete.call(this)},e.prototype._preInit=function(){var t=this;this.constructor.requirements.forEach(function(e){t[e]=t.entity.getComponent(e),assert(t[e],"required component not found")}),this._forEachChildComponent(function(t){return t._preInit()});try{"function"==typeof this.preInit&&this.preInit()}catch(t){console.error(this.entity,this.constructor.name,"preInit",t)}},e.prototype._init=function(){this._forEachChildComponent(function(t){return t._init()});try{"function"==typeof this.init&&this.init()}catch(t){console.error(this.entity,this.constructor.name,"init",t)}},e.prototype._sleep=function(){try{"function"==typeof this.sleep&&this.sleep()}catch(t){console.error(this.entity,this.constructor.name,"sleep",t)}this._forEachChildComponent(function(t){return t._sleep()})},e.prototype._forEachChildComponent=function(t){var e=this;Object.keys(this.children).forEach(function(o){var n=e.children[o];Array.isArray(n)?n.forEach(t):t(n)})},e}(Serializable);Component.reservedPropertyNames=new Set(["id","constructor","delete","children","entity","env","init","preInit","sleep","_preInit","_init","_sleep","_forEachChildComponent","_properties","_componentData","toJSON","fromJSON"]),Component.reservedPrototypeMembers=new Set(["id","children","entity","env","_preInit","_init","_sleep","_forEachChildComponent","_properties","_componentData","toJSON","fromJSON"]),Component.register=function(t){var e=t.name;void 0===e&&(e="");var o=t.description;void 0===o&&(o="");var n=t.category;void 0===n&&(n="Other");var r=t.icon;void 0===r&&(r="fa-bars");var i=t.properties;void 0===i&&(i=[]);var a=t.requirements;void 0===a&&(a=[]);var s=t.children;void 0===s&&(s=[]);var l=t.parentClass;void 0===l&&(l=Component);var p=t.prototype;void 0===p&&(p={}),assert(e,"Component must have a name."),assert(!componentClasses.has(e),"Duplicate component class "+e),Object.keys(p).forEach(function(t){Component.reservedPrototypeMembers.has(t)&&assert(!1,"Component prototype can not have a reserved member: "+t)});var c=p.constructor,u=p.delete;delete p.constructor,delete p.delete;var d=function(t){function e(){t.apply(this,arguments),c&&c()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.delete=function(){t.prototype.delete.apply(this,arguments),u&&u()},e}(l);return Object.defineProperty(d,"name",{get:function(){return e}}),d.propertyTypes=i,d.propertyTypeMap=new Map,d.category=n,d.requirements=a,d.children=s,d.description=o,d.icon=r,Object.assign(d.prototype,p),d.propertyTypes.forEach(function(t){d.propertyTypeMap.set(t.name,t),assert(!Component.reservedPropertyNames.has(t.name),"Can not have property called "+t.name),assert(void 0===d.prototype[t.name],"Name "+t.name+" clashes "),Object.defineProperty(d.prototype,t.name,{get:function(){return this._properties[t.name].value},set:function(e){this._properties[t.name].value=e}})}),componentClasses.set(d.name,d),d},Component.register({name:"Position",category:"Core",icon:"fa-circle",properties:[createPropertyType("x",.1,createPropertyType.float),createPropertyType("y",.2,createPropertyType.float)]}),Component.register({name:"Test",category:"Core",icon:"fa-circle",properties:[createPropertyType("name","Oh right",createPropertyType.string),createPropertyType("number",666,createPropertyType.float)]});var Prototype=function(t){function e(e){var o=e.name;void 0===o&&(o="No name");var n=e.parentId;void 0===n&&(n=null);var r=e.componentDatas;void 0===r&&(r=new Map);var i=e.predefinedId;void 0===i&&(i=!1),t.call(this,"prt",i),this.name=o,this.parentId=n,this.componentDatas=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getParent=function(){return this.parentId&&getSerializable(this.parentId)},e.prototype.toJSON=function(){return Object.assign(t.prototype.toJSON.call(this),{nm:this.name,mom:this.parentId||void 0})},e}(Serializable);Serializable.registerSerializable("prt",function(t){return assert(t.nm),new Prototype({name:t.nm,parentId:t.mom,predefinedId:t.id})});var Game=function(t){function e(e){void 0===e&&(e={});var o=e.name;void 0===o&&(o="Game");var n=e.prototypes;void 0===n&&(n=[]);var r=e.predefinedId;void 0===r&&(r=!1),t.call(this,"gam",r),this.prototypes=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return Object.assign(t.prototype.toJSON.call(this),{nm:this.name,prt:this.prototypes.map(function(t){return t.toJSON()})})},e}(Serializable);Serializable.registerSerializable("gam",function(t){return new Game({name:t.nm||void 0,prototypes:t.prt?t.prt.map(Serializable.fromJSON):void 0,predefinedId:t.id})});var ALIVE_ERROR="entity is already dead",Entity=function(t){function e(){t.call(this,"ent"),this.components=new Map,this.alive=!0,this.sleeping=!1,this.prototype=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getComponent=function(t){assert(this.alive,ALIVE_ERROR);var e=this.components.get(t);return void 0!==e?e[0]:null},e.prototype.getComponents=function(t){return assert(this.alive,ALIVE_ERROR),this.components.get(t)||[]},e.prototype.addComponents=function(t){var o=this;assert(this.alive,ALIVE_ERROR),assert(Array.isArray(t),"Parameter is not an array.");for(var n=0;n<t.length;n++){var r=o.components.get(t[n].name)||o.components.set(t[n].name,[]).get(t[n].name);r.push(t[n])}return this.sleeping||e.initComponents(t),this},e.initComponents=function(t){for(var e=0;e<t.length;e++)t[e]._preInit();for(var o=0;o<t.length;o++)t[o]._init()},e.makeComponentsSleep=function(t){for(var e=0;e<t.length;e++)t[e]._sleep()},e.deleteComponents=function(t){for(var e=0;e<t.length;e++)t[e].delete()},e.prototype.sleep=function(){var t=this;if(assert(this.alive,ALIVE_ERROR),this.sleeping)return!1;for(var o=0,n=t.components;o<n.length;o+=1){var r=n[o];e.makeComponentsSleep(r)}return this.sleeping=!0,!0},e.prototype.wakeUp=function(){var t=this;if(assert(this.alive,ALIVE_ERROR),!this.sleeping)return!1;for(var o=0,n=t.components;o<n.length;o+=1){var r=n[o];e.initComponents(r)}return this.sleeping=!1,!0},e.prototype.delete=function(){var o=this;assert(this.alive,ALIVE_ERROR),this.sleep(),t.prototype.delete.call(this),this.alive=!1;for(var n=0,r=o.components;n<r.length;n+=1){var i=r[n];e.deleteComponents(i)}this.components.clear()},e.prototype.toJSON=function(){return assert(this.alive,ALIVE_ERROR),Object.assign(t.prototype.toJSON.call(this),{components:[]})},e}(Serializable);!function(){var t=new Serializable("tes");Serializable.registerSerializable("tes",function(t){return new Serializable(null,t.id)});var e=t.id;assert("string"==typeof e&&e.length>10);var o=t.toJSON();assert(o&&"object"==typeof o&&"string"==typeof o.id),t.delete(),t=Serializable.fromJSON(o),assert("string"==typeof t.id&&t.id.length>10&&t.id===e),console.log("Serializable tests OK")}(),function(){var t=new Entity;assert(0===t.components.size),assert(null===t.getComponent("moi")),assert(0===t.getComponents("moi").length),console.log("Entity tests OK")}(),function(){assert(4===createPropertyType.float.default().validate("4")),assert(1===createPropertyType.float.range(0,1).validate(3)),console.log("PropertyType tests OK")}(),Component.register({name:"Example",description:"Description of what this component does",category:"Core",icon:"fa-circle",requirements:["Position"],children:["Image","Image","Sound"],properties:[createPropertyType("variable",.5,createPropertyType.float,createPropertyType.float.range(0,1),"Description of the property"),createPropertyType("otherVar_iaerfperfjoierj","Hello",createPropertyType.string,"Description of the property")],parentClass:Component,prototype:{staticVariable:"Example class info",constructor:function(){this.hiddenVariable=3},preInit:function(){this.data={lotsOfData:123+this.variable+this.hiddenVariable}},init:function(){this.Position.x=this.Position.y+1,this.howToAccessChildren=[this.children.Image[0].property,this.children.Sound.property],this.SomeComponent=this.entity.getComponent("SomeComponent")},sleep:function(){this.data=null,this.SomeComponent=null,this.howToAccessChildren=null},delete:function(){}}});var listeners={},events={listen:function(t,e){return listeners.hasOwnProperty(t)||(listeners[t]=[]),listeners[t].push(e),function(){var o=listeners[t].indexOf(e);listeners[t].splice(o,1)}},dispatch:function(t,e){if(listeners.hasOwnProperty(t)){Array.isArray(e)||(e=[e]);for(var o=0;o<listeners[t].length;++o)listeners[t][o].apply(null,e)}}},HASH="#".charCodeAt(0),DOT=".".charCodeAt(0),elcache={};el.extend=function(t){var e=elcache[t]||(elcache[t]=createElement(t));return el.bind(this,e)},List.extend=function(t,e,o,n){return List.bind(List,t,e,o,n)},list.extend=List.extend,List.prototype.update=function(t){void 0===t&&(t=[]);for(var e=this.View,o=this.key,n="function"==typeof o,r=this.initData,i=new Array(t.length),a=this.views,s=o&&{},l=o&&this.lookup,p=0;p<t.length;p++){var c=t[p],u=void 0;if(o){var d=n?o(c):c[o];u=i[p]=l[d]||new e(r,c,p,t),s[d]=u,u.__id=d}else u=i[p]=a[p]||new e(r,c,p,t);var h=u.el;h.__redom_list&&(h=h.el),h.__redom_view=u,u.update&&u.update(c,p,t)}setChildren(this,i),o&&(this.lookup=s),this.views=i};var Router=function(t,e){this.el="string"==typeof t?el(t):t,this.Views=e};Router.prototype.update=function(t,e){if(t!==this.route){var o=this.Views,n=o[t];this.view=n&&new n,this.route=t,setChildren(this.el,[this.view])}this.view&&this.view.update&&this.view.update(e)};var ModuleContainer=function(t,e){var o=this;void 0===t&&(t="unknownClass.anotherClass"),void 0===e&&(e="fa-chevron-left"),this.modules=[],this.packButtonEnabled=!!e,this.el=el("div.moduleContainer.packable."+t,this.packButton=e&&el("i.packButton.button.iconButton.fa."+e),this.tabs=list("div.tabs",ModuleTab),this.moduleElements=el("div.moduleElements")),e&&(this.el.onclick=function(){return o.el.classList.contains("packed")&&o.el.classList.remove("packed")},this.packButton.onclick=function(t){o.el.classList.add("packed"),t.stopPropagation()}),events.listen("registerModule_"+t.split(".")[0],function(t){var e=new t;e.el.classList.add("module-"+e.id),o.modules.push(e),1!==o.modules.length&&e._hide(),mount(o.moduleElements,e.el),o._updateTabs(),events.listen("activateModule_"+e.id,function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];void 0===t&&(t=!0),t&&o.el.classList.remove("packed"),o._activateModule(e,n)})}),this._updateTabs()};ModuleContainer.prototype.update=function(t){t=t||{},this.modules.forEach(function(e){return e.update(t)})},ModuleContainer.prototype._updateTabs=function(){this.tabs&&(this.tabs.update(this.modules),!this.packButtonEnabled&&this.modules.length<=1?this.tabs.el.style.display="none":this.tabs.el.style.display="block")},ModuleContainer.prototype._activateModule=function(t,e){this.modules.indexOf(t);this.modules.forEach(function(e){e!==t&&e._hide()}),t.activate.apply(t,e),t._show(),this._updateTabs()};var ModuleTab=function(){var t=this;this.el=el("span.moduleTab.button"),this.module=null,this.el.onclick=function(){events.dispatch("activateModule_"+t.module.id)}};ModuleTab.prototype.update=function(t){this.module=t,this.el.textContent=t.name,this.el.classList.toggle("active",t._visible)};var Layout=function(){var t=this;this.moduleContainers=[];var e=function(){for(var e=[],o=arguments.length;o--;)e[o]=arguments[o];var n=new(Function.prototype.bind.apply(ModuleContainer,[null].concat(e)));return t.moduleContainers.push(n),n};this.el=el("div.editorLayout",el("div.nonRight",e("top",null),el("div.middle",e("left","fa-chevron-left"),e("center",null)),e("bottom","fa-chevron-down")),e("right","fa-chevron-right"))};Layout.prototype.update=function(t){this.moduleContainers.forEach(function(e){return e.update(t)})};var Module=function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];this.name=this.name||"Module",this.id=this.id||"module",this.el=el.apply(void 0,["div.module"].concat(e)),this._visible=!0};Module.prototype.activate=function(){},Module.prototype.update=function(t){},Module.prototype._show=function(){this.el.classList.remove("hidden"),this._visible=!0},Module.prototype._hide=function(){this.el.classList.add("hidden"),this._visible=!1},Module.activateModule=function(t,e){for(var o=[],n=arguments.length-2;n-- >0;)o[n]=arguments[n+2];void 0===e&&(e=!0),events.dispatch("activateModule_"+t,[e].concat(o))},Module.packModuleContainer=function(t){document.querySelectorAll(".moduleContainer."+t)[0].classList.add("packed")},Module.unpackModuleContainer=function(t){document.querySelectorAll(".moduleContainer."+t)[0].classList.remove("packed")},Module.requestUpdate=function(){events.dispatch("requestUpdate")},Module.register=function(t,e){registerPromise=registerPromise.then(function(){events.dispatch("registerModule_"+e,[t])})};var nextPriorityNumber=1;Module.registerTopButton=function(t,e,o,n){void 0===n&&(n=nextPriorityNumber++),registerPromise=registerPromise.then(function(){events.dispatch("registerTopButton",[t,e,o,n])})};var registerPromise=new Promise(function(t){events.listen("registerModules",function(){registerPromise.then(function(){events.dispatch("modulesRegistered")}),t()})}),TopBarModule=function(t){function e(){t.call(this,this.logo=el("img.logo.button.iconButton",{src:"../img/logo_reflection_medium.png"}),this.list=list("div.buttonContainer",TopButton)),this.id="topbar",this.name="TopBar"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(t){this.list.update(t.topButtons)},e}(Module);Module.register(TopBarModule,"top"),Module.registerTopButton("Bell Types","fa fa-bell-o",function(){Module.unpackModuleContainer("bottom"),Module.activateModule("types"),Module.activateModule("type")},1),Module.registerTopButton("Cube Instances","fa fa-cubes",function(){Module.activateModule("instances"),Module.activateModule("instance")},2);var TopButton=function(){var t=this;this.el=el("div.button.topIconTextButton",el("div.topIconTextButtonContent",this.icon=el("i.fa"),this.text=el("span"))),this.el.onclick=function(){t.callback&&t.callback()},this.callback=null};TopButton.prototype.update=function(t){this.icon.className=t.icon,this.text.textContent=t.text,this.callback=t.func};var propertyTypeToEditorType={float:"number",string:"text"},PropertyModule=function(t){function e(){t.call(this,this.editor=el("div.propertyEditor","hei")),this.id="type",this.name="Type"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e),this.componentClasses=e.componentClasses;var o={editors:[{field:"yks",title:"YKS",type:"text"}]},n={},r=Array.from(this.componentClasses.values());r.forEach(function(t){var e={type:"group",field:t.name,title:t.name,editors:t.propertyTypes.map(function(e){return{field:t.name+"."+e.name,title:e.name.length>30?e.name.substring(0,28)+"..":e.name,type:propertyTypeToEditorType[e.type.name]||"text"}})};o.editors.push(e);var r={};t.propertyTypes.forEach(function(t){r[t.name]=t.initialValue}),n[t.name]=r}),new PJS($(this.editor),o,n)},e}(Module);Module.register(PropertyModule,"right");var propertyTypeToEditorType$1={float:"number",string:"text"},PropertyModule$1=function(t){function e(){t.call(this,this.editor=el("div.propertyEditor","hei")),this.id="instance",this.name="Instance"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e),this.componentClasses=e.componentClasses;var o={editors:[{field:"yks",title:"YKS",type:"text"}]},n={},r=Array.from(this.componentClasses.values());r.forEach(function(t){var e={type:"group",field:t.name,title:t.name,editors:t.propertyTypes.map(function(e){return{field:t.name+"."+e.name,title:e.name.length>30?e.name.substring(0,28)+"..":e.name,type:propertyTypeToEditorType$1[e.type.name]||"text"}})};o.editors.push(e);var r={};t.propertyTypes.forEach(function(t){r[t.name]=t.initialValue}),n[t.name]=r}),new PJS($(this.editor),o,n)},e}(Module);Module.register(PropertyModule$1,"right");var SceneModule=function(t){function e(){t.call(this,this.content=el("span","moi test")),this.id="scene",this.name="Scene"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e)},e}(Module);Module.register(SceneModule,"center");var Types=function(t){function e(){var e=this;t.call(this,this.addButton=el("span.addTypeButton.button.fa.fa-plus"),this.search=el("input"),this.searchIcon=el("i.fa.fa-search.searchIcon"),this.jstree=el("div")),this.id="types",this.name="Types",this.addButton.onclick=function(){e.game.prototypes.push(new Prototype(""+Math.random())),events.dispatch("requestUpdate")};var o=!1;this.search.addEventListener("keyup",function(){o&&clearTimeout(o),o=setTimeout(function(){$(e.jstree).jstree().search(e.search.value.trim())},200)})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){console.log("types update"),t.prototype.update.call(this,e),this.game=e.game;var o=e.game.prototypes.map(function(t){return{text:t.name,id:t.id,parent:t.parentId||"#"}});this.jstreeInited?($(this.jstree).jstree(!0).settings.core.data=o,$(this.jstree).jstree("refresh")):($(this.jstree).attr("id","types-jstree").jstree({core:{check_callback:!0,data:o,force_text:!0},plugins:["types","dnd","sort","search","unique"],types:{default:{icon:"fa fa-book"}},search:{fuzzy:!0,show_only_matches:!0,show_only_matches_children:!0,close_opened_onclear:!1}}),this.jstreeInited=!0)},e}(Module);$(document).on("dnd_stop.vakata",function(t,e){var o=$("#types-jstree").jstree(!0),n=o.get_node(e.data.obj),r=e.data.nodes;setTimeout(function(){var t=n.parent;"#"===t&&(t=null),console.log(r.map(getSerializable));var e=r.map(getSerializable);e.forEach(assert),e.forEach(function(e){return e.parentId=t}),console.log(r.map(getSerializable)),console.log("Nodes "+r+" to "+t)})}),Module.register(Types,"left");var TestModule=function(t){function e(){t.call(this,this.content=el("span","List of instances on the scene")),this.name="Instances",this.id="instances"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e)},e}(Module);Module.register(TestModule,"left");var TestModule$1=function(t){function e(){t.call(this,this.content=el("span","This is test 3")),this.id="test",this.name="Test3"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e)},e}(Module);Module.register(TestModule$1,"bottom"),window.addEventListener("load",function(){var t;try{t=Serializable.fromJSON(JSON.parse(localStorage.anotherGameJSON))}catch(t){}editor=new Editor(t),events.dispatch("registerModules")}),events.listen("modulesRegistered",function(){editor.update(),events.dispatch("loaded")}),setInterval(function(){if(editor&&editor.state.game)try{localStorage.anotherGameJSON=JSON.stringify(editor.state.game.toJSON())}catch(t){}},2e3);var editor=null,Editor=function(t){var e=this;void 0===t&&(t=new Game),this.layout=new Layout,this.state={topButtons:[],selection:{type:"none",items:[]},game:t,componentClasses:componentClasses},mount(document.body,this.layout),events.listen("registerTopButton",function(t,o,n,r){for(var i={icon:o,text:t,func:n,priority:r},a=0,s=e.state.topButtons;a<s.length;){var l=s[a];if(l.priority>r){s.splice(a,0,i),a=-1;break}a++}a>=0&&s.push(i)}),events.listen("requestUpdate",function(){console.log("requested"),e.update()})};Editor.prototype.select=function(t){this.selectedItems=t,this.layout.select(t)},Editor.prototype.update=function(){console.log("update"),this.layout.update(this.state)},window.Property=Property,window.PropertyModel=createPropertyType,window.Component=Component;
//# sourceMappingURL=explore.dev.min.js.map
