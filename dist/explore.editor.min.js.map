{"version":3,"file":null,"sources":["../src/core/serializable.js","../src/core/serializableManager.js","../src/util/assert.js","../src/core/propertyType.js","../src/core/dataTypes.js","../src/util/input.js","../src/util/net.js","../src/editor/events.js","../node_modules/redom/dist/redom.es.js","../src/editor/util/sceneEdit.js","../src/editor/views/propertyEditor.js","../src/util/algorithm.js","../src/editor/editor.js","../src/core/property.js","../src/util/vector.js","../src/core/propertyOwner.js","../src/core/entity.js","../src/core/componentData.js","../src/core/prototype.js","../src/core/game.js","../src/core/scene.js","../src/core/component.js","../src/core/entityPrototype.js","../src/core/level.js","../src/components/Transform.js","../src/components/Test.js","../src/components/Mover.js","../src/components/Rect.js","../src/components/Spawner.js","../src/components/Trigger.js","../src/core/test.js","../src/core/componentExample.js","../src/editor/layout/moduleContainer.js","../src/editor/layout/layout.js","../src/editor/module/module.js","../src/editor/views/popup/popup.js","../src/editor/views/popup/levelSelector.js","../src/editor/module/topBar.js","../src/editor/views/propertyEditorTypes.js","../src/editor/views/popup/componentAdder.js","../src/editor/module/type.js","../src/editor/module/instance.js","../src/editor/help.js","../src/editor/module/scene.js","../src/editor/module/types.js","../src/editor/module/level.js","../src/editor/module/instances.js","../src/editor/module/test3.js","../src/editorMain.js"],"sourcesContent":["import assert from '../util/assert';\nimport * as serializableManager from './serializableManager';\n\nconst CHARACTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; // 62 chars\nconst CHAR_COUNT = CHARACTERS.length;\n\nexport function createStringId(threeLetterPrefix = '???', characters = 16) {\n\tlet id = threeLetterPrefix;\n\tfor (let i = characters - 1; i >= 0; --i)\n\t\tid += CHARACTERS[Math.random() * CHAR_COUNT | 0];\n\treturn id;\n}\n\nlet serializableClasses = new Map();\n\nexport default class Serializable {\n\tconstructor(predefinedId = false, skipSerializableRegistering = false) {\n\t\tassert(this.threeLetterType, 'Forgot to Serializable.registerSerializable your class?');\n\t\tthis._children = new Map(); // threeLetterType -> array\n\t\tthis._listeners = [];\n\t\tthis._isInTree = this.isRoot;\n\t\tthis._state |= Serializable.STATE_CONSTRUCTOR;\n\t\tif (skipSerializableRegistering)\n\t\t\treturn;\n\t\tif (predefinedId) {\n\t\t\tthis._state |= Serializable.STATE_PREDEFINEDID;\n\t\t\tthis.id = predefinedId;\n\t\t} else {\n\t\t\tthis.id = createStringId(this.threeLetterType);\n\t\t}\n\t\tif (this.id.startsWith('?'))\n\t\t\tthrow new Error('?');\n\t\tserializableManager.addSerializable(this);\n\t}\n\tdelete() {\n\t\tif (this._parent) {\n\t\t\tthis._parent.deleteChild(this);\n\t\t\treturn false;\n\t\t}\n\t\tthis.deleteChildren();\n\t\tthis._alive = false;\n\t\tthis._isInTree = false;\n\t\tthis._listeners.length = 0;\n\t\tserializableManager.removeSerializable(this.id);\n\t\tthis._state |= Serializable.STATE_DESTROY;\n\t\treturn true;\n\t}\n\tdeleteChildren() {\n\t\tif (this._children.size) {\n\t\t\tthis._children.forEach(array => {\n\t\t\t\tarray.forEach(child => {\n\t\t\t\t\tchild._parent = null;\n\t\t\t\t\tchild.delete();\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis._children.clear();\n\n\t\t\tif (this._parent) {\n\t\t\t\tserializableManager.addChange(serializableManager.changeType.deleteAllChildren, this);\n\t\t\t}\n\t\t}\n\t}\n\t// this is called right after constructor\n\tinitWithChildren(children = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\t\tif (children.length > 0)\n\t\t\tthis.addChildren(children);\n\t\treturn this;\n\t}\n\taddChildren(children) {\n\t\tfor (let i = 0; i < children.length; i++)\n\t\t\tthis.addChild(children[i]);\n\t\treturn this;\n\t}\n\taddChild(child) {\n\t\t\n\t\tthis._addChild(child);\n\t\t\n\t\t\n\t\tthis._state |= Serializable.STATE_ADDCHILD;\n\t\t\n\t\tif (this._isInTree)\n\t\t\tserializableManager.addChange(serializableManager.changeType.addSerializableToTree, child);\n\t\treturn this;\n\t}\n\t_addChild(child) {\n\t\tassert(child._parent === null);\n\t\t\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tif (array === undefined) {\n\t\t\tarray = [];\n\t\t\tthis._children.set(child.threeLetterType, array);\n\t\t}\n\t\tarray.push(child);\n\t\tchild._parent = this;\n\t\tchild._state |= Serializable.STATE_ADDPARENT;\n\t\tchild.setInTreeStatus(this._isInTree);\n\t\t\n\t\treturn this;\n\t}\n\tfindChild(threeLetterType, filterFunction) {\n\t\tlet array = this._children.get(threeLetterType);\n\t\tif (!array) return null;\n\t\tif (filterFunction)\n\t\t\treturn array.find(filterFunction) || null;\n\t\telse\n\t\t\treturn array[0];\n\t}\n\tfindParent(threeLetterType, filterFunction = null) {\n\t\tlet parent = this;\n\t\twhile (parent) {\n\t\t\tif (parent.threeLetterType === threeLetterType && (!filterFunction || filterFunction(parent)))\n\t\t\t\treturn parent;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn null;\n\t}\n\tgetRoot() {\n\t\tlet element = this;\n\t\twhile (element._parent)\n\t\t\telement = element._parent;\n\t\treturn element;\n\t}\n\t// idx is optional\n\tdeleteChild(child, idx) {\n\t\tserializableManager.addChange(serializableManager.changeType.deleteSerializable, child);\n\t\tthis._detachChild(child, idx);\n\t\tchild.delete();\n\t\treturn this;\n\t}\n\t// idx is optional\n\t_detachChild(child, idx = 0) {\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tassert(array, 'child not found');\n\t\tif (array[idx] !== child)\n\t\t\tidx = array.indexOf(child);\n\t\tassert(idx >= 0, 'child not found');\n\t\tarray.splice(idx, 1);\n\t\tif (array.length === 0)\n\t\t\tthis._children.delete(child.threeLetterType);\n\t\tchild._parent = null;\n\t\tchild.setInTreeStatus(false);\n\t\t\n\t\treturn this;\n\t}\n\tforEachChild(threeLetterType = null, callback, deep = false) {\n\t\tfunction processArray(array) {\n\t\t\tarray.forEach(child => {\n\t\t\t\tcallback(child);\n\t\t\t\tdeep && child.forEachChild(threeLetterType, callback, true);\n\t\t\t});\n\t\t}\n\t\tif (threeLetterType) {\n\t\t\tprocessArray(this._children.get(threeLetterType) || []);\n\t\t} else {\n\t\t\tthis._children.forEach(processArray);\n\t\t}\n\t\treturn this;\n\t}\n\tmove(newParent) {\n\t\t\n\t\tnewParent._addChild(this._detach());\n\n\t\tserializableManager.addChange(serializableManager.changeType.move, this);\n\t\t\n\t\treturn this;\n\t}\n\t_detach() {\n\t\tthis._parent && this._parent._detachChild(this);\n\t\treturn this;\n\t}\n\tgetParent() {\n\t\treturn this._parent || null;\n\t}\n\tgetChildren(threeLetterType) {\n\t\treturn this._children.get(threeLetterType) || [];\n\t}\n\ttoJSON() {\n\t\tlet json = {\n\t\t\tid: this.id\n\t\t};\n\t\tif (this._children.size > 0) {\n\t\t\tlet arrays = [];\n\t\t\t// prototypes must come before a level\n\t\t\tArray.from(this._children.keys()).sort((a, b) => a === 'prt' ? -1 : 1)\n\t\t\t\t.forEach(key => arrays.push(this._children.get(key)));\n\t\t\tjson.c = [].concat(...arrays).map(child => child.toJSON());\n\t\t}\n\t\treturn json;\n\t}\n\ttoString() {\n\t\treturn JSON.stringify(this.toJSON(), null, 4);\n\t}\n\tclone() {\n\t\tlet obj = new this.constructor();\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\tlisten(event, callback) {\n\t\tif (!this._listeners.hasOwnProperty(event)) {\n\t\t\tthis._listeners[event] = [];\n\t\t}\n\t\tthis._listeners[event].unshift(callback);\n\t\treturn () => {\n\t\t\tvar index = this._listeners[event].indexOf(callback);\n\t\t\tthis._listeners[event].splice(index, 1);\n\t\t};\n\t}\n\tdispatch(event, ...args) {\n\t\tif (this._listeners.hasOwnProperty(event)) {\n\t\t\tfor (var i = this._listeners[event].length - 1; i >= 0; --i) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._listeners[event][i].apply(null, args);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.error(`Event ${event} listener crashed.`, this._listeners[event][i], e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\thasDescendant(child) {\n\t\tif (!child) return false;\n\t\tlet parent = child._parent;\n\t\twhile (parent) {\n\t\t\tif (parent === this) return true;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn false;\n\t}\n\tsetInTreeStatus(isInTree) {\n\t\tif (this._isInTree === isInTree)\n\t\t\treturn;\n\t\t\n\t\tthis._isInTree = isInTree;\n\t\tthis._children.forEach(array => {\n\t\t\tarray.forEach(child => child.setInTreeStatus(isInTree));\n\t\t});\n\t}\n\tstatic fromJSON(json) {\n\t\tassert(typeof json.id === 'string' && json.id.length > 5, 'Invalid id.');\n\t\tlet fromJSON = serializableClasses.get(json.id.substring(0, 3));\n\t\tassert(fromJSON);\n\t\tlet obj;\n\t\ttry {\n\t\t\tobj = fromJSON(json);\n\t\t} catch(e) {\n\t\t\tif (!window.force)\n\t\t\t\tdebugger; // Type 'force = true' in console to ignore failed imports.\n\t\t\t\n\t\t\tif (!window.force)\n\t\t\t\tthrow new Error();\n\t\t\treturn null;\n\t\t}\n\t\tlet children = json.c ? json.c.map(child => Serializable.fromJSON(child)).filter(Boolean) : [];\n\t\tif (obj._state & Serializable.STATE_INIT)\n\t\t\tobj.addChildren(children);\n\t\telse\n\t\t\tobj.initWithChildren(children);\n\t\tobj._state |= Serializable.STATE_FROMJSON;\n\t\treturn obj;\n\t}\n\tstatic registerSerializable(Class, threeLetterType, fromJSON = null) {\n\t\tClass.prototype.threeLetterType = threeLetterType;\n\t\tassert(typeof threeLetterType === 'string' && threeLetterType.length === 3);\n\t\tif (!fromJSON)\n\t\t\tfromJSON = json => new Class(json.id);\n\t\tserializableClasses.set(threeLetterType, fromJSON);\n\t}\n}\n\nSerializable.prototype._parent = null;\nSerializable.prototype._alive = true;\nSerializable.prototype._state = 0;\n\nSerializable.STATE_CONSTRUCTOR = 1;\nSerializable.STATE_INIT = 2;\nSerializable.STATE_ADDCHILD = 4;\nSerializable.STATE_ADDPARENT = 8;\nSerializable.STATE_CLONE = 16;\nSerializable.STATE_DESTROY = 32;\nSerializable.STATE_FROMJSON = 64;\nSerializable.STATE_PREDEFINEDID = 128;\n\nSerializable.prototype.isRoot = false; // If this should be a root node\nObject.defineProperty(Serializable.prototype, 'debug', {\n\tget() {\n\t\tlet info = this.threeLetterType;\n\n\t\tthis._children.forEach((value, key) => {\n\t\t\tinfo += '|';\n\t\t\tif (key === 'prp')\n\t\t\t\tinfo += this.getChildren('prp').map(p => `${p.name}=${p._value}`).join(', ');\n\t\t\telse\n\t\t\t\tinfo += `${key}(${value.length})`;\n\t\t});\n\t\t\n\t\tinfo += '|state: ';\n\t\t\n\t\tlet states = [];\n\t\tlet logState = (state, stateString) => {\n\t\t\tif (this._state & state)\n\t\t\t\tstates.push(stateString);\n\t\t};\n\t\t\n\t\tlogState(Serializable.STATE_CONSTRUCTOR, 'constructor');\n\t\tlogState(Serializable.STATE_INIT, 'init');\n\t\tlogState(Serializable.STATE_ADDCHILD, 'add child');\n\t\tlogState(Serializable.STATE_ADDPARENT, 'add parent');\n\t\tlogState(Serializable.STATE_CLONE, 'clone');\n\t\tlogState(Serializable.STATE_DESTROY, 'destroy');\n\t\tlogState(Serializable.STATE_FROMJSON, 'from json');\n\t\tlogState(Serializable.STATE_PREDEFINEDID, 'predefined id');\n\t\t\n\t\tinfo += states.join(', ');\n\t\t\n\t\treturn info;\n\t}\n});\nObject.defineProperty(Serializable.prototype, 'debugChildren', {\n\tget() {\n\t\tlet c = [];\n\t\tthis._children.forEach((value, key) => {\n\t\t\tc = c.concat(value);\n\t\t});\n\t\t\n\t\tlet children = [];\n\t\t\n\t\tfunction createDebugObject(type) {\n\t\t\tif (type === 'gam') return new function Game(){};\n\t\t\tif (type === 'sce') return new function Scene(){};\n\t\t\tif (type === 'prt') return new function Prototype(){};\n\t\t\tif (type === 'prp') return new function Property(){};\n\t\t\tif (type === 'cda') return new function ComponentData(){};\n\t\t\tif (type === 'com') return new function Component(){};\n\t\t\tif (type === 'epr') return new function EntityPrototype(){};\n\t\t\tif (type === 'ent') return new function Entity(){};\n\t\t\tif (type === 'lvl') return new function Level(){};\n\t\t\treturn new function Other(){};\n\t\t}\n\n\t\tc.forEach(child => {\n\t\t\tlet obj = createDebugObject(child.threeLetterType);\n\t\t\t\n\t\t\tobj.debug = child.debug;\n\t\t\tobj.ref = child;\n\t\t\tlet c = child.debugChildArray;\n\t\t\tif (c && c.length > 0)\n\t\t\t\tobj.children = c;\n\t\t\tchildren.push(obj);\n\t\t});\n\n\t\treturn children;\n\t}\n});\n","import assert from '../util/assert';\nimport Serializable from './serializable';\n\nexport let serializables = {};\n\nlet DEBUG_CHANGES = 0;\n\nexport function addSerializable(serializable) {\n\tassert(serializables[serializable.id] === undefined, `Serializable id clash ${serializable.id}`);\n\tserializables[serializable.id] = serializable;\n}\n\nexport function getSerializable(id) {\n\treturn serializables[id] || null;\n}\n\nexport function hasSerializable(id) {\n\treturn Boolean(serializables[id]);\n}\n\nexport function removeSerializable(id) {\n\tif (serializables[id])\n\t\tdelete serializables[id];\n\telse\n\t\tthrow new Error('Serializable not found!');\n}\n\n// reference parameters are not sent over net. they are helpers in local game instance\nexport let changeType = {\n\taddSerializableToTree: 'a', // parentId, reference\n\tsetPropertyValue: 's', // id, value\n\tdeleteSerializable: 'd', // id\n\tmove: 'm', // id, parentId\n\tdeleteAllChildren: 'c', // id\n};\nlet keyToShortKey = {\n\tid: 'i', // obj.id\n\ttype: 't', // changeType.*\n\tvalue: 'v', // value after toJSON\n\tparentId: 'p' // obj._parent.id\n};\nlet shortKeyToKey = {};\nObject.keys(keyToShortKey).forEach(k => {\n\tshortKeyToKey[keyToShortKey[k]] = k;\n});\n\nlet origin;\nlet previousVisualOrigin;\nfunction resetOrigin() {\n\torigin = null;\n}\nexport function getChangeOrigin() {\n\treturn origin;\n}\nexport function setChangeOrigin(_origin) {\n\tif (_origin !== origin) {\n\t\torigin = _origin;\n\t\tif (DEBUG_CHANGES && _origin && _origin !== previousVisualOrigin) {\n\t\t\tconsole.log('origin', previousVisualOrigin);\n\t\t\tpreviousVisualOrigin = _origin;\n\t\t}\n\t\tsetTimeout(resetOrigin);\n\t}\n}\n\nlet externalChange = false;\nexport function addChange(type, reference) {\n\tassert(origin, 'Change without origin!');\n\tif (!reference.id) return;\n\t\n\tlet change = {\n\t\ttype,\n\t\treference,\n\t\tid: reference.id,\n\t\texternal: externalChange,\n\t\torigin\n\t};\n\tif (type === changeType.setPropertyValue) {\n\t\tchange.value = reference._value;\n\t} else if (type === changeType.move) {\n\t\tchange.parent = reference._parent;\n\t} else if (type === changeType.addSerializableToTree) {\n\t\tchange.parent = reference._parent;\n\t\tdelete change.id;\n\t}\n\t\n\tif (DEBUG_CHANGES)\n\t\tconsole.log('change', change);\n\t\n\tlet previousOrigin = origin;\n\tlisteners.forEach(l => l(change));\n\tif (origin !== previousOrigin) {\n\t\tif (DEBUG_CHANGES)\n\t\t\tconsole.log('origin changed from', previousOrigin, 'to', origin && origin.constructor || origin);\n\t\torigin = previousOrigin;\n\t}\n}\n\nexport function executeExternal(callback) {\n\tsetChangeOrigin('external');\n\tif (externalChange) return callback();\n\texternalChange = true;\n\tcallback();\n\texternalChange = false;\n}\n\nlet listeners = [];\n\nexport function addChangeListener(callback) {\n\tassert(typeof callback === 'function');\n\tlisteners.push(callback);\n}\n\nexport function packChange(change) {\n\tif (change.packedChange)\n\t\treturn change.packedChange; // optimization\n\t\n\tlet packed = {};\n\ttry {\n\t\tif (change.parent)\n\t\t\tchange.parentId = change.parent.id;\n\t\t\n\t\tif (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.reference) {\n\t\t\t\tchange.value = change.reference.toJSON();\n\t\t\t} else if (change.value) {\n\t\t\t\t// change.value = change.value; // no changes\n\t\t\t} else {\n\t\t\t\tassert(false, 'invalid change of type addSerializableToTree', change);\n\t\t\t}\n\t\t} else if (change.value) {\n\t\t\tchange.value = change.reference.propertyType.type.toJSON(change.value);\n\t\t}\n\n\t\tObject.keys(keyToShortKey).forEach(key => {\n\t\t\tif (change[key]) {\n\t\t\t\tif (key === 'type' && change[key] === changeType.setPropertyValue) return; // optimize most common type\n\t\t\t\tpacked[keyToShortKey[key]] = change[key];\n\t\t\t}\n\t\t});\n\t} catch(e) {\n\t\tconsole.log('PACK ERROR', e);\n\t}\n\treturn packed;\n}\n\nexport function unpackChange(packedChange) {\n\tlet change = {\n\t\tpackedChange // optimization\n\t};\n\tObject.keys(packedChange).forEach(shortKey => {\n\t\tlet key = shortKeyToKey[shortKey];\n\t\tchange[key] = packedChange[shortKey];\n\t});\n\tif (!change.type)\n\t\tchange.type = changeType.setPropertyValue;\n\t\n\tif (change.type === changeType.addSerializableToTree) {\n\t\t// reference does not exist because it has not been created yet\n\t\tchange.id = change.value.id;\n\t} else {\n\t\tchange.reference = getSerializable(change.id);\n\t\tif (change.reference) {\n\t\t\tchange.id = change.reference.id;\n\t\t} else {\n\t\t\tconsole.error('received a change with unknown id', change, 'packed:', packedChange);\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\tif (change.parentId)\n\t\tchange.parent = getSerializable(change.parentId);\n\treturn change;\n}\n\nexport function executeChange(change) {\n\tlet newScene;\n\t\n\texecuteExternal(() => {\n\t\tconsole.log('execute change', change.type, change.id || change.value);\n\t\tif (change.type === changeType.setPropertyValue) {\n\t\t\tchange.reference.value = change.reference.propertyType.type.fromJSON(change.value);\n\t\t} else if (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.parent) {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value);\n\t\t\t\tchange.parent.addChild(obj);\n\t\t\t\tif (obj.threeLetterType === 'ent') {\n\t\t\t\t\tobj.localMaster = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value); // Scene does not need a parent\n\t\t\t\tif (obj.threeLetterType === 'sce')\n\t\t\t\t\tnewScene = obj;\n\t\t\t}\n\t\t} else if (change.type === changeType.deleteAllChildren) {\n\t\t\tchange.reference.deleteChildren();\n\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\tchange.reference.delete();\n\t\t} else if (change.type === changeType.move) {\n\t\t\tchange.reference.move(change.parent);\n\t\t}\n\t});\n\t\n\tif (newScene)\n\t\tnewScene.play();\n}\n","import { getChangeOrigin } from '../core/serializableManager';\nexport default function assert(condition, message) {\n\tif (!condition) {\n\t\tconsole.log('Assert', message, new Error().stack, '\\norigin', getChangeOrigin());\n\t\tdebugger;\n\t\tthrow new Error(message);\n\t}\n}\n","import assert from '../util/assert';\nimport Property from './property';\n\n// info about type, validator, validatorParameters, initialValue\n\n\n\nclass PropertyType {\n\tconstructor(name, type, validator, initialValue, description, flags = [], visibleIf) {\n\t\tassert(typeof name === 'string');\n\t\tassert(name[0] >= 'a' && name[0] <= 'z', 'Name of a property must start with lower case letter.');\n\t\tassert(type && typeof type.name === 'string');\n\t\tassert(validator && typeof validator.validate === 'function');\n\t\t\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.validator = validator;\n\t\tthis.initialValue = initialValue;\n\t\tthis.description = description;\n\t\tthis.visibleIf = visibleIf;\n\t\tthis.flags = {};\n\t\tflags.forEach(f => this.flags[f.type] = f);\n\t}\n\tgetFlag(flag) {\n\t\treturn this.flags[flag.type];\n\t}\n\tcreateProperty({ value, predefinedId, skipSerializableRegistering = false } = {}) {\n\t\treturn new Property({\n\t\t\tpropertyType: this,\n\t\t\tvalue,\n\t\t\tpredefinedId,\n\t\t\tname: this.name,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n}\n\n/*\n\tBeautiful way of creating property types\n\t\n\toptionalParameters:\n\t\tdescription: 'Example',\n\t\tvalidator: PropertyType.\n */\nexport default function createPropertyType(propertyName, defaultValue, type, ...optionalParameters) {\n\ttype = type();\n\tlet validator = type.validators.default();\n\tlet description = '';\n\tlet flags = [];\n\tlet visibleIf = null;\n\toptionalParameters.forEach((p, idx) => {\n\t\tif (typeof p === 'string')\n\t\t\tdescription = p;\n\t\telse if (p && p.validate)\n\t\t\tvalidator = p;\n\t\telse if (p && p.isFlag)\n\t\t\tflags.push(p);\n\t\telse if (p && p.visibleIf)\n\t\t\tvisibleIf = p;\n\t\telse\n\t\t\tassert(false, 'invalid parameter ' + p + ' idx ' + idx);\n\t});\n\treturn new PropertyType(propertyName, type, validator, defaultValue, description, flags, visibleIf);\n};\n\nexport let dataType = createPropertyType;\n\ndataType.visibleIf = function(propertyName, value) {\n\tassert(typeof propertyName === 'string' && propertyName.length);\n\tassert(typeof value !== 'undefined');\n\treturn {\n\t\tvisibleIf: true,\n\t\tpropertyName,\n\t\tvalue\n\t};\n};\n\nfunction createFlag(type, func = {}) {\n\tfunc.isFlag = true;\n\tfunc.type = type;\n\treturn func;\n}\n\ncreatePropertyType.flagDegreesInEditor = createFlag('degreesInEditor');\n\nexport function createDataType({\n\tname = '',\n\tvalidators = { default: x => x }, // default must exist. if value is a reference(object), validator should copy the value.\n\ttoJSON = x => x,\n\tfromJSON = x => x,\n\tclone = x => x\n}) {\n\tassert(name, 'name missing from property type');\n\tassert(typeof validators.default === 'function','default validator missing from property type: ' + name);\n\tassert(typeof toJSON === 'function', 'invalid toJSON for property type: ' + name);\n\tassert(typeof fromJSON === 'function', 'invalid fromJSON for property type: ' + name);\n\n\tlet type = {\n\t\tname,\n\t\tvalidators,\n\t\ttoJSON,\n\t\tfromJSON,\n\t\tclone\n\t};\n\tlet createType = () => type;\n\n\tObject.keys(validators).forEach(validatorName => {\n\t\tcreateType[validatorName] = createValidator(validatorName, validators[validatorName]);\n\t\tvalidators[validatorName] = createType[validatorName];\n\t});\n\treturn createType;\n}\n\nfunction createValidator(name, validatorFunction) {\n\tlet validator = function() {\n\t\tlet parameters = [...arguments];\n\t\treturn {\n\t\t\tvalidatorName: name,\n\t\t\tvalidatorParameters: parameters,\n\t\t\tvalidate: x => validatorFunction(x, ...parameters),\n\t\t\tparameters\n\t\t};\n\t};\n\tvalidator.validatorName = name;\n\tvalidator.validate = validatorFunction;\n\treturn validator;\n}\n","import assert from '../util/assert';\nimport { createDataType, dataType } from './propertyType';\nimport Vector from '../util/vector';\n\nfunction validateFloat(val) {\n\tif (isNaN(val) || val === Infinity || val === -Infinity)\n\t\tthrow new Error('Invalid float: ' + val);\n}\n\nconst FLOAT_JSON_PRECISION = 4;\nconst FLOAT_JSON_PRECISION_MULTIPLIER = Math.pow(10, FLOAT_JSON_PRECISION);\nconst FLOAT_DELTA = 0.0000001;\n\ndataType.float = createDataType({\n\tname: 'float',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t},\n\t\tmodulo(x, min, max) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\t\n\t\t\tlet range = max - min;\n\t\t\t\n\t\t\tif (x < min) {\n\t\t\t\tx += (((min - x) / range | 0) + 1) * range;\n\t\t\t} else if (x > max - FLOAT_DELTA) {\n\t\t\t\tx -= (((x - max) / range | 0) + 1) * range;\n\t\t\t}\n\t\t\t\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => Math.round(x*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER,\n\tfromJSON: x => x\n});\ndataType.int = createDataType({\n\tname: 'int',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseInt(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseInt(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\ndataType.vector = createDataType({\n\tname: 'vector',\n\tvalidators: {\n\t\tdefault(vec) {\n\t\t\tif (!(vec instanceof Vector))\n\t\t\t\tthrow new Error();\n\t\t\tvec = vec.clone();\n\t\t\tvec.x = parseFloat(vec.x);\n\t\t\tvec.y = parseFloat(vec.y);\n\t\t\tvalidateFloat(vec.x);\n\t\t\tvalidateFloat(vec.y);\n\t\t\treturn vec;\n\t\t}\n\t},\n\ttoJSON: vec => ({\n\t\tx: Math.round(vec.x*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER,\n\t\ty: Math.round(vec.y*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER\n\t}),\n\tfromJSON: vec => Vector.fromObject(vec),\n\tclone: vec => vec.clone()\n});\n\ndataType.string = createDataType({\n\tname: 'string',\n\tvalidators: {\n\t\tdefault: x => x ? String(x) : ''\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\ndataType.bool = createDataType({\n\tname: 'bool',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tif (typeof x !== 'boolean')\n\t\t\t\tthrow new Error();\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x ? 1 : 0,\n\tfromJSON: x => !!x\n});\n\ndataType.enum = createDataType({\n\tname: 'enum',\n\tvalidators: {\n\t\tdefault() {\n\t\t\tassert(false, `also specify enum values with Prop.enum.values('value1', 'value2', ...)`);\n\t\t},\n\t\tvalues(x, ...values) {\n\t\t\tif (!Array.isArray(values))\n\t\t\t\tthrow new Error();\n\t\t\tif (typeof x !== 'string')\n\t\t\t\tthrow new Error('val should be string');\n\t\t\tif (values.indexOf(x) < 0)\n\t\t\t\tthrow new Error(`value ${x} not in enum: [${values}]`);\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n","import Vector from '../util/vector';\n\nexport function keyPressed(key) {\n\treturn keys[key] || false;\n}\n\nexport function listenKeyDown(handler) {\n\tkeyDownListeners.push(handler);\n\treturn () => keyDownListeners.splice(keyDownListeners.indexOf(handler), 1);\n}\nexport function listenKeyUp(handler) {\n\tkeyUpListeners.push(handler);\n\treturn () => keyUpListeners.splice(keyUpListeners.indexOf(handler), 1);\n}\n\nexport const key = {\n\tleft: 37,\n\tright: 39,\n\tup: 38,\n\tdown: 40,\n\tctrl: 17,\n\tappleLeft: 91,\n\tappleRight: 93,\n\talt: 18,\n\tshift: 16,\n\tspace: 32,\n\ta: 65,\n\tz: 90,\n\t'0': 48,\n\t'1': 49,\n\t'9': 57,\n\tbackspace: 8,\n\tenter: 13,\n\tesc: 27\n};\n\nexport function listenMouseMove(element, handler) {\n\telement.addEventListener('mousemove', event => {\n\t\tlet x = event.pageX;\n\t\tlet y = event.pageY;\n\t\tlet el = element;\n\t\twhile( el != null ) {\n\t\t\tx -= el.offsetLeft;\n\t\t\ty -= el.offsetTop;\n\t\t\tel = el.offsetParent;\n\t\t}\n\t\t\n\t\telement._mx = x;\n\t\telement._my = y;\n\t\thandler(new Vector(x, y));\n\t});\n}\n\nexport function listenMouseDown(element, handler) {\n\telement.addEventListener('mousedown', event => {\n\t\tif (typeof element._mx === 'number')\n\t\t\thandler(new Vector(element._mx, element._my));\n\t\telse\n\t\t\thandler();\n\t});\n}\nexport function listenMouseUp(element, handler) {\n\telement.addEventListener('mouseup', event => {\n\t\tif (typeof element._mx === 'number')\n\t\t\thandler(new Vector(element._mx, element._my));\n\t\telse\n\t\t\thandler();\n\t});\n}\n\n////////////////////////////////////\n\n\nlet keys = {};\nlet keyDownListeners = [];\nlet keyUpListeners = [];\n\n\nif (typeof window !== 'undefined') {\n\n\twindow.onkeydown = event => {\n\t\tlet keyCode = event.which || event.keyCode;\n\n\t\tif (document.activeElement.nodeName.toLowerCase() == \"input\" && keyCode !== key.esc)\n\t\t\treturn;\n\n\t\tkeys[keyCode] = true;\n\t\tkeyDownListeners.forEach(l => l(keyCode));\n\t};\n\twindow.onkeyup = event => {\n\t\tlet key = event.which || event.keyCode;\n\t\tkeys[key] = false;\n\t\tkeyUpListeners.forEach(l => l(key));\n\t};\n}\n","import { addChangeListener, packChange, unpackChange, executeChange, executeExternal, changeType } from '../core/serializableManager'\nimport Serializable from '../core/serializable';\nimport { game } from '../core/game';\n\nimport { lzw_decode, lzw_encode } from './compression';\n\nlet networkEnabled = false;\nexport function setNetworkEnabled(enabled = true) {\n\tnetworkEnabled = enabled;\n}\n\nlet socket;\n\nfunction isInSceneTree(change) {\n\treturn change.reference.getRoot().threeLetterType === 'sce';\n}\n\nfunction getQueryVariable(variable) {\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split('=');\n\t\tif (decodeURIComponent(pair[0]) == variable) {\n\t\t\treturn decodeURIComponent(pair[1]);\n\t\t}\n\t}\n\tconsole.log('Query variable %s not found', variable);\n}\n\nfunction tryToLoad() {\n\tif (!window.io) return setTimeout(tryToLoad, 10);\n\t\n\tsocket = io();\n\t\n\tlet changes = [];\n\tlet valueChanges = {}; // id => change\n\n\taddChangeListener(change => {\n\t\tif (change.origin === 'external' || !networkEnabled)\n\t\t\treturn; // Don't send a change that you have received.\n\t\t\n\t\tif (isInSceneTree(change)) // Don't sync scene\n\t\t\treturn;\n\t\t\n\t\tif (change.type === changeType.setPropertyValue) {\n\t\t\tlet duplicateChange = valueChanges[change.id];\n\t\t\tif (duplicateChange) {\n\t\t\t\tchanges.splice(changes.indexOf(duplicateChange), 1);\n\t\t\t}\n\t\t\tvalueChanges[change.id] = change;\n\t\t}\n\t\tchanges.push(change);\n\t});\n\t\n\tsetInterval(() => {\n\t\tif (changes.length === 0)\n\t\t\treturn;\n\t\tlet packedChanges = changes.map(packChange);\n\t\tchanges.length = 0;\n\t\tvalueChanges = {};\n\t\tconsole.log('sending', packedChanges);\n\t\tsocket.emit('c', packedChanges);\n\t}, 100);\n\n\tsocket.on('c', packedChanges => {\n\t\tconsole.log('RECEIVE,', networkEnabled);\n\t\tif (!networkEnabled)\n\t\t\treturn;\n\t\t\n\t\tconsole.log('received', packedChanges);\n\t\tpackedChanges.forEach(change => {\n\t\t\tchange = unpackChange(change);\n\t\t\tif (change) {\n\t\t\t\texecuteChange(change);\n\t\t\t}\n\t\t});\n\t});\n\t\n\tsocket.on('requestGameId', serverStartTime => {\n\t\tif (game)\n\t\t\tsocket.emit('gameId', game.id);\n\t});\n\n\tlet clientStartTime = Date.now();\n\tsocket.on('refreshIfOlderThan', requiredClientTime => {\n\t\tif (clientStartTime < requiredClientTime)\n\t\t\tlocation.reload();\n\t});\n\t\n\tsocket.on('gameData', gameData => {\n\t\tconsole.log('gameData', gameData);\n\t\texecuteExternal(() => {\n\t\t\tSerializable.fromJSON(gameData);\n\t\t});\n\t\tlocalStorage.anotherGameId = gameData.id;\n\t\t// location.replace(`${location.origin}${location.pathname}?gameId=${gameData.id}`);\n\t\thistory.replaceState({}, null, `?gameId=${gameData.id}`);\n\t\tconsole.log('replaced with', `${location.origin}${location.pathname}?gameId=${gameData.id}`);\n\t});\n\t\n\tsetTimeout(() => {\n\t\tlet gameId = getQueryVariable('gameId') || localStorage.anotherGameId;\n\t\tconsole.log('requestGameData', gameId);\n\t\tsocket.emit('requestGameData', gameId);\n\t}, 100);\n}\n\nif (typeof window !== 'undefined')\n\ttryToLoad();\n","/*\n Global event system\n\n let unlisten = events.listen('event name', function(params, ...) {});\n eventManager.dispatch('event name', paramOrParamArray);\n unlisten();\n */\n\nlet listeners = {};\n\nlet events = {\n\tlisten(event, callback) {\n\t\tif (!listeners.hasOwnProperty(event)) {\n\t\t\tlisteners[event] = [];\n\t\t}\n\t\tlisteners[event].push(callback);\n\t\treturn () => {\n\t\t\tvar index = listeners[event].indexOf(callback);\n\t\t\tlisteners[event].splice(index, 1);\n\t\t};\n\t},\n\tdispatch(event, ...args) {\n\t\tif (listeners.hasOwnProperty(event)) {\n\t\t\tfor (var i = 0; i < listeners[event].length; ++i) {\n\t\t\t\tlisteners[event][i].apply(null, args);\n\t\t\t\t/*\n\t\t\t\ttry {\n\t\t\t\t\tlisteners[event][i].apply(null, args);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (console && console.error) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t}\n\t\t}\n\t},\n\tgetLoadEventPromise(event) {\n\t\treturn new Promise(function(res) {\n\t\t\tevents.listen(event, res);\n\t\t});\n\t}\n};\nexport default events;\n\n// DOM / ReDom event system\n\nexport function dispatch(view, type, data) {\n\tconst el = view === window ? view : view.el || view;\n\tconst debug = 'Debug info ' + new Error().stack;\n\tel.dispatchEvent(new CustomEvent(type, {\n\t\tdetail: { data, debug },\n\t\tbubbles: true\n\t}));\n}\nexport function listen(view, type, handler) {\n\tlet el = view === window ? view : view.el || view;\n\tel.addEventListener(type, event => {\n\t\tif (event instanceof CustomEvent)\n\t\t\thandler(event.detail.data, event.detail.debug);\n\t\telse\n\t\t\thandler(event);\n\t});\n}\n","var text = function (str) { return doc.createTextNode(str); };\n\nfunction mount (parent, child, before) {\n  var parentEl = parent.el || parent;\n  var childEl = child.el || child;\n\n  if (isList(childEl)) {\n    childEl = childEl.el;\n  }\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  if (child !== childEl) {\n    childEl.__redom_view = child;\n  }\n  if (child.isMounted) {\n    child.remount && child.remount();\n  } else {\n    child.mount && child.mount();\n  }\n  if (before) {\n    parentEl.insertBefore(childEl, before.el || before);\n  } else {\n    parentEl.appendChild(childEl);\n  }\n  if (child.isMounted) {\n    child.remounted && child.remounted();\n  } else {\n    child.isMounted = true;\n    child.mounted && child.mounted();\n  }\n\n  return child;\n}\n\nfunction unmount (parent, child) {\n  var parentEl = parent.el || parent;\n  var childEl = child.el || child;\n\n  if (child === childEl && childEl.__redom_view) {\n    // try to look up the view if not provided\n    child = childEl.__redom_view;\n  }\n\n  child.unmount && child.unmount();\n\n  parentEl.removeChild(childEl);\n\n  child.isMounted = false;\n  child.unmounted && child.unmounted();\n\n  return child;\n}\n\nfunction setStyle (view, arg1, arg2) {\n  var el = view.el || view;\n\n  if (arguments.length > 2) {\n    el.style[arg1] = arg2;\n  } else if (isString(arg1)) {\n    el.setAttribute('style', arg1);\n  } else {\n    for (var key in arg1) {\n      setStyle(el, key, arg1[key]);\n    }\n  }\n}\n\nfunction setAttr (view, arg1, arg2) {\n  var el = view.el || view;\n  var isSVG = el instanceof window.SVGElement;\n\n  if (arguments.length > 2) {\n    if (arg1 === 'style') {\n      setStyle(el, arg2);\n    } else if (isSVG && isFunction(arg2)) {\n      el[arg1] = arg2;\n    } else if (!isSVG && (arg1 in el || isFunction(arg2))) {\n      el[arg1] = arg2;\n    } else {\n      el.setAttribute(arg1, arg2);\n    }\n  } else {\n    for (var key in arg1) {\n      setAttr(el, key, arg1[key]);\n    }\n  }\n}\n\nfunction parseArguments (element, args) {\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n\n    if (!arg) {\n      continue;\n    }\n\n    // support middleware\n    if (typeof arg === 'function') {\n      arg(element);\n    } else if (isString(arg) || isNumber(arg)) {\n      element.appendChild(text(arg));\n    } else if (isNode(arg) || isNode(arg.el) || isList(arg.el)) {\n      mount(element, arg);\n    } else if (arg.length) {\n      parseArguments(element, arg);\n    } else if (typeof arg === 'object') {\n      setAttr(element, arg);\n    }\n  }\n}\n\nvar is = function (type) { return function (a) { return typeof a === type; }; };\n\nvar isString = is('string');\nvar isNumber = is('number');\nvar isFunction = is('function');\n\nvar isNode = function (a) { return a && a.nodeType; };\nvar isList = function (a) { return a && a.__redom_list; };\n\nvar doc = document;\n\nvar HASH = '#'.charCodeAt(0);\nvar DOT = '.'.charCodeAt(0);\n\nfunction createElement (query, ns) {\n  var tag;\n  var id;\n  var className;\n\n  var mode = 0;\n  var start = 0;\n\n  for (var i = 0; i <= query.length; i++) {\n    var char = query.charCodeAt(i);\n\n    if (char === HASH || char === DOT || !char) {\n      if (mode === 0) {\n        if (i === 0) {\n          tag = 'div';\n        } else if (!char) {\n          tag = query;\n        } else {\n          tag = query.substring(start, i);\n        }\n      } else {\n        var slice = query.substring(start, i);\n\n        if (mode === 1) {\n          id = slice;\n        } else if (className) {\n          className += ' ' + slice;\n        } else {\n          className = slice;\n        }\n      }\n\n      start = i + 1;\n\n      if (char === HASH) {\n        mode = 1;\n      } else {\n        mode = 2;\n      }\n    }\n  }\n\n  var element = ns ? doc.createElementNS(ns, tag) : doc.createElement(tag);\n\n  if (id) {\n    element.id = id;\n  }\n\n  if (className) {\n    if (ns) {\n      element.setAttribute('class', className);\n    } else {\n      element.className = className;\n    }\n  }\n\n  return element;\n}\n\nvar elcache = {};\n\nvar memoizeEl = function (query) { return elcache[query] || createElement(query); };\n\nfunction el (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  if (isString(query)) {\n    element = memoizeEl(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArguments(element, args);\n\n  return element;\n}\n\nel.extend = function (query) {\n  var clone = memoizeEl(query);\n\n  return el.bind(this, clone);\n};\n\nvar html = el;\n\nfunction setChildren (parent, children) {\n  if (children.length === undefined) {\n    return setChildren(parent, [children]);\n  }\n\n  var parentEl = parent.el || parent;\n  var traverse = parentEl.firstChild;\n\n  for (var i = 0; i < children.length; i++) {\n    var child = children[i];\n\n    if (!child) {\n      continue;\n    }\n\n    var childEl = child.el || child;\n\n    if (isList(childEl)) {\n      childEl = childEl.el;\n    }\n\n    if (childEl === traverse) {\n      traverse = traverse.nextSibling;\n      continue;\n    }\n\n    mount(parent, child, traverse);\n  }\n\n  while (traverse) {\n    var next = traverse.nextSibling;\n\n    unmount(parent, traverse);\n\n    traverse = next;\n  }\n}\n\nfunction list (parent, View, key, initData) {\n  return new List(parent, View, key, initData);\n}\n\nfunction List (parent, View, key, initData) {\n  this.__redom_list = true;\n  this.View = View;\n  this.key = key;\n  this.initData = initData;\n  this.views = [];\n  this.el = getParentEl(parent);\n\n  if (key) {\n    this.lookup = {};\n  }\n}\n\nList.extend = function (parent, View, key, initData) {\n  return List.bind(List, parent, View, key, initData);\n};\n\nlist.extend = List.extend;\n\nList.prototype.update = function (data) {\n  if ( data === void 0 ) data = [];\n\n  var View = this.View;\n  var key = this.key;\n  var functionKey = isFunction(key);\n  var initData = this.initData;\n  var newViews = new Array(data.length);\n  var oldViews = this.views;\n  var newLookup = key && {};\n  var oldLookup = key && this.lookup;\n\n  for (var i = 0; i < data.length; i++) {\n    var item = data[i];\n    var view = (void 0);\n\n    if (key) {\n      var id = functionKey ? key(item) : item[key];\n      view = newViews[i] = oldLookup[id] || new View(initData, item, i, data);\n      newLookup[id] = view;\n      view.__id = id;\n    } else {\n      view = newViews[i] = oldViews[i] || new View(initData, item, i, data);\n    }\n    var el$$1 = view.el;\n    if (el$$1.__redom_list) {\n      el$$1 = el$$1.el;\n    }\n    el$$1.__redom_view = view;\n    view.update && view.update(item, i, data);\n  }\n\n  setChildren(this, newViews);\n\n  if (key) {\n    this.lookup = newLookup;\n  }\n  this.views = newViews;\n};\n\nfunction getParentEl (parent) {\n  if (isString(parent)) {\n    return el(parent);\n  } else if (isNode(parent.el)) {\n    return parent.el;\n  } else {\n    return parent;\n  }\n}\n\nfunction router (parent, Views) {\n  return new Router(parent, Views);\n}\n\nvar Router = function Router (parent, Views) {\n  this.el = isString(parent) ? el(parent) : parent;\n  this.Views = Views;\n};\nRouter.prototype.update = function update (route, data) {\n  if (route !== this.route) {\n    var Views = this.Views;\n    var View = Views[route];\n\n    this.view = View && new View();\n    this.route = route;\n\n    setChildren(this.el, [ this.view ]);\n  }\n  this.view && this.view.update && this.view.update(data);\n};\n\nvar SVG = 'http://www.w3.org/2000/svg';\n\nvar svgcache = {};\n\nvar memoizeSVG = function (query) { return svgcache[query] || createElement(query, SVG); };\n\nfunction svg (query) {\n  var args = [], len = arguments.length - 1;\n  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  var element;\n\n  if (isString(query)) {\n    element = memoizeSVG(query).cloneNode(false);\n  } else if (isNode(query)) {\n    element = query.cloneNode(false);\n  } else {\n    throw new Error('At least one argument required');\n  }\n\n  parseArguments(element, args);\n\n  return element;\n}\n\nsvg.extend = function (query) {\n  var clone = memoizeSVG(query);\n\n  return svg.bind(this, clone);\n};\n\nexport { el, html, list, List, mount, unmount, router, Router, setAttr, setStyle, setChildren, svg, text };\n","import { scene } from '../../core/scene';\nimport { editor } from '../editor';\nimport { changeType } from '../../core/serializableManager';\nimport assert from '../../util/assert';\n\nlet radius = 10;\n\nexport function shouldSyncLevelAndScene() {\n\treturn editor.selectedLevel && scene && scene.isInInitialState();\n}\n\nfunction setEntityPropertyValue(entity, componentName, componentId, sourceProperty) {\n\tlet component = entity.getComponents(componentName)\n\t.filter(c => c._componentId === componentId)[0];\n\n\tif (component)\n\t\tcomponent._properties[sourceProperty.name].value = sourceProperty.value;\n}\n\nfunction getAffectedEntities(prototypeOrEntityPrototype, prototypeFilter = null) {\n\tif (prototypeOrEntityPrototype.threeLetterType === 'epr') {\n\t\t// EntityPrototype\n\t\t\n\t\tlet entity = prototypeOrEntityPrototype.previouslyCreatedEntity;\n\t\tif (entity && entity._alive)\n\t\t\treturn [entity];\n\t\telse\n\t\t\treturn [];\n\t}\n\t\n\t// Prototype\n\t\n\tlet affectedPrototypes = new Set();\n\n\tfunction goThroughChildren(prototype) {\n\t\tprototype.getChildren('prt').forEach(proto => {\n\t\t\tif (typeof prototypeFilter === 'function') {\n\t\t\t\tif (prototypeFilter(proto)) {\n\t\t\t\t\taffectedPrototypes.add(proto);\n\t\t\t\t\tgoThroughChildren(proto);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\taffectedPrototypes.add(proto);\n\t\t\t\tgoThroughChildren(proto);\n\t\t\t}\n\t\t});\n\t}\n\n\taffectedPrototypes.add(prototypeOrEntityPrototype);\n\tgoThroughChildren(prototypeOrEntityPrototype);\n\n\tlet entities = scene.level.getChildren('epr').filter(epr => {\n\t\treturn affectedPrototypes.has(epr.prototype)\n\t\t\t&& (!prototypeFilter || prototypeFilter(epr));\n\t}).map(epr => epr.previouslyCreatedEntity).filter(ent => ent && ent._alive);\n\tconsole.log('returning', entities);\n\treturn entities;\n}\n\n// Call setChangeOrigin(this) before calling this\nexport function syncAChangeBetweenSceneAndLevel(change) {\n\tif (!scene || !scene.level) return;\n\t\n\tif (!shouldSyncLevelAndScene())\n\t\treturn;\n\n\tif (change.type === 'editorSelection')\n\t\treturn;\n\t\n\tlet ref = change.reference;\n\tassert(ref._isInTree);\n\t\n\tlet threeLetterType = ref && ref.threeLetterType || null;\n\tlet rootThreeLetterType = change.reference.getRoot().threeLetterType;\n\tif (rootThreeLetterType !== 'gam')\n\t\treturn;\n\t\n\tif (change.type === changeType.addSerializableToTree) {\n\t\tif (threeLetterType === 'epr') {\n\t\t\tlet epr = ref;\n\t\t\tif (epr.findParent('lvl') === editor.selectedLevel)\n\t\t\t\tscene.addChild(epr.createEntity());\n\t\t} else if (threeLetterType === 'cda') {\n\t\t\tlet parent = ref.getParent();\n\t\t\tlet entities;\n\t\t\tif (parent.threeLetterType === 'prt') {\n\t\t\t\tentities = getAffectedEntities(parent);\n\t\t\t} else {\n\t\t\t\t// epr\n\t\t\t\tentities = [parent.previouslyCreatedEntity].filter(ent => ent && ent._alive);\n\t\t\t}\n\t\t\t\n\t\t\tentities.forEach(entity => {\n\t\t\t\t\n\t\t\t\tlet oldComponent = entity.getComponents(ref.name).find(com => com._componentId === ref.componentId);\n\t\t\t\tconsole.log('delete old component', oldComponent+'');\n\t\t\t\tif (oldComponent)\n\t\t\t\t\tentity.deleteComponent(oldComponent);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tlet proto = entity.prototype;\n\t\t\t\tlet componentData = proto.findComponentDataByComponentId(ref.componentId, true);\n\t\t\t\tconsole.log('new componentData', componentData+'');\n\t\t\t\tif (componentData) {\n\t\t\t\t\tlet component = componentData.createComponent();\n\t\t\t\t\tconsole.log('add new component', component+'');\n\t\t\t\t\tentity.addComponents([component]);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (threeLetterType === 'prp') {\n\t\t\tlet property = ref;\n\t\t\tlet componentData = property.findParent('cda');\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tentities.forEach(entity => {\n\t\t\t\tlet epr = entity.prototype;\n\t\t\t\tlet value = epr.getValue(componentData.componentId, property.name);\n\t\t\t\tlet component = entity.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tcomponent._properties[property.name].value = value;\n\t\t\t})\n\t\t}\n\t} else if (change.type === changeType.setPropertyValue) {\n\t\tlet property = ref;\n\t\tlet cda = property.findParent('cda');\n\t\tif (!cda)\n\t\t\treturn;\n\t\tlet prototype = cda.getParent();\n\t\tif (prototype.threeLetterType === 'epr') {\n\t\t\t// EntityPrototype\n\t\t\t\n\t\t\tif (prototype.previouslyCreatedEntity) {\n\t\t\t\tsetEntityPropertyValue(prototype.previouslyCreatedEntity, cda.name, cda.componentId, property);\n\t\t\t}\n\t\t} else {\n\t\t\t// Prototype\n\t\t\t\n\t\t\tlet entities = getAffectedEntities(prototype, prt => prt.findOwnProperty(cda.componentId, property.name) === null);\n\n\t\t\tentities.forEach(ent => {\n\t\t\t\tsetEntityPropertyValue(ent, cda.name, cda.componentId, property);\n\t\t\t});\n\t\t}\n\t} else if (change.type === changeType.deleteAllChildren) {\n\t\tif (threeLetterType === 'cda') {\n\t\t\tlet componentData = ref;\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tentities.forEach(entity => {\n\t\t\t\tlet epr = entity.prototype;\n\t\t\t\tlet oldComponent = entity.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tentity.deleteComponent(oldComponent);\n\n\t\t\t\tlet inheritedComponentDatas = epr.getInheritedComponentDatas();\n\t\t\t\tlet icd = inheritedComponentDatas.find(i => i.componentId === componentData.componentId);\n\t\t\t\tif (icd) {\n\t\t\t\t\tlet newComponent = Component.createWithInheritedComponentData(icd);\n\t\t\t\t\tentity.addComponents([newComponent]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t} else if (change.type === changeType.deleteSerializable) {\n\t\tif (threeLetterType === 'epr') {\n\t\t\tlet epr = ref;\n\t\t\tif (epr.previouslyCreatedEntity)\n\t\t\t\tepr.previouslyCreatedEntity.delete();\n\t\t} else if (threeLetterType === 'prp') {\n\t\t\tlet property = ref;\n\t\t\tlet componentData = property.findParent('cda');\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tentities.forEach(ent => {\n\t\t\t\tlet epr = ent.prototype;\n\t\t\t\tlet cda = epr.findComponentDataByComponentId(componentData.componentId, true);\n\t\t\t\tlet componentClass = cda.componentClass;\n\t\t\t\tlet valueProperty = cda.getProperty(property.name);\n\t\t\t\tlet value;\n\t\t\t\tif (valueProperty === property) {\n\t\t\t\t\tcda = cda.getParentComponentData();\n\t\t\t\t\tif (cda)\n\t\t\t\t\t\tvalue = cda.getValue(property.name);\n\t\t\t\t\telse\n\t\t\t\t\t\tvalue = componentClass._propertyTypesByName[property.name].initialValue;\n\t\t\t\t} else {\n\t\t\t\t\tvalue = valueProperty.value;\n\t\t\t\t}\n\t\t\t\tlet component = ent.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tif (component)\n\t\t\t\t\tcomponent._properties[property.name].value = value;\n\t\t\t});\n\t\t} else if (threeLetterType === 'cda') {\n\t\t\tlet componentData = ref;\n\t\t\tlet prototype = componentData.getParent();\n\t\t\tlet entities = getAffectedEntities(prototype);\n\t\t\tconsole.log('pissaa', componentData, prototype, entities);\n\t\t\tentities.forEach(entity => {\n\t\t\t\tlet epr = entity.prototype;\n\t\t\t\tlet oldComponent = entity.getComponents(componentData.name).find(com => com._componentId === componentData.componentId);\n\t\t\t\tentity.deleteComponent(oldComponent);\n\t\t\t\t\n\t\t\t\tlet inheritedComponentDatas = epr.getInheritedComponentDatas(cda => cda !== componentData);\n\t\t\t\tlet icd = inheritedComponentDatas.find(i => i.componentId === componentData.componentId);\n\t\t\t\tif (icd) {\n\t\t\t\t\tlet newComponent = Component.createWithInheritedComponentData(icd);\n\t\t\t\t\tentity.addComponents([newComponent]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// If Prototype is deleted, all entity prototypes are also deleted so we can ignore Prototype here\n\t} else if (change.type === changeType.move) {\n\t\t\n\t}\t\n}\n\nexport function copyEntitiesToScene(entities) {\n\tif (scene) {\n\t\tif (shouldSyncLevelAndScene()) {\n\t\t\tlet entityPrototypes = entities.map(entity => {\n\t\t\t\tlet epr = entity.prototype.clone();\n\t\t\t\tepr.position = entity.position;\n\t\t\t\treturn epr;\n\t\t\t});\n\t\t\teditor.selectedLevel.addChildren(entityPrototypes);\n\t\t\tscene.addChildren(entityPrototypes.map(epr => epr.createEntity()));\n\t\t} else {\n\t\t\tscene.addChildren(entities.map(e => e.clone()));\n\t\t}\n\t}\n}\n\nexport function getEntityUnderMouse(mousePos) {\n\tlet nearestEntity = null;\n\tlet nearestDistanceSq = Infinity;\n\t\n\tlet minX = mousePos.x - radius;\n\tlet maxX = mousePos.x + radius;\n\tlet minY = mousePos.y - radius;\n\tlet maxY = mousePos.y + radius;\n\t\n\tscene.getChildren('ent').filter(ent => {\n\t\tlet p = ent.position;\n\t\tif (p.x < minX) return false;\n\t\tif (p.x > maxX) return false;\n\t\tif (p.y < minY) return false;\n\t\tif (p.y > maxY) return false;\n\t\tlet distSq = mousePos.distanceSq(p);\n\t\tif (distSq < nearestDistanceSq) {\n\t\t\tnearestDistanceSq = distSq;\n\t\t\tnearestEntity = ent;\n\t\t}\n\t});\n\treturn nearestEntity;\n}\nexport function getEntitiesInSelection(start, end) {\n\tlet minX = Math.min(start.x, end.x);\n\tlet maxX = Math.max(start.x, end.x);\n\tlet minY = Math.min(start.y, end.y);\n\tlet maxY = Math.max(start.y, end.y);\n\n\treturn scene.getChildren('ent').filter(ent => {\n\t\tlet p = ent.position;\n\t\tif (p.x < minX) return false;\n\t\tif (p.x > maxX) return false;\n\t\tif (p.y < minY) return false;\n\t\tif (p.y > maxY) return false;\n\t\treturn true;\n\t});\n}\n\nexport function copyPositionFromEntitiesToEntityPrototypes(entities) {\n\tif (shouldSyncLevelAndScene()) {\n\t\tentities.forEach(e => {\n\t\t\te.prototype.position = e.position;\n\t\t});\n\t}\n}\n\nexport function moveEntities(entities, change) {\n\tif (entities.length === 0)\n\t\treturn;\n\n\tentities.forEach(entity => {\n\t\tlet transform = entity.getComponent('Transform');\n\t\ttransform.position = transform.position.add(change);\n\t});\n}\n\nexport function setEntityPositions(entities, position) {\n\tif (entities.length === 0)\n\t\treturn;\n\n\tentities.forEach(entity => {\n\t\tentity.position = position;\n\t});\n}\n\nexport function deleteEntities(entities) {\n\tif (shouldSyncLevelAndScene()) {\n\t\tentities.forEach(e => e.prototype.delete());\n\t}\n\tentities.forEach(e => e.delete());\n}\n\nexport function entityModifiedInEditor(entity, change) {\n\tif (!entity || entity.threeLetterType !== 'ent' || !change || change.type !== changeType.setPropertyValue)\n\t\treturn;\n\t\n\tif (shouldSyncLevelAndScene()) {\n\t\tlet entityPrototype = entity.prototype;\n\t\tconsole.log('before', entityPrototype);\n\t\tlet property = change.reference;\n\t\tlet component = property.getParent();\n\t\tlet changeComponentId = component._componentId;\n\t\tlet changePropertyName = change.reference.name;\n\t\tlet componentData = entityPrototype.getOwnComponentDataOrInherit(changeComponentId);\n\t\tconsole.log('componentData', componentData);\n\t\tlet entityPrototypeProperty = componentData.getPropertyOrCreate(changePropertyName);\n\t\tconsole.log('entityPrototypeProperty', entityPrototypeProperty);\n\t\tentityPrototypeProperty.value = property.value;\n\t\tconsole.log('after', entityPrototype);\n\t}\n\tentity.dispatch('changedInEditor', change);\n}\n\n\n/// Drawing\n\nexport function drawEntityUnderMouse(entity) {\n\tif (!entity)\n\t\treturn;\n\t\n\tlet p = entity.position;\n\tlet r = 10;\n\tscene.context.strokeStyle = '#53f8ff';\n\tscene.context.lineWidth = 1;\n\t\n\tscene.context.beginPath();\n\tscene.context.arc(p.x, p.y, r, 0, 2*Math.PI, false);\n\tscene.context.stroke();\n}\n\nexport function drawSelection(start, end, entitiesInsideSelection = []) {\n\tif (!start || !end)\n\t\treturn;\n\t\n\tscene.context.strokeStyle = '#53f8ff';\n\tscene.context.lineWidth = 0.2;\n\t\n\tlet r = 10;\n\n\tentitiesInsideSelection.forEach(e => {\n\t\tlet p = e.position;\n\t\tscene.context.beginPath();\n\t\tscene.context.arc(p.x, p.y, r, 0, 2*Math.PI, false);\n\t\tscene.context.stroke();\n\t});\n\t\n\t\n\tscene.context.fillStyle = 'rgba(255, 255, 0, 0.2)';\n\tscene.context.lineWidth = 1;\n\tscene.context.strokeStyle = 'yellow';\n\t\n\tscene.context.fillRect(start.x, start.y, end.x - start.x, end.y - start.y);\n\tscene.context.strokeRect(start.x, start.y, end.x - start.x, end.y - start.y);\n}\n\nexport function drawSelectedEntities(entities) {\n\tif (!Array.isArray(entities) || entities.length === 0)\n\t\treturn;\n\t\n\tlet r = 10;\n\t\n\tscene.context.strokeStyle = '#53f8ff';\n\tscene.context.lineWidth = 1.7;\n\n\tentities.forEach(e => {\n\t\tlet p = e.position;\n\t\tscene.context.beginPath();\n\t\tscene.context.arc(p.x, p.y, r, 0, 2*Math.PI, false);\n\t\tscene.context.stroke();\n\t});\n}\n\nexport function drawPositionHelpers(entities) {\n\tscene.context.fillStyle = 'white';\n\tlet size = 3;\n\tlet halfSize = size/2;\n\tentities.forEach(e => {\n\t\tlet p = e.position;\n\t\tscene.context.fillRect(p.x - halfSize, p.y - halfSize, size, size);\n\t});\n\t\n\tscene.context.fillStyle = 'black';\n\tsize = 2;\n\thalfSize = size/2;\n\tentities.forEach(e => {\n\t\tlet p = e.position;\n\t\tscene.context.fillRect(p.x - halfSize, p.y - halfSize, size, size);\n\t});\n}\n","import { el, list, mount } from 'redom';\nimport events, { listen, dispatch } from '../events';\nimport showPopup from './popup/popup';\nimport ComponentData from '../../core/componentData';\nimport assert from '../../util/assert';\nimport editors from './propertyEditorTypes';\nimport ComponentAdder from './popup/componentAdder';\nimport { changeType, setChangeOrigin } from '../../core/serializableManager';\nimport { Prop } from '../../core/component';\nimport { setOption, getOption, editor } from '../editor';\nimport { scene } from '../../core/scene';\nimport * as sceneEdit from '../util/sceneEdit';\nimport PropertyOwner from '../../core/propertyOwner';\n\n/*\nReference: Unbounce\n https://cdn8.webmaster.net/pics/Unbounce2.jpg\n */\n\nexport default class PropertyEditor {\n\tconstructor() {\n\t\tthis.el = el('div.propertyEditor');\n\t\tthis.dirty = true;\n\t\tthis.editingProperty = false;\n\t\n\t\t// Change in serializable tree\n\t\tevents.listen('change', change => {\n\t\t\tif (change.type === 'editorSelection') {\n\t\t\t\tthis.dirty = true;\n\t\t\t} else if (change.type === changeType.setPropertyValue) {\n\t\t\t\tif (this.item && this.item.hasDescendant(change.reference)) {\n\t\t\t\t\tif (change.origin === this) {\n\t\t\t\t\t\tif (this.item.threeLetterType === 'ent') {\n\t\t\t\t\t\t\tthis.item.dispatch('changedInEditor');\n\t\t\t\t\t\t\tsceneEdit.entityModifiedInEditor(this.item, change);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.dirty = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.addSerializableToTree) {\n\t\t\t\tif (change.parent === this.item || this.item && this.item.hasDescendant(change.parent))\n\t\t\t\t\tthis.dirty = true;\n\t\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\t\tif (this.item && this.item.hasDescendant(change.reference)) {\n\t\t\t\t\tthis.dirty = true;\n\t\t\t\t}\n\t\t\t} else if (change.type === changeType.deleteAllChildren) {\n\t\t\t\tif (this.item && this.item.hasDescendant(change.reference)) {\n\t\t\t\t\tthis.dirty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\tlisten(this, 'makingChanges', () => {\n\t\t\tsetChangeOrigin(this);\n\t\t});\n\t\t\n\t\t// Change in this editor\n\t\tlisten(this, 'markPropertyEditorDirty', () => {\n\t\t\tthis.dirty = true;\n\t\t});\n\t\t\n\t\tlisten(this, 'propertyEditorSelect', items => {\n\t\t\teditor.select(items, this);\n\t\t});\n\t}\n\tupdate(items, threeLetterType) {\n\t\tif (!this.dirty) return;\n\t\t$(this.el).empty();\n\t\tif (!items) return;\n\t\t\n\t\tif (['prt', 'ent', 'epr'].indexOf(threeLetterType) >= 0 && items.length === 1\n\t\t|| items.length === 1 && items[0] instanceof PropertyOwner) {\n\t\t\tthis.item = items[0];\n\t\t\tlet prototypeEditor = new Container();\n\t\t\tprototypeEditor.update(this.item);\n\t\t\tmount(this.el, prototypeEditor);\n\t\t}\n\t\tthis.dirty = false;\n\t}\n}\n\nclass Container {\n\tconstructor() {\n\t\tthis.el = el('div.container',\n\t\t\tthis.title = el('div.containerTitle'),\n\t\t\tthis.content = el('div.containerContent',\n\t\t\t\tthis.properties = list('table', Property, null, this.propertyEditor),\n\t\t\t\tthis.containers = list('div', Container, null, this.propertyEditor),\n\t\t\t\tthis.controls = el('div'),\n\t\t\t\tel('i.button.logButton.fa.fa-eye', {\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tconsole.log(this.item);\n\t\t\t\t\t\twindow.item = this.item;\n\t\t\t\t\t\tconsole.log(`you can use variable 'item'`);\n\t\t\t\t\t\tlet element = el('span', ' logged to console');\n\t\t\t\t\t\tmount(this.title, element);\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.title.removeChild(element);\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\t\tthis.titleClickedCallback = null;\n\t\tthis.title.onclick = () => {\n\t\t\tthis.titleClickedCallback && this.titleClickedCallback();\n\t\t};\n\t\t\n\t\tlisten(this, 'propertyInherited', property => {\n\t\t\tif (this.item.threeLetterType !== 'icd') return;\n\t\t\t// this.item is inheritedComponentData\n\t\t\tlet proto = this.item.generatedForPrototype;\n\t\t\tproto.createAndAddPropertyForComponentData(this.item, property.name, property.value);\n\t\t\tdispatch(this, 'markPropertyEditorDirty');\n\t\t});\n\t}\n\tupdate(state) {\n\t\tthis.item = state;\n\t\tthis.el.setAttribute('type', this.item.threeLetterType);\n\t\tthis.controls.innerHTML = '';\n\t\tthis.titleClickedCallback = null;\n\t\t\n\t\tif (this.item.threeLetterType === 'icd') this.updateInheritedComponentData();\n\t\telse if (this.item.threeLetterType === 'ent') this.updateEntity();\n\t\telse if (this.item.threeLetterType === 'com') this.updateComponent();\n\t\telse if (this.item.threeLetterType === 'prt') this.updatePrototype();\n\t\telse if (this.item.threeLetterType === 'epr') this.updateEntityPrototype();\n\t\telse if (this.item instanceof PropertyOwner) this.updatePropertyOwner();\n\t}\n\tupdatePrototype() {\n\t\tlet inheritedComponentDatas = this.item.getInheritedComponentDatas();\n\t\tthis.containers.update(inheritedComponentDatas);\n\t\tthis.properties.update(this.item.getChildren('prp'));\n\t\tmount(this.controls, el('button.button', el('i.fa.fa-puzzle-piece'), 'Add component', {\n\t\t\tonclick: () => {\n\t\t\t\tnew ComponentAdder(this.item);\n\t\t\t}\n\t\t}));\n\t\tmount(this.controls, el('button.button', el('i.fa.fa-clone'), 'Clone type', { onclick: () => {\n\t\t\tdispatch(this, 'makingChanges');\n\t\t\t\n\t\t\tlet clone = this.item.clone();\n\n\t\t\tlet endingNumberMatch = clone.name.match(/\\d+$/); // ending number\n\t\t\tlet num = endingNumberMatch ? parseInt(endingNumberMatch[0]) + 1 : 2;\n\t\t\tlet nameWithoutNumber = endingNumberMatch ? clone.name.substring(0, clone.name.length - endingNumberMatch[0].length) : clone.name;\n\t\t\tlet nameSuggestion = nameWithoutNumber + num++;\n\t\t\twhile (this.item.getParent().findChild('prt', prt => prt.name === nameSuggestion)) {\n\t\t\t\tnameSuggestion = nameWithoutNumber + num++;\n\t\t\t}\n\t\t\tclone.name = nameSuggestion;\n\t\t\tthis.item.getParent().addChild(clone);\n\t\t\tdispatch(this, 'propertyEditorSelect', clone);\n\t\t} }));\n\t\tmount(this.controls, el('button.dangerButton.button', el('i.fa.fa-times'), 'Delete type', { onclick: () => {\n\t\t\tdispatch(this, 'makingChanges');\n\t\t\tlet entityPrototypeCount = this.item.countEntityPrototypes(true);\n\t\t\tif (entityPrototypeCount) {\n\t\t\t\tif (confirm(`Type ${this.item.name} is used in levels ${entityPrototypeCount} times. Are you sure you want to delete this type and all ${entityPrototypeCount} instances that are using it?`))\n\t\t\t\t\tthis.item.delete();\n\t\t\t} else {\n\t\t\t\tthis.item.delete();\n\t\t\t}\n\t\t} }));\n\t}\n\tupdateEntityPrototype() {\n\t\tlet inheritedComponentDatas = this.item.getInheritedComponentDatas();\n\t\tthis.containers.update(inheritedComponentDatas);\n\t\tthis.properties.update(this.item.getChildren('prp'));\n\t\tmount(this.controls, el('button.button', el('i.fa.fa-puzzle-piece'), 'Add component', {\n\t\t\tonclick: () => {\n\t\t\t\tnew ComponentAdder(this.item);\n\t\t\t}\n\t\t}));\n\t}\n\tupdateInheritedComponentData() {\n\t\tthis.updateComponentKindOfThing(this.item.componentClass);\n\t\t\n\t\tlet packId = 'pack' + this.item.generatedForPrototype.id + this.item.componentId;\n\t\tlet packedStatus = getOption(packId);\n\t\tif (packedStatus === 'true') {\n\t\t\tthis.el.classList.add('packed');\n\t\t} else if (packedStatus === 'false') {\n\t\t\tthis.el.classList.remove('packed');\n\t\t} else {\n\t\t\tthis.el.classList.toggle('packed', !this.item.ownComponentData);\n\t\t}\n\t\t\n\t\tthis.titleClickedCallback = () => {\n\t\t\tthis.el.classList.toggle('packed');\n\t\t\tsetOption(packId, this.el.classList.contains('packed') ? 'true' : 'false');\n\t\t};\n\t\t\n\t\tlet parentComponentData = this.item.ownComponentData && this.item.ownComponentData.getParentComponentData();\n\t\tlet hasOwnProperties = false;\n\t\tthis.item.properties.forEach(prop => {\n\t\t\tif (prop.id)\n\t\t\t\thasOwnProperties = true;\n\t\t\tif (prop.propertyType.visibleIf) {\n\t\t\t\tprop._editorVisibleIfTarget = this.item.properties.find(p => p.name === prop.propertyType.visibleIf.propertyName);\n\t\t\t}\n\t\t});\n\t\tthis.properties.update(this.item.properties);\n\t\t\n\t\tif (!this.item.ownComponentData || parentComponentData) {\n\t\t\tmount(this.controls, el('button.button', 'Show parent', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tlet componentData = this.item.generatedForPrototype.getParentPrototype().findComponentDataByComponentId(this.item.componentId, true);\n\t\t\t\t\tdispatch(this, 'propertyEditorSelect', componentData.getParent());\n\t\t\t\t\tdispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tif (this.item.componentClass.componentName === 'Transform'\n\t\t\t&& this.item.generatedForPrototype.threeLetterType === 'epr')\n\t\t\treturn;\n\t\t\n\t\tif (this.item.componentClass.allowMultiple) {\n\t\t\tmount(this.controls, el('button.button', el('i.fa.fa-clone'), 'Clone', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tdispatch(this, 'makingChanges');\n\t\t\t\t\tif (this.item.ownComponentData) {\n\t\t\t\t\t\tlet clone = this.item.ownComponentData.clone();\n\t\t\t\t\t\tthis.item.generatedForPrototype.addChild(clone);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Is empty component data\n\t\t\t\t\t\tlet componentData = new ComponentData(this.item.componentClass.componentName);\n\t\t\t\t\t\tcomponentData.initWithChildren();\n\t\t\t\t\t\tthis.item.generatedForPrototype.addChild(componentData);\n\t\t\t\t\t}\n\t\t\t\t\tdispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tif (hasOwnProperties) {\n\t\t\tmount(this.controls, el('button.dangerButton.button', el('i.fa.fa-refresh'), 'Reset', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tdispatch(this, 'makingChanges');\n\t\t\t\t\tdispatch(this, 'markPropertyEditorDirty', 'fromReset');\n\t\t\t\t\tif (this.item.ownComponentData.getParentComponentData()) {\n\t\t\t\t\t\tthis.item.ownComponentData.delete();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item.ownComponentData.deleteChildren();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tif (this.item.ownComponentData && !parentComponentData) {\n\t\t\tmount(this.controls, el('button.dangerButton.button', el('i.fa.fa-times'), 'Delete', {\n\t\t\t\tonclick: () => {\n\t\t\t\t\tdispatch(this, 'makingChanges');\n\t\t\t\t\tdispatch(this, 'markPropertyEditorDirty');\n\t\t\t\t\tthis.item.ownComponentData.delete();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\tupdateEntity() {\n\t\tthis.title.textContent = this.item.prototype.name;\n\t\tthis.containers.update(this.item.getListOfAllComponents());\n\t\t// this.properties.update(this.item.getChildren('prp'));\n\t}\n\tupdateComponent() {\n\t\tthis.updateComponentKindOfThing(this.item.constructor);\n\t\tthis.properties.update(this.item.getChildren('prp'));\n\t}\n\tupdateComponentKindOfThing(componentClass) {\n\t\tthis.title.textContent = componentClass.componentName;\n\n\t\tlet icon = el('i.icon.fa.' + componentClass.icon);\n\t\tmount(this.title, icon);\n\t\tthis.title.style.color = componentClass.color;\n\t\tthis.title.setAttribute('title', componentClass.description);\n\t\tthis.el.style['border-color'] = componentClass.color;\n\t}\n\tupdatePropertyOwner() {\n\t\tthis.properties.update(this.item.getChildren('prp'));\n\t}\n}\n\nclass Property {\n\tconstructor() {\n\t\tthis.el = el('tr.property', { name: '' },\n\t\t\tthis.name = el('td.nameCell'),\n\t\t\tthis.content = el('td.propertyContent')\n\t\t);\n\t}\n\treset() {\n\t\tlet componentData = this.property.getParent();\n\t\tthis.property.delete();\n\t\tif (componentData._children.size === 0) {\n\t\t\tif (componentData.getParentComponentData())\n\t\t\t\tcomponentData.delete();\n\t\t}\n\t\t\n\t\tdispatch(this, 'markPropertyEditorDirty');\n\t}\n\toninput(val) {\n\t\ttry {\n\t\t\tthis.property.propertyType.validator.validate(this.convertFromInputToPropertyValue(val));\n\t\t\tthis.el.removeAttribute('error');\n\t\t} catch(e) {\n\t\t\tthis.el.setAttribute('error', 'true');\n\t\t}\n\t}\n\tonchange(val) {\n\t\tlet originalValue = this.property.value;\n\t\ttry {\n\t\t\tdispatch(this, 'makingChanges');\n\t\t\tthis.property.value = this.property.propertyType.validator.validate(this.convertFromInputToPropertyValue(val));\n\t\t\tif (!this.property.id) {\n\t\t\t\tdispatch(this, 'propertyInherited', this.property);\n\t\t\t}\n\t\t} catch(e) {\n\t\t\t// console.log('Error while changing property value', this.property, this.input.value);\n\t\t\tthis.property.value = originalValue;\n\t\t}\n\t\tthis.setValueFromProperty();\n\t\tthis.el.removeAttribute('error');\n\t}\n\tsetValueFromProperty() {\n\t\tlet val = this.property.value;\n\t\tif (this.property.propertyType.getFlag(Prop.flagDegreesInEditor))\n\t\t\tval = Math.round(val * 180 / Math.PI * 10) / 10;\n\t\tthis.setValue(val);\n\t}\n\tconvertFromInputToPropertyValue(val) {\n\t\tif (this.property.propertyType.getFlag(Prop.flagDegreesInEditor))\n\t\t\treturn val * Math.PI / 180;\n\t\telse\n\t\t\treturn val;\n\t}\n\tupdateVisibleIf() {\n\t\tif (!this.property._editorVisibleIfTarget)\n\t\t\treturn;\n\t\t$(this.el).toggleClass('hidden', this.property._editorVisibleIfTarget.value !== this.property.propertyType.visibleIf.value);\n\t}\n\tupdate(property) {\n\t\tif (this.visibleIfListener) {\n\t\t\tthis.visibleIfListener(); // unlisten\n\t\t\tthis.visibleIfListener = null;\n\t\t}\n\t\tthis.property = property;\n\t\tthis.el.setAttribute('name', property.name);\n\t\tthis.el.setAttribute('type', property.propertyType.type.name);\n\t\tthis.name.textContent = property.propertyType.name;\n\t\tthis.name.setAttribute('title', `${property.propertyType.name} (${property.propertyType.type.name}) ${property.propertyType.description}`);\n\t\tthis.content.innerHTML = '';\n\t\tlet propertyEditorInstance = editors[this.property.propertyType.type.name] || editors.default;\n\t\tthis.setValue = propertyEditorInstance(this.content, val => this.oninput(val), val => this.onchange(val), property.propertyType);\n\t\tthis.setValueFromProperty();\n\t\tthis.el.classList.toggle('visibleIf', !!property.propertyType.visibleIf);\n\t\tif (property._editorVisibleIfTarget) {\n\t\t\tthis.updateVisibleIf();\n\t\t\tthis.visibleIfListener = property._editorVisibleIfTarget.listen('change', _ => {\n\t\t\t\tif (!isInDom(this.el)) {\n\t\t\t\t\tthis.visibleIfListener();\n\t\t\t\t\tthis.visibleIfListener = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.updateVisibleIf()\n\t\t\t});\n\t\t}\n\t\tthis.el.classList.toggle('ownProperty', !!this.property.id);\n\t\tif (this.property.id) {\n\t\t\tlet parent = this.property.getParent();\n\t\t\tif (parent.threeLetterType === 'cda'\n\t\t\t\t&& (parent.name !== 'Transform' || parent.getParent().threeLetterType !== 'epr'))\n\t\t\t\t// Can not delete anything from entity prototype transform \n\t\t\t{\n\t\t\t\tthis.name.style.color = parent.componentClass.color;\n\n\t\t\t\tmount(this.content, el('i.fa.fa-window-close.button.resetButton.iconButton', {\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tdispatch(this, 'makingChanges');\n\t\t\t\t\t\tthis.reset();\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t} else if (parent.threeLetterType === 'com') {\n\t\t\t\tthis.name.style.color = parent.constructor.color;\n\t\t\t}\n\t\t} else\n\t\t\tthis.name.style.color = 'inherit';\n\t}\n}\n\nfunction isInDom(element) {\n\treturn $.contains(document.documentElement, element);\n}\n","export function removeTheDeadFromArray(array) {\n\tfor (let i = array.length - 1; i >= 0; --i) {\n\t\tif (array[i]._alive === false)\n\t\t\tarray.splice(i, 1);\n\t}\n}\n","import events from './events';\nimport Layout from './layout/layout';\nimport './module/topBar';\nimport './module/type';\nimport './module/instance';\nimport './module/scene';\nimport './module/types';\nimport './module/level';\nimport './module/instances';\nimport './module/test3';\nimport { el, list, mount } from 'redom';\nimport { game } from '../core/game';\nimport Serializable from '../core/serializable';\nimport { addChangeListener, serializables, executeExternal, setChangeOrigin, changeType } from '../core/serializableManager';\nimport assert from '../util/assert';\nimport { setNetworkEnabled } from '../util/net';\nimport './help';\n\nlet loaded = false;\n\nexport let modulesRegisteredPromise = events.getLoadEventPromise('modulesRegistered');\nexport let loadedPromise = events.getLoadEventPromise('loaded');\n\nmodulesRegisteredPromise.then(() => {\n\tloaded = true;\n\tevents.dispatch('loaded');\n\tsetNetworkEnabled(true);\n});\n\nloadedPromise.then(() => {\n\teditor.setLevel(game.getChildren('lvl')[0]);\n});\n\nsetInterval(() => {\n\teditor && editor.dirty && editor.update();\n}, 200);\n\naddChangeListener(change => {\n\tevents.dispatch('change', change);\n\tif (change.type === changeType.addSerializableToTree && change.reference.threeLetterType === 'gam') {\n\t\tlet game = change.reference;\n\t\teditor = new Editor(game);\n\t\tevents.dispatch('registerModules', editor);\n\t}\n\tif (editor) {\n\t\tif (change.type === changeType.deleteSerializable && change.reference.threeLetterType === 'lvl') {\n\t\t\tif (editor && editor.selectedLevel === change.reference) {\n\t\t\t\teditor.setLevel(null);\n\t\t\t}\n\t\t}\n\t\teditor.dirty = true;\n\t\tif (change.type !== 'editorSelection' && loaded && change.reference.getRoot().threeLetterType === 'gam')\n\t\t\teditor.saveNeeded = true;\n\t}\n});\n\nexport let editor = null;\nclass Editor {\n\tconstructor(game) {\n\t\tassert(game);\n\t\t\n\t\tthis.layout = new Layout();\n\t\t\n\t\tthis.dirty = true;\n\t\tthis.game = game;\n\t\tthis.selectedLevel = null;\n\t\t\n\t\tthis.selection = {\n\t\t\ttype: 'none',\n\t\t\titems: [],\n\t\t\tdirty: true\n\t\t};\n\n\t\tmount(document.body, this.layout);\n\t}\n\tsetLevel(level) {\n\t\tif (level && level.threeLetterType === 'lvl')\n\t\t\tthis.selectedLevel = level;\n\t\telse\n\t\t\tthis.selectedLevel = null;\n\t\t\n\t\tthis.select([], this);\n\t\tevents.dispatch('setLevel', this.selectedLevel);\n\t}\n\tselect(items, origin) {\n\t\tif (!Array.isArray(items))\n\t\t\titems = [items];\n\t\tthis.selection.items = [].concat(items);\n\t\t\n\t\tlet types = Array.from(new Set(items.map(i => i.threeLetterType)));\n\t\tif (types.length === 0)\n\t\t\tthis.selection.type = 'none';\n\t\telse if (types.length === 1)\n\t\t\tthis.selection.type = types[0];\n\t\telse\n\t\t\tthis.selection.type = 'mixed';\n\t\t\n\t\tthis.dirty = true;\n\t\t\n\t\tevents.dispatch('change', {\n\t\t\ttype: 'editorSelection',\n\t\t\treference: this.selection,\n\t\t\torigin\n\t\t});\n\t\t\n\t\tthis.update();\n\t}\n\tupdate() {\n\t\tif (!this.dirty || !this.game) return;\n\t\tthis.layout.update();\n\t\t\n\t\tlet logStr = 'update';\n\t\t\n\t\tif (this.saveNeeded) {\n\t\t\tlogStr += ' & save';\n\t\t\tthis.save();\n\t\t}\n\t\t\n\t\tthis.dirty = false;\n\t\tthis.saveNeeded = false;\n\t\t\n\t\tconsole.log(logStr);\n\t}\n\tsave() {\n\t\tlocalStorage.anotherGameId = this.game.id;\n\t\t// localStorage.anotherGameJSON = JSON.stringify(this.game.toJSON());\n\t}\n}\n\n\nlet options = null;\nfunction loadOptions() {\n\tif (!options) {\n\t\ttry {\n\t\t\toptions = JSON.parse(localStorage.anotherOptions);\n\t\t} catch(e) {\n\t\t\toptions = {};\n\t\t}\n\t}\n}\nexport function setOption(id, stringValue) {\n\tloadOptions();\n\toptions[id] = stringValue;\n\ttry {\n\t\tlocalStorage.anotherOptions = JSON.stringify(options);\n\t} catch(e) {\n\t}\n}\nexport function getOption(id) {\n\tloadOptions();\n\treturn options[id];\n}\n\n","import Serializable from './serializable';\nimport { addChange, changeType, setChangeOrigin } from './serializableManager'; \nimport assert from '../util/assert';\n\n// Instance of a property\nexport default class Property extends Serializable {\n\t// set skipSerializableRegistering=true if you are not planning to add this property to the hierarchy\n\t// if you give propertyType, value in real value form\n\t// if you don't give propertyType (give it later), value as JSON form\n\tconstructor({ value, predefinedId, name, propertyType, skipSerializableRegistering = false }) {\n\t\tassert(name, 'Property without a name can not exist');\n\t\tsuper(predefinedId, skipSerializableRegistering);\n\t\tthis._initialValue = value;\n\t\tif (propertyType)\n\t\t\tthis.setPropertyType(propertyType);\n\t\telse {\n\t\t\tthis.name = name;\n\t\t\tthis._initialValueIsJSON = true;\n\t\t}\n\t}\n\tsetPropertyType(propertyType) {\n\t\tthis.propertyType = propertyType;\n\t\ttry {\n\t\t\tif (this._initialValue !== undefined)\n\t\t\t\tthis.value = this._initialValueIsJSON ? propertyType.type.fromJSON(this._initialValue) : this._initialValue;\n\t\t\telse\n\t\t\t\tthis.value = propertyType.initialValue;\n\t\t} catch(e) {\n\t\t\tconsole.log('Invalid value', e, propertyType, this);\n\t\t\tthis.value = propertyType.initialValue;\n\t\t}\n\t\tthis.name = propertyType.name;\n\t}\n\tclone(skipSerializableRegistering = false) {\n\t\treturn new Property({\n\t\t\tvalue: this.propertyType.type.clone(this.value),\n\t\t\tname: this.name,\n\t\t\tpropertyType: this.propertyType,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tv: this.type.toJSON(this.value),\n\t\t\tn: this.propertyType.name\n\t\t});\n\t}\n}\nProperty.prototype.propertyType = null;\nObject.defineProperty(Property.prototype, 'type', {\n\tget() {\n\t\treturn this.propertyType.type;\n\t}\n});\nObject.defineProperty(Property.prototype, 'value', {\n\tset(newValue) {\n\t\tthis._value = this.propertyType.validator.validate(newValue);\n\t\tthis.dispatch('change', this._value);\n\t\tif (this._isInTree)\n\t\t\taddChange(changeType.setPropertyValue, this);\n\t},\n\tget() {\n\t\treturn this._value;\n\t}\n});\n\nSerializable.registerSerializable(Property, 'prp', json => {\n\treturn new Property({\n\t\tvalue: json.v,\n\t\tpredefinedId: json.id,\n\t\tname: json.n\n\t});\n});\n\nObject.defineProperty(Property.prototype, 'debug', {\n\tget() {\n\t\treturn `prp ${this.name}=${this.value}`;\n\t}\n});\n","export default class Vector {\n\tconstructor(x, y) {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t}\n\tadd(vec) {\n\t\tthis.x += vec.x;\n\t\tthis.y += vec.y;\n\t\treturn this;\n\t}\n\tsubtract(vec) {\n\t\tthis.x -= vec.x;\n\t\tthis.y -= vec.y;\n\t\treturn this;\n\t}\n\tmultiply(vec) {\n\t\tthis.x *= vec.x;\n\t\tthis.y *= vec.y;\n\t\treturn this;\n\t}\n\tmultiplyScalar(scalar) {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\treturn this;\n\t}\n\tdivide(vec) {\n\t\tthis.x /= vec.x;\n\t\tthis.y /= vec.y;\n\t\treturn this;\n\t}\n\tdivideScalar(scalar) {\n\t\tthis.x /= scalar;\n\t\tthis.y /= scalar;\n\t\treturn this;\n\t}\n\tdot(vec) {\n\t\treturn this.x * vec.x + this.y * vec.y;\n\t}\n\tlength() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n\tsetLength(newLength) {\n\t\tlet oldLength = this.length();\n\n\t\tif (oldLength === 0) {\n\t\t\tthis.x = newLength;\n\t\t\tthis.y = 0;\n\t\t} else {\n\t\t\tthis.multiplyScalar(newLength / oldLength);\n\t\t}\n\t\treturn this;\n\t}\n\tgetProjectionOn(vec) {\n\t\tlet length = vec.length();\n\t\tif (length === 0)\n\t\t\treturn this.clone();\n\t\telse\n\t\t\treturn vec.clone().multiplyScalar(this.dot(vec) / (length * length));\n\t}\n\tdistance(vec) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t}\n\tdistanceSq(vec) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn dx * dx + dy * dy;\n\t}\n\tnormalize() {\n\t\treturn this.setLength(1);\n\t}\n\thorizontalAngle() {\n\t\treturn Math.atan2(this.y, this.x);\n\t}\n\tverticalAngle() {\n\t\treturn Math.atan2(this.x, this.y);\n\t}\n\trotate(angle) {\n\t\tlet x = this.x * Math.cos(angle) - this.y * Math.sin(angle);\n\t\tthis.y = this.x * Math.sin(angle) + this.y * Math.cos(angle);\n\t\tthis.x = x;\n\n\t\treturn this;\n\t}\n\trotateTo(rotation) {\n\t\treturn this.rotate(rotation-this.verticalAngle());\n\t}\n\tisEqualTo(vec) {\n\t\treturn this.x === vec.x && this.y === vec.y;\n\t}\n\tclone() {\n\t\treturn new Vector(this.x, this.y);\n\t}\n\tset(vec) {\n\t\tthis.x = vec.x;\n\t\tthis.y = vec.y;\n\t\treturn this;\n\t}\n\ttoString() {\n\t\treturn `[${this.x}, ${this.y}]`;\n\t}\n}\nVector.fromObject = function(obj) {\n\treturn new Vector(obj.x, obj.y);\n};\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nexport { default as Prop } from './propertyType';\n\nexport default class PropertyOwner extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tassert(Array.isArray(this.constructor._propertyTypes), 'call PropertyOwner.defineProperties after class definition');\n\t\tsuper(predefinedId);\n\t\tthis._properties = {};\n\t}\n\t// Just a helper\n\tinitWithPropertyValues(values = {}) {\n\t\tlet children = [];\n\t\t\n\t\tObject.keys(values).forEach(propName => {\n\t\t\tlet propertyType = this.constructor._propertyTypesByName[propName];\n\t\t\tassert(propertyType, 'Invalid property ' + propName);\n\t\t\tchildren.push(propertyType.createProperty({\n\t\t\t\tvalue: values[propName]\n\t\t\t}));\n\t\t});\n\t\tthis.initWithChildren(children);\n\t\treturn this;\n\t}\n\tinitWithChildren(children = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\t\t\n\t\tlet propChildren = [];\n\t\tlet otherChildren = [];\n\t\t// Separate Property children and other children\n\t\tchildren.forEach(child => {\n\t\t\tif (child.threeLetterType === 'prp') {\n\t\t\t\tpropChildren.push(child);\n\t\t\t} else {\n\t\t\t\totherChildren.push(child);\n\t\t\t}\n\t\t});\n\t\tsuper.addChildren(otherChildren);\n\t\t\n\t\tlet invalidPropertiesCount = 0;\n\t\t\n\t\t// Make sure Properties have a PropertyType. They don't work without it.\n\t\tpropChildren.filter(prop => !prop.propertyType).forEach(prop => {\n\t\t\tif (!this.constructor._propertyTypesByName[prop.name]) {\n\t\t\t\tconsole.log('Property of that name not defined', this.id, prop.name, this);\n\t\t\t\tinvalidPropertiesCount++;\n\t\t\t\tprop.isInvalid = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprop.setPropertyType(this.constructor._propertyTypesByName[prop.name]);\n\t\t});\n\t\tif (invalidPropertiesCount)\n\t\t\tpropChildren = propChildren.filter(p => !p.isInvalid);\n\t\t\n\t\t// Make sure all PropertyTypes have a matching Property\n\t\tlet nameToProp = {};\n\t\tpropChildren.forEach(c => nameToProp[c.name] = c);\n\t\tthis.constructor._propertyTypes.forEach(propertyType => {\n\t\t\tif (!nameToProp[propertyType.name])\n\t\t\t\tpropChildren.push(propertyType.createProperty());\n\t\t});\n\t\t\n\t\tsuper.addChildren(propChildren);\n\t};\n\taddChild(child) {\n\t\tassert(this._state & Serializable.STATE_INIT, this.constructor.componentName || this.constructor + ' requires that initWithChildren will be called before addChild');\n\t\tsuper.addChild(child);\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!child.propertyType) {\n\t\t\t\tif (!this.constructor._propertyTypesByName[child.name]) {\n\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tchild.setPropertyType(this.constructor._propertyTypesByName[child.name]);\n\t\t\t}\n\t\t\tassert(this._properties[child.propertyType.name] === undefined, 'Property already added');\n\t\t\tthis._properties[child.propertyType.name] = child;\n\t\t}\n\t};\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\t\tthis._properties = {};\n\t\treturn true;\n\t}\n\t// idx is optional\n\tdeleteChild(child, idx) {\n\t\tassert(child.threeLetterType !== 'prp', 'Can not delete just one Property child.');\n\t\tsuper.deleteChild(child, idx);\n\t}\n}\n\nPropertyOwner.defineProperties = function(Class, propertyTypes) {\n\tClass._propertyTypes = propertyTypes;\n\tClass._propertyTypesByName = {};\n\tpropertyTypes.forEach(propertyType => {\n\t\tassert(Class.prototype[propertyType.name] === undefined, 'Property name ' + propertyType.name + ' clashes');\n\t\tClass._propertyTypesByName[propertyType.name] = propertyType;\n\t\tObject.defineProperty(Class.prototype, propertyType.name, {\n\t\t\tget() {\n\t\t\t\treturn this._properties[propertyType.name].value;\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis._properties[propertyType.name].value = value;\n\t\t\t}\n\t\t});\n\t});\n};\n","import Serializable from './serializable';\nimport assert from '../util/assert';\n\nconst ALIVE_ERROR = 'entity is already dead';\n\nexport default class Entity extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\t\tthis.components = new Map(); // name -> array\n\t\tthis.sleeping = false;\n\t\tthis.prototype = null; // should be set immediately after constructor\n\t\tthis.localMaster = true; // set false if entity is controlled over the net\n\t}\n\n\t// Get the first component of given name\n\tgetComponent(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tlet components = this.components.get(name);\n\t\tif (components !== undefined)\n\t\t\treturn components[0];\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// Get all components with given name\n\tgetComponents(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\treturn this.components.get(name) || [];\n\t}\n\t\n\tgetListOfAllComponents() {\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value);\n\t\t});\n\t\treturn components;\n\t}\n\t\n\tclone() {\n\t\tlet entity = new Entity();\n\t\tentity.prototype = this.prototype;\n\t\tentity.sleeping = this.sleeping;\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value.map(c => c.clone()));\n\t\t});\n\t\tentity.addComponents(components);\n\t\treturn entity;\n\t}\n\n\t/*\n\tAdds multiple components as an array to this Entity.\n\tUses addComponent internally.\n\tInitializes components after all components are added.\n\t*/\n\taddComponents(components) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tassert(Array.isArray(components), 'Parameter is not an array.');\n\n\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\tlet componentList = this.components.get(components[i]._name) || this.components.set(components[i]._name, []).get(components[i]._name);\n\t\t\tcomponentList.push(components[i]);\n\t\t\tcomponents[i].entity = this;\n\t\t\tcomponents[i]._parent = this;\n\t\t}\n\t\t\n\t\tif (!this.sleeping)\n\t\t\tEntity.initComponents(components);\n\t\treturn this;\n\t}\n\tstatic initComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._preInit();\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._init();\n\t}\n\tstatic makeComponentsSleep(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._sleep();\n\t}\n\tstatic deleteComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i].delete();\n\t}\n\tsleep() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (this.sleeping) return false;\n\t\t\n\t\tthis.components.forEach((value, key) => Entity.makeComponentsSleep(value));\n\t\t\n\t\tthis.sleeping = true;\n\t\treturn true;\n\t}\n\twakeUp() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (!this.sleeping) return false;\n\n\t\tthis.components.forEach((value, key) => Entity.initComponents(value));\n\n\t\tthis.sleeping = false;\n\t\treturn true;\n\t}\n\tdelete() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tthis.sleep();\n\t\tif (!super.delete()) return false;\n\t\t\n\t\tthis.components.forEach((value, key) => Entity.deleteComponents(value));\n\t\tthis.components.clear();\n\t\t\n\t\treturn true;\n\t}\n\tdeleteComponent(component) {\n\t\tlet array = this.getComponents(component.constructor.componentName);\n\t\tlet idx = array.indexOf(component);\n\t\tassert(idx >= 0);\n\t\tif (!this.sleeping)\n\t\t\tcomponent._sleep();\n\t\tcomponent.delete();\n\t\tarray.splice(idx, 1);\n\t\treturn this;\n\t}\n\tsetInTreeStatus(isInTree) {\n\t\tif (this._isInTree === isInTree)\n\t\t\treturn;\n\n\t\tthis._isInTree = isInTree;\n\t\tthis.components.forEach((value, key) => {\n\t\t\tvalue.forEach(component => component.setInTreeStatus(isInTree));\n\t\t});\n\t}\n\ttoJSON() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\t\n\t\tlet components = [];\n\t\tthis.components.forEach(compArray => {\n\t\t\tcompArray.forEach(comp => {\n\t\t\t\tcomponents.push(comp.toJSON());\n\t\t\t});\n\t\t});\n\t\t\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tcomp: components,\n\t\t\tproto: this.prototype.id\n\t\t});\n\t}\n}\nObject.defineProperty(Entity.prototype, 'position', {\n\tget() {\n\t\treturn this.getComponent('Transform').position;\n\t},\n\tset(position) {\n\t\tthis.getComponent('Transform').position = position;\n\t}\n});\n\nSerializable.registerSerializable(Entity, 'ent', json => {\n\tconsole.log('creating entity from json', json);\n\tlet entity = new Entity(json.id);\n\tentity.prototype = getSerializable(json.proto);\n\tconsole.log('created entity from json', entity);\n\tif (json.comp) {\n\t\tentity.addComponents(json.comp.map(Serializable.fromJSON));\n\t}\n\treturn entity;\n});\n","import Serializable, { createStringId } from './serializable';\nimport assert from '../util/assert';\nimport { componentClasses, Component } from './component';\n\nexport default class ComponentData extends Serializable {\n\tconstructor(componentClassName, predefinedId = false, predefinedComponentId = false) {\n\t\tthis.name = componentClassName;\n\t\tthis.componentClass = componentClasses.get(this.name);\n\t\tassert(this.componentClass, 'Component class not defined: ' + componentClassName);\n\t\tsuper(predefinedId);\n\t\tif (!this.componentClass.allowMultiple)\n\t\t\tpredefinedComponentId = '_' + componentClassName;\n\t\tthis.componentId = predefinedComponentId || createStringId('cid', 10); // what will be the id of component created from this componentData\n\t}\n\taddChild(child) {\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!child.propertyType) {\n\t\t\t\tif (!this.componentClass._propertyTypesByName[child.name]) {\n\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tchild.setPropertyType(this.componentClass._propertyTypesByName[child.name]);\n\t\t\t}\n\t\t}\n\t\tsuper.addChild(child);\n\t\treturn this;\n\t};\n\tclone() {\n\t\tlet obj = new ComponentData(this.name);\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tcid: this.componentId,\n\t\t\tn: this.name\n\t\t});\n\t}\n\t/*\n\tReturns a list of Properties.\n\tThose which don't have an id are temporary properties generated from parents.\n\tDon't set _depth.\n\t */\n\tgetInheritedProperties(_depth = 0) {\n\t\tlet properties = {};\n\n\t\t// properties from parent\n\t\tlet parentComponentData = this.getParentComponentData();\n\t\tif (parentComponentData)\n\t\t\tparentComponentData.getInheritedProperties(_depth + 1).forEach(prop => properties[prop.name] = prop);\n\t\t\n\t\t// properties from this. override properties of parents\n\t\tthis.getChildren('prp').forEach(prop => {\n\t\t\tif (_depth === 0)\n\t\t\t\tproperties[prop.name] = prop;\n\t\t\telse\n\t\t\t\tproperties[prop.name] = prop.clone(true);\n\t\t});\n\t\t\n\t\t// fill from propertyType\n\t\tif (_depth === 0) {\n\t\t\treturn this.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\treturn properties[propertyType.name] || propertyType.createProperty({\n\t\t\t\t\tskipSerializableRegistering: true\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn Object.keys(properties).map(key => properties[key]);\n\t\t}\n\t}\n\tgetParentComponentData() {\n\t\tif (!this._parent) return null;\n\t\tlet parentPrototype = this._parent.getParentPrototype();\n\t\twhile (parentPrototype) {\n\t\t\tlet parentComponentData = parentPrototype.findChild('cda', componentData => componentData.componentId === this.componentId);\n\t\t\tif (parentComponentData)\n\t\t\t\treturn parentComponentData;\n\t\t\telse\n\t\t\t\tparentPrototype = parentPrototype.getParentPrototype();\n\t\t}\n\t\treturn null;\n\t}\n\tgetPropertyOrCreate(name) {\n\t\tlet property = this.findChild('prp', prp => prp.name === name);\n\t\tif (!property) {\n\t\t\tproperty = this.componentClass._propertyTypesByName[name].createProperty();\n\t\t\tthis.addChild(property);\n\t\t}\n\t\treturn property;\n\t}\n\tgetProperty(name) {\n\t\treturn this.findChild('prp', prp => prp.name === name);\n\t}\n\tsetValue(propertyName, value) {\n\t\tthis.getPropertyOrCreate(propertyName).value = value;\n\t\treturn this;\n\t}\n\tgetValue(name) {\n\t\tlet property = this.getProperty(name);\n\t\tif (property)\n\t\t\treturn property.value;\n\t\tlet parent = this.getParentComponentData();\n\t\t\n\t\tif (parent)\n\t\t\treturn parent.getValue(name);\n\t\t\n\t\treturn this.componentClass._propertyTypesByName[name].initialValue;\n\t}\n\tcreateComponent() {\n\t\tlet properties = this.getInheritedProperties();\n\t\tlet values = {};\n\t\tproperties.forEach(prop => {\n\t\t\tvalues[prop.name] = prop.value;\n\t\t});\n\t\tlet component = Component.create(this.name, values);\n\t\tcomponent._componentId = this.componentId;\n\t\treturn component;\n\t}\n}\nSerializable.registerSerializable(ComponentData, 'cda', json => {\n\treturn new ComponentData(json.n, json.id, json.cid);\n});\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nimport Prop from './propertyType';\nimport PropertyOwner from './propertyOwner';\nimport ComponentData from './componentData';\nimport Entity from './entity';\nimport { game } from './game';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Prototype extends PropertyOwner {\n\tconstructor() {\n\t\tsuper(...arguments);\n\t\t\n\t\tthis.previouslyCreatedEntity = null;\n\t}\n\t\n\taddChild(child) {\n\t\tif (child.threeLetterType === 'cda' && !child.componentClass.allowMultiple)\n\t\t\tassert(this.findChild('cda', cda => cda.componentId === child.componentId) === null, `Can't have multiple ${child.name} components. See Component.allowMultiple`);\n\t\tsuper.addChild(child);\n\t}\n\tgetParentPrototype() {\n\t\treturn this._parent && this._parent.threeLetterType === 'prt' ? this._parent : null;\n\t}\n\t\n\t/*\n\tReturns JSON:\n\t[\n\t\t{\n\t\t\townComponent: false, // component of a parent prototype\n\t\t\tcomponentClass: [object Object],\n\t\t\tcomponentId: <componentId>,\n\t\t\tthreeLetterType: 'icd',\n\t \t\tgeneratedForPrototype: <this>,\n\t\t\tproperties: [\n\t\t\t\t{ id missing }\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t ownComponentData: <ComponentData> || null, // null if this prototype has 0 properties defined\n\t\t\t componentClass: [object Object],\n\t\t\t componentId: <componentId>,\n\t\t\t threeLetterType: 'icd',\n\t\t\t generatedForPrototype: <this>,\n\t\t\t properties: [\n\t\t\t \t{ id found if own property } // some properties might be from parent prototypes and thus missing id\n\t\t\t ]\n\t\t }\n\t]\n\t */\n\tgetInheritedComponentDatas(filter = null) {\n\t\tlet originalPrototype = this;\n\t\t\n\t\tfunction getDataFromPrototype(prototype, _depth = 0) {\n\t\t\tlet data;\n\t\t\t\n\t\t\tlet parentPrototype = prototype.getParentPrototype();\n\t\t\tif (parentPrototype)\n\t\t\t\tdata = getDataFromPrototype(parentPrototype, _depth + 1);\n\t\t\telse\n\t\t\t\tdata = {}; // Top level\n\t\t\t\n\t\t\tlet componentDatas = prototype.getChildren('cda');\n\t\t\tcomponentDatas.forEach(componentData => {\n\t\t\t\tif (filter && !filter(componentData))\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\tif (!data[componentData.componentId]) {\n\t\t\t\t\t// Most parent version of this componentId\n\t\t\t\t\tdata[componentData.componentId] = {\n\t\t\t\t\t\t// ownComponent = true if the original prototype is the first one introducing this componentId\n\t\t\t\t\t\townComponentData: null, // will be given value if original prototype has this componentId\n\t\t\t\t\t\tcomponentClass: componentData.componentClass,\n\t\t\t\t\t\tcomponentId: componentData.componentId,\n\t\t\t\t\t\tpropertyHash: {},\n\t\t\t\t\t\tthreeLetterType: 'icd',\n\t\t\t\t\t\tgeneratedForPrototype: originalPrototype\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (_depth === 0) {\n\t\t\t\t\tdata[componentData.componentId].ownComponentData = componentData;\n\t\t\t\t}\n\n\t\t\t\tcomponentData.getChildren('prp').forEach(property => {\n\t\t\t\t\t// Newest version of a property always overrides old property\n\t\t\t\t\tdata[componentData.componentId].propertyHash[property.name] = _depth === 0 ? property : property.clone(true);\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\treturn data;\n\t\t}\n\n\t\tlet data = getDataFromPrototype(this);\n\t\tlet array = Object.keys(data).map(key => data[key]);\n\t\tarray.forEach(inheritedComponentData => {\n\t\t\tinheritedComponentData.properties = inheritedComponentData.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\tif (inheritedComponentData.propertyHash[propertyType.name])\n\t\t\t\t\treturn inheritedComponentData.propertyHash[propertyType.name];\n\t\t\t\telse\n\t\t\t\t\treturn propertyType.createProperty({ skipSerializableRegistering: true });\n\t\t\t});\n\t\t\tdelete inheritedComponentData.propertyHash;\n\t\t});\n\t\t\n\t\tarray.forEach(inheritedComponentData => {\n\t\t\tlet cid = inheritedComponentData.componentId;\n\t\t});\n\n\t\treturn array.sort((a, b) => a.componentClass.componentName.localeCompare(b.componentClass.componentName));\n\t}\n\t\n\tcreateAndAddPropertyForComponentData(inheritedComponentData, propertyName, propertyValue) {\n\t\tlet propertyType = inheritedComponentData.componentClass._propertyTypesByName[propertyName];\n\t\tassert(propertyType, 'Invalid propertyName', propertyName, inheritedComponentData);\n\t\tlet componentData = this.findChild('cda', componentData => componentData.componentId === inheritedComponentData.componentId);\n\t\tlet componentDataIsNew = false;\n\t\tif (!componentData) {\n\t\t\tconsole.log('no component data. create one', this, inheritedComponentData);\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.componentClass.componentName, false, inheritedComponentData.componentId);\n\t\t\tcomponentDataIsNew = true;\n\t\t}\n\t\tlet property = componentData.findChild('prp', property => property.name === propertyName);\n\t\tif (property) {\n\t\t\tproperty.value = propertyValue;\n\t\t\treturn property;\n\t\t}\n\n\t\tproperty = propertyType.createProperty({\n\t\t\tvalue: propertyValue,\n\t\t});\n\t\tcomponentData.addChild(property);\n\t\t\n\t\tif (componentDataIsNew)\n\t\t\tthis.addChild(componentData);\n\t\t\n\t\treturn property;\n\t}\n\t\n\tfindComponentDataByComponentId(componentId, alsoFindFromParents = false) {\n\t\tlet child = this.findChild('cda', componentData => componentData.componentId === componentId);\n\t\tif (child)\n\t\t\treturn child;\n\t\tif (alsoFindFromParents) {\n\t\t\tlet parent = this.getParentPrototype();\n\t\t\tif (parent)\n\t\t\t\treturn parent.findComponentDataByComponentId(componentId, alsoFindFromParents);\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tgetOwnComponentDataOrInherit(componentId) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, false);\n\t\tif (!componentData) {\n\t\t\tlet inheritedComponentData = this.findComponentDataByComponentId(componentId, true);\n\t\t\tif (!inheritedComponentData)\n\t\t\t\treturn null;\n\t\t\t\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.name, false, componentId);\n\t\t\tthis.addChild(componentData);\n\t\t}\n\t\treturn componentData\n\t}\n\t\n\tfindOwnProperty(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId);\n\t\tif (componentData) {\n\t\t\treturn componentData.getProperty(propertyName);\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tcreateEntity() {\n\t\tlet entity = new Entity();\n\t\tlet inheritedComponentDatas = this.getInheritedComponentDatas();\n\t\tlet components = inheritedComponentDatas.map(Component.createWithInheritedComponentData);\n\t\tentity.addComponents(components);\n\t\tentity.prototype = this;\n\t\t\n\t\tthis.previouslyCreatedEntity = entity;\n\t\treturn entity;\n\t}\n\t\n\tgetValue(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, true);\n\t\tif (componentData)\n\t\t\treturn componentData.getValue(propertyName);\n\t\telse\n\t\t\treturn undefined;\n\t}\n\t\n\tcountEntityPrototypes(findParents = false) {\n\t\tif (this.threeLetterType !== 'prt')\n\t\t\treturn 0;\n\t\t\n\t\tlet count = 0;\n\t\tlet levels = game.getChildren('lvl');\n\t\tfor (let i = levels.length-1; i >= 0; i--) {\n\t\t\tlet entityPrototypes = levels[i].getChildren('epr');\n\t\t\tfor (let j = entityPrototypes.length-1; j >= 0; j--) {\n\t\t\t\tif (entityPrototypes[j].prototype === this)\n\t\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (findParents)\n\t\t\tthis.forEachChild('prt', prt => count += prt.countEntityPrototypes(true));\n\t\t\n\t\treturn count;\n\t}\n\t\n\tdelete() {\n\t\tthis._game = this._game || this.getRoot();\n\t\tif (!super.delete()) return false;\n\t\tif (this.threeLetterType === 'prt') {\n\t\t\tthis._game.forEachChild('lvl', lvl => {\n\t\t\t\tlet items = lvl.getChildren('epr');\n\t\t\t\tfor (let i = items.length-1; i >= 0; i--) {\n\t\t\t\t\tif (items[i].prototype === this) {\n\t\t\t\t\t\tlvl.deleteChild(items[i], i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.previouslyCreatedEntity = null;\n\t\treturn true;\n\t}\n}\nPropertyOwner.defineProperties(Prototype, propertyTypes);\n\nPrototype.create = function(name) {\n\treturn new Prototype().initWithPropertyValues({ name: name });\n};\n\nSerializable.registerSerializable(Prototype, 'prt');\n","import Serializable from './serializable'\nimport { addChange, changeType, setChangeOrigin } from './serializableManager';\nimport Prototype from '../core/prototype'\nimport assert from '../util/assert'\nimport PropertyOwner, { Prop } from '../core/propertyOwner';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nlet game = null; // only one game at the time\nexport { game };\n\nlet isClient = typeof window !== 'undefined';\n\nexport default class Game extends PropertyOwner {\n\tconstructor(predefinedId) {\n\t\tif (isClient) {\n\t\t\tif (game) {\n\t\t\t\ttry {\n\t\t\t\t\tgame.delete();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Deleting old game failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tgame = this;\n\t\t}\n\t\t\n\t\tif (predefinedId)\n\t\t\tconsole.log('game import');\n\t\telse\n\t\t\tconsole.log('game created');\n\t\t\n\t\tsuper(...arguments);\n\t}\n\tinitWithChildren() {\n\t\tsuper.initWithChildren(...arguments);\n\t\taddChange(changeType.addSerializableToTree, this);\n\t}\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\t\t\n\t\tif (game === this)\n\t\t\tgame = null;\n\t\tconsole.log('game.delete');\n\t\t\n\t\treturn true;\n\t}\n}\nPropertyOwner.defineProperties(Game, propertyTypes);\n\nGame.prototype.isRoot = true;\n\nSerializable.registerSerializable(Game, 'gam');\n","import Serializable from './serializable';\nimport Entity from './entity';\nimport assert from '../util/assert';\nimport { game } from './game';\nimport { addChange, changeType, setChangeOrigin } from './serializableManager';\n\nlet scene = null;\nexport { scene };\n\nlet isClient = typeof window !== 'undefined';\n\nexport default class Scene extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tif (isClient) {\n\t\t\tif (scene) {\n\t\t\t\ttry {\n\t\t\t\t\tscene.delete();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Deleting old scene failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tscene = this;\n\t\t\t\n\t\t\tthis.canvas = document.querySelector('canvas.anotherCanvas');\n\t\t\tthis.context = this.canvas.getContext('2d');\n\t\t}\n\t\tthis.level = null;\n\t\t\n\t\t// To make component based entity search fast:\n\t\tthis.components = new Map(); // componentName -> Set of components\n\t\t\n\t\tthis.animationFrameId = null;\n\t\tthis.playing = false;\n\t\tthis.time = 0;\n\n\t\tsuper(predefinedId);\n\t\taddChange(changeType.addSerializableToTree, this);\n\n\t\tif (predefinedId)\n\t\t\tconsole.log('scene import');\n\t\telse\n\t\t\tconsole.log('scene created');\n\t\t\n\t\tthis.draw();\n\t}\n\twin() {\n\t\tsetTimeout(() => {\n\t\t\tsetChangeOrigin(this);\n\t\t\tthis.reset();\n\t\t\tgame.dispatch('levelCompleted');\n\t\t})\n\t}\n\tanimFrame(playCalled) {\n\t\tthis.animationFrameId = null;\n\t\tif (!this._alive || !this.playing) return;\n\t\t\n\t\tlet t = 0.001*performance.now();\n\t\tlet dt = t-this._prevUpdate;\n\t\tif (dt > 0.1)\n\t\t\tdt = 0.1;\n\t\tthis._prevUpdate = t;\n\t\tthis.time += dt;\n\n\t\tsetChangeOrigin(this);\n\t\tthis.dispatch('onUpdate', dt, this.time);\n\t\tthis.draw();\n\t\t\n\t\tthis.requestAnimFrame();\n\t}\n\trequestAnimFrame() {\n\t\tthis.animationFrameId = window.requestAnimationFrame(() => this.animFrame());\n\t}\n\tdraw() {\n\t\tthis.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\t\tthis.dispatch('onDraw', this.context);\n\t}\n\tisInInitialState() {\n\t\treturn !this.playing && this.time === 0;\n\t}\n\treset() {\n\t\tthis.pause();\n\t\tthis.deleteChildren();\n\t\tif (this.level)\n\t\t\tthis.level.createScene(this);\n\t\tthis.time = 0;\n\t\tthis.draw();\n\t}\n\tpause() {\n\t\tif (!this.playing) return;\n\t\t\n\t\tthis.playing = false;\n\t\tif (this.animationFrameId)\n\t\t\twindow.cancelAnimationFrame(this.animationFrameId);\n\t\tthis.animationFrameId = null;\n\t}\n\tplay() {\n\t\tif (this.playing) return;\n\t\t\n\t\tthis._prevUpdate = 0.001*performance.now();\n\t\tthis.playing = true;\n\t\t\n\t\tthis.requestAnimFrame();\n\t\t\n\t\t\n\t\tif (this.time === 0)\n\t\t\tthis.dispatch('onStart');\n\t\t\n\t\t/*\n\t\tlet player = game.findChild('prt', p => p.name === 'Player', true);\n\t\tif (player) {\n\t\t\tconsole.log('Spawning player!', player);\n\t\t\tthis.spawn(player);\n\t\t}\n\t\t*/\n\t}\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\t\t\n\t\tif (scene === this)\n\t\t\tscene = null;\n\t\t\n\t\tconsole.log('scene.delete');\n\t\treturn true;\n\t}\n\n\t// To make component based entity search fast:\n\taddComponent(component) {\n\t\tlet set = this.components.get(component.constructor.componentName);\n\t\tif (!set) {\n\t\t\tset = new Set();\n\t\t\tthis.components.set(component.constructor.componentName, set);\n\t\t}\n\t\tset.add(component);\n\t}\n\tremoveComponent(component) {\n\t\tlet set = this.components.get(component.constructor.componentName);\n\t\tassert(set);\n\t\tassert(set.delete(component));\n\t}\n\tgetComponents(componentName) {\n\t\treturn this.components.get(componentName) || new Set;\n\t}\n}\nScene.prototype.isRoot = true;\n\nSerializable.registerSerializable(Scene, 'sce');\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport Property from './property';\nimport PropertyOwner from './propertyOwner';\nimport { scene } from './scene';\nimport { game } from './game';\nexport { default as Prop } from './propertyType';\nexport let componentClasses = new Map();\nimport ComponentData from './componentData';\n\n// Instance of a component, see componentExample.js\nexport class Component extends PropertyOwner {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\t\tthis._componentId = null; // Creator will fill this\n\t\tthis.scene = scene;\n\t\tthis.game = game;\n\t\tthis._listenRemoveFunctions = [];\n\t\tthis.entity = null;\n\t}\n\tdelete() {\n\t\t// Component.delete never returns false because entity doesn't have components as children\n\t\tthis._parent = null;\n\t\tthis.entity = null;\n\t\tsuper.delete();\n\t\treturn true;\n\t}\n\t_preInit() {\n\t\tthis.constructor.requirements.forEach(r => {\n\t\t\tthis[r] = this.entity.getComponent(r);\n\t\t\tassert(this[r], `${this.constructor.componentName} requires component ${r} but it is not found`);\n\t\t});\n\n\t\tthis.forEachChild('com', c => c._preInit());\n\t\t\n\t\t['onUpdate', 'onDraw', 'onDrawHelper', 'onStart'].forEach(funcName => {\n\t\t\tif (typeof this[funcName] === 'function') {\n\t\t\t\t// console.log('listen ' + funcName);\n\t\t\t\tthis._listenRemoveFunctions.push(this.scene.listen(funcName, (...args) => this[funcName](...args)));\n\t\t\t}\n\t\t});\n\n\t\tif (this.constructor.componentName !== 'Transform')\n\t\t\tthis.scene.addComponent(this);\n\t\t\n\t\ttry {\n\t\t\tif (typeof this.preInit === 'function')\n\t\t\t\tthis.preInit();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'preInit', e);\n\t\t}\n\t}\n\t_init() {\n\t\tthis.forEachChild('com', c => c._init());\n\t\ttry {\n\t\t\tif (typeof this.init === 'function')\n\t\t\t\tthis.init();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'init', e);\n\t\t}\n\t}\n\t_sleep() {\n\t\ttry {\n\t\t\tif (typeof this.sleep === 'function')\n\t\t\t\tthis.sleep();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'sleep', e);\n\t\t}\n\n\t\tif (this.constructor.componentName !== 'Transform')\n\t\t\tthis.scene.removeComponent(this);\n\t\t\n\t\tthis.forEachChild('com', c => c._sleep());\n\t\t// console.log(`remove ${this._listenRemoveFunctions.length} listeners`);\n\t\tthis._listenRemoveFunctions.forEach(f => f());\n\t\tthis._listenRemoveFunctions.length = 0;\n\t}\n\tcreateComponentData() {\n\t\tlet componentName = this.constructor.componentName;\n\t\tlet propertyTypes = this.constructor._propertyTypes;\n\t\tlet componentData = new ComponentData(componentName);\n\t\tlet children = [];\n\t\tpropertyTypes.forEach(pt => {\n\t\t\tchildren.push(pt.createProperty({\n\t\t\t\tvalue: this[pt.name]\n\t\t\t}));\n\t\t});\n\t\tcomponentData.initWithChildren(children);\n\t\treturn componentData;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tn: this.constructor.componentName,\n\t\t\tcid: this._componentId\n\t\t});\n\t}\n}\nComponent.create = function(name, values = {}) {\n\tlet componentClass = componentClasses.get(name);\n\tassert(componentClass);\n\tlet component = new componentClass();\n\tcomponent.initWithPropertyValues(values);\n\treturn component;\n};\nComponent.createWithInheritedComponentData = function(inheritedComponentData) {\n\tlet component = new inheritedComponentData.componentClass;\n\tcomponent._componentId = inheritedComponentData.componentId;\n\tlet properties = inheritedComponentData.properties.map(p => p.clone());\n\tcomponent.initWithChildren(properties);\n\treturn component;\n};\n\nComponent.reservedPropertyNames = new Set(['id', 'constructor', 'delete', 'children', 'entity', 'env', 'init', 'preInit', 'sleep', 'toJSON', 'fromJSON']);\nComponent.reservedPrototypeMembers = new Set(['id', 'children', 'entity', 'env', '_preInit', '_init', '_sleep', '_forEachChildComponent', '_properties', '_componentData', 'toJSON', 'fromJSON']);\nComponent.register = function({\n\tname = '', // required\n\tdescription = '',\n\tcategory = 'Other',\n\ticon = 'fa-puzzle-piece', // in editor\n\tcolor = '', // in editor\n\tproperties = [],\n\trequirements = ['Transform'],\n\tchildren = [],\n\tparentClass = Component,\n\tprototype = {},\n\tallowMultiple = true\n}) {\n\tassert(name, 'Component must have a name.');\n\tassert(name[0] >= 'A' && name[0] <= 'Z', 'Component name must start with capital letter.');\n\tassert(!componentClasses.has(name), 'Duplicate component class ' + name);\n\tObject.keys(prototype).forEach(k => {\n\t\tif (Component.reservedPrototypeMembers.has(k))\n\t\t\tassert(false, 'Component prototype can not have a reserved member: ' + k);\n\t});\n\t\n\tlet constructorFunction = prototype.constructor;\n\tlet deleteFunction = prototype.delete;\n\tdelete prototype.constructor;\n\tdelete prototype.delete;\n\tclass Com extends parentClass {\n\t\tconstructor() {\n\t\t\tsuper(...arguments);\n\t\t\tif (constructorFunction)\n\t\t\t\tconstructorFunction();\n\t\t}\n\t\tdelete() {\n\t\t\tif (!super.delete()) return false;\n\t\t\t\n\t\t\tif (deleteFunction)\n\t\t\t\tdeleteFunction();\n\t\t\t\n\t\t\treturn true;\n\t\t}\n\t}\n\tproperties.forEach(p => {\n\t\tassert(!Component.reservedPropertyNames.has(p.name), 'Can not have property called ' + p.name);\n\t});\n\tPropertyOwner.defineProperties(Com, properties); // properties means propertyTypes here\n\tCom.componentName = name;\n\tCom.category = category;\n\tif (requirements.indexOf('Transform') < 0) requirements.push('Transform');\n\tCom.requirements = requirements;\n\tCom.children = children;\n\tCom.description = description;\n\tCom.allowMultiple = allowMultiple;\n\tCom.icon = icon;\n\t\n\tlet num = name.split('').reduce((prev, curr) => prev + curr.charCodeAt(0), 0);\n\tCom.color = color || `hsla(${ num % 360 }, 40%, 60%, 1)`;\n\n\tprototype._name = name;\n\tObject.assign(Com.prototype, prototype);\n\tcomponentClasses.set(Com.componentName, Com);\n\treturn Com;\n};\n\nSerializable.registerSerializable(Component, 'com', json => {\n\tlet component = new (componentClasses.get(json.n))(json.id);\n\tcomponent._componentId = json.cid || null;\n\treturn component;\n});\n","import Prototype from './prototype';\nimport Property from './property';\nimport Serializable from './serializable';\nimport { getSerializable } from './serializableManager';\nimport { Prop, componentClasses } from './component';\nimport ComponentData from './componentData';\nimport { scene } from './scene';\nimport assert from '../util/assert';\nimport Vector from '../util/vector';\n\n// EntityPrototype is a prototype that always has one Transform ComponentData and optionally other ComponentDatas also.\n// Entities are created based on EntityPrototypes\nexport default class EntityPrototype extends Prototype {\n\tconstructor(predefinedId = false) {\n\t\tsuper(...arguments);\n\t\t// this._parent is level, not prototype. We need a link to parent-prototype.\n\t\tthis.prototype = null;\n\t}\n\tgetTransform() {\n\t\treturn this.findChild('cda', cda => cda.name === 'Transform');\n\t}\n\tgetParentPrototype() {\n\t\treturn this.prototype;\n\t}\n\tclone() {\n\t\tlet obj = new EntityPrototype();\n\t\tobj.prototype = this.prototype;\n\t\tlet id = obj.id;\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tif (child.threeLetterType === 'prp' && child.name === 'name') {\n\t\t\t\tlet property = new Property({\n\t\t\t\t\tvalue: child.propertyType.type.clone(child.value),\n\t\t\t\t\tname: child.name,\n\t\t\t\t\tpropertyType: this.propertyType,\n\t\t\t\t\tpredefinedId: id + '_n'\n\t\t\t\t});\n\t\t\t\tchildren.push(property);\n\t\t\t} else if (child.threeLetterType === 'cda' && child.name === 'Transform') {\n\t\t\t\tlet transform = new ComponentData('Transform', id + '_t');\n\n\t\t\t\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', prp => prp.name === 'position').value,\n\t\t\t\t\tpredefinedId: id + '_p'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(position);\n\n\t\t\t\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', prp => prp.name === 'scale').value,\n\t\t\t\t\tpredefinedId: id + '_s'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(scale);\n\n\t\t\t\tlet rotation = transform.componentClass._propertyTypesByName.rotation.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', prp => prp.name === 'rotation').value,\n\t\t\t\t\tpredefinedId: id + '_r'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(rotation);\n\t\t\t\t\n\t\t\t\tchildren.push(transform);\n\t\t\t} else {\n\t\t\t\tchildren.push(child.clone());\n\t\t\t}\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\ttoJSON() {\n\t\t// return super.toJSON();\n\t\t\n\t\t// Below optimization reduces size 88%. id's have to be generated based on this.id\n\t\t\n\t\tlet Transform = this.getTransform();\n\t\tlet json = {\n\t\t\tid: this.id,\n\t\t\tp: this.prototype.id\n\t\t};\n\t\t\n\t\tlet childArrays = [];\n\t\tthis._children.forEach(child => {\n\t\t\tchildArrays.push(child);\n\t\t});\n\t\tlet children = [].concat(...childArrays).filter(child => {\n\t\t\treturn child !== Transform && child !== this._properties.name;\n\t\t});\n\t\tif (children.length > 0)\n\t\t\tjson.c = children.map(child => child.toJSON());\n\t\t\n\t\tlet prototype = this.prototype;\n\t\t\n\t\tlet floatToJSON = Prop.float().toJSON;\n\t\tlet handleProperty = prp => {\n\t\t\tif (prp.name === 'name') {\n\t\t\t\tif (!prototype || prp.value !== prototype.name)\n\t\t\t\t\tjson.n = prp.value;\n\t\t\t} else if (prp.name === 'position') {\n\t\t\t\tjson.x = floatToJSON(prp.value.x);\n\t\t\t\tjson.y = floatToJSON(prp.value.y);\n\t\t\t} else if (prp.name === 'scale') {\n\t\t\t\tif (!prp.value.isEqualTo(new Vector(1, 1))) {\n\t\t\t\t\tjson.w = floatToJSON(prp.value.x);\n\t\t\t\t\tjson.h = floatToJSON(prp.value.y);\n\t\t\t\t}\n\t\t\t} else if (prp.name === 'rotation') {\n\t\t\t\tif (prp.value !== 0)\n\t\t\t\t\tjson.a = floatToJSON(prp.value);\n\t\t\t}\n\t\t};\n\t\thandleProperty(this._properties.name);\n\n\t\tTransform.getChildren('prp').forEach(handleProperty);\n\t\treturn json;\n\t}\n\tspawnEntityToScene(position) {\n\t\tif (!scene)\n\t\t\treturn;\n\t\t\n\t\tif (position) {\n\t\t\tthis.getTransform().getPropertyOrCreate('position').value = position;\n\t\t}\n\t\t\n\t\tlet entity = this.createEntity();\n\t\tscene.addChild(entity);\n\t}\n}\nObject.defineProperty(EntityPrototype.prototype, 'position', {\n\tget() {\n\t\treturn this.getTransform().findChild('prp', prp => prp.name === 'position').value;\n\t},\n\tset(position) {\n\t\treturn this.getTransform().findChild('prp', prp => prp.name === 'position').value = position;\n\t}\n});\n\n// If Transform or Transform.position is missing, they are added.\nEntityPrototype.createFromPrototype = function(prototype, componentDatas = []) {\n\n\tlet entityPrototype = new EntityPrototype();\n\tentityPrototype.prototype = prototype;\n\tlet id = entityPrototype.id;\n\t\n\tassert(!componentDatas.find(cda => cda.name === 'Transform'), 'Prototype (prt) can not have a Transform component');\n\t\n\tlet transform = new ComponentData('Transform', id + '_t');\n\tcomponentDatas.push(transform);\n\t\n\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\tvalue: new Vector(0, 0),\n\t\tpredefinedId: id + '_p'\n\t});\n\ttransform.addChild(position);\n\n\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: new Vector(1, 1),\n\t\tpredefinedId: id + '_s'\n\t});\n\ttransform.addChild(scale);\n\n\tlet rotation = transform.componentClass._propertyTypesByName.rotation.createProperty({\n\t\tvalue: 0,\n\t\tpredefinedId: id + '_r'\n\t});\n\ttransform.addChild(rotation);\n\n\tlet name = EntityPrototype._propertyTypesByName.name.createProperty({\n\t\tvalue: prototype.name,\n\t\tpredefinedId: id + '_n'\n\t});\n\t\n\tentityPrototype.initWithChildren([name, ...componentDatas])\n\n\treturn entityPrototype;\n};\n\nSerializable.registerSerializable(EntityPrototype, 'epr', json => {\n\tlet entityPrototype = new EntityPrototype(json.id);\n\tentityPrototype.prototype = getSerializable(json.p);\n\tassert(entityPrototype.prototype, `Prototype ${json.p} not found`);\n\t\n\tlet nameId = json.id + '_n';\n\tlet transformId = json.id + '_t';\n\tlet positionId = json.id + '_p';\n\tlet scaleId = json.id + '_s';\n\tlet rotationId = json.id + '_r';\n\t\n\tlet name = Prototype._propertyTypesByName.name.createProperty({ \n\t\tvalue: json.n === undefined ? entityPrototype.prototype.name : json.n, \n\t\tpredefinedId: nameId \n\t});\n\t\n\tlet transformData = new ComponentData('Transform', transformId);\n\tlet transformClass = componentClasses.get('Transform');\n\t\n\tlet position = transformClass._propertyTypesByName.position.createProperty({\n\t\tvalue: new Vector(json.x, json.y),\n\t\tpredefinedId: positionId\n\t});\n\ttransformData.addChild(position);\n\n\tlet scale = transformClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: new Vector(json.w === undefined ? 1 : json.w, json.h === undefined ? 1 : json.h),\n\t\tpredefinedId: scaleId\n\t});\n\ttransformData.addChild(scale);\n\n\tlet rotation = transformClass._propertyTypesByName.rotation.createProperty({\n\t\tvalue: json.a || 0,\n\t\tpredefinedId: rotationId\n\t});\n\ttransformData.addChild(rotation);\n\t\n\t\n\tentityPrototype.initWithChildren([name, transformData]);\n\treturn entityPrototype;\n});\n","import Serializable from './serializable';\nimport PropertyOwner, { Prop } from '../core/propertyOwner';\nimport Scene, { scene } from './scene';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Level extends PropertyOwner {\n\tconstructor(predefinedId) {\n\t\tsuper(...arguments);\n\n\t\tif (predefinedId)\n\t\t\tconsole.log('level import');\n\t\telse\n\t\t\tconsole.log('level created');\n\t}\n\tcreateScene(predefinedSceneObject = false) {\n\t\tif (!predefinedSceneObject)\n\t\t\tnew Scene();\n\t\tlet entities = this.getChildren('epr').map(epr => epr.createEntity());\n\t\tscene.addChildren(entities);\n\t\tscene.level = this;\n\t\treturn scene;\n\t}\n\t\n\t\n\t/*\n\tOPTIMIZATION DOES NOT WORK, YET\n\ttoJSON() {\n\t\tlet json = super.toJSON();\n\t\tconsole.log('before', json);\n\t\tif (json.c) {\n\t\t\tlet prototypeIds = new Set();\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tconsole.log('child', child);\n\t\t\t\tprototypeIds.add(child.p);\n\t\t\t});\n\t\t\t\n\t\t\tlet prototypeIdToNum = {};\n\t\t\tlet prototypeIdArray = [];\n\t\t\tlet num = 0;\n\t\t\tprototypeIds.forEach(key => {\n\t\t\t\tprototypeIdArray[num] = key;\n\t\t\t\tprototypeIdToNum[key] = num++;\n\t\t\t});\n\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tchild.p = prototypeIdToNum[child.p] || child.p;\n\t\t\t});\n\t\t\t\n\t\t\tjson.p = prototypeIdArray;\n\n\t\t\tconsole.log(json, prototypeIds, prototypeIdToNum, prototypeIdArray);\n\t\t}\n\t\treturn json;\n\t}\n\t*/\n}\nPropertyOwner.defineProperties(Level, propertyTypes);\n\nSerializable.registerSerializable(Level, 'lvl');\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Transform',\n\tcategory: 'Core',\n\ticon: 'fa-dot-circle-o',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('position', new Vector(0, 0), Prop.vector),\n\t\tProp('scale', new Vector(1, 1), Prop.vector),\n\t\tProp('rotation', 0, Prop.float, Prop.float.modulo(0, Math.PI * 2), Prop.flagDegreesInEditor)\n\t]\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nlet vari = 0;\n\nComponent.register({\n\tname: 'Test',\n\tcategory: 'Core',\n\tproperties: [\n\t\tProp('name', 'Oh right', Prop.string),\n\t\tProp('enum', 'yksi', Prop.enum, Prop.enum.values('yksi', 'kaksi', 'kolme', 'neljä')),\n\t\tProp('topBarHelper', new Vector(0, 1), Prop.vector),\n\t\tProp('test' + ++vari, vari, Prop.int),\n\t\tProp('test' + ++vari, false, Prop.bool),\n\t\tProp('test' + ++vari, true, Prop.bool)\n\t]\n});\n","import { Component, Prop } from '../core/component';\nimport { key, keyPressed } from '../util/input';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Mover',\n\tproperties: [\n\t\tProp('change', new Vector(10, 10), Prop.vector),\n\t\tProp('userControlled', false, Prop.bool),\n\t\tProp('speed', 1, Prop.float),\n\t\tProp('rotationSpeed', 0, Prop.float, 'Degrees per second', Prop.flagDegreesInEditor)\n\t],\n\tprototype: {\n\t\tonUpdate(dt, t) {\n\t\t\tif (this.userControlled) {\n\t\t\t\tif (!this.entity.localMaster) return;\n\t\t\t\t\n\t\t\t\tlet dx = 0;\n\t\t\t\tlet dy = 0;\n\t\t\t\t\n\t\t\t\tif (keyPressed(key.left)) dx -= 1;\n\t\t\t\tif (keyPressed(key.right)) dx += 1;\n\t\t\t\tif (keyPressed(key.up)) dy -= 1;\n\t\t\t\tif (keyPressed(key.down)) dy += 1;\n\t\t\t\tif (dx) this.Transform.position.x += dx * this.speed * dt;\n\t\t\t\tif (dy) this.Transform.position.y += dy * this.speed * dt;\n\t\t\t\tif (dx || dy) {\n\t\t\t\t\tthis.Transform.position = this.Transform.position;\n\t\t\t\t}\n\t\t\t\tif (dx && this.rotationSpeed) {\n\t\t\t\t\tthis.Transform.rotation += dt * dx * this.rotationSpeed;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet change = new Vector(dt, 0).rotate(t * this.speed).multiply(this.change);\n\t\t\t\tthis.Transform.position.set(this.Transform.position).add(change);\n\t\t\t\t\n\t\t\t\tif (this.rotationSpeed)\n\t\t\t\t\tthis.Transform.rotation += dt * this.rotationSpeed;\n\t\t\t}\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Rect',\n\ticon: 'fa-stop',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('size', new Vector(10, 10), Prop.vector),\n\t\tProp('style', 'red', Prop.string),\n\t\tProp('randomStyle', false, Prop.bool)\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\tif (this.randomStyle)\n\t\t\t\tthis.style = `hsl(${Math.random()*360 | 0}, 100%, 40%)`;\n\t\t},\n\t\tonDraw(context) {\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - this.size.x/2 * this.Transform.scale.x,\n\t\t\t\ty = this.Transform.position.y - this.size.y/2 * this.Transform.scale.y,\n\t\t\t\tw = this.size.x * this.Transform.scale.x,\n\t\t\t\th = this.size.y * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = this.style;\n\t\t\tcontext.translate(x+w/2, y+h/2);\n\t\t\tcontext.rotate(this.Transform.rotation);\n\t\t\tcontext.fillRect(-w/2, -h/2, w, h);\n\t\t\tcontext.restore();\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport EntityPrototype from '../core/entityPrototype';\n\nComponent.register({\n\tname: 'Spawner',\n\tproperties: [\n\t\tProp('typeName', '', Prop.string)\n\t],\n\tprototype: {\n\t\tonStart() {\n\t\t\tthis.spawn();\n\t\t},\n\t\tonDrawHelper(context) {\n\t\t\tlet size = 30;\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - size * this.Transform.scale.x/2,\n\t\t\t\ty = this.Transform.position.y - size * this.Transform.scale.y/2,\n\t\t\t\tw = size * this.Transform.scale.x,\n\t\t\t\th = size * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = 'blue';\n\t\t\tcontext.strokeStyle = 'white';\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.font = '40px FontAwesome';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.fillText('\\uf21d', this.Transform.position.x + 2, this.Transform.position.y);\n\t\t\tcontext.strokeText('\\uf21d', this.Transform.position.x + 2, this.Transform.position.y);\n\t\t\t\n\t\t\tcontext.restore();\n\t\t},\n\t\tspawn() {\n\t\t\tlet prototype = this.game.findChild('prt', prt => prt.name === this.typeName);\n\t\t\tif (!prototype)\n\t\t\t\treturn;\n\n\t\t\tEntityPrototype.createFromPrototype(prototype).spawnEntityToScene(this.Transform.position);\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Trigger',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('trigger', 'playerComesNear', Prop.enum, Prop.enum.values('playerComesNear')),\n\t\tProp('radius', 40, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('trigger', 'playerComesNear')),\n\t\tProp('action', 'win', Prop.enum, Prop.enum.values('win'))\n\t],\n\tprototype: {\n\t\tonDrawHelper(context) {\n\t\t\tlet size = 30;\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - size * this.Transform.scale.x/2,\n\t\t\t\ty = this.Transform.position.y - size * this.Transform.scale.y/2,\n\t\t\t\tw = size * this.Transform.scale.x,\n\t\t\t\th = size * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = 'blue';\n\t\t\tcontext.strokeStyle = 'white';\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.font = '40px FontAwesome';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.fillText('\\uf085', this.Transform.position.x, this.Transform.position.y + 15);\n\t\t\tcontext.strokeText('\\uf085', this.Transform.position.x, this.Transform.position.y + 15);\n\t\t\t\n\t\t\tcontext.restore();\n\t\t},\n\t\tpreInit() {\n\t\t\tthis.storeProp = `__Trigger_${this._componentId}`;\n\t\t},\n\t\tonUpdate() {\n\t\t\tif (this.trigger === 'playerComesNear') {\n\t\t\t\tlet componentSet = this.scene.getComponents('Mover');\n\t\t\t\tlet entities = [];\n\t\t\t\tcomponentSet.forEach(c => entities.push(c.entity));\n\t\t\t\tlet distSq = this.radius * this.radius;\n\t\t\t\tlet pos = this.Transform.position;\n\t\t\t\tfor (let i = 0; i < entities.length; ++i) {\n\t\t\t\t\tif (entities[i].position.distanceSq(pos) < distSq) {\n\t\t\t\t\t\tif (!entities[i][this.storeProp] && this.launchTrigger(entities[i]) === false)\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tentities[i][this.storeProp] = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentities[i][this.storeProp] = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Return false if other triggers should not be checked\n\t\tlaunchTrigger(entity) {\n\t\t\tif (this.action === 'win') {\n\t\t\t\tthis.scene.win();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n});\n","import assert from '../util/assert';\n\nimport Serializable from './serializable';\n(() => {\n\tclass S extends Serializable {}\n\tSerializable.registerSerializable(S, 'tes', json => {\n\t\treturn new S(json.id);\n\t});\n\tlet s = new S();\n\tlet id = s.id;\n\tassert(typeof id === 'string' && id.length > 10);\n\tlet json = s.toJSON();\n\tassert(json && typeof json === 'object' && typeof json.id === 'string');\n\ts.delete();\n\ts = Serializable.fromJSON(json);\n\tassert(typeof s.id === 'string' && s.id.length > 10 && s.id === id);\n\ts.delete();\n\tconsole.log('Serializable tests OK');\n})();\n\nimport Entity from './entity';\n(() => {\n\tlet i = new Entity();\n\tassert(i.components.size === 0);\n\tassert(i.getComponent('moi') === null);\n\tassert(i.getComponents('moi').length === 0);\n\ti.delete();\n\tconsole.log('Entity tests OK');\n})();\n\nimport PropertyType from './propertyType';\n(() => {\n\tassert(PropertyType.float.default().validate('4') === 4);\n\tassert(PropertyType.float.range(0, 1).validate(3) === 1);\n\tconsole.log('PropertyType tests OK');\n})();\n","import { Component, Prop } from '../core/component';\n\n// Export so that other components can have this component as parent\nexport default Component.register({\n\tname: 'Example',\n\tdescription: 'Description of what this component does',\n\tcategory: 'Core', // You can also make up new categories.\n\ticon: 'fa-bars', // Font Awesome id\n\trequirements: ['Transform'], // These shared components are autofilled. Error if component is not found.\n\tchildren: ['Image', 'Image', 'Sound'], // These private components are also autofilled. Error if component is not found.\n\tproperties: [\n\t\tProp('variable', 0.5, Prop.float, Prop.float.range(0, 1), 'Description of the property'),\n\t\tProp('otherVar_iaerfperfjoierj', 'Hello', Prop.string, 'Description of the property')\n\t],\n\tparentClass: Component,\n\tprototype: {\n\t\tstaticVariable: 'Example class info',\n\t\tconstructor() {\n\t\t\t// This will be called once, when creating the component\n\t\t\tthis.hiddenVariable = 3;\n\t\t},\n\t\tpreInit() {\n\t\t\t// preInit is called for every component before any component is inited with init(). Children are already preInited here.\n\t\t\tthis.data = {\n\t\t\t\tlotsOfData: 123 + this.variable + this.hiddenVariable\n\t\t\t};\n\t\t},\n\t\tinit() {\n\t\t\t// All the components of this entity has been preInited. You can use them. Children are already inited here.\n\t\t\tthis.Transform.position.x = this.Transform.position.y + 1;\n\n\t\t\tthis.howToAccessChildren = [\n\t\t\t\tthis.children.Image[0].property,\n\t\t\t\tthis.children.Sound.property\n\t\t\t];\n\n\t\t\tthis.SomeComponent = this.entity.getComponent('SomeComponent');\n\t\t},\n\t\tsleep() {\n\t\t\t// Release all the data created in preInit and init\n\t\t\tthis.data = null;\n\t\t\tthis.SomeComponent = null;\n\t\t\tthis.howToAccessChildren = null;\n\t\t\t// Position component is automatically released because it is a requirement.\n\t\t},\n\t\tdelete() {\n\t\t\t// This will be called once, when component stops existing\n\t\t}\n\t}\n});\n","import { el, list, mount } from 'redom';\nimport events from '../events';\nimport { setOption, getOption } from '../editor';\n\nexport default class ModuleContainer {\n\tconstructor(moduleContainerName = 'unknownClass.anotherClass', packButtonIcon = 'fa-chevron-left') {\n\t\tthis.modules = [];\n\t\tthis.packButtonEnabled = !!packButtonIcon;\n\t\tthis.el = el(`div.moduleContainer.packable.${moduleContainerName}`,\n\t\t\tthis.packButton = packButtonIcon && el(`i.packButton.button.iconButton.fa.${packButtonIcon}`),\n\t\t\tthis.tabs = list('div.tabs', ModuleTab),\n\t\t\tthis.moduleElements = el('div.moduleElements')\n\t\t);\n\n\t\t\t\n\t\tif (packButtonIcon) {\n\t\t\tlet packId = 'moduleContainerPacked_' + moduleContainerName;\n\t\t\tif (getOption(packId))\n\t\t\t\tthis.el.classList.add('packed');\n\t\t\t\t\n\t\t\tthis.el.onclick = () => {\n\t\t\t\tsetOption(packId, '');\n\t\t\t\treturn this.el.classList.contains('packed') && this.el.classList.remove('packed') || undefined;\n\t\t\t};\n\t\t\tthis.packButton.onclick = e => {\n\t\t\t\tthis.el.classList.add('packed');\n\t\t\t\tsetOption(packId, 'true');\n\t\t\t\te.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tevents.listen('registerModule_' + moduleContainerName.split('.')[0], (moduleClass, editor) => {\n\t\t\tlet module = new moduleClass(editor);\n\t\t\tmodule.el.classList.add('module-' + module.id);\n\t\t\tthis.modules.push(module);\n\t\t\tthis.el.classList.remove('noModules');\n\t\t\tif (this.modules.length !== 1) {\n\t\t\t\tmodule._hide();\n\t\t\t}\n\t\t\tmount(this.moduleElements, module.el);\n\t\t\tthis._updateTabs();\n\t\t\t\n\t\t\tevents.listen('activateModule_' + module.id, (unpackModuleView = true, ...args) => {\n\t\t\t\tif (unpackModuleView)\n\t\t\t\t\tthis.el.classList.remove('packed');\n\t\t\t\tthis._activateModule(module, args);\n\t\t\t});\n\t\t});\n\t\tthis._updateTabs();\n\t}\n\tupdate() {\n\t\tthis.modules.forEach(m => {\n\t\t\tif (m.update() !== false) {\n\t\t\t\tthis._enableModule(m);\n\t\t\t} else\n\t\t\t\tthis._disableModule(m);\n\t\t});\n\t\tthis._updateTabs();\n\t}\n\t_updateTabs() {\n\t\tif (!this.tabs) return;\n\t\t\n\t\tthis.tabs.update(this.modules);\n\t\t\n\t\tif (!this.packButtonEnabled && this.modules.length <= 1)\n\t\t\tthis.tabs.el.style.display = 'none';\n\t\telse\n\t\t\tthis.tabs.el.style.display = 'block';\n\t\t\n\t\tlet noModules = !this.modules.find(m => m._enabled);\n\t\tthis.el.classList.toggle('noModules', noModules);\n\t}\n\t_activateModule(module, args) {\n\t\tthis.modules.forEach(m => {\n\t\t\tif (m !== module) {\n\t\t\t\tm._hide();\n\t\t\t}\n\t\t});\n\t\tmodule._enabled = true;\n\t\tmodule.activate(...args);\n\t\tmodule._show();\n\t\tthis._updateTabs();\n\t}\n\t_enableModule(module) {\n\t\tif (!module._enabled) {\n\t\t\tmodule._enabled = true;\n\t\t\tlet selectedModule = this.modules.find(m => m._selected);\n\t\t\tif (!selectedModule)\n\t\t\t\tthis._activateModule(module);\n\t\t\tthis._updateTabs();\n\t\t}\n\t}\n\t_disableModule(module) {\n\t\tif (module._enabled) {\n\t\t\tmodule._enabled = false;\n\t\t\tif (module._selected) {\n\t\t\t\tmodule._selected = false;\n\t\t\t\tlet enabledModule = this.modules.find(m => m._enabled);\n\t\t\t\tif (enabledModule)\n\t\t\t\t\tthis._activateModule(enabledModule);\n\t\t\t}\n\t\t\tmodule._hide();\n\t\t\tthis._updateTabs();\n\t\t}\n\t}\n}\n\nclass ModuleTab {\n\tconstructor() {\n\t\tthis.el = el('span.moduleTab.button');\n\t\tthis.module = null;\n\t\tthis.el.onclick = () => {\n\t\t\tevents.dispatch('activateModule_' + this.module.id);\n\t\t};\n\t}\n\tupdate(module) {\n\t\tthis.module = module;\n\t\tthis.el.textContent = module.name;\n\t\tthis.el.classList.toggle('moduleSelected', module._selected);\n\t\tthis.el.classList.toggle('moduleEnabled', module._enabled);\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport ModuleContainer from './moduleContainer';\n\nexport default class Layout {\n\tconstructor() {\n\t\tthis.moduleContainers = [];\n\t\tlet addContainer = (...args) => {\n\t\t\tlet container = new ModuleContainer(...args);\n\t\t\tthis.moduleContainers.push(container);\n\t\t\treturn container;\n\t\t}\n\t\tthis.el = el('div.editorLayout',\n\t\t\tel('div.nonRight',\n\t\t\t\taddContainer('top', null),\n\t\t\t\tel('div.bottomLeft',\n\t\t\t\t\taddContainer('left', 'fa-chevron-left'),\n\t\t\t\t\tel('div.middle',\n\t\t\t\t\t\taddContainer('center', null),\n\t\t\t\t\t\taddContainer('bottom', 'fa-chevron-down')\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t),\n\t\t\taddContainer('right', 'fa-chevron-right')\n\t\t);\n\t}\n\tupdate() {\n\t\tthis.moduleContainers.forEach(mc => mc.update());\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport events from '../events';\n\nexport default class Module {\n\tconstructor() {\n\t\tthis.type = 'module';\n\t\tthis.name = this.name || 'Module';\n\t\tthis.id = this.id || 'module';\n\t\tthis.el = el('div.module', ...arguments);\n\t\tthis._selected = true;\n\t\tthis._enabled = true;\n\t}\n\t// Called when this module is opened. Other modules can call Module.activateModule('Module', ...args);\n\tactivate() {\n\t}\n\t// Called when changes happen. return false to hide from ui\n\tupdate() {\n\t}\n\t_show() {\n\t\tthis.el.classList.remove('hidden');\n\t\tthis._selected = true;\n\t\tthis._enabled = true;\n\t}\n\t_hide() {\n\t\tthis.el.classList.add('hidden');\n\t\tthis._selected = false;\n\t}\n}\n//arguments: moduleName, unpackModuleView=true, ...args \nModule.activateModule = function(moduleId, unpackModuleView=true, ...args) {\n\tevents.dispatch('activateModule_' + moduleId, unpackModuleView, ...args);\n};\nModule.packModuleContainer = function(moduleContainerName) {\n\tdocument.querySelectorAll(`.moduleContainer.${moduleContainerName}`)[0].classList.add('packed');\n};\nModule.unpackModuleContainer = function(moduleContainerName) {\n\tdocument.querySelectorAll(`.moduleContainer.${moduleContainerName}`)[0].classList.remove('packed');\n};\n\n// moduleContainerName = left | middle | right | bottom\nModule.register = function(moduleClass, moduleContainerName) {\n\tregisterPromise = registerPromise.then(() => {\n\t\tevents.dispatch('registerModule_' + moduleContainerName, moduleClass);\n\t});\n};\n\nlet nextTopBarPriorityNumber = 1;\nModule.registerTopButton = function(topButton, priority = nextTopBarPriorityNumber++) {\n\tregisterPromise = registerPromise.then(() => {\n\t\tevents.dispatch('registerTopButton', topButton, priority);\n\t});\n};\n\n\nlet registerPromise = new Promise(function(resolve) {\n\tevents.listen('registerModules', function() {\n\t\tregisterPromise.then(() => {\n\t\t\tevents.dispatch('modulesRegistered');\n\t\t});\n\t\tresolve();\n\t});\n});\n","import { el, mount, list } from 'redom';\n\nlet popupDepth = 0;\n\nexport default class Popup {\n\tconstructor({\n\t\ttitle = 'Undefined popup',\n\t\tcancelCallback = null,\n\t\twidth = null,\n\t\tcontent = el('div', 'Undefined content')\n\t}) {\n\t\tthis.el = el('div.popup', { style: { 'z-index': 1000 + popupDepth++ } },\n\t\t\tnew Layer(this),\n\t\t\tel('div.popupContent',\n\t\t\t\tthis.text = el('div.popupTitle', title),\n\t\t\t\tthis.content = content\n\t\t\t)\n\t\t);\n\t\tthis.cancelCallback = cancelCallback;\n\t\t\n\t\tmount(document.body, this.el);\n\t}\n\tremove() {\n\t\tpopupDepth--;\n\t\tthis.el.parentNode.removeChild(this.el);\n\t}\n}\n\nexport class Button {\n\tconstructor() {\n\t\tthis.el = el('button.button', {onclick: () => {\n\t\t\tthis.callback();\n\t\t}});\n\t}\n\tupdate(button) {\n\t\tthis.el.textContent = button.text;\n\t\tif (button.icon) {\n\t\t\tlet icon = el('i.fa.' + button.icon);\n\t\t\tif (button.color)\n\t\t\t\ticon.style.color = button.color;\n\t\t\tmount(this.el, icon, this.el.firstChild);\n\t\t}\n\t\tthis.el.className = button.class ? `button ${button.class}` : 'button';\n\t\tthis.callback = button.callback;\n\t\tif (button.color)\n\t\t\tthis.el.style['border-color'] = button.color;\n\t}\n}\n\nclass Layer {\n\tconstructor(popup) {\n\t\tthis.el = el('div.popupLayer', { onclick: () => {\n\t\t\tpopup.remove();\n\t\t\tpopup.cancelCallback && popup.cancelCallback();\n\t\t} });\n\t}\n}\n","import Popup, { Button } from './popup';\nimport { componentClasses } from '../../../core/component';\nimport ComponentData from '../../../core/componentData';\nimport { list, el } from 'redom';\nimport assert from '../../../util/assert';\nimport { setChangeOrigin } from '../../../core/serializableManager';\nimport { game } from '../../../core/game';\nimport { scene } from '../../../core/scene';\nimport Level from '../../../core/level';\nimport { editor } from '../../editor';\nimport { listen, dispatch } from '../../events';\nimport Module from '../../module/module';\n\nexport default class LevelSelector extends Popup {\n\tconstructor() {\n\t\tsuper({\n\t\t\ttitle: 'Levels',\n\t\t\twidth: '500px',\n\t\t\tcontent: el('div.levelSelectorButtons',\n\t\t\t\tthis.buttons = list('div.levelSelectorButtons', LevelItem),\n\t\t\t\t'Create: ',\n\t\t\t\tthis.createButton = new Button\n\t\t\t)\n\t\t});\n\n\t\tthis.parent = parent;\n\t\t\n\t\tthis.buttons.update(game.getChildren('lvl'));\n\n\t\tthis.createButton.update({\n\t\t\ttext: 'New level',\n\t\t\ticon: 'fa-area-chart',\n\t\t\tcallback: () => {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tlet lvl = new Level();\n\t\t\t\tlvl.initWithPropertyValues({\n\t\t\t\t\tname: 'New level'\n\t\t\t\t});\n\t\t\t\teditor.game.addChild(lvl);\n\t\t\t\teditor.setLevel(lvl);\n\t\t\t\teditor.select(lvl, this);\n\t\t\t\t\n\t\t\t\tthis.remove();\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tModule.activateModule('level', true, 'focusOnProperty', 'name');\n\t\t\t\t}, 100);\n\t\t\t}\n\t\t});\n\n\t\tlisten(this.el, 'selectLevel', level => { \n\t\t\teditor.setLevel(level);\n\n\t\t\tthis.remove();\n\t\t\teditor.select(level, this);\n\t\t});\n\t\t\n\t\tlisten(this.el, 'deleteLevel', level => {\n\t\t\tif (confirm('Are you sure you want to delete level: ' + level.name)) {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tlevel.delete();\n\t\t\t\t\n\t\t\t\tthis.remove();\n\t\t\t\tnew LevelSelector();\n\t\t\t}\n\t\t});\n\t}\n}\n\nclass LevelItem {\n\tconstructor() {\n\t\tthis.el = el('div.levelItem',\n\t\t\tthis.number = el('span'),\n\t\t\tthis.selectButton = new Button,\n\t\t\tthis.deleteButton = new Button\n\t\t)\n\t}\n\tselectClicked() {\n\t\tdispatch(this, 'selectLevel', this.level);\n\t}\n\tdeleteClicked() {\n\t\tdispatch(this, 'deleteLevel', this.level);\n\t}\n\tupdate(level, idx) {\n\t\tthis.level = level;\n\t\tthis.number.textContent = (idx+1) + '.';\n\t\tthis.selectButton.update({\n\t\t\ttext: level.name,\n\t\t\ticon: 'fa-area-chart',\n\t\t\tcallback: () => this.selectClicked()\n\t\t});\n\t\tthis.deleteButton.update({\n\t\t\ttext: 'Delete',\n\t\t\tclass: 'dangerButton',\n\t\t\ticon: 'fa-cross',\n\t\t\tcallback: () => this.deleteClicked()\n\t\t});\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport { editor, modulesRegisteredPromise } from '../editor';\nimport Level from '../../core/level';\nimport events from '../events';\nimport { setChangeOrigin } from '../../core/serializableManager';\nimport LevelSelector from '../views/popup/levelSelector';\n\nexport class TopBarModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.logo = el('img.logo.button.iconButton', { src: '../img/logo_reflection_medium.png' }),\n\t\t\tthis.buttons = el('div.buttonContainer')\n\t\t);\n\t\tthis.id = 'topbar';\n\t\tthis.name = 'TopBar'; // not visible\n\t\t\n\t\tevents.listen('addTopButtonToTopBar', topButton => {\n\t\t\tmount(this.buttons, topButton);\n\t\t});\n\t\t\n\t\tnew TopButton({\n\t\t\ttext: 'Levels',\n\t\t\ticonClass: 'fa-area-chart',\n\t\t\tcallback: () => {\n\t\t\t\tnew LevelSelector();\n\t\t\t}\n\t\t});\n\t}\n}\nModule.register(TopBarModule, 'top');\n\nexport class TopButton {\n\tconstructor({\n\t\ttext = 'Button',\n\t\tcallback,\n\t\ticonClass = 'fa-circle',\n\t\tpriority = 1\n\t} = {}) {\n\t\tthis.priority = priority || 0;\n\t\t\n\t\tthis.el = el('div.button.topIconTextButton',\n\t\t\tel('div.topIconTextButtonContent',\n\t\t\t\tthis.icon = el(`i.fa.${iconClass}`),\n\t\t\t\tthis.text = el('span', text)\n\t\t\t)\n\t\t);\n\t\tthis.el.onclick = () => {\n\t\t\tif (callback) {\n\t\t\t\tcallback(this);\n\t\t\t}\n\t\t};\n\n\t\tmodulesRegisteredPromise.then(() => {\n\t\t\tevents.dispatch('addTopButtonToTopBar', this);\n\t\t});\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport Vector from '../../util/vector';\n\nconst EDITOR_FLOAT_PRECISION = Math.pow(10, 3);\n\n// <dataTypeName>: createFunction(container, oninput, onchange) -> setValueFunction\nlet editors = {};\nexport default editors;\n\neditors.default = editors.string = (container, oninput, onchange) => {\n\tlet input = el('input', {\n\t\toninput: () => oninput(input.value),\n\t\tonchange: () => onchange(input.value)\n\t});\n\tmount(container, input);\n\n\treturn val => input.value = val;\n};\n\neditors.float = editors.int = (container, oninput, onchange) => {\n\tlet input = el('input', {\n\t\ttype: 'number',\n\t\toninput: () => oninput(+input.value),\n\t\tonchange: () => onchange(+input.value)\n\t});\n\tmount(container, input);\n\treturn val => input.value = Math.round(val*EDITOR_FLOAT_PRECISION) / EDITOR_FLOAT_PRECISION;\n};\n\neditors.bool = (container, oninput, onchange) => {\n\tlet input = el('input', {\n\t\ttype: 'checkbox',\n\t\tonchange: () => {\n\t\t\tonchange(input.checked);\n\t\t\tlabel.textContent = input.checked ? 'Yes' : 'No';\n\t\t}\n\t});\n\tlet label = el('span');\n\tmount(container, el('label', input, label));\n\treturn val => {\n\t\tinput.checked = val;\n\t\tlabel.textContent = val ? 'Yes' : 'No';\n\t}\n};\n\neditors.vector = (container, oninput, onchange) => {\n\tfunction getValue() {\n\t\treturn new Vector(+xInput.value, +yInput.value);\n\t}\n\tlet xInput = el('input.xInput', {\n\t\ttype: 'number',\n\t\toninput: () => oninput(getValue()),\n\t\tonchange: () => onchange(getValue())\n\t});\n\tlet yInput = el('input', {\n\t\ttype: 'number',\n\t\toninput: () => oninput(getValue()),\n\t\tonchange: () => onchange(getValue())\n\t});\n\tmount(container, el('div', el('span', 'x:'), xInput, el('span', 'y:'), yInput));\n\treturn val => {\n\t\txInput.value = Math.round(val.x*EDITOR_FLOAT_PRECISION) / EDITOR_FLOAT_PRECISION;\n\t\tyInput.value = Math.round(val.y*EDITOR_FLOAT_PRECISION) / EDITOR_FLOAT_PRECISION;\n\t};\n};\n\neditors.enum = (container, oninput, onchange, propertyType) => {\n\tlet select = el('select', ...propertyType.validator.parameters.map(p => el('option', p)));\n\tselect.onchange = () => {\n\t\tonchange(select.value);\n\t};\n\tmount(container, select);\n\treturn val => {\n\t\tselect.value = val;\n\t}\n};\n","import Popup, { Button } from './popup';\nimport { componentClasses } from '../../../core/component';\nimport ComponentData from '../../../core/componentData';\nimport { list, el } from 'redom';\nimport assert from '../../../util/assert';\nimport { setChangeOrigin } from '../../../core/serializableManager';\n\nexport default class ComponentAdder extends Popup {\n\tconstructor(parent, callback) {\n\t\tsuper({\n\t\t\ttitle: 'Add component',\n\t\t\twidth: '500px',\n\t\t\tcontent: this.buttons = list('div', Button)\n\t\t});\n\t\t\n\t\tthis.parent = parent;\n\n\t\tlet components = Array.from(componentClasses.values());\n\t\tcomponents = components.map(comp => {\n\t\t\treturn {\n\t\t\t\ttext: comp.componentName,\n\t\t\t\tcolor: comp.color,\n\t\t\t\ticon: comp.icon,\n\t\t\t\tcallback: () => {\n\t\t\t\t\tthis.addComponentToParent(comp.componentName);\n\t\t\t\t\tcallback && callback();\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t\t\n\t\tthis.update(components);\n\t}\n\taddComponentToParent(componentName) {\n\t\tsetChangeOrigin(this);\n\t\tif (['epr', 'prt'].indexOf(this.parent.threeLetterType) >= 0) {\n\t\t\tlet component = new ComponentData(componentName);\n\t\t\tthis.parent.addChild(component);\n\t\t\treturn component;\n\t\t}\n\t\tassert(false);\n\t}\n\tupdate(components) {\n\t\tthis.buttons.update(components);\n\t}\n}\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport PropertyEditor from '../views/propertyEditor';\nimport { editor } from '../editor';\nimport PropertyOwner from '../../core/propertyOwner'\n\nclass Type extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.propertyEditor = new PropertyEditor()\n\t\t);\n\t\tthis.id = 'type';\n\t\tthis.name = 'Type';\n\t}\n\tupdate() {\n\t\tif (editor.selection.items.length != 1)\n\t\t\treturn false;\n\t\t\n\t\tif (editor.selection.type === 'prt') {\n\t\t\tthis.propertyEditor.update(editor.selection.items, editor.selection.type);\n\t\t} else if (editor.selection.type === 'ent') {\n\t\t\tthis.propertyEditor.update(editor.selection.items.map(e => e.prototype.prototype), editor.selection.type);\n\t\t} else {\n\t\t\treturn false; // hide\n\t\t}\n\t}\n\tactivate(command, parameter) {\n\t\tif (command === 'focusOnProperty') {\n\t\t\t\n\t\t\tthis.propertyEditor.el.querySelector(`.property[name='${parameter}'] input`).select();\n\t\t\t// console.log(nameProp);\n\t\t}\n\t}\n}\n\nModule.register(Type, 'right');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport PropertyEditor from '../views/propertyEditor';\nimport { editor } from '../editor';\nimport { scene } from '../../core/scene';\n\nclass Instance extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.propertyEditor = new PropertyEditor()\n\t\t);\n\t\tthis.id = 'instance';\n\t\tthis.name = 'Instance';\n\t}\n\tupdate() {\n\t\tif (editor.selection.items.length != 1)\n\t\t\treturn false; // multiedit not supported yet\n\t\t\n\t\tif (editor.selection.type === 'ent') {\n\t\t\tif (scene.isInInitialState()) {\n\t\t\t\tthis.propertyEditor.update(editor.selection.items.map(entity => entity.prototype), 'epr');\n\t\t\t} else {\n\t\t\t\tthis.propertyEditor.update(editor.selection.items, editor.selection.type);\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log('hide', this.id);\n\t\t\treturn false; // hide module\n\t\t}\n\t}\n\tactivate(command, parameter) {\n\t}\n}\n\nModule.register(Instance, 'right');\n","import { game } from '../core/game'\nimport { editor } from './editor'\nimport { scene } from '../core/scene'\nimport Vector from '../util/vector'\n\nclass Help {\n\tget game() {\n\t\treturn game;\n\t}\n\tget editor() {\n\t\treturn editor;\n\t}\n\tget level() {\n\t\treturn editor.selectedLevel;\n\t}\n\tget scene() {\n\t\treturn scene;\n\t}\n\tget Vector() {\n\t\treturn Vector;\n\t}\n}\n\nlet help = new Help;\nexport { help };\nwindow.help = help;\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport events, { dispatch, listen } from '../events';\nimport { listenMouseMove, listenMouseDown, listenMouseUp, listenKeyDown, key, keyPressed } from '../../util/input';\nimport Scene, { scene } from '../../core/scene';\nimport { game } from '../../core/game';\nimport EntityPrototype from '../../core/entityPrototype';\nimport ComponentData from '../../core/componentData';\nimport assert from '../../util/assert';\nimport Entity from '../../core/entity';\nimport { Component } from '../../core/component';\nimport { TopButton } from './topBar';\nimport { editor } from '../editor';\nimport { changeType, setChangeOrigin } from '../../core/serializableManager';\nimport * as sceneEdit from '../util/sceneEdit';\nimport Vector from '../../util/vector';\nimport { removeTheDeadFromArray } from '../../util/algorithm';\nimport { help } from '../help';\n\nclass SceneModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.canvas = el('canvas.anotherCanvas', {\n\t\t\t\t// width and height will be fixed after loading\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t}),\n\t\t\tel('div.pauseInfo', `Paused. Editing instances will not affect the level.`),\n\t\t\tel('i.fa.fa-pause.pauseInfo.topLeft'),\n\t\t\tel('i.fa.fa-pause.pauseInfo.topRight'),\n\t\t\tel('i.fa.fa-pause.pauseInfo.bottomLeft'),\n\t\t\tel('i.fa.fa-pause.pauseInfo.bottomRight')\n\t\t);\n\t\tthis.el.classList.add('hidePauseButtons');\n\n\t\tsetInterval(() => {\n\t\t\tthis.fixAspectRatio();\n\t\t}, 500);\n\t\tsetTimeout(() => {\n\t\t\tthis.fixAspectRatio();\n\t\t});\n\t\t\n\t\tthis.id = 'scene';\n\t\tthis.name = 'Scene';\n\t\t\n\t\thelp.sceneModule = this;\n\n\t\t/*\n\t\tloadedPromise.then(() => {\n\t\t\tif (editor.selectedLevel)\n\t\t\t\teditor.selectedLevel.createScene();\n\t\t\telse\n\t\t\t\tthis.drawInvalidScene();\n\t\t});\n\t\t*/\n\t\t\n\t\tthis.newEntities = [];\n\t\tthis.entityUnderMouse = null;\n\t\tthis.previousMousePos = null;\n\t\t\n\t\tthis.entitiesToMove = [];\n\t\tthis.selectedEntities = [];\n\t\t\n\t\tthis.selectionStart = null;\n\t\tthis.selectionEnd = null;\n\t\tthis.entitiesInSelection = [];\n\t\t\n\t\tthis.playButton = new TopButton({\n\t\t\ttext: 'Play',\n\t\t\ticonClass: 'fa-play',\n\t\t\tcallback: btn => {\n\t\t\t\tif (!scene)\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\tsetChangeOrigin(this);\n\n\t\t\t\tthis.clearState();\n\t\t\t\t\n\t\t\t\tif (scene.playing) {\n\t\t\t\t\tscene.pause();\n\t\t\t\t\tthis.draw();\n\t\t\t\t} else\n\t\t\t\t\tscene.play();\n\t\t\t\tthis.updatePlayPauseButtonStates();\n\t\t\t}\n\t\t});\n\t\tthis.stopButton = new TopButton({\n\t\t\ttext: 'Reset',\n\t\t\ticonClass: 'fa-stop',\n\t\t\tcallback: btn => {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tthis.stopAndReset();\n\t\t\t}\n\t\t});\n\n\t\tgame.listen('levelCompleted', () => {\n\t\t\tthis.updatePlayPauseButtonStates();\n\t\t\tthis.draw();\n\t\t});\n\t\t\n\t\tevents.listen('setLevel', lvl => {\n\t\t\tconsole.log('scenemodule.setLevel');\n\t\t\tif (lvl)\n\t\t\t\tlvl.createScene(false, this);\n\t\t\telse if (scene) {\n\t\t\t\tscene.delete(this);\n\t\t\t}\n\t\t\t\n\t\t\tthis.updatePlayPauseButtonStates();\n\t\t\t\n\t\t\tthis.clearState();\n\t\t\tthis.draw();\n\t\t});\n\n\t\t// Change in serializable tree\n\t\tevents.listen('prototypeClicked', prototype => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\t\t\t\n\t\t\tthis.clearState();\n\t\t\t\n\t\t\tlet entityPrototype = EntityPrototype.createFromPrototype(prototype, []);\n\t\t\tentityPrototype.position = new Vector(this.canvas.width/2, this.canvas.height/2);\n\t\t\tlet newEntity = entityPrototype.createEntity(this);\n\t\t\tthis.newEntities.push(newEntity);\n\t\t\tthis.draw();\n\t\t});\n\t\t\n\t\tevents.listen('change', change => {\n\t\t\t// console.log('sceneModule change', change);\n\t\t\tif (change.origin !== this) {\n\t\t\t\tsetChangeOrigin(this);\n\t\t\t\tsceneEdit.syncAChangeBetweenSceneAndLevel(change);\n\t\t\t\tthis.draw();\n\t\t\t}\n\t\t});\n\t\t\n\t\tlistenKeyDown(k => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\t\t\t\n\t\t\tsetChangeOrigin(this);\n\t\t\tif (k === key.esc) {\n\t\t\t\tthis.clearState();\n\t\t\t\tthis.draw();\n\t\t\t} else if (k === key.backspace) {\n\t\t\t\tsceneEdit.deleteEntities(this.selectedEntities);\n\t\t\t\tthis.clearState();\n\t\t\t\tthis.draw();\n\t\t\t}\n\t\t});\n\n\t\tlistenMouseMove(this.el, mousePos => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\t\t\t\n\t\t\tsetChangeOrigin(this);\n\t\t\tlet change = this.previousMousePos ? mousePos.clone().subtract(this.previousMousePos) : mousePos;\n\t\t\tthis.entityUnderMouse = null;\n\t\t\t\n\t\t\tsceneEdit.setEntityPositions(this.newEntities, mousePos); // these are not in scene\n\t\t\tsceneEdit.moveEntities(this.entitiesToMove, change); // these are in scene\n\t\t\tsceneEdit.copyPositionFromEntitiesToEntityPrototypes(this.entitiesToMove);\n\t\t\t\n\t\t\tif (scene) {\n\t\t\t\tif (!scene.playing && this.newEntities.length === 0 && !this.selectionEnd)\n\t\t\t\t\tthis.entityUnderMouse = sceneEdit.getEntityUnderMouse(mousePos);\n\t\t\t}\n\t\t\t\n\t\t\tif (this.selectionEnd) {\n\t\t\t\tthis.selectionEnd.add(change);\n\t\t\t\tthis.entitiesInSelection = sceneEdit.getEntitiesInSelection(this.selectionStart, this.selectionEnd);\n\t\t\t}\n\n\t\t\tthis.previousMousePos = mousePos;\n\t\t\tthis.draw();\n\t\t});\n\t\tlistenMouseDown(this.el, mousePos => {\n\t\t\tif (!scene || !mousePos) // !mousePos if mouse has not moved since refresh\n\t\t\t\treturn;\n\t\t\t\n\t\t\tsetChangeOrigin(this);\n\t\t\tif (this.newEntities.length > 0)\n\t\t\t\tsceneEdit.copyEntitiesToScene(this.newEntities);\n\t\t\telse if (this.entityUnderMouse) {\n\t\t\t\tif (this.selectedEntities.indexOf(this.entityUnderMouse) >= 0) {\n\t\t\t\t} else {\n\t\t\t\t\tif (!keyPressed(key.shift))\n\t\t\t\t\t\tthis.selectedEntities.length = 0;\n\t\t\t\t\tthis.selectedEntities.push(this.entityUnderMouse);\n\t\t\t\t}\n\t\t\t\tthis.entitiesToMove.push(...this.selectedEntities);\n\t\t\t\tthis.selectSelectedEntitiesInEditor();\n\t\t\t} else {\n\t\t\t\tthis.selectedEntities.length = 0;\n\t\t\t\tthis.selectionStart = mousePos;\n\t\t\t\tthis.selectionEnd = mousePos.clone();\n\t\t\t}\n\t\t\t\n\t\t\tthis.draw();\n\t\t});\n\t\tlistenMouseUp(this.el, mousePos => {\n\t\t\tif (!scene)\n\t\t\t\treturn;\n\t\t\t\n\t\t\tthis.selectionStart = null;\n\t\t\tthis.selectionEnd = null;\n\t\t\tthis.entitiesToMove.length = 0;\n\t\t\t\n\t\t\tif (this.entitiesInSelection.length > 0) {\n\t\t\t\tthis.selectedEntities.push(...this.entitiesInSelection);\n\t\t\t\tthis.entitiesInSelection.length = 0;\n\t\t\t\tthis.selectSelectedEntitiesInEditor();\n\t\t\t}\n\t\t\t\n\t\t\tthis.draw();\n\t\t});\n\t}\n\tupdatePlayPauseButtonStates() {\n\t\tif (!scene)\n\t\t\treturn;\n\t\tif (scene.playing) {\n\t\t\tthis.el.classList.add('hidePauseButtons');\n\t\t\tthis.playButton.icon.className = 'fa fa-pause';\n\t\t} else {\n\t\t\tthis.el.classList.toggle('hidePauseButtons', scene.isInInitialState());\n\t\t\tthis.playButton.icon.className = 'fa fa-play';\n\t\t}\n\t}\n\t\n\tfixAspectRatio() {\n\t\tif (this.canvas) {\n\t\t\tlet change = false;\n\t\t\tif (this.canvas.width !== this.canvas.offsetWidth && this.canvas.offsetWidth) {\n\t\t\t\tthis.canvas.width = this.canvas.offsetWidth;\n\t\t\t\tchange = true;\n\t\t\t}\n\t\t\tif (this.canvas.height !== this.canvas.offsetHeight && this.canvas.offsetHeight) {\n\t\t\t\tthis.canvas.height = this.canvas.offsetHeight;\n\t\t\t\tchange = true;\n\t\t\t}\n\t\t\tif (change) {\n\t\t\t\tthis.draw();\n\t\t\t}\n\t\t}\n\t}\n\t\n\tdraw() {\n\t\tif (scene) {\n\t\t\tif (!scene.playing) {\n\t\t\t\tthis.filterDeadSelection();\n\t\t\t\t\n\t\t\t\tscene.draw();\n\t\t\t\tscene.dispatch('onDrawHelper', scene.context);\n\t\t\t\tsceneEdit.drawPositionHelpers(scene.getChildren('ent'));\n\t\t\t\tsceneEdit.drawEntityUnderMouse(this.entityUnderMouse);\n\t\t\t\tsceneEdit.drawSelection(this.selectionStart, this.selectionEnd, this.entitiesInSelection);\n\t\t\t\tsceneEdit.drawSelectedEntities(this.selectedEntities);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.drawInvalidScene();\n\t\t}\n\t}\n\t\n\tdrawInvalidScene() {\n\t\tthis.canvas.width = this.canvas.width; \n\t\tlet context = this.canvas.getContext('2d');\n\t\tcontext.font = '30px arial';\n\t\tcontext.fillStyle = 'white';\n\t\tcontext.fillText('No level loaded.', 10, 35);\n\t}\n\t\n\tclearState() {\n\t\tthis.deleteNewEntities();\n\t\t\n\t\tthis.entityUnderMouse = null;\n\t\tthis.selectedEntities.length = 0;\n\t\tthis.entitiesToMove.length = 0;\n\n\t\tthis.selectionStart = null;\n\t\tthis.selectionEnd = null;\n\t}\n\t\n\tdeleteNewEntities() {\n\t\tthis.newEntities.forEach(e => {\n\t\t\te.prototype.delete();\n\t\t\te.delete();\n\t\t});\n\t\tthis.newEntities.length = 0;\n\t}\n\t\n\tselectSelectedEntitiesInEditor() {\n\t\teditor.select(this.selectedEntities, this);\n\t}\n\t\n\tstopAndReset() {\n\t\tthis.clearState();\n\t\tif (editor.selection.type === 'ent') {\n\t\t\teditor.select(editor.selection.items.map(ent => ent.prototype.prototype), this);\n\t\t}\n\t\tif (scene)\n\t\t\tscene.reset(this);\n\t\tthis.playButton.icon.className = 'fa fa-play';\n\t\tthis.updatePlayPauseButtonStates();\n\t\tthis.draw();\n\t}\n\t\n\tfilterDeadSelection() {\n\t\tremoveTheDeadFromArray(this.selectedEntities);\n\t\tremoveTheDeadFromArray(this.entitiesToMove);\n\n\t\tfor (let i = this.newEntities.length - 1; i >= 0; --i) {\n\t\t\tif (this.newEntities[i].prototype.prototype._alive === false) {\n\t\t\t\tlet entity = this.newEntities.splice(i, 1)[0];\n\t\t\t\tentity.prototype.delete();\n\t\t\t\tentity.delete();\n\t\t\t}\n\t\t}\n\t}\n}\n\nModule.register(SceneModule, 'center');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport events from '../events';\nimport Prototype from '../../core/prototype';\nimport { getSerializable, changeType, setChangeOrigin } from '../../core/serializableManager';\nimport assert from '../../util/assert';\nimport { editor } from '../editor';\n\nclass Types extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.addButton = el('span.addTypeButton.button.fa.fa-plus'),\n\t\t\tthis.search = el('input'),\n\t\t\tthis.searchIcon = el('i.fa.fa-search.searchIcon'),\n\t\t\tthis.jstree = el('div')\n\t\t);\n\t\tthis.id = 'types';\n\t\tthis.name = 'Types';\n\n\t\tthis.addButton.onclick = () => {\n\t\t\tsetChangeOrigin(this);\n\t\t\tlet prototype = Prototype.create(' New type');\n\t\t\teditor.game.addChild(prototype);\n\t\t\teditor.select(prototype);\n\t\t\tsetTimeout(() => {\n\t\t\t\tModule.activateModule('type', true, 'focusOnProperty', 'name');\n\t\t\t}, 100);\n\t\t};\n\t\t\n\t\tlet searchTimeout = false;\n\t\tthis.search.addEventListener('keyup', () => {\n\t\t\tif (searchTimeout)\n\t\t\t\tclearTimeout(searchTimeout);\n\n\t\t\tsearchTimeout = setTimeout(() => {\n\t\t\t\t$(this.jstree).jstree().search(this.search.value.trim());\n\t\t\t}, 200);\n\t\t});\n\t\t\n\t\tthis.externalChange = false;\n\n\t\tevents.listen('change', change => {\n\t\t\tlet jstree = $(this.jstree).jstree(true);\n\t\t\tif (!jstree)\n\t\t\t\treturn;\n\t\t\t\n\t\t\tthis.externalChange = true;\n\t\t\t\n\t\t\tif (change.reference.threeLetterType === 'prt') {\n\t\t\t\tif (change.type === changeType.addSerializableToTree) {\n\t\t\t\t\tlet parent = change.parent;\n\t\t\t\t\tlet parentNode;\n\t\t\t\t\tif (parent.threeLetterType === 'gam')\n\t\t\t\t\t\tparentNode = '#';\n\t\t\t\t\telse\n\t\t\t\t\t\tparentNode = jstree.get_node(parent.id);\n\n\t\t\t\t\tjstree.create_node(parentNode, {\n\t\t\t\t\t\ttext: change.reference.getChildren('prp')[0].value,\n\t\t\t\t\t\tid: change.reference.id\n\t\t\t\t\t});\n\t\t\t\t} else\n\t\t\t\t\tthis.dirty = true; // prototypes added, removed, moved or something\n\t\t\t} else if (change.type === changeType.setPropertyValue) {\n\t\t\t\tlet propParent = change.reference._parent;\n\t\t\t\tif (propParent && propParent.threeLetterType === 'prt') {\n\t\t\t\t\tlet node = jstree.get_node(propParent.id);\n\t\t\t\t\tjstree.rename_node(node, change.value);\n\t\t\t\t}\n\t\t\t} else if (change.type === 'editorSelection') {\n\t\t\t\tif (change.origin != this) {\n\t\t\t\t\tif (change.reference.type === 'prt') {\n\t\t\t\t\t\tlet node = jstree.get_node(change.reference.items[0].id);\n\t\t\t\t\t\tjstree.deselect_all();\n\t\t\t\t\t\tjstree.select_node(node);\n\t\t\t\t\t} else if (change.reference.type === 'epr') {\n\t\t\t\t\t\tlet jstree = $(this.jstree).jstree(true);\n\t\t\t\t\t\tlet node = jstree.get_node(change.reference.items[0].getParentPrototype().id);\n\t\t\t\t\t\tjstree.deselect_all();\n\t\t\t\t\t\tjstree.select_node(node);\n\t\t\t\t\t} else if (change.reference.type === 'ent') {\n\t\t\t\t\t\tlet node = jstree.get_node(change.reference.items[0].prototype.getParentPrototype().id);\n\t\t\t\t\t\tjstree.deselect_all();\n\t\t\t\t\t\tjstree.select_node(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.externalChange = false;\n\t\t});\n\t}\n\tupdate() {\n\t\tif (this.skipUpdate) return;\n\t\tif (!this.jstreeInited)\n\t\t\tthis.dirty = true;\n\n\t\tif (!this.dirty) return;\n\t\t\n\t\tlet data = [];\n\t\teditor.game.forEachChild('prt', prototype => {\n\t\t\tlet parent = prototype.getParent();\n\t\t\tdata.push({\n\t\t\t\ttext: prototype.name,\n\t\t\t\tid: prototype.id,\n\t\t\t\tparent: parent.threeLetterType === 'prt' ? parent.id : '#'\n\t\t\t});\n\t\t}, true);\n\n\t\tif (!this.jstreeInited) {\n\t\t\t$(this.jstree).attr('id', 'types-jstree').on('changed.jstree', (e, data) => {\n\t\t\t\tif (this.externalChange)\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\t// selection changed\n\t\t\t\tlet prototypes = data.selected.map(getSerializable);\n\t\t\t\teditor.select(prototypes, this);\n\t\t\t\tif (prototypes.length === 1)\n\t\t\t\t\tevents.dispatch('prototypeClicked', prototypes[0]);\n\t\t\t\t\n\t\t\t}).on('loaded.jstree refresh.jstree', () => {\n\t\t\t\tlet jstree = $(this.jstree).jstree(true);\n\t\t\t\t// let selNode = jstree.get_node('prtF21ZLL0vsLdQI5z');\n\t\t\t\t// console.log(jstree, selNode);\n\t\t\t\tif (editor.selection.type === 'none') {\n\t\t\t\t\t//jstree.select_node();\n\t\t\t\t}\n\t\t\t\tif (editor.selection.type === 'prt') {\n\t\t\t\t\t// jstree.select_node(editor.selection.items.map(i => i.id));\n\t\t\t\t}\n\t\t\t}).jstree({\n\t\t\t\tcore: {\n\t\t\t\t\tcheck_callback: true,\n\t\t\t\t\tdata,\n\t\t\t\t\tforce_text: true\n\t\t\t\t},\n\t\t\t\tplugins: ['types', 'dnd', 'sort', 'search'/*, 'state'*/],\n\t\t\t\ttypes: {\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\ticon: 'fa fa-book'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsort: function (a, b) {\n\t\t\t\t\treturn this.get_text(a).toLowerCase() > this.get_text(b).toLowerCase() ? 1 : -1;\n\t\t\t\t},\n\t\t\t\tdnd: {\n\t\t\t\t\tcopy: false // jstree makes it way too hard to copy multiple prototypes\n\t\t\t\t},\n\t\t\t\tsearch: {\n\t\t\t\t\tfuzzy: true,\n\t\t\t\t\tshow_only_matches: true,\n\t\t\t\t\tshow_only_matches_children: true,\n\t\t\t\t\tclose_opened_onclear: false\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.jstreeInited = true;\n\t\t} else {\n\t\t\t$(this.jstree).jstree(true).settings.core.data = data;\n\t\t\t$(this.jstree).jstree('refresh');\n\t\t}\n\t\t$(this.jstree).data('typesModule', this);\n\n\t\tthis.dirty = false;\n\t}\n}\n\n$(document).on('dnd_stop.vakata', function (e, data) {\n\tlet jstree = $('#types-jstree').jstree(true);\n\tlet typesModule = $('#types-jstree').data('typesModule');\n\t\n\tsetTimeout(function () {\n\t\t// Now the nodes have moved in the DOM.\n\n\t\tlet node = jstree.get_node(data.data.obj);\n\t\tlet nodes = data.data.nodes; // these prototypes will move\n\t\tlet newParent;\n\t\tif (node.parent === '#')\n\t\t\tnewParent = editor.game;\n\t\telse\n\t\t\tnewParent = getSerializable(node.parent);\n\t\t\n\t\tlet nodeObjects = nodes.map(getSerializable);\n\t\tnodeObjects.forEach(assert);\n\t\tnodeObjects.forEach(prototype => {\n\t\t\tsetChangeOrigin(jstree);\n\t\t\tprototype.move(newParent);\n\t\t});\n\t\t\n\t\t// console.log('dnd stopped from', nodes, 'to', newParent);\n\t});\n});\n\nModule.register(Types, 'left');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\nimport PropertyEditor from '../views/propertyEditor';\nimport { editor } from '../editor';\nimport PropertyOwner from '../../core/propertyOwner'\n\nclass Level extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.propertyEditor = new PropertyEditor()\n\t\t);\n\t\tthis.id = 'level';\n\t\tthis.name = 'Level';\n\t}\n\tupdate() {\n\t\tif (editor.selectedLevel)\n\t\t\tthis.propertyEditor.update([editor.selectedLevel], 'lvl');\n\t\telse\n\t\t\treturn false;\n\t}\n\tactivate(command, parameter) {\n\t\tif (command === 'focusOnProperty') {\n\t\t\tthis.propertyEditor.el.querySelector(`.property[name='${parameter}'] input`).select();\n\t\t}\n\t}\n}\n\nModule.register(Level, 'right');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nclass TestModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.content = el('span', 'List of instances on the scene')\n\t\t);\n\t\tthis.name = 'Instances';\n\t\tthis.id = 'instances';\n\t}\n\tupdate() {\n\t}\n}\n\nModule.register(TestModule, 'left');\n","import { el, list, mount } from 'redom';\nimport Module from './module';\n\nclass TestModule extends Module {\n\tconstructor() {\n\t\tsuper(\n\t\t\tthis.content = el('span', 'This is test 3')\n\t\t);\n\t\tthis.id = 'test';\n\t\tthis.name = 'Test3';\n\t}\n\tupdate() {\n\t\treturn false;\n\t}\n}\n\nModule.register(TestModule, 'bottom');\n","import './main';\n\nimport './core/test';\nimport './core/componentExample'; // temp\n\nimport './editor/editor';\n\nimport Property from './core/property';\nwindow.Property = Property;\n\nimport PropertyType from './core/propertyType';\nwindow.PropertyType = PropertyType;\n\nimport { Component, Prop } from './core/component';\nwindow.Component = Component;\nwindow.Prop = Prop;\n\nimport Serializable from './core/serializable';\nwindow.Serializable = Serializable;\n\nimport { getSerializable, serializables, setChangeOrigin } from './core/serializableManager';\nwindow.getSerializable = getSerializable;\nwindow.serializables = serializables;\nwindow.setChangeOrigin = setChangeOrigin;\n\nimport { default as Game } from './core/game';\nwindow.Game = Game;\n"],"names":["createStringId","threeLetterPrefix","characters","let","id","i","CHARACTERS","Math","random","CHAR_COUNT","addSerializable","serializable","assert","undefined","serializables","getSerializable","removeSerializable","Error","resetOrigin","origin","getChangeOrigin","setChangeOrigin","_origin","setTimeout","addChange","type","reference","change","external","externalChange","changeType","setPropertyValue","value","_value","move","parent","_parent","addSerializableToTree","previousOrigin","listeners","forEach","l","executeExternal","callback","addChangeListener","push","packChange","packedChange","packed","parentId","toJSON","propertyType","Object","keys","keyToShortKey","key","e","console","log","unpackChange","shortKey","shortKeyToKey","error","executeChange","newScene","fromJSON","obj","Serializable","addChild","threeLetterType","localMaster","deleteAllChildren","deleteChildren","deleteSerializable","delete","play","condition","message","stack","createPropertyType","propertyName","defaultValue","validator","validators","default","description","flags","visibleIf","optionalParameters","p","idx","validate","isFlag","PropertyType","createFlag","func","createDataType","ref","x","name","clone","createType","validatorName","createValidator","validatorFunction","parameters","validatorParameters","validateFloat","val","isNaN","Infinity","keyPressed","listenKeyDown","handler","keyDownListeners","splice","indexOf","listenMouseMove","element","addEventListener","event","pageX","y","pageY","el","offsetLeft","offsetTop","offsetParent","_mx","_my","Vector","listenMouseDown","listenMouseUp","setNetworkEnabled","enabled","networkEnabled","isInSceneTree","getRoot","getQueryVariable","variable","query","window","location","search","substring","vars","split","length","pair","decodeURIComponent","tryToLoad","io","socket","changes","valueChanges","duplicateChange","setInterval","packedChanges","map","emit","on","serverStartTime","game","clientStartTime","Date","now","requiredClientTime","reload","gameData","localStorage","anotherGameId","history","replaceState","gameId","dispatch","view","data","const","debug","dispatchEvent","CustomEvent","detail","bubbles","listen","mount","child","before","parentEl","childEl","isList","__redom_view","isMounted","remount","insertBefore","appendChild","remounted","mounted","unmount","removeChild","unmounted","setStyle","arg1","arg2","arguments","style","isString","setAttribute","setAttr","isSVG","SVGElement","isFunction","parseArguments","args","arg","isNumber","text","isNode","createElement","ns","tag","className","mode","start","char","charCodeAt","HASH","DOT","slice","doc","createElementNS","len","memoizeEl","cloneNode","setChildren","children","traverse","firstChild","nextSibling","next","list","View","initData","List","this","__redom_list","views","getParentEl","lookup","shouldSyncLevelAndScene","editor","selectedLevel","scene","isInInitialState","setEntityPropertyValue","entity","componentName","componentId","sourceProperty","component","getComponents","filter","c","_componentId","_properties","getAffectedEntities","prototypeOrEntityPrototype","prototypeFilter","goThroughChildren","prototype","getChildren","proto","affectedPrototypes","add","previouslyCreatedEntity","_alive","Set","entities","level","epr","has","ent","syncAChangeBetweenSceneAndLevel","_isInTree","findParent","createEntity","getParent","oldComponent","find","com","deleteComponent","componentData","findComponentDataByComponentId","createComponent","addComponents","property","getValue","cda","prt","findOwnProperty","inheritedComponentDatas","getInheritedComponentDatas","icd","newComponent","Component","createWithInheritedComponentData","componentClass","valueProperty","getProperty","getParentComponentData","_propertyTypesByName","initialValue","copyEntitiesToScene","entityPrototypes","position","addChildren","getEntityUnderMouse","mousePos","nearestEntity","nearestDistanceSq","minX","maxX","minY","maxY","distSq","distanceSq","getEntitiesInSelection","end","min","max","copyPositionFromEntitiesToEntityPrototypes","moveEntities","transform","getComponent","setEntityPositions","deleteEntities","entityModifiedInEditor","entityPrototype","changeComponentId","changePropertyName","getOwnComponentDataOrInherit","entityPrototypeProperty","getPropertyOrCreate","drawEntityUnderMouse","context","strokeStyle","lineWidth","beginPath","arc","PI","stroke","drawSelection","entitiesInsideSelection","fillStyle","fillRect","strokeRect","drawSelectedEntities","Array","isArray","drawPositionHelpers","size","halfSize","isInDom","$","contains","document","documentElement","removeTheDeadFromArray","array","loadOptions","options","JSON","parse","anotherOptions","setOption","stringValue","stringify","getOption","serializableClasses","Map","predefinedId","skipSerializableRegistering","_children","_listeners","isRoot","_state","STATE_CONSTRUCTOR","STATE_PREDEFINEDID","startsWith","serializableManager.addSerializable","deleteChild","serializableManager.removeSerializable","STATE_DESTROY","clear","serializableManager.addChange","serializableManager.changeType","initWithChildren","STATE_INIT","_addChild","STATE_ADDCHILD","get","set","STATE_ADDPARENT","setInTreeStatus","findChild","filterFunction","_detachChild","forEachChild","deep","processArray","newParent","_detach","json","arrays","from","sort","a","b","concat","toString","constructor","STATE_CLONE","hasOwnProperty","unshift","index","this$1","apply","hasDescendant","isInTree","force","Boolean","STATE_FROMJSON","registerSerializable","Class","defineProperty","info","join","states","logState","state","stateString","createDebugObject","debugChildArray","k","Property","super","_initialValue","setPropertyType","_initialValueIsJSON","assign","v","n","newValue","f","getFlag","flag","createProperty","dataType","flagDegreesInEditor","vec","subtract","multiply","multiplyScalar","scalar","divide","divideScalar","dot","sqrt","lengthSq","setLength","newLength","oldLength","getProjectionOn","distance","dx","dy","normalize","horizontalAngle","atan2","verticalAngle","rotate","angle","cos","sin","rotateTo","rotation","isEqualTo","fromObject","FLOAT_JSON_PRECISION_MULTIPLIER","pow","float","parseFloat","range","modulo","round","int","parseInt","vector","string","String","bool","enum","values","PropertyOwner","_propertyTypes","initWithPropertyValues","propName","propChildren","otherChildren","invalidPropertiesCount","prop","isInvalid","nameToProp","defineProperties","propertyTypes","ALIVE_ERROR","Entity","components","sleeping","getListOfAllComponents","_name","initComponents","_preInit","_init","makeComponentsSleep","_sleep","deleteComponents","sleep","wakeUp","compArray","comp","ComponentData","componentClassName","predefinedComponentId","componentClasses","allowMultiple","cid","getInheritedProperties","_depth","properties","parentComponentData","parentPrototype","getParentPrototype","prp","setValue","create","Prop","Prototype","getDataFromPrototype","ownComponentData","propertyHash","generatedForPrototype","originalPrototype","inheritedComponentData","localeCompare","createAndAddPropertyForComponentData","propertyValue","componentDataIsNew","alsoFindFromParents","countEntityPrototypes","findParents","count","levels","j","_game","lvl","items","isClient","Game","warn","Scene","canvas","querySelector","getContext","animationFrameId","playing","time","draw","win","reset","animFrame","playCalled","t","performance","dt","_prevUpdate","requestAnimFrame","requestAnimationFrame","clearRect","width","height","pause","createScene","cancelAnimationFrame","addComponent","removeComponent","_listenRemoveFunctions","requirements","r","funcName","preInit","init","createComponentData","pt","reservedPropertyNames","reservedPrototypeMembers","register","constructorFunction","deleteFunction","Com","parentClass","category","icon","num","reduce","prev","curr","color","EntityPrototype","getTransform","scale","Transform","childArrays","floatToJSON","handleProperty","w","h","spawnEntityToScene","createFromPrototype","componentDatas","nameId","transformId","positionId","scaleId","rotationId","transformData","transformClass","Level","predefinedSceneObject","vari","left","right","up","down","ctrl","appleLeft","appleRight","alt","shift","space","z","0","1","9","backspace","enter","esc","keyUpListeners","onkeydown","keyCode","which","activeElement","nodeName","toLowerCase","onkeyup","onUpdate","userControlled","speed","rotationSpeed","randomStyle","onDraw","save","translate","restore","onStart","spawn","onDrawHelper","font","textAlign","fillText","strokeText","typeName","storeProp","trigger","componentSet","radius","pos","launchTrigger","action","S","s","staticVariable","hiddenVariable","lotsOfData","howToAccessChildren","Image","Sound","SomeComponent","events","getLoadEventPromise","Promise","res","str","createTextNode","is","nodeType","elcache","extend","bind","update","functionKey","newViews","oldViews","newLookup","oldLookup","item","__id","el$$1","Views","route","ModuleContainer","moduleContainerName","packButtonIcon","modules","packButtonEnabled","packButton","tabs","ModuleTab","moduleElements","packId","classList","onclick","remove","stopPropagation","moduleClass","module","_hide","_updateTabs","unpackModuleView","_activateModule","m","_enableModule","_disableModule","display","noModules","_enabled","toggle","activate","_show","_selected","enabledModule","textContent","Layout","moduleContainers","addContainer","container","mc","Module","argsArray","activateModule","moduleId","packModuleContainer","querySelectorAll","unpackModuleContainer","registerPromise","then","nextTopBarPriorityNumber","registerTopButton","topButton","priority","resolve","popupDepth","Popup","z-index","Layer","title","content","cancelCallback","body","parentNode","Button","button","class","popup","LevelSelector","buttons","LevelItem","createButton","setLevel","select","confirm","number","selectButton","deleteButton","selectClicked","deleteClicked","TopBarModule","logo","src","TopButton","iconClass","modulesRegisteredPromise","EDITOR_FLOAT_PRECISION","editors","oninput","onchange","input","checked","label","xInput","yInput","ComponentAdder","addComponentToParent","PropertyEditor","dirty","editingProperty","sceneEdit.entityModifiedInEditor","empty","prototypeEditor","Container","propertyEditor","containers","controls","titleClickedCallback","innerHTML","updateInheritedComponentData","updateEntity","updateComponent","updatePrototype","updateEntityPrototype","updatePropertyOwner","endingNumberMatch","match","nameWithoutNumber","nameSuggestion","entityPrototypeCount","updateComponentKindOfThing","packedStatus","hasOwnProperties","_editorVisibleIfTarget","convertFromInputToPropertyValue","removeAttribute","originalValue","setValueFromProperty","updateVisibleIf","toggleClass","visibleIfListener","propertyEditorInstance","_","Type","selection","command","parameter","Instance","Help","prototypeAccessors","help","SceneModule","fixAspectRatio","sceneModule","newEntities","entityUnderMouse","previousMousePos","entitiesToMove","selectedEntities","selectionStart","selectionEnd","entitiesInSelection","playButton","btn","clearState","updatePlayPauseButtonStates","stopButton","stopAndReset","newEntity","sceneEdit.syncAChangeBetweenSceneAndLevel","sceneEdit.deleteEntities","sceneEdit.setEntityPositions","sceneEdit.moveEntities","sceneEdit.copyPositionFromEntitiesToEntityPrototypes","sceneEdit.getEntityUnderMouse","sceneEdit.getEntitiesInSelection","sceneEdit.copyEntitiesToScene","selectSelectedEntitiesInEditor","offsetWidth","offsetHeight","filterDeadSelection","sceneEdit.drawPositionHelpers","sceneEdit.drawEntityUnderMouse","sceneEdit.drawSelection","sceneEdit.drawSelectedEntities","drawInvalidScene","deleteNewEntities","Types","addButton","searchIcon","jstree","searchTimeout","clearTimeout","trim","get_node","create_node","propParent","node","rename_node","deselect_all","select_node","skipUpdate","jstreeInited","settings","core","attr","prototypes","selected","check_callback","force_text","plugins","types","get_text","dnd","copy","fuzzy","show_only_matches","show_only_matches_children","close_opened_onclear","nodes","nodeObjects","TestModule","loaded","loadedPromise","Editor","saveNeeded","layout","logStr"],"mappings":"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"}