{"version":3,"file":null,"sources":["../src/core/serializable.js","../src/core/serializableManager.js","../src/util/assert.js","../src/core/propertyType.js","../src/core/dataTypes.js","../src/feature/physicsP2.js","../src/util/input.js","../src/util/net.js","../src/main.js","../src/util/environment.js","../src/core/property.js","../src/util/vector.js","../src/core/propertyOwner.js","../src/core/entity.js","../src/core/componentData.js","../src/core/prototype.js","../src/core/game.js","../src/core/scene.js","../src/core/component.js","../src/core/entityPrototype.js","../src/core/level.js","../src/components/Transform.js","../src/components/TransformVariance.js","../src/components/Test.js","../src/components/Mover.js","../src/components/Rect.js","../src/components/Spawner.js","../src/components/Trigger.js","../src/components/PhysicsP2.js"],"sourcesContent":["import assert from '../util/assert';\nimport * as serializableManager from './serializableManager';\nimport { isClient } from '../util/environment';\n\nconst CHARACTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; // 62 chars\nconst CHAR_COUNT = CHARACTERS.length;\n\nexport function createStringId(threeLetterPrefix = '???', characters = 16) {\n\tlet id = threeLetterPrefix;\n\tfor (let i = characters - 1; i >= 0; --i)\n\t\tid += CHARACTERS[Math.random() * CHAR_COUNT | 0];\n\treturn id;\n}\n\nlet serializableClasses = new Map();\n\nexport default class Serializable {\n\tconstructor(predefinedId = false, skipSerializableRegistering = false) {\n\t\tassert(this.threeLetterType, 'Forgot to Serializable.registerSerializable your class?');\n\t\tthis._children = new Map(); // threeLetterType -> array\n\t\tthis._listeners = [];\n\t\tthis._isInTree = this.isRoot;\n\t\tthis._state |= Serializable.STATE_CONSTRUCTOR;\n\t\tif (skipSerializableRegistering)\n\t\t\treturn;\n\t\tif (predefinedId) {\n\t\t\tthis._state |= Serializable.STATE_PREDEFINEDID;\n\t\t\tthis.id = predefinedId;\n\t\t} else {\n\t\t\tthis.id = createStringId(this.threeLetterType);\n\t\t}\n\t\tif (this.id.startsWith('?'))\n\t\t\tthrow new Error('?');\n\t\tserializableManager.addSerializable(this);\n\t}\n\tdelete() {\n\t\tif (this._parent) {\n\t\t\tthis._parent.deleteChild(this);\n\t\t\treturn false;\n\t\t}\n\t\tthis.deleteChildren();\n\t\tthis._alive = false;\n\t\tthis._isInTree = false;\n\t\tthis._listeners.length = 0;\n\t\tserializableManager.removeSerializable(this.id);\n\t\tthis._state |= Serializable.STATE_DESTROY;\n\t\treturn true;\n\t}\n\tdeleteChildren() {\n\t\tif (this._children.size) {\n\t\t\tthis._children.forEach(array => {\n\t\t\t\tarray.forEach(child => {\n\t\t\t\t\tchild._parent = null;\n\t\t\t\t\tchild.delete();\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis._children.clear();\n\n\t\t\tif (this._parent) {\n\t\t\t\tserializableManager.addChange(serializableManager.changeType.deleteAllChildren, this);\n\t\t\t}\n\t\t}\n\t}\n\t// this is called right after constructor\n\tinitWithChildren(children = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\t\tif (children.length > 0)\n\t\t\tthis.addChildren(children);\n\t\treturn this;\n\t}\n\taddChildren(children) {\n\t\tfor (let i = 0; i < children.length; i++)\n\t\t\tthis.addChild(children[i]);\n\t\treturn this;\n\t}\n\taddChild(child) {\n\t\t\n\t\tthis._addChild(child);\n\t\t\n\t\t\n\t\tthis._state |= Serializable.STATE_ADDCHILD;\n\t\t\n\t\tif (this._isInTree)\n\t\t\tserializableManager.addChange(serializableManager.changeType.addSerializableToTree, child);\n\t\treturn this;\n\t}\n\t_addChild(child) {\n\t\tassert(child._parent === null);\n\t\t\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tif (array === undefined) {\n\t\t\tarray = [];\n\t\t\tthis._children.set(child.threeLetterType, array);\n\t\t}\n\t\tarray.push(child);\n\t\tchild._parent = this;\n\t\tchild._state |= Serializable.STATE_ADDPARENT;\n\t\tchild.setInTreeStatus(this._isInTree);\n\t\t\n\t\treturn this;\n\t}\n\tfindChild(threeLetterType, filterFunction) {\n\t\tlet array = this._children.get(threeLetterType);\n\t\tif (!array) return null;\n\t\tif (filterFunction)\n\t\t\treturn array.find(filterFunction) || null;\n\t\telse\n\t\t\treturn array[0];\n\t}\n\tfindParent(threeLetterType, filterFunction = null) {\n\t\tlet parent = this;\n\t\twhile (parent) {\n\t\t\tif (parent.threeLetterType === threeLetterType && (!filterFunction || filterFunction(parent)))\n\t\t\t\treturn parent;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn null;\n\t}\n\tgetRoot() {\n\t\tlet element = this;\n\t\twhile (element._parent)\n\t\t\telement = element._parent;\n\t\treturn element;\n\t}\n\t// idx is optional\n\tdeleteChild(child, idx) {\n\t\tserializableManager.addChange(serializableManager.changeType.deleteSerializable, child);\n\t\tthis._detachChild(child, idx);\n\t\tchild.delete();\n\t\treturn this;\n\t}\n\t// idx is optional\n\t_detachChild(child, idx = 0) {\n\t\tlet array = this._children.get(child.threeLetterType);\n\t\tassert(array, 'child not found');\n\t\tif (array[idx] !== child)\n\t\t\tidx = array.indexOf(child);\n\t\tassert(idx >= 0, 'child not found');\n\t\tarray.splice(idx, 1);\n\t\tif (array.length === 0)\n\t\t\tthis._children.delete(child.threeLetterType);\n\t\tchild._parent = null;\n\t\tchild.setInTreeStatus(false);\n\t\t\n\t\treturn this;\n\t}\n\tforEachChild(threeLetterType = null, callback, deep = false) {\n\t\tfunction processArray(array) {\n\t\t\tarray.forEach(child => {\n\t\t\t\tcallback(child);\n\t\t\t\tdeep && child.forEachChild(threeLetterType, callback, true);\n\t\t\t});\n\t\t}\n\t\tif (threeLetterType) {\n\t\t\tprocessArray(this._children.get(threeLetterType) || []);\n\t\t} else {\n\t\t\tthis._children.forEach(processArray);\n\t\t}\n\t\treturn this;\n\t}\n\tmove(newParent) {\n\t\t\n\t\tnewParent._addChild(this._detach());\n\n\t\tserializableManager.addChange(serializableManager.changeType.move, this);\n\t\t\n\t\treturn this;\n\t}\n\t_detach() {\n\t\tthis._parent && this._parent._detachChild(this);\n\t\treturn this;\n\t}\n\tgetParent() {\n\t\treturn this._parent || null;\n\t}\n\tgetChildren(threeLetterType) {\n\t\treturn this._children.get(threeLetterType) || [];\n\t}\n\ttoJSON() {\n\t\tlet json = {\n\t\t\tid: this.id\n\t\t};\n\t\tif (this._children.size > 0) {\n\t\t\tlet arrays = [];\n\t\t\t// prototypes must come before a level\n\t\t\tArray.from(this._children.keys()).sort((a, b) => a === 'prt' ? -1 : 1)\n\t\t\t\t.forEach(key => arrays.push(this._children.get(key)));\n\t\t\tjson.c = [].concat(...arrays).map(child => child.toJSON());\n\t\t}\n\t\treturn json;\n\t}\n\ttoString() {\n\t\treturn JSON.stringify(this.toJSON(), null, 4);\n\t}\n\tclone() {\n\t\tlet obj = new this.constructor();\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\tlisten(event, callback) {\n\t\tif (!this._listeners.hasOwnProperty(event)) {\n\t\t\tthis._listeners[event] = [];\n\t\t}\n\t\tthis._listeners[event].unshift(callback);\n\t\treturn () => {\n\t\t\tvar index = this._listeners[event].indexOf(callback);\n\t\t\tthis._listeners[event].splice(index, 1);\n\t\t};\n\t}\n\tdispatch(event, ...args) {\n\t\tif (this._listeners.hasOwnProperty(event)) {\n\t\t\tfor (var i = this._listeners[event].length - 1; i >= 0; --i) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._listeners[event][i].apply(null, args);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.error(`Event ${event} listener crashed.`, this._listeners[event][i], e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\thasDescendant(child) {\n\t\tif (!child) return false;\n\t\tlet parent = child._parent;\n\t\twhile (parent) {\n\t\t\tif (parent === this) return true;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn false;\n\t}\n\tsetInTreeStatus(isInTree) {\n\t\tif (this._isInTree === isInTree)\n\t\t\treturn;\n\t\t\n\t\tthis._isInTree = isInTree;\n\t\tthis._children.forEach(array => {\n\t\t\tarray.forEach(child => child.setInTreeStatus(isInTree));\n\t\t});\n\t}\n\tstatic fromJSON(json) {\n\t\tassert(typeof json.id === 'string' && json.id.length > 5, 'Invalid id.');\n\t\tlet fromJSON = serializableClasses.get(json.id.substring(0, 3));\n\t\tassert(fromJSON);\n\t\tlet obj;\n\t\ttry {\n\t\t\tobj = fromJSON(json);\n\t\t} catch(e) {\n\t\t\tif (isClient) {\n\t\t\t\tif (!window.force)\n\t\t\t\t\tdebugger; // Type 'force = true' in console to ignore failed imports.\n\n\t\t\t\tif (!window.force)\n\t\t\t\t\tthrow new Error();\n\t\t\t} else {\n\t\t\t\tconsole.log('Error fromJSON', e);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\tlet children = json.c ? json.c.map(child => Serializable.fromJSON(child)).filter(Boolean) : [];\n\t\tif (obj._state & Serializable.STATE_INIT)\n\t\t\tobj.addChildren(children);\n\t\telse\n\t\t\tobj.initWithChildren(children);\n\t\tobj._state |= Serializable.STATE_FROMJSON;\n\t\treturn obj;\n\t}\n\tstatic registerSerializable(Class, threeLetterType, fromJSON = null) {\n\t\tClass.prototype.threeLetterType = threeLetterType;\n\t\tassert(typeof threeLetterType === 'string' && threeLetterType.length === 3);\n\t\tif (!fromJSON)\n\t\t\tfromJSON = json => new Class(json.id);\n\t\tserializableClasses.set(threeLetterType, fromJSON);\n\t}\n}\n\nSerializable.prototype._parent = null;\nSerializable.prototype._alive = true;\nSerializable.prototype._state = 0;\n\nSerializable.STATE_CONSTRUCTOR = 1;\nSerializable.STATE_INIT = 2;\nSerializable.STATE_ADDCHILD = 4;\nSerializable.STATE_ADDPARENT = 8;\nSerializable.STATE_CLONE = 16;\nSerializable.STATE_DESTROY = 32;\nSerializable.STATE_FROMJSON = 64;\nSerializable.STATE_PREDEFINEDID = 128;\n\nSerializable.prototype.isRoot = false; // If this should be a root node\nObject.defineProperty(Serializable.prototype, 'debug', {\n\tget() {\n\t\tlet info = this.threeLetterType;\n\n\t\tthis._children.forEach((value, key) => {\n\t\t\tinfo += '|';\n\t\t\tif (key === 'prp')\n\t\t\t\tinfo += this.getChildren('prp').map(p => `${p.name}=${p._value}`).join(', ');\n\t\t\telse\n\t\t\t\tinfo += `${key}(${value.length})`;\n\t\t});\n\t\t\n\t\tinfo += '|state: ';\n\t\t\n\t\tlet states = [];\n\t\tlet logState = (state, stateString) => {\n\t\t\tif (this._state & state)\n\t\t\t\tstates.push(stateString);\n\t\t};\n\t\t\n\t\tlogState(Serializable.STATE_CONSTRUCTOR, 'constructor');\n\t\tlogState(Serializable.STATE_INIT, 'init');\n\t\tlogState(Serializable.STATE_ADDCHILD, 'add child');\n\t\tlogState(Serializable.STATE_ADDPARENT, 'add parent');\n\t\tlogState(Serializable.STATE_CLONE, 'clone');\n\t\tlogState(Serializable.STATE_DESTROY, 'destroy');\n\t\tlogState(Serializable.STATE_FROMJSON, 'from json');\n\t\tlogState(Serializable.STATE_PREDEFINEDID, 'predefined id');\n\t\t\n\t\tinfo += states.join(', ');\n\t\t\n\t\treturn info;\n\t}\n});\nObject.defineProperty(Serializable.prototype, 'debugChildren', {\n\tget() {\n\t\tlet c = [];\n\t\tthis._children.forEach((value, key) => {\n\t\t\tc = c.concat(value);\n\t\t});\n\t\t\n\t\tlet children = [];\n\t\t\n\t\tfunction createDebugObject(type) {\n\t\t\tif (type === 'gam') return new function Game(){};\n\t\t\tif (type === 'sce') return new function Scene(){};\n\t\t\tif (type === 'prt') return new function Prototype(){};\n\t\t\tif (type === 'prp') return new function Property(){};\n\t\t\tif (type === 'cda') return new function ComponentData(){};\n\t\t\tif (type === 'com') return new function Component(){};\n\t\t\tif (type === 'epr') return new function EntityPrototype(){};\n\t\t\tif (type === 'ent') return new function Entity(){};\n\t\t\tif (type === 'lvl') return new function Level(){};\n\t\t\treturn new function Other(){};\n\t\t}\n\n\t\tc.forEach(child => {\n\t\t\tlet obj = createDebugObject(child.threeLetterType);\n\t\t\t\n\t\t\tobj.debug = child.debug;\n\t\t\tobj.ref = child;\n\t\t\tlet c = child.debugChildArray;\n\t\t\tif (c && c.length > 0)\n\t\t\t\tobj.children = c;\n\t\t\tchildren.push(obj);\n\t\t});\n\n\t\treturn children;\n\t}\n});\n","import assert from '../util/assert';\nimport Serializable from './serializable';\n\nexport let serializables = {};\n\nlet DEBUG_CHANGES = 0;\nlet CHECK_FOR_INVALID_ORIGINS = 0;\n\nexport function addSerializable(serializable) {\n\tassert(serializables[serializable.id] === undefined, `Serializable id clash ${serializable.id}`);\n\tserializables[serializable.id] = serializable;\n}\n\nexport function getSerializable(id) {\n\treturn serializables[id] || null;\n}\n\nexport function hasSerializable(id) {\n\treturn Boolean(serializables[id]);\n}\n\nexport function removeSerializable(id) {\n\tif (serializables[id])\n\t\tdelete serializables[id];\n\telse\n\t\tthrow new Error('Serializable not found!');\n}\n\n// reference parameters are not sent over net. they are helpers in local game instance\nexport let changeType = {\n\taddSerializableToTree: 'a', // parentId, reference\n\tsetPropertyValue: 's', // id, value\n\tdeleteSerializable: 'd', // id\n\tmove: 'm', // id, parentId\n\tdeleteAllChildren: 'c', // id\n};\nlet keyToShortKey = {\n\tid: 'i', // obj.id\n\ttype: 't', // changeType.*\n\tvalue: 'v', // value after toJSON\n\tparentId: 'p' // obj._parent.id\n};\nlet shortKeyToKey = {};\nObject.keys(keyToShortKey).forEach(k => {\n\tshortKeyToKey[keyToShortKey[k]] = k;\n});\n\nlet origin;\nlet previousVisualOrigin;\nfunction resetOrigin() {\n\torigin = null;\n}\nexport function getChangeOrigin() {\n\treturn origin;\n}\nexport function setChangeOrigin(_origin) {\n\tif (_origin !== origin) {\n\t\torigin = _origin;\n\t\tif (DEBUG_CHANGES && _origin && _origin !== previousVisualOrigin) {\n\t\t\tconsole.log('origin', previousVisualOrigin);\n\t\t\tpreviousVisualOrigin = _origin;\n\t\t}\n\t\t\n\t\tif (CHECK_FOR_INVALID_ORIGINS)\n\t\t\tsetTimeout(resetOrigin);\n\t}\n}\n\nlet externalChange = false;\nexport function addChange(type, reference) {\n\tassert(origin, 'Change without origin!');\n\tif (!reference.id) return;\n\t\n\tlet change = {\n\t\ttype,\n\t\treference,\n\t\tid: reference.id,\n\t\texternal: externalChange,\n\t\torigin\n\t};\n\tif (type === changeType.setPropertyValue) {\n\t\tchange.value = reference._value;\n\t} else if (type === changeType.move) {\n\t\tchange.parent = reference._parent;\n\t} else if (type === changeType.addSerializableToTree) {\n\t\tchange.parent = reference._parent;\n\t\tdelete change.id;\n\t}\n\t\n\tif (DEBUG_CHANGES)\n\t\tconsole.log('change', change);\n\t\n\tlet previousOrigin = origin;\n\tlisteners.forEach(l => l(change));\n\tif (origin !== previousOrigin) {\n\t\tif (DEBUG_CHANGES)\n\t\t\tconsole.log('origin changed from', previousOrigin, 'to', origin && origin.constructor || origin);\n\t\torigin = previousOrigin;\n\t}\n}\n\nexport function executeExternal(callback) {\n\tsetChangeOrigin('external');\n\tif (externalChange) return callback();\n\texternalChange = true;\n\tcallback();\n\texternalChange = false;\n}\n\nlet listeners = [];\n\nexport function addChangeListener(callback) {\n\tassert(typeof callback === 'function');\n\tlisteners.push(callback);\n}\n\nexport function packChange(change) {\n\tif (change.packedChange)\n\t\treturn change.packedChange; // optimization\n\t\n\tlet packed = {};\n\ttry {\n\t\tif (change.parent)\n\t\t\tchange.parentId = change.parent.id;\n\t\t\n\t\tif (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.reference) {\n\t\t\t\tchange.value = change.reference.toJSON();\n\t\t\t} else if (change.value) {\n\t\t\t\t// change.value = change.value; // no changes\n\t\t\t} else {\n\t\t\t\tassert(false, 'invalid change of type addSerializableToTree', change);\n\t\t\t}\n\t\t} else if (change.value) {\n\t\t\tchange.value = change.reference.propertyType.type.toJSON(change.value);\n\t\t}\n\n\t\tObject.keys(keyToShortKey).forEach(key => {\n\t\t\tif (change[key]) {\n\t\t\t\tif (key === 'type' && change[key] === changeType.setPropertyValue) return; // optimize most common type\n\t\t\t\tpacked[keyToShortKey[key]] = change[key];\n\t\t\t}\n\t\t});\n\t} catch(e) {\n\t\tconsole.log('PACK ERROR', e);\n\t}\n\treturn packed;\n}\n\nexport function unpackChange(packedChange) {\n\tlet change = {\n\t\tpackedChange // optimization\n\t};\n\tObject.keys(packedChange).forEach(shortKey => {\n\t\tlet key = shortKeyToKey[shortKey];\n\t\tchange[key] = packedChange[shortKey];\n\t});\n\tif (!change.type)\n\t\tchange.type = changeType.setPropertyValue;\n\t\n\tif (change.type === changeType.addSerializableToTree) {\n\t\t// reference does not exist because it has not been created yet\n\t\tchange.id = change.value.id;\n\t} else {\n\t\tchange.reference = getSerializable(change.id);\n\t\tif (change.reference) {\n\t\t\tchange.id = change.reference.id;\n\t\t} else {\n\t\t\tconsole.error('received a change with unknown id', change, 'packed:', packedChange);\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\tif (change.parentId)\n\t\tchange.parent = getSerializable(change.parentId);\n\treturn change;\n}\n\nexport function executeChange(change) {\n\tlet newScene;\n\t\n\texecuteExternal(() => {\n\t\tconsole.log('execute change', change.type, change.id || change.value);\n\t\tif (change.type === changeType.setPropertyValue) {\n\t\t\tchange.reference.value = change.reference.propertyType.type.fromJSON(change.value);\n\t\t} else if (change.type === changeType.addSerializableToTree) {\n\t\t\tif (change.parent) {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value);\n\t\t\t\tchange.parent.addChild(obj);\n\t\t\t\tif (obj.threeLetterType === 'ent') {\n\t\t\t\t\tobj.localMaster = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet obj = Serializable.fromJSON(change.value); // Scene does not need a parent\n\t\t\t\tif (obj.threeLetterType === 'sce')\n\t\t\t\t\tnewScene = obj;\n\t\t\t}\n\t\t} else if (change.type === changeType.deleteAllChildren) {\n\t\t\tchange.reference.deleteChildren();\n\t\t} else if (change.type === changeType.deleteSerializable) {\n\t\t\tchange.reference.delete();\n\t\t} else if (change.type === changeType.move) {\n\t\t\tchange.reference.move(change.parent);\n\t\t}\n\t});\n\t\n\tif (newScene)\n\t\tnewScene.play();\n}\n","import { getChangeOrigin } from '../core/serializableManager';\nexport default function assert(condition, message) {\n\tif (!condition) {\n\t\tconsole.log('Assert', message, new Error().stack, '\\norigin', getChangeOrigin());\n\t\tdebugger;\n\t\tthrow new Error(message);\n\t}\n}\n","import assert from '../util/assert';\nimport Property from './property';\n\n// info about type, validator, validatorParameters, initialValue\n\n\n\nclass PropertyType {\n\tconstructor(name, type, validator, initialValue, description, flags = [], visibleIf) {\n\t\tassert(typeof name === 'string');\n\t\tassert(name[0] >= 'a' && name[0] <= 'z', 'Name of a property must start with lower case letter.');\n\t\tassert(type && typeof type.name === 'string');\n\t\tassert(validator && typeof validator.validate === 'function');\n\t\t\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.validator = validator;\n\t\tthis.initialValue = initialValue;\n\t\tthis.description = description;\n\t\tthis.visibleIf = visibleIf;\n\t\tthis.flags = {};\n\t\tflags.forEach(f => this.flags[f.type] = f);\n\t}\n\tgetFlag(flag) {\n\t\treturn this.flags[flag.type];\n\t}\n\tcreateProperty({ value, predefinedId, skipSerializableRegistering = false } = {}) {\n\t\treturn new Property({\n\t\t\tpropertyType: this,\n\t\t\tvalue,\n\t\t\tpredefinedId,\n\t\t\tname: this.name,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n}\n\n/*\n\tBeautiful way of creating property types\n\t\n\toptionalParameters:\n\t\tdescription: 'Example',\n\t\tvalidator: PropertyType.\n */\nexport default function createPropertyType(propertyName, defaultValue, type, ...optionalParameters) {\n\ttype = type();\n\tlet validator = type.validators.default();\n\tlet description = '';\n\tlet flags = [];\n\tlet visibleIf = null;\n\toptionalParameters.forEach((p, idx) => {\n\t\tif (typeof p === 'string')\n\t\t\tdescription = p;\n\t\telse if (p && p.validate)\n\t\t\tvalidator = p;\n\t\telse if (p && p.isFlag)\n\t\t\tflags.push(p);\n\t\telse if (p && p.visibleIf)\n\t\t\tvisibleIf = p;\n\t\telse\n\t\t\tassert(false, 'invalid parameter ' + p + ' idx ' + idx);\n\t});\n\treturn new PropertyType(propertyName, type, validator, defaultValue, description, flags, visibleIf);\n};\n\nexport let dataType = createPropertyType;\n\ndataType.visibleIf = function(propertyName, value) {\n\tassert(typeof propertyName === 'string' && propertyName.length);\n\tassert(typeof value !== 'undefined');\n\treturn {\n\t\tvisibleIf: true,\n\t\tpropertyName,\n\t\tvalue\n\t};\n};\n\nfunction createFlag(type, func = {}) {\n\tfunc.isFlag = true;\n\tfunc.type = type;\n\treturn func;\n}\n\ncreatePropertyType.flagDegreesInEditor = createFlag('degreesInEditor');\n\nexport function createDataType({\n\tname = '',\n\tvalidators = { default: x => x }, // default must exist. if value is a reference(object), validator should copy the value.\n\ttoJSON = x => x,\n\tfromJSON = x => x,\n\tclone = x => x\n}) {\n\tassert(name, 'name missing from property type');\n\tassert(typeof validators.default === 'function','default validator missing from property type: ' + name);\n\tassert(typeof toJSON === 'function', 'invalid toJSON for property type: ' + name);\n\tassert(typeof fromJSON === 'function', 'invalid fromJSON for property type: ' + name);\n\n\tlet type = {\n\t\tname,\n\t\tvalidators,\n\t\ttoJSON,\n\t\tfromJSON,\n\t\tclone\n\t};\n\tlet createType = () => type;\n\n\tObject.keys(validators).forEach(validatorName => {\n\t\tcreateType[validatorName] = createValidator(validatorName, validators[validatorName]);\n\t\tvalidators[validatorName] = createType[validatorName];\n\t});\n\treturn createType;\n}\n\nfunction createValidator(name, validatorFunction) {\n\tlet validator = function() {\n\t\tlet parameters = [...arguments];\n\t\treturn {\n\t\t\tvalidatorName: name,\n\t\t\tvalidatorParameters: parameters,\n\t\t\tvalidate: x => validatorFunction(x, ...parameters),\n\t\t\tparameters\n\t\t};\n\t};\n\tvalidator.validatorName = name;\n\tvalidator.validate = validatorFunction;\n\treturn validator;\n}\n","import assert from '../util/assert';\nimport { createDataType, dataType } from './propertyType';\nimport Vector from '../util/vector';\n\nfunction validateFloat(val) {\n\tif (isNaN(val) || val === Infinity || val === -Infinity)\n\t\tthrow new Error('Invalid float: ' + val);\n}\n\nconst FLOAT_JSON_PRECISION = 4;\nconst FLOAT_JSON_PRECISION_MULTIPLIER = Math.pow(10, FLOAT_JSON_PRECISION);\nconst FLOAT_DELTA = 0.0000001;\n\ndataType.float = createDataType({\n\tname: 'float',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t},\n\t\tmodulo(x, min, max) {\n\t\t\tx = parseFloat(x);\n\t\t\tvalidateFloat(x);\n\t\t\t\n\t\t\tlet range = max - min;\n\t\t\t\n\t\t\tif (x < min) {\n\t\t\t\tx += (((min - x) / range | 0) + 1) * range;\n\t\t\t} else if (x > max - FLOAT_DELTA) {\n\t\t\t\tx -= (((x - max) / range | 0) + 1) * range;\n\t\t\t}\n\t\t\t\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => Math.round(x*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER,\n\tfromJSON: x => x\n});\ndataType.int = createDataType({\n\tname: 'int',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tx = parseInt(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn x;\n\t\t},\n\t\t// PropertyType.float.range(min, max)\n\t\trange(x, min, max) {\n\t\t\tx = parseInt(x);\n\t\t\tvalidateFloat(x);\n\t\t\treturn Math.min(max, Math.max(min, x));\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\ndataType.vector = createDataType({\n\tname: 'vector',\n\tvalidators: {\n\t\tdefault(vec) {\n\t\t\tif (!(vec instanceof Vector))\n\t\t\t\tthrow new Error();\n\t\t\tvec = vec.clone();\n\t\t\tvec.x = parseFloat(vec.x);\n\t\t\tvec.y = parseFloat(vec.y);\n\t\t\tvalidateFloat(vec.x);\n\t\t\tvalidateFloat(vec.y);\n\t\t\treturn vec;\n\t\t}\n\t},\n\ttoJSON: vec => ({\n\t\tx: Math.round(vec.x*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER,\n\t\ty: Math.round(vec.y*FLOAT_JSON_PRECISION_MULTIPLIER)/FLOAT_JSON_PRECISION_MULTIPLIER\n\t}),\n\tfromJSON: vec => Vector.fromObject(vec),\n\tclone: vec => vec.clone()\n});\n\ndataType.string = createDataType({\n\tname: 'string',\n\tvalidators: {\n\t\tdefault: x => x ? String(x) : ''\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n\ndataType.bool = createDataType({\n\tname: 'bool',\n\tvalidators: {\n\t\tdefault(x) {\n\t\t\tif (typeof x !== 'boolean')\n\t\t\t\tthrow new Error();\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x ? 1 : 0,\n\tfromJSON: x => !!x\n});\n\ndataType.enum = createDataType({\n\tname: 'enum',\n\tvalidators: {\n\t\tdefault() {\n\t\t\tassert(false, `also specify enum values with Prop.enum.values('value1', 'value2', ...)`);\n\t\t},\n\t\tvalues(x, ...values) {\n\t\t\tif (!Array.isArray(values))\n\t\t\t\tthrow new Error();\n\t\t\tif (typeof x !== 'string')\n\t\t\t\tthrow new Error('val should be string');\n\t\t\tif (values.indexOf(x) < 0)\n\t\t\t\tthrow new Error(`value ${x} not in enum: [${values}]`);\n\t\t\treturn x;\n\t\t}\n\t},\n\ttoJSON: x => x,\n\tfromJSON: x => x\n});\n","import assert from '../util/assert';\nimport { isClient } from '../util/environment';\n\nlet p2;\nif (isClient)\n\tp2 = window.p2;\nelse\n\tp2 = require('../src/external/p2');\n\nexport default p2;\n\nexport function createWorld(owner, options) {\n\tassert(!owner._p2World);\n\towner._p2World = new p2.World({\n\t\tgravity: [0, 9.81]\n\t});\n\n\t// Stress test says that Body sleeping performs better than Island sleeping when idling.\n\towner._p2World.sleepMode = p2.World.BODY_SLEEPING;\n}\n// const MAX_PHYSICS_DT = 0.2;\nconst PHYSICS_DT = 1 / 60;\nexport function updateWorld(owner, dt) {\n\towner._p2World.step(PHYSICS_DT, dt, 10);\n}\nexport function deleteWorld(owner) {\n\tif (owner._p2World)\n\t\towner._p2World.clear()\n\tdelete owner._p2World;\n\tdelete owner._p2Materials;\n}\nexport function addBody(owner, body) {\n\towner._p2World.addBody(body);\n}\nexport function deleteBody(owner, body) {\n\towner._p2World.removeBody(body);\n}\n\n// export function addContactMaterial(owner, A, B, options) {\n// \towner._p2World.addContactMaterial(new p2.ContactMaterial(A, B, options));\n// }\n\nconst defaultMaterialOptions = {\n\tfriction: 0.3,\n\trestitution: 0,\n\tstiffness: 1e6,\n\trelaxation: 4,\n\tfrictionStiffness: 1e6,\n\tfrictionRelaxation: 4,\n\tsurfaceVelocity: 0\n};\n\nexport function createMaterial(owner, options) {\n\tif (!owner._p2Materials)\n\t\towner._p2Materials = {};\n\tlet materials = owner._p2Materials;\n\toptions = Object.assign({}, defaultMaterialOptions, options);\n\tlet hash = [\n\t\toptions.friction,\n\t\toptions.restitution,\n\t\toptions.stiffness,\n\t\toptions.relaxation,\n\t\toptions.frictionStiffness,\n\t\toptions.frictionRelaxation,\n\t\toptions.surfaceVelocity\n\t].join(';');\n\t\n\tif (materials[hash])\n\t\treturn materials[hash];\n\t\n\tlet material = new p2.Material();\n\tmaterial.options = options;\n\tmaterials[hash] = material;\n\t\n\tfor (var h in materials) {\n\t\tlet m = materials[h];\n\t\tlet o1 = material.options;\n\t\tlet o2 = m.options;\n\t\tlet contactMaterial = new p2.ContactMaterial(material, m, {\n\t\t\tfriction:\t\t\t\tMath.min(o1.friction, o2.friction),\n\t\t\trestitution:\t\t\to1.restitution * o2.restitution,\n\t\t\tstiffness:\t\t\t\tMath.min(o1.stiffness, o2.stiffness),\n\t\t\trelaxation:\t\t\t\t(o1.relaxation + o2.relaxation) / 2,\n\t\t\tfrictionStiffness:\t\tMath.min(o1.frictionStiffness, o2.frictionStiffness),\n\t\t\tfrictionRelaxation:\t\t(o1.frictionRelaxation + o2.frictionRelaxation) / 2,\n\t\t\tsurfaceVelocity:\t\tMath.max(o1.surfaceVelocity, o2.surfaceVelocity)\n\t\t});\n\t\towner._p2World.addContactMaterial(contactMaterial);\n\t}\n\t\n\treturn material;\n}\n","import Vector from '../util/vector';\n\nexport function keyPressed(key) {\n\treturn keys[key] || false;\n}\n\nexport function listenKeyDown(handler) {\n\tkeyDownListeners.push(handler);\n\treturn () => keyDownListeners.splice(keyDownListeners.indexOf(handler), 1);\n}\nexport function listenKeyUp(handler) {\n\tkeyUpListeners.push(handler);\n\treturn () => keyUpListeners.splice(keyUpListeners.indexOf(handler), 1);\n}\n\nexport const key = {\n\tleft: 37,\n\tright: 39,\n\tup: 38,\n\tdown: 40,\n\tctrl: 17,\n\tappleLeft: 91,\n\tappleRight: 93,\n\talt: 18,\n\tshift: 16,\n\tspace: 32,\n\ta: 65,\n\tb: 66,\n\tc: 67,\n\td: 68,\n\te: 69,\n\tf: 70,\n\tg: 71,\n\th: 72,\n\ti: 73,\n\tj: 74,\n\tk: 75,\n\tl: 76,\n\tm: 77,\n\tn: 78,\n\to: 79,\n\tp: 80,\n\tq: 81,\n\tr: 82,\n\ts: 83,\n\tt: 84,\n\tu: 85,\n\tv: 86,\n\tw: 87,\n\tx: 88,\n\ty: 89,\n\tz: 90,\n\t'0': 48,\n\t'1': 49,\n\t'9': 57,\n\tbackspace: 8,\n\tenter: 13,\n\tesc: 27\n};\n\nexport function listenMouseMove(element, handler) {\n\telement.addEventListener('mousemove', event => {\n\t\tlet x = event.pageX;\n\t\tlet y = event.pageY;\n\t\tlet el = element;\n\t\twhile( el != null ) {\n\t\t\tx -= el.offsetLeft;\n\t\t\ty -= el.offsetTop;\n\t\t\tel = el.offsetParent;\n\t\t}\n\t\t\n\t\telement._mx = x;\n\t\telement._my = y;\n\t\thandler(new Vector(x, y));\n\t});\n}\n\nexport function listenMouseDown(element, handler) {\n\telement.addEventListener('mousedown', event => {\n\t\tif (typeof element._mx === 'number')\n\t\t\thandler(new Vector(element._mx, element._my));\n\t\telse\n\t\t\thandler();\n\t});\n}\nexport function listenMouseUp(element, handler) {\n\telement.addEventListener('mouseup', event => {\n\t\tif (typeof element._mx === 'number')\n\t\t\thandler(new Vector(element._mx, element._my));\n\t\telse\n\t\t\thandler();\n\t});\n}\n\n////////////////////////////////////\n\n\nlet keys = {};\nlet keyDownListeners = [];\nlet keyUpListeners = [];\n\n\nif (typeof window !== 'undefined') {\n\n\twindow.onkeydown = event => {\n\t\tlet keyCode = event.which || event.keyCode;\n\n\t\tif (document.activeElement.nodeName.toLowerCase() == \"input\" && keyCode !== key.esc)\n\t\t\treturn;\n\n\t\tkeys[keyCode] = true;\n\t\tkeyDownListeners.forEach(l => l(keyCode));\n\t};\n\twindow.onkeyup = event => {\n\t\tlet key = event.which || event.keyCode;\n\t\tkeys[key] = false;\n\t\tkeyUpListeners.forEach(l => l(key));\n\t};\n}\n","import { addChangeListener, packChange, unpackChange, executeChange, executeExternal, changeType } from '../core/serializableManager'\nimport Serializable from '../core/serializable';\nimport { game } from '../core/game';\nimport { isClient } from './environment';\n\nimport { lzw_decode, lzw_encode } from './compression';\n\nlet networkEnabled = false;\nexport function setNetworkEnabled(enabled = true) {\n\tnetworkEnabled = enabled;\n}\n\nlet shouldStartSceneWhenGameLoaded = false;\nexport function startSceneWhenGameLoaded() {\n\tshouldStartSceneWhenGameLoaded = true;\n}\n\nlet socket;\n\nfunction isInSceneTree(change) {\n\treturn change.reference.getRoot().threeLetterType === 'sce';\n}\n\nfunction getQueryVariable(variable) {\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split('=');\n\t\tif (decodeURIComponent(pair[0]) == variable) {\n\t\t\treturn decodeURIComponent(pair[1]);\n\t\t}\n\t}\n\tconsole.log('Query variable %s not found', variable);\n}\n\nfunction tryToLoad() {\n\tif (!window.io) return setTimeout(tryToLoad, 10);\n\t\n\tsocket = io();\n\t\n\tlet changes = [];\n\tlet valueChanges = {}; // id => change\n\n\taddChangeListener(change => {\n\t\tif (change.origin === 'external' || !networkEnabled)\n\t\t\treturn; // Don't send a change that you have received.\n\t\t\n\t\tif (isInSceneTree(change)) // Don't sync scene\n\t\t\treturn;\n\t\t\n\t\tif (change.type === changeType.setPropertyValue) {\n\t\t\tlet duplicateChange = valueChanges[change.id];\n\t\t\tif (duplicateChange) {\n\t\t\t\tchanges.splice(changes.indexOf(duplicateChange), 1);\n\t\t\t}\n\t\t\tvalueChanges[change.id] = change;\n\t\t}\n\t\tchanges.push(change);\n\t});\n\t\n\tsetInterval(() => {\n\t\tif (changes.length === 0)\n\t\t\treturn;\n\t\tlet packedChanges = changes.map(packChange);\n\t\tchanges.length = 0;\n\t\tvalueChanges = {};\n\t\tconsole.log('sending', packedChanges);\n\t\tsocket.emit('c', packedChanges);\n\t}, 100);\n\n\tsocket.on('c', packedChanges => {\n\t\tconsole.log('RECEIVE,', networkEnabled);\n\t\tif (!networkEnabled)\n\t\t\treturn;\n\t\t\n\t\tconsole.log('received', packedChanges);\n\t\tpackedChanges.forEach(change => {\n\t\t\tchange = unpackChange(change);\n\t\t\tif (change) {\n\t\t\t\texecuteChange(change);\n\t\t\t}\n\t\t});\n\t});\n\t\n\tsocket.on('requestGameId', serverStartTime => {\n\t\tif (game)\n\t\t\tsocket.emit('gameId', game.id);\n\t});\n\n\tlet clientStartTime = Date.now();\n\tsocket.on('refreshIfOlderThan', requiredClientTime => {\n\t\tif (clientStartTime < requiredClientTime)\n\t\t\tlocation.reload();\n\t});\n\t\n\tsocket.on('gameData', gameData => {\n\t\tconsole.log('gameData', gameData);\n\t\texecuteExternal(() => {\n\t\t\tSerializable.fromJSON(gameData);\n\t\t});\n\t\tlocalStorage.anotherGameId = gameData.id;\n\t\t// location.replace(`${location.origin}${location.pathname}?gameId=${gameData.id}`);\n\t\thistory.replaceState({}, null, `?gameId=${gameData.id}`);\n\t\tconsole.log('replaced with', `${location.origin}${location.pathname}?gameId=${gameData.id}`);\n\t\t\n\t\tif (shouldStartSceneWhenGameLoaded) {\n\t\t\tlet scene = game.getChildren('lvl')[0].createScene();\n\t\t\tscene.play();\n\t\t\t\n\t\t\tgame.listen('levelCompleted', () => {\n\t\t\t\tscene.play();\n\t\t\t});\n\t\t}\n\t});\n\t\n\tsetTimeout(() => {\n\t\tlet gameId = getQueryVariable('gameId') || localStorage.anotherGameId;\n\t\tconsole.log('requestGameData', gameId);\n\t\tsocket.emit('requestGameData', gameId);\n\t}, 100);\n}\n\nif (isClient)\n\ttryToLoad();\n","import './core'\nimport './components'\nimport { startSceneWhenGameLoaded, setNetworkEnabled } from './util/net'\n\nstartSceneWhenGameLoaded();\nsetNetworkEnabled(true);\n\nlet canvas;\nwindow.addEventListener('load', () => {\n\tcanvas = document.querySelector('canvas.anotherCanvas');\n\tresizeCanvas();\n});\nwindow.addEventListener('resize', resizeCanvas);\n\nfunction resizeCanvas() {\n\tif (!canvas)\n\t\treturn;\n\tcanvas.width = window.innerWidth;\n\tcanvas.height = window.innerHeight;\n}\n","let isClient = typeof window !== 'undefined';\nlet isServer = typeof module !== 'undefined';\n\nif (isClient && isServer)\n\tthrow new Error('Can not be client and server at the same time.');\n\nexport { isClient, isServer };\n","import Serializable from './serializable';\nimport { addChange, changeType, setChangeOrigin } from './serializableManager'; \nimport assert from '../util/assert';\n\n// Instance of a property\nexport default class Property extends Serializable {\n\t// set skipSerializableRegistering=true if you are not planning to add this property to the hierarchy\n\t// if you give propertyType, value in real value form\n\t// if you don't give propertyType (give it later), value as JSON form\n\tconstructor({ value, predefinedId, name, propertyType, skipSerializableRegistering = false }) {\n\t\tassert(name, 'Property without a name can not exist');\n\t\tsuper(predefinedId, skipSerializableRegistering);\n\t\tthis._initialValue = value;\n\t\tif (propertyType)\n\t\t\tthis.setPropertyType(propertyType);\n\t\telse {\n\t\t\tthis.name = name;\n\t\t\tthis._initialValueIsJSON = true;\n\t\t}\n\t}\n\tsetPropertyType(propertyType) {\n\t\tthis.propertyType = propertyType;\n\t\ttry {\n\t\t\tif (this._initialValue !== undefined)\n\t\t\t\tthis.value = this._initialValueIsJSON ? propertyType.type.fromJSON(this._initialValue) : this._initialValue;\n\t\t\telse\n\t\t\t\tthis.value = propertyType.initialValue;\n\t\t} catch(e) {\n\t\t\tconsole.log('Invalid value', e, propertyType, this);\n\t\t\tthis.value = propertyType.initialValue;\n\t\t}\n\t\tthis.name = propertyType.name;\n\t}\n\tclone(skipSerializableRegistering = false) {\n\t\treturn new Property({\n\t\t\tvalue: this.propertyType.type.clone(this.value),\n\t\t\tname: this.name,\n\t\t\tpropertyType: this.propertyType,\n\t\t\tskipSerializableRegistering\n\t\t});\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tv: this.type.toJSON(this.value),\n\t\t\tn: this.propertyType.name\n\t\t});\n\t}\n}\nProperty.prototype.propertyType = null;\nObject.defineProperty(Property.prototype, 'type', {\n\tget() {\n\t\treturn this.propertyType.type;\n\t}\n});\nObject.defineProperty(Property.prototype, 'value', {\n\tset(newValue) {\n\t\tthis._value = this.propertyType.validator.validate(newValue);\n\t\tthis.dispatch('change', this._value);\n\t\tif (this._isInTree)\n\t\t\taddChange(changeType.setPropertyValue, this);\n\t},\n\tget() {\n\t\treturn this._value;\n\t}\n});\n\nSerializable.registerSerializable(Property, 'prp', json => {\n\treturn new Property({\n\t\tvalue: json.v,\n\t\tpredefinedId: json.id,\n\t\tname: json.n\n\t});\n});\n\nObject.defineProperty(Property.prototype, 'debug', {\n\tget() {\n\t\treturn `prp ${this.name}=${this.value}`;\n\t}\n});\n","export default class Vector {\n\tconstructor(x, y) {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t}\n\tadd(vec) {\n\t\tthis.x += vec.x;\n\t\tthis.y += vec.y;\n\t\treturn this;\n\t}\n\tsubtract(vec) {\n\t\tthis.x -= vec.x;\n\t\tthis.y -= vec.y;\n\t\treturn this;\n\t}\n\tmultiply(vec) {\n\t\tthis.x *= vec.x;\n\t\tthis.y *= vec.y;\n\t\treturn this;\n\t}\n\tmultiplyScalar(scalar) {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\treturn this;\n\t}\n\tdivide(vec) {\n\t\tthis.x /= vec.x;\n\t\tthis.y /= vec.y;\n\t\treturn this;\n\t}\n\tdivideScalar(scalar) {\n\t\tthis.x /= scalar;\n\t\tthis.y /= scalar;\n\t\treturn this;\n\t}\n\tdot(vec) {\n\t\treturn this.x * vec.x + this.y * vec.y;\n\t}\n\tlength() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n\tsetLength(newLength) {\n\t\tlet oldLength = this.length();\n\n\t\tif (oldLength === 0) {\n\t\t\tthis.x = newLength;\n\t\t\tthis.y = 0;\n\t\t} else {\n\t\t\tthis.multiplyScalar(newLength / oldLength);\n\t\t}\n\t\treturn this;\n\t}\n\tgetProjectionOn(vec) {\n\t\tlet length = vec.length();\n\t\tif (length === 0)\n\t\t\treturn this.clone();\n\t\telse\n\t\t\treturn vec.clone().multiplyScalar(this.dot(vec) / (length * length));\n\t}\n\tdistance(vec) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t}\n\tdistanceSq(vec) {\n\t\tlet dx = this.x - vec.x,\n\t\t\tdy = this.y - vec.y;\n\t\treturn dx * dx + dy * dy;\n\t}\n\tnormalize() {\n\t\treturn this.setLength(1);\n\t}\n\thorizontalAngle() {\n\t\treturn Math.atan2(this.y, this.x);\n\t}\n\tverticalAngle() {\n\t\treturn Math.atan2(this.x, this.y);\n\t}\n\trotate(angle) {\n\t\tlet x = this.x * Math.cos(angle) - this.y * Math.sin(angle);\n\t\tthis.y = this.x * Math.sin(angle) + this.y * Math.cos(angle);\n\t\tthis.x = x;\n\n\t\treturn this;\n\t}\n\trotateTo(angle) {\n\t\treturn this.rotate(angle-this.verticalAngle());\n\t}\n\tisEqualTo(vec) {\n\t\treturn this.x === vec.x && this.y === vec.y;\n\t}\n\tisZero() {\n\t\treturn !this.x && !this.y;\n\t}\n\tclone() {\n\t\treturn new Vector(this.x, this.y);\n\t}\n\tset(vec) {\n\t\tthis.x = vec.x;\n\t\tthis.y = vec.y;\n\t\treturn this;\n\t}\n\ttoString() {\n\t\treturn `[${this.x}, ${this.y}]`;\n\t}\n\ttoArray() {\n\t\treturn [this.x, this.y];\n\t}\n}\nVector.fromObject = function(obj) {\n\treturn new Vector(obj.x, obj.y);\n};\nVector.fromArray = function(obj) {\n\treturn new Vector(obj[0], obj[1]);\n};\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nexport { default as Prop } from './propertyType';\n\nexport default class PropertyOwner extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tassert(Array.isArray(this.constructor._propertyTypes), 'call PropertyOwner.defineProperties after class definition');\n\t\tsuper(predefinedId);\n\t\tthis._properties = {};\n\t}\n\t// Just a helper\n\tinitWithPropertyValues(values = {}) {\n\t\tlet children = [];\n\t\t\n\t\tObject.keys(values).forEach(propName => {\n\t\t\tlet propertyType = this.constructor._propertyTypesByName[propName];\n\t\t\tassert(propertyType, 'Invalid property ' + propName);\n\t\t\tchildren.push(propertyType.createProperty({\n\t\t\t\tvalue: values[propName]\n\t\t\t}));\n\t\t});\n\t\tthis.initWithChildren(children);\n\t\treturn this;\n\t}\n\tinitWithChildren(children = []) {\n\t\tassert(!(this._state & Serializable.STATE_INIT), 'init already done');\n\t\tthis._state |= Serializable.STATE_INIT;\n\t\t\n\t\tlet propChildren = [];\n\t\tlet otherChildren = [];\n\t\t// Separate Property children and other children\n\t\tchildren.forEach(child => {\n\t\t\tif (child.threeLetterType === 'prp') {\n\t\t\t\tpropChildren.push(child);\n\t\t\t} else {\n\t\t\t\totherChildren.push(child);\n\t\t\t}\n\t\t});\n\t\tsuper.addChildren(otherChildren);\n\t\t\n\t\tlet invalidPropertiesCount = 0;\n\t\t\n\t\t// Make sure Properties have a PropertyType. They don't work without it.\n\t\tpropChildren.filter(prop => !prop.propertyType).forEach(prop => {\n\t\t\tif (!this.constructor._propertyTypesByName[prop.name]) {\n\t\t\t\tconsole.log('Property of that name not defined', this.id, prop.name, this);\n\t\t\t\tinvalidPropertiesCount++;\n\t\t\t\tprop.isInvalid = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprop.setPropertyType(this.constructor._propertyTypesByName[prop.name]);\n\t\t});\n\t\tif (invalidPropertiesCount)\n\t\t\tpropChildren = propChildren.filter(p => !p.isInvalid);\n\t\t\n\t\t// Make sure all PropertyTypes have a matching Property\n\t\tlet nameToProp = {};\n\t\tpropChildren.forEach(c => nameToProp[c.name] = c);\n\t\tthis.constructor._propertyTypes.forEach(propertyType => {\n\t\t\tif (!nameToProp[propertyType.name])\n\t\t\t\tpropChildren.push(propertyType.createProperty());\n\t\t});\n\t\t\n\t\tsuper.addChildren(propChildren);\n\t};\n\taddChild(child) {\n\t\tassert(this._state & Serializable.STATE_INIT, this.constructor.componentName || this.constructor + ' requires that initWithChildren will be called before addChild');\n\t\tsuper.addChild(child);\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!child.propertyType) {\n\t\t\t\tif (!this.constructor._propertyTypesByName[child.name]) {\n\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tchild.setPropertyType(this.constructor._propertyTypesByName[child.name]);\n\t\t\t}\n\t\t\tassert(this._properties[child.propertyType.name] === undefined, 'Property already added');\n\t\t\tthis._properties[child.propertyType.name] = child;\n\t\t}\n\t};\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\t\tthis._properties = {};\n\t\treturn true;\n\t}\n\t// idx is optional\n\tdeleteChild(child, idx) {\n\t\tassert(child.threeLetterType !== 'prp', 'Can not delete just one Property child.');\n\t\tsuper.deleteChild(child, idx);\n\t}\n}\n\nPropertyOwner.defineProperties = function(Class, propertyTypes) {\n\tClass._propertyTypes = propertyTypes;\n\tClass._propertyTypesByName = {};\n\tpropertyTypes.forEach(propertyType => {\n\t\tassert(Class.prototype[propertyType.name] === undefined, 'Property name ' + propertyType.name + ' clashes');\n\t\tClass._propertyTypesByName[propertyType.name] = propertyType;\n\t\tObject.defineProperty(Class.prototype, propertyType.name, {\n\t\t\tget() {\n\t\t\t\treturn this._properties[propertyType.name].value;\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis._properties[propertyType.name].value = value;\n\t\t\t}\n\t\t});\n\t});\n};\n","import Serializable from './serializable';\nimport assert from '../util/assert';\n\nconst ALIVE_ERROR = 'entity is already dead';\n\nexport default class Entity extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\t\tthis.components = new Map(); // name -> array\n\t\tthis.sleeping = false;\n\t\tthis.prototype = null; // should be set immediately after constructor\n\t\tthis.localMaster = true; // set false if entity is controlled over the net\n\t}\n\n\t// Get the first component of given name\n\tgetComponent(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tlet components = this.components.get(name);\n\t\tif (components !== undefined)\n\t\t\treturn components[0];\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// Get all components with given name\n\tgetComponents(name) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\treturn this.components.get(name) || [];\n\t}\n\t\n\tgetListOfAllComponents() {\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value);\n\t\t});\n\t\treturn components;\n\t}\n\t\n\tclone() {\n\t\tlet entity = new Entity();\n\t\tentity.prototype = this.prototype.clone();\n\t\tentity.sleeping = this.sleeping;\n\t\tlet components = [];\n\t\tthis.components.forEach((value, key) => {\n\t\t\tcomponents.push(...value.map(c => c.clone()));\n\t\t});\n\t\tentity.addComponents(components);\n\t\treturn entity;\n\t}\n\n\t/*\n\tAdds multiple components as an array to this Entity.\n\tUses addComponent internally.\n\tInitializes components after all components are added.\n\t*/\n\taddComponents(components) {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tassert(Array.isArray(components), 'Parameter is not an array.');\n\n\t\tfor (let i = 0; i < components.length; i++) {\n\t\t\tlet componentList = this.components.get(components[i]._name) || this.components.set(components[i]._name, []).get(components[i]._name);\n\t\t\tcomponentList.push(components[i]);\n\t\t\tcomponents[i].entity = this;\n\t\t\tcomponents[i]._parent = this;\n\t\t}\n\t\t\n\t\tif (!this.sleeping)\n\t\t\tEntity.initComponents(components);\n\t\treturn this;\n\t}\n\tstatic initComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._preInit();\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._init();\n\t}\n\tstatic makeComponentsSleep(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i]._sleep();\n\t}\n\tstatic deleteComponents(components) {\n\t\tfor (let i = 0; i < components.length; i++)\n\t\t\tcomponents[i].delete();\n\t}\n\tsleep() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (this.sleeping) return false;\n\t\t\n\t\tthis.components.forEach((value, key) => Entity.makeComponentsSleep(value));\n\t\t\n\t\tthis.sleeping = true;\n\t\treturn true;\n\t}\n\twakeUp() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tif (!this.sleeping) return false;\n\n\t\tthis.components.forEach((value, key) => Entity.initComponents(value));\n\n\t\tthis.sleeping = false;\n\t\treturn true;\n\t}\n\tdelete() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\tthis.sleep();\n\t\tif (!super.delete()) return false;\n\t\t\n\t\tthis.components.forEach((value, key) => Entity.deleteComponents(value));\n\t\tthis.components.clear();\n\t\t\n\t\treturn true;\n\t}\n\tdeleteComponent(component) {\n\t\tlet array = this.getComponents(component.constructor.componentName);\n\t\tlet idx = array.indexOf(component);\n\t\tassert(idx >= 0);\n\t\tif (!this.sleeping)\n\t\t\tcomponent._sleep();\n\t\tcomponent.delete();\n\t\tarray.splice(idx, 1);\n\t\treturn this;\n\t}\n\tsetInTreeStatus(isInTree) {\n\t\tif (this._isInTree === isInTree)\n\t\t\treturn;\n\n\t\tthis._isInTree = isInTree;\n\t\tthis.components.forEach((value, key) => {\n\t\t\tvalue.forEach(component => component.setInTreeStatus(isInTree));\n\t\t});\n\t}\n\ttoJSON() {\n\t\tassert(this._alive, ALIVE_ERROR);\n\t\t\n\t\tlet components = [];\n\t\tthis.components.forEach(compArray => {\n\t\t\tcompArray.forEach(comp => {\n\t\t\t\tcomponents.push(comp.toJSON());\n\t\t\t});\n\t\t});\n\t\t\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tcomp: components,\n\t\t\tproto: this.prototype.id\n\t\t});\n\t}\n}\nObject.defineProperty(Entity.prototype, 'position', {\n\tget() {\n\t\treturn this.getComponent('Transform').position;\n\t},\n\tset(position) {\n\t\tthis.getComponent('Transform').position = position;\n\t}\n});\n\nSerializable.registerSerializable(Entity, 'ent', json => {\n\tconsole.log('creating entity from json', json);\n\tlet entity = new Entity(json.id);\n\tentity.prototype = getSerializable(json.proto);\n\tconsole.log('created entity from json', entity);\n\tif (json.comp) {\n\t\tentity.addComponents(json.comp.map(Serializable.fromJSON));\n\t}\n\treturn entity;\n});\n","import Serializable, { createStringId } from './serializable';\nimport assert from '../util/assert';\nimport { componentClasses, Component } from './component';\nimport { isClient } from '../util/environment';\n\nexport default class ComponentData extends Serializable {\n\tconstructor(componentClassName, predefinedId = false, predefinedComponentId = false) {\n\t\tthis.name = componentClassName;\n\t\tthis.componentClass = componentClasses.get(this.name);\n\t\tassert(this.componentClass, 'Component class not defined: ' + componentClassName);\n\t\tsuper(predefinedId);\n\t\tif (!this.componentClass.allowMultiple)\n\t\t\tpredefinedComponentId = '_' + componentClassName;\n\t\tthis.componentId = predefinedComponentId || createStringId('cid', 10); // what will be the id of component created from this componentData\n\t}\n\taddChild(child) {\n\t\tif (child.threeLetterType === 'prp') {\n\t\t\tif (!child.propertyType) {\n\t\t\t\tif (!this.componentClass._propertyTypesByName[child.name]) {\n\t\t\t\t\tif (isClient)\n\t\t\t\t\t\tconsole.log('Property of that name not defined', this.id, child, this);\n\t\t\t\t\telse\n\t\t\t\t\t\tconsole.log('Property of that name not defined', this.id, this.name, child.name);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tchild.setPropertyType(this.componentClass._propertyTypesByName[child.name]);\n\t\t\t}\n\t\t}\n\t\tsuper.addChild(child);\n\t\treturn this;\n\t};\n\tclone(options) {\n\t\tlet newComponentId = (options && options.cloneComponentId) ? this.componentId : false;\n\t\tlet obj = new ComponentData(this.name, false, newComponentId);\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tchildren.push(child.clone());\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tcid: this.componentId,\n\t\t\tn: this.name\n\t\t});\n\t}\n\t/*\n\tReturns a list of Properties.\n\tThose which don't have an id are temporary properties generated from parents.\n\tDon't set _depth.\n\t */\n\tgetInheritedProperties(_depth = 0) {\n\t\tlet properties = {};\n\n\t\t// properties from parent\n\t\tlet parentComponentData = this.getParentComponentData();\n\t\tif (parentComponentData)\n\t\t\tparentComponentData.getInheritedProperties(_depth + 1).forEach(prop => properties[prop.name] = prop);\n\t\t\n\t\t// properties from this. override properties of parents\n\t\tthis.getChildren('prp').forEach(prop => {\n\t\t\tif (_depth === 0)\n\t\t\t\tproperties[prop.name] = prop;\n\t\t\telse\n\t\t\t\tproperties[prop.name] = prop.clone(true);\n\t\t});\n\t\t\n\t\t// fill from propertyType\n\t\tif (_depth === 0) {\n\t\t\treturn this.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\treturn properties[propertyType.name] || propertyType.createProperty({\n\t\t\t\t\tskipSerializableRegistering: true\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn Object.keys(properties).map(key => properties[key]);\n\t\t}\n\t}\n\tgetParentComponentData() {\n\t\tif (!this._parent) return null;\n\t\tlet parentPrototype = this._parent.getParentPrototype();\n\t\twhile (parentPrototype) {\n\t\t\tlet parentComponentData = parentPrototype.findChild('cda', componentData => componentData.componentId === this.componentId);\n\t\t\tif (parentComponentData)\n\t\t\t\treturn parentComponentData;\n\t\t\telse\n\t\t\t\tparentPrototype = parentPrototype.getParentPrototype();\n\t\t}\n\t\treturn null;\n\t}\n\tgetPropertyOrCreate(name) {\n\t\tlet property = this.findChild('prp', prp => prp.name === name);\n\t\tif (!property) {\n\t\t\tproperty = this.componentClass._propertyTypesByName[name].createProperty();\n\t\t\tthis.addChild(property);\n\t\t}\n\t\treturn property;\n\t}\n\tgetProperty(name) {\n\t\treturn this.findChild('prp', prp => prp.name === name);\n\t}\n\tsetValue(propertyName, value) {\n\t\tthis.getPropertyOrCreate(propertyName).value = value;\n\t\treturn this;\n\t}\n\tgetValue(name) {\n\t\tlet property = this.getProperty(name);\n\t\tif (property)\n\t\t\treturn property.value;\n\t\tlet parent = this.getParentComponentData();\n\t\t\n\t\tif (parent)\n\t\t\treturn parent.getValue(name);\n\t\t\n\t\treturn this.componentClass._propertyTypesByName[name].initialValue;\n\t}\n\tcreateComponent() {\n\t\tlet properties = this.getInheritedProperties();\n\t\tlet values = {};\n\t\tproperties.forEach(prop => {\n\t\t\tvalues[prop.name] = prop.value;\n\t\t});\n\t\tlet component = Component.create(this.name, values);\n\t\tcomponent._componentId = this.componentId;\n\t\treturn component;\n\t}\n}\nSerializable.registerSerializable(ComponentData, 'cda', json => {\n\treturn new ComponentData(json.n, json.id, json.cid);\n});\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport { getSerializable } from './serializableManager';\nimport Prop from './propertyType';\nimport PropertyOwner from './propertyOwner';\nimport ComponentData from './componentData';\nimport Entity from './entity';\nimport { game } from './game';\nimport { Component } from './component';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Prototype extends PropertyOwner {\n\tconstructor() {\n\t\tsuper(...arguments);\n\t\t\n\t\tthis.previouslyCreatedEntity = null;\n\t}\n\t\n\taddChild(child) {\n\t\tif (child.threeLetterType === 'cda' && !child.componentClass.allowMultiple)\n\t\t\tassert(this.findChild('cda', cda => cda.componentId === child.componentId) === null, `Can't have multiple ${child.name} components. See Component.allowMultiple`);\n\t\tsuper.addChild(child);\n\t}\n\tgetParentPrototype() {\n\t\treturn this._parent && this._parent.threeLetterType === 'prt' ? this._parent : null;\n\t}\n\t\n\t/*\n\tReturns JSON:\n\t[\n\t\t{\n\t\t\townComponent: false, // component of a parent prototype\n\t\t\tcomponentClass: [object Object],\n\t\t\tcomponentId: <componentId>,\n\t\t\tthreeLetterType: 'icd',\n\t \t\tgeneratedForPrototype: <this>,\n\t\t\tproperties: [\n\t\t\t\t{ id missing }\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t ownComponentData: <ComponentData> || null, // null if this prototype has 0 properties defined\n\t\t\t componentClass: [object Object],\n\t\t\t componentId: <componentId>,\n\t\t\t threeLetterType: 'icd',\n\t\t\t generatedForPrototype: <this>,\n\t\t\t properties: [\n\t\t\t \t{ id found if own property } // some properties might be from parent prototypes and thus missing id\n\t\t\t ]\n\t\t }\n\t]\n\t */\n\tgetInheritedComponentDatas(filter = null) {\n\t\tlet originalPrototype = this;\n\t\t\n\t\tfunction getDataFromPrototype(prototype, _depth = 0) {\n\t\t\tlet data;\n\t\t\t\n\t\t\tlet parentPrototype = prototype.getParentPrototype();\n\t\t\tif (parentPrototype)\n\t\t\t\tdata = getDataFromPrototype(parentPrototype, _depth + 1);\n\t\t\telse\n\t\t\t\tdata = {}; // Top level\n\t\t\t\n\t\t\tlet componentDatas = prototype.getChildren('cda');\n\t\t\tcomponentDatas.forEach(componentData => {\n\t\t\t\tif (filter && !filter(componentData))\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\tif (!data[componentData.componentId]) {\n\t\t\t\t\t// Most parent version of this componentId\n\t\t\t\t\tdata[componentData.componentId] = {\n\t\t\t\t\t\t// ownComponent = true if the original prototype is the first one introducing this componentId\n\t\t\t\t\t\townComponentData: null, // will be given value if original prototype has this componentId\n\t\t\t\t\t\tcomponentClass: componentData.componentClass,\n\t\t\t\t\t\tcomponentId: componentData.componentId,\n\t\t\t\t\t\tpropertyHash: {},\n\t\t\t\t\t\tthreeLetterType: 'icd',\n\t\t\t\t\t\tgeneratedForPrototype: originalPrototype\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (_depth === 0) {\n\t\t\t\t\tdata[componentData.componentId].ownComponentData = componentData;\n\t\t\t\t}\n\n\t\t\t\tcomponentData.getChildren('prp').forEach(property => {\n\t\t\t\t\t// Newest version of a property always overrides old property\n\t\t\t\t\tdata[componentData.componentId].propertyHash[property.name] = _depth === 0 ? property : property.clone(true);\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\treturn data;\n\t\t}\n\n\t\tlet data = getDataFromPrototype(this);\n\t\tlet array = Object.keys(data).map(key => data[key]);\n\t\tarray.forEach(inheritedComponentData => {\n\t\t\tinheritedComponentData.properties = inheritedComponentData.componentClass._propertyTypes.map(propertyType => {\n\t\t\t\tif (inheritedComponentData.propertyHash[propertyType.name])\n\t\t\t\t\treturn inheritedComponentData.propertyHash[propertyType.name];\n\t\t\t\telse\n\t\t\t\t\treturn propertyType.createProperty({ skipSerializableRegistering: true });\n\t\t\t});\n\t\t\tdelete inheritedComponentData.propertyHash;\n\t\t});\n\t\t\n\t\tarray.forEach(inheritedComponentData => {\n\t\t\tlet cid = inheritedComponentData.componentId;\n\t\t});\n\n\t\treturn array.sort((a, b) => a.componentClass.componentName.localeCompare(b.componentClass.componentName));\n\t}\n\t\n\tcreateAndAddPropertyForComponentData(inheritedComponentData, propertyName, propertyValue) {\n\t\tlet propertyType = inheritedComponentData.componentClass._propertyTypesByName[propertyName];\n\t\tassert(propertyType, 'Invalid propertyName', propertyName, inheritedComponentData);\n\t\tlet componentData = this.findChild('cda', componentData => componentData.componentId === inheritedComponentData.componentId);\n\t\tlet componentDataIsNew = false;\n\t\tif (!componentData) {\n\t\t\tconsole.log('no component data. create one', this, inheritedComponentData);\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.componentClass.componentName, false, inheritedComponentData.componentId);\n\t\t\tcomponentDataIsNew = true;\n\t\t}\n\t\tlet property = componentData.findChild('prp', property => property.name === propertyName);\n\t\tif (property) {\n\t\t\tproperty.value = propertyValue;\n\t\t\treturn property;\n\t\t}\n\n\t\tproperty = propertyType.createProperty({\n\t\t\tvalue: propertyValue,\n\t\t});\n\t\tcomponentData.addChild(property);\n\t\t\n\t\tif (componentDataIsNew)\n\t\t\tthis.addChild(componentData);\n\t\t\n\t\treturn property;\n\t}\n\t\n\tfindComponentDataByComponentId(componentId, alsoFindFromParents = false) {\n\t\tlet child = this.findChild('cda', componentData => componentData.componentId === componentId);\n\t\tif (child)\n\t\t\treturn child;\n\t\tif (alsoFindFromParents) {\n\t\t\tlet parent = this.getParentPrototype();\n\t\t\tif (parent)\n\t\t\t\treturn parent.findComponentDataByComponentId(componentId, alsoFindFromParents);\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tgetOwnComponentDataOrInherit(componentId) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, false);\n\t\tif (!componentData) {\n\t\t\tlet inheritedComponentData = this.findComponentDataByComponentId(componentId, true);\n\t\t\tif (!inheritedComponentData)\n\t\t\t\treturn null;\n\t\t\t\n\t\t\tcomponentData = new ComponentData(inheritedComponentData.name, false, componentId);\n\t\t\tthis.addChild(componentData);\n\t\t}\n\t\treturn componentData\n\t}\n\t\n\tfindOwnProperty(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId);\n\t\tif (componentData) {\n\t\t\treturn componentData.getProperty(propertyName);\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tcreateEntity() {\n\t\tlet entity = new Entity();\n\t\tlet inheritedComponentDatas = this.getInheritedComponentDatas();\n\t\tlet components = inheritedComponentDatas.map(Component.createWithInheritedComponentData);\n\t\tentity.addComponents(components);\n\t\tentity.prototype = this;\n\t\t\n\t\tthis.previouslyCreatedEntity = entity;\n\t\treturn entity;\n\t}\n\t\n\tgetValue(componentId, propertyName) {\n\t\tlet componentData = this.findComponentDataByComponentId(componentId, true);\n\t\tif (componentData)\n\t\t\treturn componentData.getValue(propertyName);\n\t\telse\n\t\t\treturn undefined;\n\t}\n\t\n\tcountEntityPrototypes(findParents = false) {\n\t\tif (this.threeLetterType !== 'prt')\n\t\t\treturn 0;\n\t\t\n\t\tlet count = 0;\n\t\tlet levels = game.getChildren('lvl');\n\t\tfor (let i = levels.length-1; i >= 0; i--) {\n\t\t\tlet entityPrototypes = levels[i].getChildren('epr');\n\t\t\tfor (let j = entityPrototypes.length-1; j >= 0; j--) {\n\t\t\t\tif (entityPrototypes[j].prototype === this)\n\t\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (findParents)\n\t\t\tthis.forEachChild('prt', prt => count += prt.countEntityPrototypes(true));\n\t\t\n\t\treturn count;\n\t}\n\t\n\tdelete() {\n\t\tthis._game = this._game || this.getRoot();\n\t\tif (!super.delete()) return false;\n\t\tif (this.threeLetterType === 'prt') {\n\t\t\tthis._game.forEachChild('lvl', lvl => {\n\t\t\t\tlet items = lvl.getChildren('epr');\n\t\t\t\tfor (let i = items.length-1; i >= 0; i--) {\n\t\t\t\t\tif (items[i].prototype === this) {\n\t\t\t\t\t\tlvl.deleteChild(items[i], i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.previouslyCreatedEntity = null;\n\t\treturn true;\n\t}\n}\nPropertyOwner.defineProperties(Prototype, propertyTypes);\n\nPrototype.create = function(name) {\n\treturn new Prototype().initWithPropertyValues({ name: name });\n};\n\nSerializable.registerSerializable(Prototype, 'prt');\n","import Serializable from './serializable'\nimport { addChange, changeType, setChangeOrigin } from './serializableManager';\nimport Prototype from '../core/prototype'\nimport assert from '../util/assert'\nimport PropertyOwner, { Prop } from '../core/propertyOwner';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nlet game = null; // only one game at the time\nexport { game };\n\nlet isClient = typeof window !== 'undefined';\n\nexport default class Game extends PropertyOwner {\n\tconstructor(predefinedId) {\n\t\tif (isClient) {\n\t\t\tif (game) {\n\t\t\t\ttry {\n\t\t\t\t\tgame.delete();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Deleting old game failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tgame = this;\n\t\t}\n\t\t\n\t\tif (predefinedId)\n\t\t\tconsole.log('game import');\n\t\telse\n\t\t\tconsole.log('game created');\n\t\t\n\t\tsuper(...arguments);\n\t}\n\tinitWithChildren() {\n\t\tsuper.initWithChildren(...arguments);\n\t\taddChange(changeType.addSerializableToTree, this);\n\t}\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\t\t\n\t\tif (game === this)\n\t\t\tgame = null;\n\t\tconsole.log('game.delete');\n\t\t\n\t\treturn true;\n\t}\n}\nPropertyOwner.defineProperties(Game, propertyTypes);\n\nGame.prototype.isRoot = true;\n\nSerializable.registerSerializable(Game, 'gam');\n","import Serializable from './serializable';\nimport Entity from './entity';\nimport assert from '../util/assert';\nimport { game } from './game';\nimport { addChange, changeType, setChangeOrigin } from './serializableManager';\nimport { isClient } from '../util/environment';\n\n// import { createWorld, deleteWorld, updateWorld } from '../feature/physicsMatter';\n// import { createWorld, deleteWorld, updateWorld } from '../feature/physicsJs';\nimport { createWorld, deleteWorld, updateWorld } from '../feature/physicsP2';\n\nlet scene = null;\nexport { scene };\n\nconst physicsOptions = {\n\tenableSleeping: true\n};\n\nexport default class Scene extends Serializable {\n\tconstructor(predefinedId = false) {\n\t\tif (isClient) {\n\t\t\tif (scene) {\n\t\t\t\ttry {\n\t\t\t\t\tscene.delete();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Deleting old scene failed', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tscene = this;\n\t\t\t\n\t\t\tthis.canvas = document.querySelector('canvas.anotherCanvas');\n\t\t\tthis.context = this.canvas.getContext('2d');\n\t\t}\n\t\tthis.level = null;\n\t\t\n\t\t// To make component based entity search fast:\n\t\tthis.components = new Map(); // componentName -> Set of components\n\t\t\n\t\tthis.animationFrameId = null;\n\t\tthis.playing = false;\n\t\tthis.time = 0;\n\t\t\n\t\tsuper(predefinedId);\n\t\taddChange(changeType.addSerializableToTree, this);\n\n\t\tif (predefinedId)\n\t\t\tconsole.log('scene import');\n\t\telse\n\t\t\tconsole.log('scene created');\n\n\t\tcreateWorld(this, physicsOptions);\n\t\t\n\t\tthis.draw();\n\t}\n\twin() {\n\t\tsetTimeout(() => {\n\t\t\tsetChangeOrigin(this);\n\t\t\tthis.reset();\n\t\t\tgame.dispatch('levelCompleted');\n\t\t})\n\t}\n\tanimFrame(playCalled) {\n\t\tthis.animationFrameId = null;\n\t\tif (!this._alive || !this.playing) return;\n\t\t\n\t\tlet timeInMilliseconds = performance.now();\n\t\tlet t = 0.001*timeInMilliseconds;\n\t\tlet dt = t-this._prevUpdate;\n\t\tif (dt > 0.05)\n\t\t\tdt = 0.05;\n\t\tthis._prevUpdate = t;\n\t\tthis.time += dt;\n\n\t\tsetChangeOrigin(this);\n\t\t\n\t\tthis.dispatch('onUpdate', dt, this.time);\n\t\tupdateWorld(this, dt, timeInMilliseconds);\n\t\tthis.draw();\n\t\t\n\t\tthis.requestAnimFrame();\n\t}\n\trequestAnimFrame() {\n\t\tthis.animationFrameId = window.requestAnimationFrame(() => this.animFrame());\n\t}\n\tdraw() {\n\t\tthis.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\t\tthis.dispatch('onDraw', this.context);\n\t}\n\tisInInitialState() {\n\t\treturn !this.playing && this.time === 0;\n\t}\n\treset() {\n\t\tthis.resetting = true;\n\t\tthis.pause();\n\t\tthis.deleteChildren();\n\n\t\tdeleteWorld(this);\n\t\tcreateWorld(this, physicsOptions);\n\t\t\n\t\tif (this.level)\n\t\t\tthis.level.createScene(this);\n\t\t\n\t\tthis.time = 0;\n\t\tthis.draw();\n\t\tdelete this.resetting;\n\t}\n\tpause() {\n\t\tif (!this.playing) return;\n\t\t\n\t\tthis.playing = false;\n\t\tif (this.animationFrameId)\n\t\t\twindow.cancelAnimationFrame(this.animationFrameId);\n\t\tthis.animationFrameId = null;\n\t}\n\tplay() {\n\t\tif (this.playing) return;\n\t\t\n\t\tthis._prevUpdate = 0.001*performance.now();\n\t\tthis.playing = true;\n\t\t\n\t\tthis.requestAnimFrame();\n\t\t\n\t\t\n\t\tif (this.time === 0)\n\t\t\tthis.dispatch('onStart');\n\t\t\n\t\t/*\n\t\tlet player = game.findChild('prt', p => p.name === 'Player', true);\n\t\tif (player) {\n\t\t\tconsole.log('Spawning player!', player);\n\t\t\tthis.spawn(player);\n\t\t}\n\t\t*/\n\t}\n\tdelete() {\n\t\tif (!super.delete()) return false;\n\n\t\tdeleteWorld(this);\n\t\t\n\t\tif (scene === this)\n\t\t\tscene = null;\n\t\t\n\t\tconsole.log('scene.delete');\n\t\treturn true;\n\t}\n\n\t// To make component based entity search fast:\n\taddComponent(component) {\n\t\tlet set = this.components.get(component.constructor.componentName);\n\t\tif (!set) {\n\t\t\tset = new Set();\n\t\t\tthis.components.set(component.constructor.componentName, set);\n\t\t}\n\t\tset.add(component);\n\t}\n\tremoveComponent(component) {\n\t\tlet set = this.components.get(component.constructor.componentName);\n\t\tassert(set);\n\t\tassert(set.delete(component));\n\t}\n\tgetComponents(componentName) {\n\t\treturn this.components.get(componentName) || new Set;\n\t}\n}\nScene.prototype.isRoot = true;\n\nSerializable.registerSerializable(Scene, 'sce');\n","import Serializable from './serializable';\nimport assert from '../util/assert';\nimport Property from './property';\nimport PropertyOwner from './propertyOwner';\nimport { scene } from './scene';\nimport { game } from './game';\nexport { default as Prop } from './propertyType';\nexport let componentClasses = new Map();\nimport ComponentData from './componentData';\n\n// Instance of a component, see componentExample.js\nexport class Component extends PropertyOwner {\n\tconstructor(predefinedId = false) {\n\t\tsuper(predefinedId);\n\t\tthis._componentId = null; // Creator will fill this\n\t\tthis.scene = scene;\n\t\tthis.game = game;\n\t\tthis._listenRemoveFunctions = [];\n\t\tthis.entity = null;\n\t}\n\tdelete() {\n\t\t// Component.delete never returns false because entity doesn't have components as children\n\t\tthis._parent = null;\n\t\tthis.entity = null;\n\t\tsuper.delete();\n\t\treturn true;\n\t}\n\t_preInit() {\n\t\tthis.constructor.requirements.forEach(r => {\n\t\t\tthis[r] = this.entity.getComponent(r);\n\t\t\tassert(this[r], `${this.constructor.componentName} requires component ${r} but it is not found`);\n\t\t});\n\n\t\tthis.forEachChild('com', c => c._preInit());\n\t\t\n\t\t['onUpdate', 'onDraw', 'onDrawHelper', 'onStart'].forEach(funcName => {\n\t\t\tif (typeof this[funcName] === 'function') {\n\t\t\t\t// console.log('listen ' + funcName);\n\t\t\t\tthis._listenRemoveFunctions.push(this.scene.listen(funcName, (...args) => this[funcName](...args)));\n\t\t\t}\n\t\t});\n\n\t\tif (this.constructor.componentName !== 'Transform')\n\t\t\tthis.scene.addComponent(this);\n\t\t\n\t\ttry {\n\t\t\tif (typeof this.preInit === 'function')\n\t\t\t\tthis.preInit();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'preInit', e);\n\t\t}\n\t}\n\t_init() {\n\t\tthis.forEachChild('com', c => c._init());\n\t\ttry {\n\t\t\tif (typeof this.init === 'function')\n\t\t\t\tthis.init();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'init', e);\n\t\t}\n\t}\n\t_sleep() {\n\t\ttry {\n\t\t\tif (typeof this.sleep === 'function')\n\t\t\t\tthis.sleep();\n\t\t} catch(e) {\n\t\t\tconsole.error(this.entity, this.constructor.componentName, 'sleep', e);\n\t\t}\n\n\t\tif (this.constructor.componentName !== 'Transform')\n\t\t\tthis.scene.removeComponent(this);\n\t\t\n\t\tthis.forEachChild('com', c => c._sleep());\n\t\t// console.log(`remove ${this._listenRemoveFunctions.length} listeners`);\n\t\tthis._listenRemoveFunctions.forEach(f => f());\n\t\tthis._listenRemoveFunctions.length = 0;\n\t}\n\tlistenProperty(component, propertyName, callback) {\n\t\tthis._listenRemoveFunctions.push(component._properties[propertyName].listen('change', callback));\n\t}\n\tcreateComponentData() {\n\t\tlet componentName = this.constructor.componentName;\n\t\tlet propertyTypes = this.constructor._propertyTypes;\n\t\tlet componentData = new ComponentData(componentName);\n\t\tlet children = [];\n\t\tpropertyTypes.forEach(pt => {\n\t\t\tchildren.push(pt.createProperty({\n\t\t\t\tvalue: this[pt.name]\n\t\t\t}));\n\t\t});\n\t\tcomponentData.initWithChildren(children);\n\t\treturn componentData;\n\t}\n\ttoJSON() {\n\t\treturn Object.assign(super.toJSON(), {\n\t\t\tn: this.constructor.componentName,\n\t\t\tcid: this._componentId\n\t\t});\n\t}\n}\nComponent.create = function(name, values = {}) {\n\tlet componentClass = componentClasses.get(name);\n\tassert(componentClass);\n\tlet component = new componentClass();\n\tcomponent.initWithPropertyValues(values);\n\treturn component;\n};\nComponent.createWithInheritedComponentData = function(inheritedComponentData) {\n\tlet component = new inheritedComponentData.componentClass;\n\tcomponent._componentId = inheritedComponentData.componentId;\n\tlet properties = inheritedComponentData.properties.map(p => p.clone());\n\tcomponent.initWithChildren(properties);\n\treturn component;\n};\n\nComponent.reservedPropertyNames = new Set(['id', 'constructor', 'delete', 'children', 'entity', 'env', 'init', 'preInit', 'sleep', 'toJSON', 'fromJSON']);\nComponent.reservedPrototypeMembers = new Set(['id', 'children', 'entity', 'env', '_preInit', '_init', '_sleep', '_forEachChildComponent', '_properties', '_componentData', 'toJSON', 'fromJSON']);\nComponent.register = function({\n\tname = '', // required\n\tdescription = '',\n\tcategory = 'Other',\n\ticon = 'fa-puzzle-piece', // in editor\n\tcolor = '', // in editor\n\tproperties = [],\n\trequirements = ['Transform'],\n\tchildren = [],\n\tparentClass = Component,\n\tprototype = {},\n\tallowMultiple = true,\n\trequiesInitWhenEntityIsEdited = false\n}) {\n\tassert(name, 'Component must have a name.');\n\tassert(name[0] >= 'A' && name[0] <= 'Z', 'Component name must start with capital letter.');\n\tassert(!componentClasses.has(name), 'Duplicate component class ' + name);\n\tObject.keys(prototype).forEach(k => {\n\t\tif (Component.reservedPrototypeMembers.has(k))\n\t\t\tassert(false, 'Component prototype can not have a reserved member: ' + k);\n\t});\n\t\n\tlet constructorFunction = prototype.constructor;\n\tlet deleteFunction = prototype.delete;\n\tdelete prototype.constructor;\n\tdelete prototype.delete;\n\tclass Com extends parentClass {\n\t\tconstructor() {\n\t\t\tsuper(...arguments);\n\t\t\tif (constructorFunction)\n\t\t\t\tconstructorFunction();\n\t\t}\n\t\tdelete() {\n\t\t\tif (!super.delete()) return false;\n\t\t\t\n\t\t\tif (deleteFunction)\n\t\t\t\tdeleteFunction();\n\t\t\t\n\t\t\treturn true;\n\t\t}\n\t}\n\tproperties.forEach(p => {\n\t\tassert(!Component.reservedPropertyNames.has(p.name), 'Can not have property called ' + p.name);\n\t});\n\tPropertyOwner.defineProperties(Com, properties); // properties means propertyTypes here\n\tCom.componentName = name;\n\tCom.category = category;\n\tif (requirements.indexOf('Transform') < 0) requirements.push('Transform');\n\tCom.requirements = requirements;\n\tCom.children = children;\n\tCom.description = description;\n\tCom.allowMultiple = allowMultiple;\n\tCom.icon = icon;\n\t\n\tlet num = name.split('').reduce((prev, curr) => prev + curr.charCodeAt(0), 0);\n\tCom.color = color || `hsla(${ num % 360 }, 40%, 60%, 1)`;\n\n\tprototype._name = name;\n\tObject.assign(Com.prototype, prototype);\n\tcomponentClasses.set(Com.componentName, Com);\n\treturn Com;\n};\n\nSerializable.registerSerializable(Component, 'com', json => {\n\tlet component = new (componentClasses.get(json.n))(json.id);\n\tcomponent._componentId = json.cid || null;\n\treturn component;\n});\n","import Prototype from './prototype';\nimport Property from './property';\nimport Serializable from './serializable';\nimport { getSerializable } from './serializableManager';\nimport { Prop, componentClasses } from './component';\nimport ComponentData from './componentData';\nimport { scene } from './scene';\nimport assert from '../util/assert';\nimport Vector from '../util/vector';\n\n// EntityPrototype is a prototype that always has one Transform ComponentData and optionally other ComponentDatas also.\n// Entities are created based on EntityPrototypes\nexport default class EntityPrototype extends Prototype {\n\tconstructor(predefinedId = false) {\n\t\tsuper(...arguments);\n\t\t// this._parent is level, not prototype. We need a link to parent-prototype.\n\t\tthis.prototype = null;\n\t}\n\tgetTransform() {\n\t\treturn this.findChild('cda', cda => cda.name === 'Transform');\n\t}\n\tgetParentPrototype() {\n\t\treturn this.prototype;\n\t}\n\tclone() {\n\t\tlet obj = new EntityPrototype();\n\t\tobj.prototype = this.prototype;\n\t\tlet id = obj.id;\n\t\tlet children = [];\n\t\tthis.forEachChild(null, child => {\n\t\t\tif (child.threeLetterType === 'prp' && child.name === 'name') {\n\t\t\t\tlet property = new Property({\n\t\t\t\t\tvalue: child.propertyType.type.clone(child.value),\n\t\t\t\t\tname: child.name,\n\t\t\t\t\tpropertyType: this.propertyType,\n\t\t\t\t\tpredefinedId: id + '_n'\n\t\t\t\t});\n\t\t\t\tchildren.push(property);\n\t\t\t} else if (child.threeLetterType === 'cda' && child.name === 'Transform') {\n\t\t\t\tlet transform = new ComponentData('Transform', id + '_t');\n\n\t\t\t\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', prp => prp.name === 'position').value,\n\t\t\t\t\tpredefinedId: id + '_p'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(position);\n\n\t\t\t\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', prp => prp.name === 'scale').value,\n\t\t\t\t\tpredefinedId: id + '_s'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(scale);\n\n\t\t\t\tlet angle = transform.componentClass._propertyTypesByName.angle.createProperty({\n\t\t\t\t\tvalue: child.findChild('prp', prp => prp.name === 'angle').value,\n\t\t\t\t\tpredefinedId: id + '_r'\n\t\t\t\t});\n\t\t\t\ttransform.addChild(angle);\n\t\t\t\t\n\t\t\t\tchildren.push(transform);\n\t\t\t} else if (child.threeLetterType === 'cda') {\n\t\t\t\tchildren.push(child.clone({ cloneComponentId: true }));\n\t\t\t} else {\n\t\t\t\tchildren.push(child.clone());\n\t\t\t}\n\t\t});\n\t\tobj.initWithChildren(children);\n\t\tthis._state |= Serializable.STATE_CLONE;\n\t\treturn obj;\n\t}\n\ttoJSON() {\n\t\t// return super.toJSON();\n\t\t\n\t\t// Below optimization reduces size 88%. id's have to be generated based on this.id\n\t\t\n\t\tlet Transform = this.getTransform();\n\t\tlet json = {\n\t\t\tid: this.id,\n\t\t\tp: this.prototype.id\n\t\t};\n\t\t\n\t\tlet childArrays = [];\n\t\tthis._children.forEach(child => {\n\t\t\tchildArrays.push(child);\n\t\t});\n\t\tlet children = [].concat(...childArrays).filter(child => {\n\t\t\treturn child !== Transform && child !== this._properties.name;\n\t\t});\n\t\tif (children.length > 0)\n\t\t\tjson.c = children.map(child => child.toJSON());\n\t\t\n\t\tlet prototype = this.prototype;\n\t\t\n\t\tlet floatToJSON = Prop.float().toJSON;\n\t\tlet handleProperty = prp => {\n\t\t\tif (prp.name === 'name') {\n\t\t\t\tif (!prototype || prp.value !== prototype.name)\n\t\t\t\t\tjson.n = prp.value;\n\t\t\t} else if (prp.name === 'position') {\n\t\t\t\tjson.x = floatToJSON(prp.value.x);\n\t\t\t\tjson.y = floatToJSON(prp.value.y);\n\t\t\t} else if (prp.name === 'scale') {\n\t\t\t\tif (!prp.value.isEqualTo(new Vector(1, 1))) {\n\t\t\t\t\tjson.w = floatToJSON(prp.value.x);\n\t\t\t\t\tjson.h = floatToJSON(prp.value.y);\n\t\t\t\t}\n\t\t\t} else if (prp.name === 'angle') {\n\t\t\t\tif (prp.value !== 0)\n\t\t\t\t\tjson.a = floatToJSON(prp.value);\n\t\t\t}\n\t\t};\n\t\thandleProperty(this._properties.name);\n\n\t\tTransform.getChildren('prp').forEach(handleProperty);\n\t\treturn json;\n\t}\n\tspawnEntityToScene(position) {\n\t\tif (!scene)\n\t\t\treturn;\n\t\t\n\t\tif (position) {\n\t\t\tthis.getTransform().getPropertyOrCreate('position').value = position;\n\t\t}\n\t\t\n\t\tlet entity = this.createEntity();\n\t\tscene.addChild(entity);\n\t}\n}\nObject.defineProperty(EntityPrototype.prototype, 'position', {\n\tget() {\n\t\treturn this.getTransform().findChild('prp', prp => prp.name === 'position').value;\n\t},\n\tset(position) {\n\t\treturn this.getTransform().findChild('prp', prp => prp.name === 'position').value = position;\n\t}\n});\n\n// If Transform or Transform.position is missing, they are added.\nEntityPrototype.createFromPrototype = function(prototype, componentDatas = []) {\n\n\tlet entityPrototype = new EntityPrototype();\n\tentityPrototype.prototype = prototype;\n\tlet id = entityPrototype.id;\n\t\n\tassert(!componentDatas.find(cda => cda.name === 'Transform'), 'Prototype (prt) can not have a Transform component');\n\t\n\tlet transform = new ComponentData('Transform', id + '_t');\n\tcomponentDatas.push(transform);\n\t\n\tlet position = transform.componentClass._propertyTypesByName.position.createProperty({\n\t\tvalue: new Vector(0, 0),\n\t\tpredefinedId: id + '_p'\n\t});\n\ttransform.addChild(position);\n\n\tlet scale = transform.componentClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: new Vector(1, 1),\n\t\tpredefinedId: id + '_s'\n\t});\n\ttransform.addChild(scale);\n\n\tlet angle = transform.componentClass._propertyTypesByName.angle.createProperty({\n\t\tvalue: 0,\n\t\tpredefinedId: id + '_r'\n\t});\n\ttransform.addChild(angle);\n\n\tlet name = EntityPrototype._propertyTypesByName.name.createProperty({\n\t\tvalue: prototype.name,\n\t\tpredefinedId: id + '_n'\n\t});\n\t\n\tentityPrototype.initWithChildren([name, ...componentDatas])\n\n\treturn entityPrototype;\n};\n\nSerializable.registerSerializable(EntityPrototype, 'epr', json => {\n\tlet entityPrototype = new EntityPrototype(json.id);\n\tentityPrototype.prototype = getSerializable(json.p);\n\tassert(entityPrototype.prototype, `Prototype ${json.p} not found`);\n\t\n\tlet nameId = json.id + '_n';\n\tlet transformId = json.id + '_t';\n\tlet positionId = json.id + '_p';\n\tlet scaleId = json.id + '_s';\n\tlet angleId = json.id + '_r';\n\t\n\tlet name = Prototype._propertyTypesByName.name.createProperty({ \n\t\tvalue: json.n === undefined ? entityPrototype.prototype.name : json.n, \n\t\tpredefinedId: nameId \n\t});\n\t\n\tlet transformData = new ComponentData('Transform', transformId);\n\tlet transformClass = componentClasses.get('Transform');\n\t\n\tlet position = transformClass._propertyTypesByName.position.createProperty({\n\t\tvalue: new Vector(json.x, json.y),\n\t\tpredefinedId: positionId\n\t});\n\ttransformData.addChild(position);\n\n\tlet scale = transformClass._propertyTypesByName.scale.createProperty({\n\t\tvalue: new Vector(json.w === undefined ? 1 : json.w, json.h === undefined ? 1 : json.h),\n\t\tpredefinedId: scaleId\n\t});\n\ttransformData.addChild(scale);\n\n\tlet angle = transformClass._propertyTypesByName.angle.createProperty({\n\t\tvalue: json.a || 0,\n\t\tpredefinedId: angleId\n\t});\n\ttransformData.addChild(angle);\n\t\n\t\n\tentityPrototype.initWithChildren([name, transformData]);\n\treturn entityPrototype;\n});\n","import Serializable from './serializable';\nimport PropertyOwner, { Prop } from '../core/propertyOwner';\nimport Scene, { scene } from './scene';\n\nlet propertyTypes = [\n\tProp('name', 'No name', Prop.string)\n];\n\nexport default class Level extends PropertyOwner {\n\tconstructor(predefinedId) {\n\t\tsuper(...arguments);\n\n\t\tif (predefinedId)\n\t\t\tconsole.log('level import');\n\t\telse\n\t\t\tconsole.log('level created');\n\t}\n\tcreateScene(predefinedSceneObject = false) {\n\t\tif (!predefinedSceneObject)\n\t\t\tnew Scene();\n\t\tlet entities = this.getChildren('epr').map(epr => epr.createEntity());\n\t\tscene.addChildren(entities);\n\t\tscene.level = this;\n\t\treturn scene;\n\t}\n\t\n\t\n\t/*\n\tOPTIMIZATION DOES NOT WORK, YET\n\ttoJSON() {\n\t\tlet json = super.toJSON();\n\t\tconsole.log('before', json);\n\t\tif (json.c) {\n\t\t\tlet prototypeIds = new Set();\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tconsole.log('child', child);\n\t\t\t\tprototypeIds.add(child.p);\n\t\t\t});\n\t\t\t\n\t\t\tlet prototypeIdToNum = {};\n\t\t\tlet prototypeIdArray = [];\n\t\t\tlet num = 0;\n\t\t\tprototypeIds.forEach(key => {\n\t\t\t\tprototypeIdArray[num] = key;\n\t\t\t\tprototypeIdToNum[key] = num++;\n\t\t\t});\n\n\t\t\tjson.c.forEach(child => {\n\t\t\t\tchild.p = prototypeIdToNum[child.p] || child.p;\n\t\t\t});\n\t\t\t\n\t\t\tjson.p = prototypeIdArray;\n\n\t\t\tconsole.log(json, prototypeIds, prototypeIdToNum, prototypeIdArray);\n\t\t}\n\t\treturn json;\n\t}\n\t*/\n}\nPropertyOwner.defineProperties(Level, propertyTypes);\n\nSerializable.registerSerializable(Level, 'lvl');\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Transform',\n\tcategory: 'Core',\n\ticon: 'fa-dot-circle-o',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('position', new Vector(0, 0), Prop.vector),\n\t\tProp('scale', new Vector(1, 1), Prop.vector),\n\t\tProp('angle', 0, Prop.float, Prop.float.modulo(0, Math.PI * 2), Prop.flagDegreesInEditor)\n\t]\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'TransformVariance',\n\tcategory: 'Core',\n\ticon: 'fa-dot-circle-o',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('positionVariance', new Vector(0, 0), Prop.vector),\n\t\tProp('scaleVariance', new Vector(0, 0), Prop.vector),\n\t\tProp('angleVariance', 0, Prop.float, Prop.float.range(0, Math.PI), Prop.flagDegreesInEditor)\n\t],\n\tprototype: {\n\t\tonStart() {\n\t\t\tif (!this.positionVariance.isZero())\n\t\t\t\tthis.Transform.position = this.Transform.position.add(this.positionVariance.clone().multiplyScalar(-1 + 2 * Math.random()));\n\n\t\t\tif (!this.scaleVariance.isZero())\n\t\t\t\tthis.Transform.scale = this.Transform.scale.add(this.scaleVariance.clone().multiplyScalar(-1 + 2 * Math.random()));\n\t\t\t\n\t\t\tif (this.angleVariance)\n\t\t\t\tthis.Transform.angle += this.angleVariance * (-1 + 2 * Math.random());\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nlet vari = 0;\n\nComponent.register({\n\tname: 'Test',\n\tcategory: 'Core',\n\tproperties: [\n\t\tProp('name', 'Oh right', Prop.string),\n\t\tProp('enum', 'yksi', Prop.enum, Prop.enum.values('yksi', 'kaksi', 'kolme', 'neljä')),\n\t\tProp('topBarHelper', new Vector(0, 1), Prop.vector),\n\t\tProp('test' + ++vari, vari, Prop.int),\n\t\tProp('test' + ++vari, false, Prop.bool),\n\t\tProp('test' + ++vari, true, Prop.bool)\n\t]\n});\n","import { Component, Prop } from '../core/component';\nimport { key, keyPressed } from '../util/input';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Mover',\n\tproperties: [\n\t\tProp('change', new Vector(10, 10), Prop.vector),\n\t\tProp('userControlled', false, Prop.bool),\n\t\tProp('speed', 1, Prop.float),\n\t\tProp('rotationSpeed', 0, Prop.float, 'Degrees per second', Prop.flagDegreesInEditor)\n\t],\n\tprototype: {\n\t\tonUpdate(dt, t) {\n\t\t\tif (this.userControlled) {\n\t\t\t\tif (!this.entity.localMaster) return;\n\t\t\t\t\n\t\t\t\tlet dx = 0;\n\t\t\t\tlet dy = 0;\n\t\t\t\t\n\t\t\t\tif (keyPressed(key.left)) dx -= 1;\n\t\t\t\tif (keyPressed(key.right)) dx += 1;\n\t\t\t\tif (keyPressed(key.up)) dy -= 1;\n\t\t\t\tif (keyPressed(key.down)) dy += 1;\n\t\t\t\tif (dx) this.Transform.position.x += dx * this.speed * dt;\n\t\t\t\tif (dy) this.Transform.position.y += dy * this.speed * dt;\n\t\t\t\tif (dx || dy) {\n\t\t\t\t\tthis.Transform.position = this.Transform.position;\n\t\t\t\t}\n\t\t\t\tif (dx && this.rotationSpeed) {\n\t\t\t\t\tthis.Transform.angle += dt * dx * this.rotationSpeed;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet change = new Vector(dt, 0).rotate(t * this.speed).multiply(this.change);\n\t\t\t\tthis.Transform.position.set(this.Transform.position).add(change);\n\t\t\t\t\n\t\t\t\tif (this.rotationSpeed)\n\t\t\t\t\tthis.Transform.angle += dt * this.rotationSpeed;\n\t\t\t}\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Rect',\n\ticon: 'fa-stop',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('size', new Vector(10, 10), Prop.vector),\n\t\tProp('style', 'red', Prop.string),\n\t\tProp('randomStyle', false, Prop.bool)\n\t],\n\tprototype: {\n\t\tinit() {\n\t\t\tif (this.randomStyle)\n\t\t\t\tthis.style = `hsl(${Math.random()*360 | 0}, 100%, 40%)`;\n\t\t},\n\t\tonDraw(context) {\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - this.size.x/2 * this.Transform.scale.x,\n\t\t\t\ty = this.Transform.position.y - this.size.y/2 * this.Transform.scale.y,\n\t\t\t\tw = this.size.x * this.Transform.scale.x,\n\t\t\t\th = this.size.y * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = this.style;\n\t\t\tcontext.translate(x+w/2, y+h/2);\n\t\t\tcontext.rotate(this.Transform.angle);\n\t\t\tcontext.fillRect(-w/2, -h/2, w, h);\n\t\t\tcontext.restore();\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport EntityPrototype from '../core/entityPrototype';\n\nComponent.register({\n\tname: 'Spawner',\n\tproperties: [\n\t\tProp('typeName', '', Prop.string)\n\t],\n\tprototype: {\n\t\tonStart() {\n\t\t\tthis.spawn();\n\t\t},\n\t\tonDrawHelper(context) {\n\t\t\tlet size = 30;\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - size * this.Transform.scale.x/2,\n\t\t\t\ty = this.Transform.position.y - size * this.Transform.scale.y/2,\n\t\t\t\tw = size * this.Transform.scale.x,\n\t\t\t\th = size * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = 'blue';\n\t\t\tcontext.strokeStyle = 'white';\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.font = '40px FontAwesome';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.fillText('\\uf21d', this.Transform.position.x + 2, this.Transform.position.y);\n\t\t\tcontext.strokeText('\\uf21d', this.Transform.position.x + 2, this.Transform.position.y);\n\t\t\t\n\t\t\tcontext.restore();\n\t\t},\n\t\tspawn() {\n\t\t\tlet prototype = this.game.findChild('prt', prt => prt.name === this.typeName);\n\t\t\tif (!prototype)\n\t\t\t\treturn;\n\n\t\t\tEntityPrototype.createFromPrototype(prototype).spawnEntityToScene(this.Transform.position);\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\n\nComponent.register({\n\tname: 'Trigger',\n\tallowMultiple: true,\n\tproperties: [\n\t\tProp('trigger', 'playerComesNear', Prop.enum, Prop.enum.values('playerComesNear')),\n\t\tProp('radius', 40, Prop.float, Prop.float.range(0, 1000), Prop.visibleIf('trigger', 'playerComesNear')),\n\t\tProp('action', 'win', Prop.enum, Prop.enum.values('win'))\n\t],\n\tprototype: {\n\t\tonDrawHelper(context) {\n\t\t\tlet size = 30;\n\t\t\tlet\n\t\t\t\tx = this.Transform.position.x - size * this.Transform.scale.x/2,\n\t\t\t\ty = this.Transform.position.y - size * this.Transform.scale.y/2,\n\t\t\t\tw = size * this.Transform.scale.x,\n\t\t\t\th = size * this.Transform.scale.y;\n\t\t\tcontext.save();\n\t\t\tcontext.fillStyle = 'blue';\n\t\t\tcontext.strokeStyle = 'white';\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.font = '40px FontAwesome';\n\t\t\tcontext.textAlign = 'center';\n\t\t\tcontext.fillText('\\uf085', this.Transform.position.x, this.Transform.position.y + 15);\n\t\t\tcontext.strokeText('\\uf085', this.Transform.position.x, this.Transform.position.y + 15);\n\t\t\t\n\t\t\tcontext.restore();\n\t\t},\n\t\tpreInit() {\n\t\t\tthis.storeProp = `__Trigger_${this._componentId}`;\n\t\t},\n\t\tonUpdate() {\n\t\t\tif (this.trigger === 'playerComesNear') {\n\t\t\t\tlet componentSet = this.scene.getComponents('Mover');\n\t\t\t\tlet entities = [];\n\t\t\t\tcomponentSet.forEach(c => entities.push(c.entity));\n\t\t\t\tlet distSq = this.radius * this.radius;\n\t\t\t\tlet pos = this.Transform.position;\n\t\t\t\tfor (let i = 0; i < entities.length; ++i) {\n\t\t\t\t\tif (entities[i].position.distanceSq(pos) < distSq) {\n\t\t\t\t\t\tif (!entities[i][this.storeProp] && this.launchTrigger(entities[i]) === false)\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tentities[i][this.storeProp] = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentities[i][this.storeProp] = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Return false if other triggers should not be checked\n\t\tlaunchTrigger(entity) {\n\t\t\tif (this.action === 'win') {\n\t\t\t\tthis.scene.win();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n});\n","import { Component, Prop } from '../core/component';\nimport Vector from '../util/vector';\nimport p2, { addBody, deleteBody, createMaterial } from '../feature/physicsP2';\n\nconst PHYSICS_SCALE = 1/50;\n\nconst type = {\n\tdynamic: p2.Body.DYNAMIC,\n\tkinematic: p2.Body.KINEMATIC,\n\tstatic: p2.Body.STATIC\n};\n\nComponent.register({\n\tname: 'Physics',\n\ticon: 'fa-stop',\n\tallowMultiple: false,\n\tproperties: [\n\t\tProp('type', 'dynamic', Prop.enum, Prop.enum.values('dynamic', 'static')),\n\t\tProp('density', 1, Prop.float, Prop.float.range(0, 100), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('startStill', false, Prop.bool, Prop.visibleIf('type', 'dynamic')),\n\t\tProp('drag', 0.1, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('rotationalDrag', 0.1, Prop.float, Prop.float.range(0, 1), Prop.visibleIf('type', 'dynamic')),\n\t\tProp('bounciness', 0, Prop.float, Prop.float.range(0, 1)),\n\t\tProp('friction', 0.1, Prop.float, Prop.float.range(0, 1))\n\t],\n\trequirements: [\n\t\t'Rect'\n\t],\n\trequiesInitWhenEntityIsEdited: true,\n\tprototype: {\n\t\tinit() {\n\t\t\tlet update = callback => {\n\t\t\t\treturn value => {\n\t\t\t\t\tif (!this.updatingOthers && this.body) {\n\t\t\t\t\t\tcallback(value);\n\t\t\t\t\t\tif (this.type === 'dynamic')\n\t\t\t\t\t\t\tthis.body.wakeUp();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.listenProperty(this.Transform, 'position', update(position => this.body.position = position.toArray().map(x => x * PHYSICS_SCALE)));\n\t\t\tthis.listenProperty(this.Transform, 'angle', update(angle => this.body.angle = angle));\n\t\t\tthis.listenProperty(this, 'density', update(density => {\n\t\t\t\tthis.body.setDensity(density);\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'friction', update(friction => this.updateMaterial()));\n\t\t\tthis.listenProperty(this, 'drag', update(drag => this.body.damping = drag));\n\t\t\tthis.listenProperty(this, 'type', update(type => {\n\t\t\t\tthis.body.type = type[this.type];\n\t\t\t\tthis.entity.sleep();\n\t\t\t\tthis.entity.wakeUp();\n\t\t\t\t// this.body.setDensity(this.density);\n\t\t\t}));\n\t\t\tthis.listenProperty(this, 'bounciness', update(bounciness => this.updateMaterial()));\n\n\t\t\tif (this._isInTree)\n\t\t\t\tthis.createBody();\n\t\t},\n\t\tcreateBody() {\n\t\t\tthis.body = new p2.Body({\n\t\t\t\ttype: type[this.type],\n\t\t\t\tposition: [this.Transform.position.x * PHYSICS_SCALE, this.Transform.position.y * PHYSICS_SCALE],\n\t\t\t\tangle: this.Transform.angle,\n\t\t\t\tvelocity: [0, 0],\n\t\t\t\tangularVelocity: 0,\n\t\t\t\tsleepTimeLimit: 0.5,\n\t\t\t\tsleepSpeedLimit: 0.3,\n\t\t\t\tdamping: this.drag,\n\t\t\t\tangularDamping: this.rotationalDrag\n\t\t\t});\n\t\t\tthis.body.entity = this.entity;\n\t\t\tlet shape = new p2.Box({\n\t\t\t\twidth: this.Rect.size.x * PHYSICS_SCALE,\n\t\t\t\theight: this.Rect.size.y * PHYSICS_SCALE\n\t\t\t});\n\t\t\tthis.body.addShape(shape);\n\t\t\tthis.updateMaterial();\n\t\t\t\n\t\t\tif (this.type === 'dynamic')\n\t\t\t\tthis.body.setDensity(this.density);\n\t\t\t\n\t\t\taddBody(this.scene, this.body);\n\t\t},\n\t\tupdateMaterial() {\n\t\t\tlet material = createMaterial(this.scene, {\n\t\t\t\tfriction: this.friction,\n\t\t\t\trestitution: this.bounciness,\n\t\t\t\t// stiffness: 1e6,\n\t\t\t\t// relaxation: 4,\n\t\t\t\t// frictionStiffness: 1e6,\n\t\t\t\t// frictionRelaxation: 4,\n\t\t\t\t// surfaceVelocity: 0\n\t\t\t});\n\t\t\tthis.body.shapes.forEach(s => s.material = material);\n\t\t},\n\t\tonStart() {\n\t\t\tif (this.startStill && this.type === 'dynamic')\n\t\t\t\tthis.body.sleep();\n\t\t},\n\t\tsetInTreeStatus(inTree) {\n\t\t\tif (inTree)\n\t\t\t\tthis.createBody();\n\t\t\treturn Component.prototype.setInTreeStatus.call(this, ...arguments);\n\t\t},\n\t\tonUpdate() {\n\t\t\tif (!this.body || this.body.sleepState === p2.Body.SLEEPING)\n\t\t\t\treturn;\n\n\t\t\tthis.updatingOthers = true;\n\t\t\tthis.Transform.position = Vector.fromArray(this.body.position).divideScalar(PHYSICS_SCALE);\n\t\t\tthis.Transform.angle = this.body.angle;\n\t\t\tthis.updatingOthers = false;\n\t\t},\n\t\tsleep() {\n\t\t\tif (this.body) {\n\t\t\t\tdeleteBody(this.scene, this.body);\n\t\t\t\tthis.body = null;\n\t\t\t}\n\t\t}\n\t}\n});\n"],"names":["createStringId","threeLetterPrefix","characters","let","id","i","CHARACTERS","Math","random","CHAR_COUNT","addSerializable","serializable","assert","undefined","serializables","getSerializable","removeSerializable","Error","getChangeOrigin","origin","setChangeOrigin","_origin","addChange","type","reference","change","external","externalChange","changeType","setPropertyValue","value","_value","move","parent","_parent","addSerializableToTree","previousOrigin","listeners","forEach","l","executeExternal","callback","addChangeListener","push","packChange","packedChange","packed","parentId","toJSON","propertyType","Object","keys","keyToShortKey","key","e","console","log","unpackChange","shortKey","shortKeyToKey","error","executeChange","newScene","fromJSON","obj","Serializable","addChild","threeLetterType","localMaster","deleteAllChildren","deleteChildren","deleteSerializable","delete","play","condition","message","stack","createPropertyType","propertyName","defaultValue","validator","validators","default","description","flags","visibleIf","optionalParameters","p","idx","validate","isFlag","PropertyType","createFlag","func","createDataType","ref","x","name","clone","createType","validatorName","createValidator","validatorFunction","parameters","validatorParameters","validateFloat","val","isNaN","Infinity","createWorld","owner","options","_p2World","p2","World","gravity","sleepMode","BODY_SLEEPING","updateWorld","dt","step","deleteWorld","clear","_p2Materials","addBody","body","deleteBody","removeBody","createMaterial","materials","assign","defaultMaterialOptions","hash","friction","restitution","stiffness","relaxation","frictionStiffness","frictionRelaxation","surfaceVelocity","join","material","Material","h","m","o1","o2","contactMaterial","ContactMaterial","min","max","addContactMaterial","keyPressed","setNetworkEnabled","enabled","networkEnabled","startSceneWhenGameLoaded","shouldStartSceneWhenGameLoaded","isInSceneTree","getRoot","getQueryVariable","variable","query","window","location","search","substring","vars","split","length","pair","decodeURIComponent","tryToLoad","io","setTimeout","socket","changes","valueChanges","duplicateChange","splice","indexOf","setInterval","packedChanges","map","emit","on","serverStartTime","game","clientStartTime","Date","now","requiredClientTime","reload","gameData","localStorage","anotherGameId","history","replaceState","scene","getChildren","createScene","listen","gameId","resizeCanvas","canvas","width","innerWidth","height","innerHeight","isClient","isServer","module","const","serializableClasses","Map","predefinedId","skipSerializableRegistering","this","_children","_listeners","_isInTree","isRoot","_state","STATE_CONSTRUCTOR","STATE_PREDEFINEDID","startsWith","serializableManager.addSerializable","deleteChild","_alive","serializableManager.removeSerializable","STATE_DESTROY","size","array","child","serializableManager.addChange","serializableManager.changeType","initWithChildren","children","STATE_INIT","addChildren","_addChild","STATE_ADDCHILD","get","set","STATE_ADDPARENT","setInTreeStatus","findChild","filterFunction","find","findParent","element","_detachChild","forEachChild","deep","processArray","newParent","_detach","getParent","json","arrays","Array","from","sort","a","b","c","concat","toString","JSON","stringify","constructor","STATE_CLONE","event","hasOwnProperty","unshift","index","this$1","dispatch","apply","args","hasDescendant","isInTree","force","filter","Boolean","STATE_FROMJSON","registerSerializable","Class","prototype","defineProperty","info","states","logState","state","stateString","createDebugObject","debug","debugChildArray","k","Property","super","_initialValue","setPropertyType","_initialValueIsJSON","initialValue","v","n","newValue","f","getFlag","flag","createProperty","dataType","flagDegreesInEditor","Vector","y","add","vec","subtract","multiply","multiplyScalar","scalar","divide","divideScalar","dot","sqrt","lengthSq","setLength","newLength","oldLength","getProjectionOn","distance","dx","dy","distanceSq","normalize","horizontalAngle","atan2","verticalAngle","rotate","angle","cos","sin","rotateTo","isEqualTo","isZero","toArray","fromObject","fromArray","FLOAT_JSON_PRECISION_MULTIPLIER","pow","float","parseFloat","range","modulo","round","int","parseInt","vector","string","String","bool","enum","values","isArray","PropertyOwner","_propertyTypes","_properties","initWithPropertyValues","propName","_propertyTypesByName","propChildren","otherChildren","invalidPropertiesCount","prop","isInvalid","nameToProp","componentName","defineProperties","propertyTypes","ALIVE_ERROR","Entity","components","sleeping","getComponent","getComponents","getListOfAllComponents","entity","addComponents","_name","initComponents","_preInit","_init","makeComponentsSleep","_sleep","deleteComponents","sleep","wakeUp","deleteComponent","component","compArray","comp","proto","position","ComponentData","componentClassName","predefinedComponentId","componentClass","componentClasses","allowMultiple","componentId","newComponentId","cloneComponentId","cid","getInheritedProperties","_depth","properties","parentComponentData","getParentComponentData","parentPrototype","getParentPrototype","componentData","getPropertyOrCreate","property","prp","getProperty","setValue","getValue","createComponent","Component","create","_componentId","Prop","Prototype","arguments","previouslyCreatedEntity","cda","getInheritedComponentDatas","getDataFromPrototype","data","ownComponentData","propertyHash","generatedForPrototype","originalPrototype","inheritedComponentData","localeCompare","createAndAddPropertyForComponentData","propertyValue","componentDataIsNew","findComponentDataByComponentId","alsoFindFromParents","getOwnComponentDataOrInherit","findOwnProperty","createEntity","inheritedComponentDatas","createWithInheritedComponentData","countEntityPrototypes","findParents","count","levels","entityPrototypes","j","prt","_game","lvl","items","Game","warn","require","physicsOptions","enableSleeping","Scene","document","querySelector","context","getContext","level","animationFrameId","playing","time","draw","win","reset","animFrame","playCalled","timeInMilliseconds","performance","t","_prevUpdate","requestAnimFrame","requestAnimationFrame","clearRect","isInInitialState","resetting","pause","cancelAnimationFrame","addComponent","Set","removeComponent","_listenRemoveFunctions","requirements","r","funcName","preInit","init","listenProperty","createComponentData","pt","reservedPropertyNames","reservedPrototypeMembers","register","has","constructorFunction","deleteFunction","Com","parentClass","category","icon","num","reduce","prev","curr","charCodeAt","color","EntityPrototype","getTransform","transform","scale","Transform","childArrays","floatToJSON","handleProperty","w","spawnEntityToScene","createFromPrototype","componentDatas","entityPrototype","nameId","transformId","positionId","scaleId","angleId","transformData","transformClass","Level","predefinedSceneObject","entities","epr","PI","onStart","positionVariance","scaleVariance","angleVariance","vari","left","right","up","down","ctrl","appleLeft","appleRight","alt","shift","space","d","g","o","q","s","u","z","0","1","9","backspace","enter","esc","keyDownListeners","keyUpListeners","onkeydown","keyCode","which","activeElement","nodeName","toLowerCase","onkeyup","onUpdate","userControlled","speed","rotationSpeed","randomStyle","style","onDraw","save","fillStyle","translate","fillRect","restore","spawn","onDrawHelper","strokeStyle","lineWidth","font","textAlign","fillText","strokeText","typeName","storeProp","trigger","componentSet","distSq","radius","pos","launchTrigger","action","dynamic","Body","DYNAMIC","kinematic","KINEMATIC","static","STATIC","requiesInitWhenEntityIsEdited","update","updatingOthers","density","setDensity","updateMaterial","drag","damping","bounciness","createBody","velocity","angularVelocity","sleepTimeLimit","sleepSpeedLimit","angularDamping","rotationalDrag","shape","Box","Rect","addShape","shapes","startStill","inTree","call","argsArray","sleepState","SLEEPING","addEventListener"],"mappings":"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"}