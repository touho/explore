function assert(t,e){if(!t)throw new Error(e)}function addSerializable(t){if(serializables.has(t.id))throw new Error("Serializable id clash!");serializables.set(t.id,t)}function removeSerializable(t){if(!serializables.delete(t))throw new Error("Serializable not found!")}function char(){return BASE_64_CHARACTERS[Math.random()*CHAR_COUNT|0]}function createStringId(t,e){void 0===t&&(t="???"),void 0===e&&(e=16);for(var o=t,r=e-1;0!==r;--r)o+=char();return o}function PropertyType(t,e,o){for(var r=[],n=arguments.length-3;n-- >0;)r[n]=arguments[n+3];o=o();var i=o.validators.default(),a="";return r.forEach(function(t){"string"==typeof t?a=t:t&&t.validate?i=t:assert(!1,"invalid parameter "+t)}),new PropertyModel(t,o,i,e)}function addType(t){var e=t.name;void 0===e&&(e="");var o=t.validators;void 0===o&&(o={default:function(t){return t}});var r=t.toJSON;void 0===r&&(r=function(t){return t});var n=t.fromJSON;void 0===n&&(n=function(t){return t}),assert(e,"name missing from property type"),assert("function"==typeof o.default,"default validator missing from property type: "+e),assert("function"==typeof r,"invalid toJSON for property type: "+e),assert("function"==typeof n,"invalid fromJSON for property type: "+e);var i={name:e,validators:o,toJSON:r,fromJSON:n},a=function(){return i};Object.keys(o).forEach(function(t){a[t]=createValidator(t,o[t]),o[t]=a[t]}),PropertyType[e]=a}function createValidator(t,e){var o=function(){for(var o=arguments.length,r=Array(o);o--;)r[o]=arguments[o];var n=[].concat(r);return{validatorName:t,validatorParameters:n,validate:function(t){return e.apply(void 0,[t].concat(n))}}};return o.validatorName=t,o.validate=e,o}function createElement(t,e){for(var o,r,n,i=0,a=0,s=0;s<=t.length;s++){var l=t.charCodeAt(s);if(l===HASH||l===DOT||!l){if(0===i)o=0===s?"div":l?t.substring(a,s):t;else{var p=t.substring(a,s);1===i?r=p:n?n+=" "+p:n=p}a=s+1,i=l===HASH?1:2}}var u=e?document.createElementNS(e,o):document.createElement(o);return r&&(u.id=r),n&&(u.className=n),u}function text(t){return document.createTextNode(t)}function mount(t,e,o){var r=t.el||t,n=e.el||e;n.__redom_list&&(n=n.el),e===n&&n.__redom_view&&(e=n.__redom_view),e!==n&&(n.__redom_view=e),e.isMounted?e.remount&&e.remount():e.mount&&e.mount(),o?r.insertBefore(n,o.el||o):r.appendChild(n),e.isMounted?e.remounted&&e.remounted():(e.isMounted=!0,e.mounted&&e.mounted())}function unmount(t,e){var o=t.el||t,r=e.el||e;e===r&&r.__redom_view&&(e=r.__redom_view),e.unmount&&e.unmount(),o.removeChild(r),e.isMounted=!1,e.unmounted&&e.unmounted()}function el(t){var e,o=arguments;if("string"==typeof t)e=(elcache[t]||(elcache[t]=createElement(t))).cloneNode(!1);else{if(!t||!t.nodeType)throw new Error("At least one argument required");e=t.cloneNode(!1)}for(var r=!0,n=1;n<arguments.length;n++){var i=o[n];if(i)if("function"==typeof i)i(e);else if("string"==typeof i||"number"==typeof i)r?(r=!1,e.textContent=i):e.appendChild(text(i));else if(i.nodeType||i.el&&i.el.nodeType)r=!1,mount(e,i);else if(i.length){r=!1;for(var a=0;a<i.length;a++)mount(e,i[a])}else if("object"==typeof i)for(var s in i){var l=i[s];if("style"===s)if("string"==typeof l)e.setAttribute(s,l);else for(var p in l)e.style[p]=l[p];else s in e||"function"==typeof l?e[s]=l:e.setAttribute(s,l)}}return e}function setChildren(t,e){for(var o=t.el||t,r=o.firstChild,n=0;n<e.length;n++){var i=e[n];if(i){var a=i.el||i;a!==r?mount(t,i,r):r=r.nextSibling}}for(;r;){var s=r.nextSibling;unmount(t,r),r=s}}var serializables=new Map,BASE_64_CHARACTERS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",CHAR_COUNT=BASE_64_CHARACTERS.length,Serializable=function(t,e){void 0===e&&(e=!1),e?this.id=e:this.id=createStringId(t),addSerializable(this)};Serializable.prototype.delete=function(){removeSerializable(this.id)},Serializable.prototype.toJSON=function(){return{id:this.id}},Serializable.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,4)},Serializable.fromJSON=function(t){return assert("string"==typeof t.id),new Serializable(null,t.id)};var ALIVE_ERROR="entity is already dead",Entity=function(t){function e(){t.call(this,"ent"),this.components=new Map,this.alive=!0,this.sleeping=!1,this.prototype=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getComponent=function(t){assert(this.alive,ALIVE_ERROR);var e=this.components.get(t);return void 0!==e?e[0]:null},e.prototype.getComponents=function(t){return assert(this.alive,ALIVE_ERROR),this.components.get(t)||[]},e.prototype.addComponents=function(t){var o=this;assert(this.alive,ALIVE_ERROR),assert(Array.isArray(t),"Parameter is not an array.");for(var r=0;r<t.length;r++){var n=o.components.get(t[r].name)||o.components.set(t[r].name,[]).get(t[r].name);n.push(t[r])}return this.sleeping||e.initComponents(t),this},e.initComponents=function(t){for(var e=0;e<t.length;e++)t[e]._preInit();for(var o=0;o<t.length;o++)t[o]._init()},e.makeComponentsSleep=function(t){for(var e=0;e<t.length;e++)t[e]._sleep()},e.deleteComponents=function(t){for(var e=0;e<t.length;e++)t[e].delete()},e.prototype.sleep=function(){var t=this;if(assert(this.alive,ALIVE_ERROR),this.sleeping)return!1;for(var o=0,r=t.components;o<r.length;o+=1){var n=r[o];e.makeComponentsSleep(n)}return this.sleeping=!0,!0},e.prototype.wakeUp=function(){var t=this;if(assert(this.alive,ALIVE_ERROR),!this.sleeping)return!1;for(var o=0,r=t.components;o<r.length;o+=1){var n=r[o];e.initComponents(n)}return this.sleeping=!1,!0},e.prototype.delete=function(){var o=this;assert(this.alive,ALIVE_ERROR),this.sleep(),t.prototype.delete.call(this),this.alive=!1;for(var r=0,n=o.components;r<n.length;r+=1){var i=n[r];e.deleteComponents(i)}this.components.clear()},e.prototype.toJSON=function(){return assert(this.alive,ALIVE_ERROR),Object.assign(t.prototype.toJSON.call(this),{components:[]})},e}(Serializable),PropertyModel=function(t){function e(e,o,r,n){assert("string"==typeof e),assert("string"==typeof o.name),assert("function"==typeof r.validate),t.call(this,"pmo"),this.name=e,this.type=o,this.validator=r,this.initialValue=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return Object.assign(t.prototype.toJSON.call(this),{name:this.name,type:this.type.name,validatorName:this.validator.validatorName,validatorParameters:this.validator.validatorParameters,initialValue:this.type.toJSON(this.initialValue)})},e.prototype.delete=function(){t.prototype.delete.call(this),this.type=null,this.validator=null},e}(Serializable);addType({name:"float",validators:{default:function(t){return t=parseFloat(t),assert(!isNaN(t),"invalid float: "+t),t},range:function(t,e,o){return t=parseFloat(t),assert(!isNaN(t),"invalid float: "+t),Math.min(o,Math.max(e,t))}},toJSON:function(t){return t},fromJSON:function(t){return t}}),addType({name:"string",validators:{default:function(t){return String(t)}},toJSON:function(t){return t},fromJSON:function(t){return t}}),function(){var t=new Serializable("tes"),e=t.id;assert("string"==typeof e&&e.length>10);var o=t.toJSON();assert(o&&"object"==typeof o&&"string"==typeof o.id),t.delete(),t=Serializable.fromJSON(o),assert("string"==typeof t.id&&t.id.length>10&&t.id===e),console.log("Serializable tests OK")}(),function(){var t=new Entity;assert(0===t.components.size),assert(null===t.getComponent("moi")),assert(0===t.getComponents("moi").length),console.log("Entity tests OK")}(),function(){assert(4===PropertyType.float.default().validate("4")),assert(1===PropertyType.float.range(0,1).validate(3)),console.log("PropertyType tests OK")}();var HASH="#".charCodeAt(0),DOT=".".charCodeAt(0),elcache={};el.extend=function(t){var e=elcache[t]||(elcache[t]=createElement(t));return el.bind(this,e)};var Router=function(t,e){this.el="string"==typeof t?el(t):t,this.Views=e};Router.prototype.update=function(t,e){if(t!==this.route){var o=this.Views,r=o[t];this.view=r&&new r,this.route=t,setChildren(this.el,[this.view])}this.view&&this.view.update&&this.view.update(e)};var Layout=function(){this.el=el("div.editorLayout",el("div.leftCenter",this.top=new Top,el("div.middle",this.left=new Left,this.center=new Center),this.bottom=new Bottom),this.right=new Right)};Layout.prototype.update=function(t){this.top.update(t.top),this.left.update(t.left),this.center.update(t.center),this.right.update(t.right),this.bottom.update(t.bottom)};var Top=function(){this.el=el("div.top")};Top.prototype.update=function(t){};var Left=function(){this.el=el("div.left")};Left.prototype.update=function(t){};var Center=function(){this.el=el("div.center")};Center.prototype.update=function(t){};var Right=function(){this.el=el("div.right")};Right.prototype.update=function(t){};var Bottom=function(){this.el=el("div.bottom")};Bottom.prototype.update=function(t){};var layout=new Layout;mount(document.body,layout),console.log("joo");var Property=function(t){function e(e){t.call(this,"pro"),this.model=e,this.value=e.initialValue}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return Object.assign(t.prototype.toJSON.call(this),{value:this.type.toJSON(this.value),modelId:this.model.id})},e.prototype.delete=function(){t.prototype.delete.call(this),this.model=null},e}(Serializable);Object.defineProperty(Property.prototype,"type",{get:function(){return this.model.type}}),Object.defineProperty(Property.prototype,"value",{set:function(t){this._value=this.model.validator.validate(t)},get:function(){return this._value}}),Object.defineProperty(Property.prototype,"initialValue",{get:function(){return this.model.initialValue}});var componentClasses=new Map,Component=function(t){function e(e,o,r){var n=this;t.call(this,"com"),this.entity=o,this.env=r,this.children={},this._properties={},this._componentModel=e,this.constructor.propertyModels.forEach(function(t){n._properties[t.name]=new Property(t)})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.delete=function(){assert(!this.env.entity.alive,"Do not call Component.delete!"),t.prototype.delete.call(this)},e.prototype._preInit=function(){var t=this;this.constructor.requirements.forEach(function(e){t[e]=t.entity.getComponent(e),assert(t[e],"required component not found")}),this._forEachChildComponent(function(t){return t._preInit()});try{"function"==typeof this.preInit&&this.preInit()}catch(t){console.error(this.entity,this.constructor.name,"preInit",t)}},e.prototype._init=function(){this._forEachChildComponent(function(t){return t._init()});try{"function"==typeof this.init&&this.init()}catch(t){console.error(this.entity,this.constructor.name,"init",t)}},e.prototype._sleep=function(){try{"function"==typeof this.sleep&&this.sleep()}catch(t){console.error(this.entity,this.constructor.name,"sleep",t)}this._forEachChildComponent(function(t){return t._sleep()})},e.prototype._forEachChildComponent=function(t){var e=this;Object.keys(this.children).forEach(function(o){var r=e.children[o];Array.isArray(r)?r.forEach(t):t(r)})},e}(Serializable);Component.reservedPropertyNames=new Set(["children","delete","entity","env","init","preInit","sleep"]),Component.register=function(t,e){void 0===e&&(e={});var o=e.properties;void 0===o&&(o=[]);var r=e.category;void 0===r&&(r="Other");var n=e.requirements;void 0===n&&(n=[]);var i=e.children;void 0===i&&(i=[]),assert(!componentClasses.has(t.name),"Duplicate component class "+t.name),t.propertyModels=o,t.category=r,t.requirements=n,t.children=i,t.propertyModels.forEach(function(e){assert(!Component.reservedPropertyNames.has(e.name),"Can not have property called "+e.name),assert(void 0===t.prototype[e.name],"Name "+e.name+" clashes "),Object.defineProperty(t.prototype,e.name,{get:function(){return this._properties[e.name].value},set:function(t){this._properties[e.name].value=t}})}),componentClasses.set(t.name,t)};var properties=[PropertyType("x",0,PropertyType.float),PropertyType("y",0,PropertyType.float)],Position=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Component);Component.register(Position,{properties:properties,category:"Core"}),window.Property=Property,window.PropertyModel=PropertyModel,window.PropertyType=PropertyType;
//# sourceMappingURL=engine.dev.min.js.map
